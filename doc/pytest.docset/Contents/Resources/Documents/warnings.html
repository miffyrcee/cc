


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Warnings Capture &#8212; pytest documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/pygments_pytest.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Doctest integration for modules and test files" href="doctest.html" />
    <link rel="prev" title="Capturing of the stdout/stderr output" href="capture.html" />
  <script>DOCUMENTATION_OPTIONS.URL_ROOT = './';</script>
   
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="doctest.html" title="Doctest integration for modules and test files"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="capture.html" title="Capturing of the stdout/stderr output"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="contents.html">pytest-6.2</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Warnings Capture</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="warnings-capture">
<span id="warnings"></span><h1>Warnings Capture<a class="headerlink" href="#warnings-capture" title="Permalink to this headline">¶</a></h1>
<p>Starting from version <code class="docutils literal notranslate"><span class="pre">3.1</span></code>, pytest now automatically catches warnings during test execution
and displays them at the end of the session:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of test_show_warnings.py</span>
<span class="kn">import</span> <span class="nn">warnings</span>


<span class="k">def</span> <span class="nf">api_v1</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">(</span><span class="s2">&quot;api v1, should use functions from v2&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">test_one</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">api_v1</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Running pytest now produces this output:</p>
<div class="highlight-pytest notranslate"><div class="highlight"><pre><span></span>$ pytest test_show_warnings.py
<span class=" -Color -Color-Bold">=========================== test session starts ============================</span>
platform linux -- Python 3.x.y, pytest-6.x.y, py-1.x.y, pluggy-1.x.y
cachedir: $PYTHON_PREFIX/.pytest_cache
rootdir: $REGENDOC_TMPDIR
collected 1 item

test_show_warnings.py <span class=" -Color -Color-Green">.</span>                                              <span class=" -Color -Color-Green">[100%]</span>

<span class=" -Color -Color-Yellow">============================= warnings summary =============================</span>
test_show_warnings.py::test_one
  $REGENDOC_TMPDIR/test_show_warnings.py:5: UserWarning: api v1, should use functions from v2
    warnings.warn(UserWarning(&quot;api v1, should use functions from v2&quot;))

-- Docs: https://docs.pytest.org/en/stable/warnings.html
<span class=" -Color -Color-Yellow">======================= </span><span class=" -Color -Color-Green">1 passed</span>, <span class=" -Color -Color-Bold -Color-Bold-Yellow">1 warning</span><span class=" -Color -Color-Yellow"> in 0.12s =======================</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-W</span></code> flag can be passed to control which warnings will be displayed or even turn
them into errors:</p>
<div class="highlight-pytest notranslate"><div class="highlight"><pre><span></span>$ pytest -q test_show_warnings.py -W error::UserWarning
<span class=" -Color -Color-Red">F</span>                                                                    <span class=" -Color -Color-Red">[100%]</span>
================================= FAILURES =================================
<span class=" -Color -Color-Bold -Color-Bold-Red">_________________________________ test_one _________________________________</span>

    def test_one():
&gt;       assert api_v1() == 1

<span class=" -Color -Color-Bold -Color-Bold-Red">test_show_warnings.py</span>:10:
<span class=" -Color -Color-Bold -Color-Bold-Red">_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</span>

    def api_v1():
&gt;       warnings.warn(UserWarning(&quot;api v1, should use functions from v2&quot;))
<span class=" -Color -Color-Bold -Color-Bold-Red">E       UserWarning: api v1, should use functions from v2</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_show_warnings.py</span>:5: UserWarning
========================= short test summary info ==========================
FAILED test_show_warnings.py::test_one - UserWarning: api v1, should use ...
<span class=" -Color -Color-Bold -Color-Bold-Red">1 failed</span><span class=" -Color -Color-Red"> in 0.12s</span>
</pre></div>
</div>
<p>The same option can be set in the <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code> or <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file using the
<code class="docutils literal notranslate"><span class="pre">filterwarnings</span></code> ini option. For example, the configuration below will ignore all
user warnings and specific deprecation warnings matching a regex, but will transform
all other warnings into errors.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">filterwarnings</span> <span class="o">=</span>
    <span class="na">error</span>
    <span class="na">ignore::UserWarning</span>
    <span class="na">ignore:function ham\(\) is deprecated:DeprecationWarning</span>
</pre></div>
</div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="c1"># pyproject.toml</span>
<span class="k">[tool.pytest.ini_options]</span>
<span class="n">filterwarnings</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&quot;error&quot;</span><span class="p">,</span>
    <span class="s">&quot;ignore::UserWarning&quot;</span><span class="p">,</span>
    <span class="c1"># note the use of single quote below to denote &quot;raw&quot; strings in TOML</span>
    <span class="s">&#39;ignore:function ham\(\) is deprecated:DeprecationWarning&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>When a warning matches more than one option in the list, the action for the last matching option
is performed.</p>
<p>Both <code class="docutils literal notranslate"><span class="pre">-W</span></code> command-line option and <code class="docutils literal notranslate"><span class="pre">filterwarnings</span></code> ini option are based on Python’s own
<a class="reference external" href="https://docs.python.org/3/using/cmdline.html#cmdoption-w">-W option</a> and <a class="reference external" href="https://docs.python.org/3/library/warnings.html#warnings.simplefilter">warnings.simplefilter</a>, so please refer to those sections in the Python
documentation for other examples and advanced usage.</p>
<div class="section" id="pytest-mark-filterwarnings">
<span id="filterwarnings"></span><h2><code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.filterwarnings</span></code><a class="headerlink" href="#pytest-mark-filterwarnings" title="Permalink to this headline">¶</a></h2>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.filterwarnings</span></code> to add warning filters to specific test items,
allowing you to have finer control of which warnings should be captured at test, class or
even module level:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>


<span class="k">def</span> <span class="nf">api_v1</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">(</span><span class="s2">&quot;api v1, should use functions from v2&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore:api v1&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_one</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">api_v1</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Filters applied using a mark take precedence over filters passed on the command line or configured
by the <code class="docutils literal notranslate"><span class="pre">filterwarnings</span></code> ini option.</p>
<p>You may apply a filter to all tests of a class by using the <code class="docutils literal notranslate"><span class="pre">filterwarnings</span></code> mark as a class
decorator or to all tests in a module by setting the <a class="reference internal" href="reference.html#globalvar-pytestmark"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytestmark</span></code></a> variable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># turns all warnings into errors for this module</span>
<span class="n">pytestmark</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Credits go to Florian Schulze for the reference implementation in the</em> <a class="reference external" href="https://github.com/fschulze/pytest-warnings">pytest-warnings</a>
<em>plugin.</em></p>
</div>
<div class="section" id="disabling-warnings-summary">
<h2>Disabling warnings summary<a class="headerlink" href="#disabling-warnings-summary" title="Permalink to this headline">¶</a></h2>
<p>Although not recommended, you can use the <code class="docutils literal notranslate"><span class="pre">--disable-warnings</span></code> command-line option to suppress the
warning summary entirely from the test run output.</p>
</div>
<div class="section" id="disabling-warning-capture-entirely">
<h2>Disabling warning capture entirely<a class="headerlink" href="#disabling-warning-capture-entirely" title="Permalink to this headline">¶</a></h2>
<p>This plugin is enabled by default but can be disabled entirely in your <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code> file with:</p>
<blockquote>
<div><div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[pytest]</span>
<span class="na">addopts</span> <span class="o">=</span> <span class="s">-p no:warnings</span>
</pre></div>
</div>
</div></blockquote>
<p>Or passing <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">no:warnings</span></code> in the command-line. This might be useful if your test suites handles warnings
using an external system.</p>
</div>
<div class="section" id="deprecationwarning-and-pendingdeprecationwarning">
<span id="deprecation-warnings"></span><h2>DeprecationWarning and PendingDeprecationWarning<a class="headerlink" href="#deprecationwarning-and-pendingdeprecationwarning" title="Permalink to this headline">¶</a></h2>
<p>By default pytest will display <code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> and <code class="docutils literal notranslate"><span class="pre">PendingDeprecationWarning</span></code> warnings from
user code and third-party libraries, as recommended by <a class="reference external" href="https://www.python.org/dev/peps/pep-0565">PEP-0565</a>.
This helps users keep their code modern and avoid breakages when deprecated warnings are effectively removed.</p>
<p>Sometimes it is useful to hide some specific deprecation warnings that happen in code that you have no control over
(such as third-party libraries), in which case you might use the warning filters options (ini or marks) to ignore
those warnings.</p>
<p>For example:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[pytest]</span>
<span class="na">filterwarnings</span> <span class="o">=</span>
    <span class="na">ignore:.*U.*mode is deprecated:DeprecationWarning</span>
</pre></div>
</div>
<p>This will ignore all warnings of type <code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> where the start of the message matches
the regular expression <code class="docutils literal notranslate"><span class="pre">&quot;.*U.*mode</span> <span class="pre">is</span> <span class="pre">deprecated&quot;</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If warnings are configured at the interpreter level, using
the <a class="reference external" href="https://docs.python.org/3/using/cmdline.html#envvar-PYTHONWARNINGS">PYTHONWARNINGS</a> environment variable or the
<code class="docutils literal notranslate"><span class="pre">-W</span></code> command-line option, pytest will not configure any filters by default.</p>
<p>Also pytest doesn’t follow <code class="docutils literal notranslate"><span class="pre">PEP-0506</span></code> suggestion of resetting all warning filters because
it might break test suites that configure warning filters themselves
by calling <code class="docutils literal notranslate"><span class="pre">warnings.simplefilter</span></code> (see issue <a class="reference external" href="https://github.com/pytest-dev/pytest/issues/2430">#2430</a>
for an example of that).</p>
</div>
</div>
<div class="section" id="ensuring-code-triggers-a-deprecation-warning">
<span id="ensuring-function-triggers"></span><span id="ensuring-a-function-triggers-a-deprecation-warning"></span><h2>Ensuring code triggers a deprecation warning<a class="headerlink" href="#ensuring-code-triggers-a-deprecation-warning" title="Permalink to this headline">¶</a></h2>
<p>You can also use <a class="reference internal" href="reference.html#pytest.deprecated_call" title="pytest.deprecated_call"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.deprecated_call()</span></code></a> for checking
that a certain function call triggers a <code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> or
<code class="docutils literal notranslate"><span class="pre">PendingDeprecationWarning</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="k">def</span> <span class="nf">test_myfunction_deprecated</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">deprecated_call</span><span class="p">():</span>
        <span class="n">myfunction</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
</pre></div>
</div>
<p>This test will fail if <code class="docutils literal notranslate"><span class="pre">myfunction</span></code> does not issue a deprecation warning
when called with a <code class="docutils literal notranslate"><span class="pre">17</span></code> argument.</p>
</div>
<div class="section" id="warns">
<span id="asserting-warnings-with-the-warns-function"></span><span id="assertwarnings"></span><span id="asserting-warnings"></span><span id="id2"></span><h2>Asserting warnings with the warns function<a class="headerlink" href="#warns" title="Permalink to this headline">¶</a></h2>
<p>You can check that code raises a particular warning using func:<code class="docutils literal notranslate"><span class="pre">pytest.warns</span></code>,
which works in a similar manner to <a class="reference internal" href="assert.html#assertraises"><span class="std std-ref">raises</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">pytest</span>


<span class="k">def</span> <span class="nf">test_warning</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;my warning&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
</pre></div>
</div>
<p>The test will fail if the warning in question is not raised. The keyword
argument <code class="docutils literal notranslate"><span class="pre">match</span></code> to assert that the exception matches a text or regex:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s1">&#39;must be 0 or None&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;value must be 0 or None&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;must be \d+$&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;value must be 42&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;must be \d+$&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;this is not here&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="gr">Failed</span>: <span class="n">DID NOT WARN. No warnings of type ...UserWarning... was emitted...</span>
</pre></div>
</div>
<p>You can also call func:<code class="docutils literal notranslate"><span class="pre">pytest.warns</span></code> on a function or code string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="n">expected_warning</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="n">expected_warning</span><span class="p">,</span> <span class="s2">&quot;func(*args, **kwargs)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The function also returns a list of all raised warnings (as
<code class="docutils literal notranslate"><span class="pre">warnings.WarningMessage</span></code> objects), which you can query for
additional information:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="ne">RuntimeWarning</span><span class="p">)</span> <span class="k">as</span> <span class="n">record</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;another warning&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>

<span class="c1"># check that only one warning was raised</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="c1"># check that the message matches</span>
<span class="k">assert</span> <span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;another warning&quot;</span>
</pre></div>
</div>
<p>Alternatively, you can examine raised warnings in detail using the
<a class="reference internal" href="#recwarn"><span class="std std-ref">recwarn</span></a> fixture (see below).</p>
<p>The <a class="reference internal" href="#recwarn"><span class="std std-ref">recwarn</span></a> fixture automatically ensures to reset the warnings
filter at the end of the test, so no global state is leaked.</p>
</div>
<div class="section" id="recwarn">
<span id="recording-warnings"></span><span id="id3"></span><h2>Recording warnings<a class="headerlink" href="#recwarn" title="Permalink to this headline">¶</a></h2>
<p>You can record raised warnings either using func:<code class="docutils literal notranslate"><span class="pre">pytest.warns</span></code> or with
the <code class="docutils literal notranslate"><span class="pre">recwarn</span></code> fixture.</p>
<p>To record with func:<code class="docutils literal notranslate"><span class="pre">pytest.warns</span></code> without asserting anything about the warnings,
pass <code class="docutils literal notranslate"><span class="pre">None</span></code> as the expected warning type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">record</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;runtime&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;user&quot;</span>
<span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;runtime&quot;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">recwarn</span></code> fixture will record warnings for the whole function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>


<span class="k">def</span> <span class="nf">test_hello</span><span class="p">(</span><span class="n">recwarn</span><span class="p">):</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">recwarn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">recwarn</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">message</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;hello&quot;</span>
    <span class="k">assert</span> <span class="n">w</span><span class="o">.</span><span class="n">filename</span>
    <span class="k">assert</span> <span class="n">w</span><span class="o">.</span><span class="n">lineno</span>
</pre></div>
</div>
<p>Both <code class="docutils literal notranslate"><span class="pre">recwarn</span></code> and func:<code class="docutils literal notranslate"><span class="pre">pytest.warns</span></code> return the same interface for recorded
warnings: a WarningsRecorder instance. To view the recorded warnings, you can
iterate over this instance, call <code class="docutils literal notranslate"><span class="pre">len</span></code> on it to get the number of recorded
warnings, or index into it to get a particular recorded warning.</p>
<p>Full API: <code class="xref py py-class docutils literal notranslate"><span class="pre">WarningsRecorder</span></code>.</p>
</div>
<div class="section" id="custom-failure-messages">
<span id="id4"></span><h2>Custom failure messages<a class="headerlink" href="#custom-failure-messages" title="Permalink to this headline">¶</a></h2>
<p>Recording warnings provides an opportunity to produce custom test
failure messages for when no warnings are issued or other conditions
are met.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="ne">Warning</span><span class="p">)</span> <span class="k">as</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">f</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="p">:</span>
            <span class="n">pytest</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Expected a warning!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If no warnings are issued when calling <code class="docutils literal notranslate"><span class="pre">f</span></code>, then <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">record</span></code> will
evaluate to <code class="docutils literal notranslate"><span class="pre">True</span></code>.  You can then call <a class="reference internal" href="reference.html#pytest.fail" title="pytest.fail"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.fail()</span></code></a> with a
custom error message.</p>
</div>
<div class="section" id="internal-pytest-warnings">
<span id="internal-warnings"></span><h2>Internal pytest warnings<a class="headerlink" href="#internal-pytest-warnings" title="Permalink to this headline">¶</a></h2>
<p>pytest may generate its own warnings in some situations, such as improper usage or deprecated features.</p>
<p>For example, pytest will emit a warning if it encounters a class that matches <a class="reference internal" href="reference.html#confval-python_classes"><code class="xref std std-confval docutils literal notranslate"><span class="pre">python_classes</span></code></a> but also
defines an <code class="docutils literal notranslate"><span class="pre">__init__</span></code> constructor, as this prevents the class from being instantiated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of test_pytest_warnings.py</span>
<span class="k">class</span> <span class="nc">Test</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-pytest notranslate"><div class="highlight"><pre><span></span>$ pytest test_pytest_warnings.py -q

<span class=" -Color -Color-Yellow">============================= warnings summary =============================</span>
test_pytest_warnings.py:1
  $REGENDOC_TMPDIR/test_pytest_warnings.py:1: PytestCollectionWarning: cannot collect test class &#39;Test&#39; because it has a __init__ constructor (from: test_pytest_warnings.py)
    class Test:

-- Docs: https://docs.pytest.org/en/stable/warnings.html
<span class=" -Color -Color-Bold -Color-Bold-Yellow">1 warning</span><span class=" -Color -Color-Yellow"> in 0.12s</span>
</pre></div>
</div>
<p>These warnings might be filtered using the same builtin mechanisms used to filter other types of warnings.</p>
<p>Please read our <a class="reference internal" href="backwards-compatibility.html#backwards-compatibility"><span class="std std-ref">Backwards Compatibility Policy</span></a> to learn how we proceed about deprecating and eventually removing
features.</p>
<p>The full list of warnings is listed in <a class="reference internal" href="reference.html#warnings-ref"><span class="std std-ref">the reference documentation</span></a>.</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="clearer"></div>
    </div>
  
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015–2020, holger krekel and pytest-dev team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.4.
    </div>
  <script src="_static/version_warning_offset.js"></script>

  </body>
</html>