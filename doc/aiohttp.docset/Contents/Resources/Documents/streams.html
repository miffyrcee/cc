<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="IE=Edge" http-equiv="X-UA-Compatible"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Streaming API — aiohttp 3.4.4 documentation</title>
<link href="_static/aiohttp.css" rel="stylesheet" type="text/css"/>
<link href="_static/pygments.css" rel="stylesheet" type="text/css"/>
<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js" type="text/javascript"></script>
<script src="_static/jquery.js" type="text/javascript"></script>
<script src="_static/underscore.js" type="text/javascript"></script>
<script src="_static/doctools.js" type="text/javascript"></script>
<link href="_static/favicon.ico" rel="shortcut icon"/>
<link href="genindex.html" rel="index" title="Index"/>
<link href="search.html" rel="search" title="Search"/>
<link href="signals.html" rel="next" title="Signals"/>
<link href="multipart_reference.html" rel="prev" title="Multipart reference"/>
<link href="_static/custom.css" rel="stylesheet" type="text/css"/>
<link href="http://docs.aiohttp.org/en/stable/streams.html" rel="canonical"/>
<meta content="width=device-width, initial-scale=0.9, maximum-scale=0.9" name="viewport"/>
<link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet"/>
</head><body>
<div class="document">
<div class="documentwrapper">
<div class="body" role="main">
<div class="section" id="module-aiohttp">
<span id="streaming-api"></span><span id="aiohttp-streams"></span><h1>Streaming API<a class="headerlink" href="#module-aiohttp" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">aiohttp</span></code> uses streams for retrieving <em>BODIES</em>:
<code class="xref py py-attr docutils literal notranslate"><span class="pre">aiohttp.web.Request.content</span></code> and
<a class="reference internal" href="client_reference.html#aiohttp.ClientResponse.content" title="aiohttp.ClientResponse.content"><code class="xref py py-attr docutils literal notranslate"><span class="pre">aiohttp.ClientResponse.content</span></code></a> are properties with stream API.</p>
<dl class="class">
<dt id="aiohttp.StreamReader"><a name="//apple_ref/cpp/Class/aiohttp.StreamReader"></a>
<em class="property">class </em><code class="descclassname">aiohttp.</code><code class="descname">StreamReader</code><a class="headerlink" href="#aiohttp.StreamReader" title="Permalink to this definition">¶</a></dt>
<dd><p>The reader from incoming stream.</p>
<p>User should never instantiate streams manually but use existing
<code class="xref py py-attr docutils literal notranslate"><span class="pre">aiohttp.web.Request.content</span></code> and
<a class="reference internal" href="client_reference.html#aiohttp.ClientResponse.content" title="aiohttp.ClientResponse.content"><code class="xref py py-attr docutils literal notranslate"><span class="pre">aiohttp.ClientResponse.content</span></code></a> properties for accessing raw
BODY data.</p>
</dd></dl>
<div class="section" id="reading-methods">
<h2>Reading Methods<a class="headerlink" href="#reading-methods" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="aiohttp.StreamReader.read"><a name="//apple_ref/cpp/Method/aiohttp.StreamReader.read"></a>
<em class="property">coroutine </em><code class="descclassname">StreamReader.</code><code class="descname">read</code><span class="sig-paren">(</span><em>n=-1</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read up to <em>n</em> bytes. If <em>n</em> is not provided, or set to <code class="docutils literal notranslate"><span class="pre">-1</span></code>, read until
EOF and return all read bytes.</p>
<p>If the EOF was received and the internal buffer is empty, return an
empty bytes object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name"/>
<col class="field-body"/>
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>n</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – how many bytes to read, <code class="docutils literal notranslate"><span class="pre">-1</span></code> for the whole stream.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return bytes:</th><td class="field-body">the given data</td>
</tr>
</tbody>
</table>
</dd></dl>
<dl class="method">
<dt id="aiohttp.StreamReader.readany"><a name="//apple_ref/cpp/Method/aiohttp.StreamReader.readany"></a>
<em class="property">coroutine </em><code class="descclassname">StreamReader.</code><code class="descname">readany</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.readany" title="Permalink to this definition">¶</a></dt>
<dd><p>Read next data portion for the stream.</p>
<p>Returns immediately if internal buffer has a data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name"/>
<col class="field-body"/>
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return bytes:</th><td class="field-body">the given data</td>
</tr>
</tbody>
</table>
</dd></dl>
<dl class="method">
<dt id="aiohttp.StreamReader.readexactly"><a name="//apple_ref/cpp/Method/aiohttp.StreamReader.readexactly"></a>
<em class="property">coroutine </em><code class="descclassname">StreamReader.</code><code class="descname">readexactly</code><span class="sig-paren">(</span><em>n</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.readexactly" title="Permalink to this definition">¶</a></dt>
<dd><p>Read exactly <em>n</em> bytes.</p>
<p>Raise an <a class="reference external" href="https://docs.python.org/3/library/asyncio-exceptions.html#asyncio.IncompleteReadError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">asyncio.IncompleteReadError</span></code></a> if the end of the
stream is reached before <em>n</em> can be read, the
<a class="reference external" href="https://docs.python.org/3/library/asyncio-exceptions.html#asyncio.IncompleteReadError.partial" title="(in Python v3.7)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">asyncio.IncompleteReadError.partial</span></code></a> attribute of the
exception contains the partial read bytes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name"/>
<col class="field-body"/>
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>n</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – how many bytes to read.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return bytes:</th><td class="field-body">the given data</td>
</tr>
</tbody>
</table>
</dd></dl>
<dl class="method">
<dt id="aiohttp.StreamReader.readline"><a name="//apple_ref/cpp/Method/aiohttp.StreamReader.readline"></a>
<em class="property">coroutine </em><code class="descclassname">StreamReader.</code><code class="descname">readline</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.readline" title="Permalink to this definition">¶</a></dt>
<dd><p>Read one line, where “line” is a sequence of bytes ending
with <code class="docutils literal notranslate"><span class="pre">\n</span></code>.</p>
<p>If EOF is received, and <code class="docutils literal notranslate"><span class="pre">\n</span></code> was not found, the method will
return the partial read bytes.</p>
<p>If the EOF was received and the internal buffer is empty, return an
empty bytes object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name"/>
<col class="field-body"/>
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return bytes:</th><td class="field-body">the given line</td>
</tr>
</tbody>
</table>
</dd></dl>
<dl class="method">
<dt id="aiohttp.StreamReader.readchunk"><a name="//apple_ref/cpp/Method/aiohttp.StreamReader.readchunk"></a>
<em class="property">coroutine </em><code class="descclassname">StreamReader.</code><code class="descname">readchunk</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.readchunk" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a chunk of data as it was received by the server.</p>
<p>Returns a tuple of (data, end_of_HTTP_chunk).</p>
<p>When chunked transfer encoding is used, end_of_HTTP_chunk is a <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>
indicating if the end of the data corresponds to the end of a HTTP chunk,
otherwise it is always <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name"/>
<col class="field-body"/>
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Return tuple[bytes, bool]:</th></tr>
<tr class="field-odd field"><td> </td><td class="field-body">a chunk of data and a <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> that is <code class="docutils literal notranslate"><span class="pre">True</span></code>
when the end of the returned chunk corresponds
to the end of a HTTP chunk.</td>
</tr>
</tbody>
</table>
</dd></dl>
</div>
<div class="section" id="asynchronous-iteration-support">
<h2>Asynchronous Iteration Support<a class="headerlink" href="#asynchronous-iteration-support" title="Permalink to this headline">¶</a></h2>
<p>Stream reader supports asynchronous iteration over BODY.</p>
<p>By default it iterates over lines:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<p>Also there are methods for iterating over data chunks with maximum
size limit and over any available data.</p>
<dl class="method">
<dt id="aiohttp.StreamReader.iter_chunked"><a name="//apple_ref/cpp/Method/aiohttp.StreamReader.iter_chunked"></a>
<em class="property">async-for </em><code class="descclassname">StreamReader.</code><code class="descname">iter_chunked</code><span class="sig-paren">(</span><em>n</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.iter_chunked" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterates over data chunks with maximum size limit:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">iter_chunked</span><span class="p">(</span><span class="mi">1024</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="aiohttp.StreamReader.iter_any"><a name="//apple_ref/cpp/Method/aiohttp.StreamReader.iter_any"></a>
<em class="property">async-for </em><code class="descclassname">StreamReader.</code><code class="descname">iter_any</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.iter_any" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterates over data chunks in order of intaking them into the stream:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">iter_any</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>
<dl class="method">
<dt id="aiohttp.StreamReader.iter_chunks"><a name="//apple_ref/cpp/Method/aiohttp.StreamReader.iter_chunks"></a>
<em class="property">async-for </em><code class="descclassname">StreamReader.</code><code class="descname">iter_chunks</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.iter_chunks" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterates over data chunks as received from the server:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">iter_chunks</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>If chunked transfer encoding is used, the original http chunks formatting
can be retrieved by reading the second element of returned tuples:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">buffer</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span>

<span class="k">async</span> <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">end_of_http_chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">iter_chunks</span><span class="p">():</span>
    <span class="n">buffer</span> <span class="o">+=</span> <span class="n">data</span>
    <span class="k">if</span> <span class="n">end_of_http_chunk</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span>
</pre></div>
</div>
</dd></dl>
</div>
<div class="section" id="helpers">
<h2>Helpers<a class="headerlink" href="#helpers" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="aiohttp.StreamReader.exception"><a name="//apple_ref/cpp/Method/aiohttp.StreamReader.exception"></a>
<code class="descclassname">StreamReader.</code><code class="descname">exception</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the exception occurred on data reading.</p>
</dd></dl>
<dl class="method">
<dt id="aiohttp.is_eof"><a name="//apple_ref/cpp/Method/aiohttp.is_eof"></a>
<code class="descclassname">aiohttp.</code><code class="descname">is_eof</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.is_eof" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if EOF was reached.</p>
<p>Internal buffer may be not empty at the moment.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="#aiohttp.StreamReader.at_eof" title="aiohttp.StreamReader.at_eof"><code class="xref py py-meth docutils literal notranslate"><span class="pre">StreamReader.at_eof()</span></code></a></p>
</div>
</dd></dl>
<dl class="method">
<dt id="aiohttp.StreamReader.at_eof"><a name="//apple_ref/cpp/Method/aiohttp.StreamReader.at_eof"></a>
<code class="descclassname">StreamReader.</code><code class="descname">at_eof</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.at_eof" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the buffer is empty and EOF was reached.</p>
</dd></dl>
<dl class="method">
<dt id="aiohttp.StreamReader.read_nowait"><a name="//apple_ref/cpp/Method/aiohttp.StreamReader.read_nowait"></a>
<code class="descclassname">StreamReader.</code><code class="descname">read_nowait</code><span class="sig-paren">(</span><em>n=None</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.read_nowait" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns data from internal buffer if any, empty bytes object otherwise.</p>
<p>Raises <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> if other coroutine is waiting for stream.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name"/>
<col class="field-body"/>
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>n</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – how many bytes to read, <code class="docutils literal notranslate"><span class="pre">-1</span></code> for the whole internal
buffer.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return bytes:</th><td class="field-body">the given data</td>
</tr>
</tbody>
</table>
</dd></dl>
<dl class="method">
<dt id="aiohttp.StreamReader.unread_data"><a name="//apple_ref/cpp/Method/aiohttp.StreamReader.unread_data"></a>
<code class="descclassname">StreamReader.</code><code class="descname">unread_data</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.StreamReader.unread_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Rollback reading some data from stream, inserting it to buffer head.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name"/>
<col class="field-body"/>
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – data to push back into the stream.</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The method does not wake up waiters.</p>
<p class="last">E.g. <a class="reference internal" href="#aiohttp.StreamReader.read" title="aiohttp.StreamReader.read"><code class="xref py py-meth docutils literal notranslate"><span class="pre">read()</span></code></a> will not be resumed.</p>
</div>
</dd></dl>
<dl class="method">
<dt id="aiohttp.wait_eof"><a name="//apple_ref/cpp/Method/aiohttp.wait_eof"></a>
<em class="property">coroutine </em><code class="descclassname">aiohttp.</code><code class="descname">wait_eof</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#aiohttp.wait_eof" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for EOF. The given data may be accessible by upcoming read calls.</p>
</dd></dl>
</div>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div class="footer">
      ©2013-2018, Aiohttp contributors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.7</a>
      
      |
      <a href="_sources/streams.rst.txt" rel="nofollow">Page source</a>
</div>
</body>
</html>