<html><!-- Online page at https://redis.io/docs/management/scaling/ --><head><meta charset="utf-8"><title>Scaling with Redis Cluster</title><link rel="stylesheet" href="../../css_1.css" type="text/css"><link rel="stylesheet" href="../../css_2.css" type="text/css"><link rel="stylesheet" href="../../css_3.css" type="text/css"><link rel="stylesheet" href="../../css_4.css" type="text/css"><link rel="stylesheet" href="../../css_5.css" type="text/css"><script type="text/javascript" src="../../js_1.js"></script><script type="text/javascript" src="../../js_10.js"></script><script type="text/javascript" src="../../js_3.js"></script><script type="text/javascript" src="../../js_4.js"></script><script type="text/javascript" src="../../js_5.js"></script><script type="text/javascript" src="../../js_6.js"></script><script type="text/javascript" src="../../js_7.js"></script><script type="text/javascript" src="../../js_8.js"></script><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style></head><body class="antialiased tracking-[-0.01em]">
    <noscript>&amp;amp;amp;amp;amp;lt;iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T4MTBKP"
        height="0" width="0" style="display:none;visibility:hidden"&amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;lt;/iframe&amp;amp;amp;amp;amp;gt;</noscript>
    <header class="sticky top-0 z-50 flex items-center w-full text-xs lg:text-sm font-semibold lg:font-medium text-white shadow bg-midnight-700">
      <div class="flex items-center w-full h-16 container max-w-[85rem] mx-auto px-4 sm:px-8">
  <a class="relative z-50 mr-auto" href="../../../redis.io.html">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 368.69 125.59" class="w-auto h-8">
  <defs>
    <style>
      .cls-1 {
        fill: none;
      }

      .cls-2 {
        clip-path: url(#clip-path);
      }

      .cls-3 {
        fill: #a32422;
      }

      .cls-4 {
        fill: #dc382c;
      }

      .cls-5 {
        fill: #fff;
      }

      .cls-6 {
        fill: #741113;
      }

      .cls-7 {
        fill: #ac2724;
      }
    </style>
    <clipPath id="clip-path" transform="translate(0.01 0.01)">
      <rect class="cls-1" width="146.42" height="125.48"></rect>
    </clipPath>
  </defs>
  <g id="Layer_2" data-name="Layer 2">
    <g id="Layer_1-2" data-name="Layer 1">
      <g class="cls-2">
        <path class="cls-3" d="M140.66,96.74c-7.8,4.08-48.28,20.73-57,25.3s-13.39,4.44-20.21,1.18S13.7,102.5,5.92,98.78C2,96.94,0,95.37,0,93.9V79.09S56.08,66.92,65.13,63.64,77.31,60.28,85,63.1,138.79,74.24,146.4,77V91.6c0,1.52-1.75,3-5.74,5.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,82c-7.8,4.06-48.28,20.71-57,25.2s-13.39,4.45-20.21,1.2S13.7,87.69,5.92,84s-7.93-6.27-.3-9.25S56.08,55,65.13,51.7,77.31,48.33,85,51.16,133,70,140.57,72.79s7.92,5.08.09,9.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-3" d="M140.66,72.62c-7.8,4.07-48.28,20.71-57,25.2S70.31,102.27,63.49,99,13.7,78.37,5.92,74.66C2,72.8,0,71.24,0,69.76V55S56.08,42.79,65.13,39.51,77.31,36.14,85,39,138.79,50.1,146.4,52.88v14.6C146.4,69,144.65,70.52,140.66,72.62Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,57.81c-7.8,4.08-48.28,20.72-57,25.21s-13.39,4.46-20.21,1.2S13.7,63.57,5.92,59.85-2,53.6,5.62,50.62s50.46-19.79,59.51-23S77.31,24.21,85,27,133,45.94,140.57,48.65s7.92,5.09.09,9.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-3" d="M140.66,47.59c-7.8,4.08-48.28,20.73-57,25.21S70.31,77.25,63.49,74,13.7,53.34,5.92,49.63C2,47.79,0,46.22,0,44.74V29.93S56.08,17.76,65.13,14.49,77.31,11.12,85,13.94s53.77,11.14,61.38,13.92v14.6C146.4,44,144.65,45.5,140.66,47.59Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,32.8c-7.8,4-48.28,20.75-57,25.2s-13.39,4.44-20.21,1.2S13.7,38.53,5.92,34.83s-7.93-6.27-.3-9.25S56.08,5.8,65.13,2.54,77.31-.82,85,2,133,20.85,140.57,23.63s7.92,5.09.09,9.14Z" transform="translate(0.01 0.01)"></path>
      </g>
      <polygon class="cls-5" points="75.51 11.78 85.17 8.61 82.55 14.87 92.38 18.55 79.71 19.87 76.86 26.71 72.28 19.08 57.63 17.76 68.57 13.82 65.28 7.76 75.51 11.78 75.51 11.78 75.51 11.78"></polygon>
      <polygon class="cls-5" points="76.12 51.71 52.44 41.88 86.36 36.67 76.12 51.71 76.12 51.71 76.12 51.71"></polygon>
      <path class="cls-5" d="M43.28,22.34c10,0,18.13,3.15,18.13,7s-8.15,7-18.13,7-18.14-3.15-18.14-7S33.27,22.34,43.28,22.34Z" transform="translate(0.01 0.01)"></path>
      <polygon class="cls-6" points="107.39 20.42 127.46 28.35 107.41 36.28 107.39 20.42 107.39 20.42 107.39 20.42"></polygon>
      <polygon class="cls-7" points="107.39 20.42 107.41 36.28 105.23 37.13 85.17 29.2 107.39 20.42 107.39 20.42 107.39 20.42"></polygon>
      <path class="cls-5" d="M193,41.4a17.36,17.36,0,0,1,6.23-4.34,20,20,0,0,1,7.3-1.61,6.71,6.71,0,0,1,5,1.61,5,5,0,0,1,1.52,3.79,5.39,5.39,0,0,1-1.52,3.79,4.9,4.9,0,0,1-3.79,1.63c-6.24.55-14.9,6.77-14.9,15.22V80.67a5.57,5.57,0,0,1-5.42,5.41,4.92,4.92,0,0,1-3.87-1.67,5.36,5.36,0,0,1-1.62-3.79v-40a5.35,5.35,0,0,1,1.62-3.79,7.2,7.2,0,0,1,4.07-1.36,5.52,5.52,0,0,1,5.41,5.4Z" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M258.71,59a5.25,5.25,0,0,1-1.35,3.54,6.11,6.11,0,0,1-3.79,1.62h-32a10.31,10.31,0,0,0,3.47,6.56,14.46,14.46,0,0,0,9.48,4.57,14.07,14.07,0,0,0,10.56-2.44,5.52,5.52,0,0,1,4.07-1.63,4.65,4.65,0,0,1,3.51,1.36,4.41,4.41,0,0,1,.26,6.24c-.08.09-.17.17-.26.26a24.49,24.49,0,0,1-17.59,6.5A23,23,0,0,1,217.5,78a26.67,26.67,0,0,1-7.3-17.9,24.31,24.31,0,0,1,7.3-17.88,22.59,22.59,0,0,1,17.06-7.31,22,22,0,0,1,16.74,6.78,24.78,24.78,0,0,1,7.61,16.74v.53Zm-24.1-14.35a14.2,14.2,0,0,0-9.13,3.53,13.17,13.17,0,0,0-4.33,7h28.43a12.39,12.39,0,0,0-4.88-6.76,17.3,17.3,0,0,0-10-3.81" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M309.66,80.12a5.57,5.57,0,0,1-5.41,5.42,5.85,5.85,0,0,1-5.42-4.34A23.23,23.23,0,0,1,285,85.54a23.57,23.57,0,0,1-17.33-7.31,24.14,24.14,0,0,1-7.05-17.88,25.75,25.75,0,0,1,7.05-17.87A23.85,23.85,0,0,1,285,34.87a22.34,22.34,0,0,1,13.53,4.34V20.28a4.92,4.92,0,0,1,1.63-3.79A5.37,5.37,0,0,1,304,14.86a4.92,4.92,0,0,1,3.79,1.63,5.36,5.36,0,0,1,1.63,3.79V80.12ZM285.31,74.7a12,12,0,0,0,9.47-4.32,14.4,14.4,0,0,0,0-20A13,13,0,0,0,285.31,46a11.65,11.65,0,0,0-9.48,4.34,14.4,14.4,0,0,0,0,20,12.49,12.49,0,0,0,9.48,4.32" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M325.67,20.28v2.18A5.5,5.5,0,0,1,324,26.58a4.64,4.64,0,0,1-3.79,1.35,4.86,4.86,0,0,1-3.78-1.61,5.44,5.44,0,0,1-1.63-4.06v-2a5.28,5.28,0,0,1,1.63-3.79,5.33,5.33,0,0,1,3.78-1.63A5,5,0,0,1,324,16.49a4.9,4.9,0,0,1,1.66,3.79m-9.13,16.53a5.28,5.28,0,0,1,3.79-1.63,4.85,4.85,0,0,1,3.79,1.63,5.48,5.48,0,0,1,1.55,4V80.42A4.55,4.55,0,0,1,324,84.21a5.33,5.33,0,0,1-3.78,1.63,4.9,4.9,0,0,1-3.79-1.63,5.28,5.28,0,0,1-1.63-3.79V40.85a5.39,5.39,0,0,1,1.63-4" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M364.08,40.6a5.29,5.29,0,0,1,2.17,3.24,7.17,7.17,0,0,1-.54,4.06,5.4,5.4,0,0,1-3.25,2.16,5.61,5.61,0,0,1-4.07-.81c-3.79-2.43-6.75-3.78-9.2-3.78a8.74,8.74,0,0,0-6,1.88c-1.08.82-1.62,1.36-1.62,1.9a2,2,0,0,0,.27,1.36,3.74,3.74,0,0,0,1.08.81,16.19,16.19,0,0,0,7.32,2.43h0a37.75,37.75,0,0,1,9.74,3,13.57,13.57,0,0,1,6.5,5.7,13.46,13.46,0,0,1-4.06,18.67,21.79,21.79,0,0,1-13,4.06c-6.23,0-12.18-2.43-17.87-7a5.77,5.77,0,0,1-1.9-3.53,5.2,5.2,0,0,1,8.4-4.56,15.73,15.73,0,0,0,11.1,4.33,11.61,11.61,0,0,0,6.77-1.9c1.08-1.08,1.9-1.89,1.9-2.71s0-1.08-.27-1.35c0-.28-.55-.81-1.36-1.08a20.15,20.15,0,0,0-8.13-2.86h0a28.26,28.26,0,0,1-9.2-3,16.56,16.56,0,0,1-6.5-5.67,12.61,12.61,0,0,1-1.61-6.23,13.3,13.3,0,0,1,5.95-11.11,21.82,21.82,0,0,1,12.45-3.79c4.56.28,9.48,2.16,14.89,5.69" transform="translate(0.01 0.01)"></path>
    </g>
  </g>
</svg>
  </a>

	<nav data-menu="" class="hidden lg:flex items-center justify-center content-start lg:content-center lg:gap-y-4 flex-1 z-40 fixed inset-0 lg:static bg-slate-900 lg:bg-transparent text-sm max-h-screen lg:max-w-none pt-20 pb-8 lg:py-0 overflow-y-auto lg:overflow-y-visible">
    
    
      

        
        <a href="../getting-started.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Get started
        </a>

        
        <a href="../getting-started.html" class="flex lg:hidden items-center mt-1.5">
          Get started
        </a>
      
    
      
        
        
        <dl class="hidden lg:flex group relative first:ml-auto ml-1 mt-3 mb-0 px-3 pt-2 pb-5 cursor-pointer">
          <dt class="sr-only uppercase lg:not-sr-only flex items-center justify-items-center group-hover:text-white/50 group-focus-within:text-white/50 whitespace-nowrap transition-colors" href="#">
            
            Docs
          </dt>
          <dd class="hidden lg:grid text-[0.8rem] lg:text-sm text-redis-neutral-800 absolute top-full -mt-1 right-[1000rem] p-2 group-hover:right-[unset] group-hover:-left-3 group-focus-within:right-[unset] group-focus-within:-left-3 bg-white rounded-lg border border-slate-500/10 bg-clip-padding shadow-md">
            
              
                <div class="-my-2 pr-3 py-4 col-start-1  pl-3 ">
                  <a href="../about.html" class=" font-semibold text-[0.9375rem] text-slate-900 flex items-center whitespace-nowrap min-w-[10rem] hover:text-slate-600 focus:text-slate-600 transition-colors">
                    
                      <span class="grid place-items-center w-5 h-5 mr-2.5">
                        
                        <svg viewBox="0 0 147 126" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M140.708 96.7107c-7.81 4.0703-48.2904 20.7203-57.0004 25.2903C74.9976 126.571 70.3176 126.441 63.4976 123.191s-49.8-20.73-57.57002-24.4403C2.04758 96.9007.00756836 95.3407.00756836 93.8607V79.0508S56.0876 66.8807 65.1376 63.6107 77.3176 60.2406 85.0276 63.0606C92.7376 65.8806 138.798 74.2007 146.408 76.9807V91.5606C146.408 93.0806 144.658 94.5606 140.668 96.6907L140.708 96.7107z" fill="#a32422"></path><path d="M140.708 81.9108C132.898 85.9808 92.4176 102.631 83.7076 107.121 74.9976 111.611 70.3176 111.561 63.4976 108.321c-6.82-3.24-49.8-20.6703-57.57001-24.3703-7.77-3.7-7.92999-6.27-.30999-9.25s50.47-19.78 59.52-23S77.3176 48.3408 85.0276 51.1708C92.7376 54.0008 132.968 70.0108 140.578 72.7908 148.188 75.5708 148.488 77.8808 140.668 81.9208L140.708 81.9108z" fill="#dc382c"></path><path d="M140.708 72.5807C132.898 76.6507 92.4176 93.3008 83.7076 97.7908 74.9976 102.281 70.3176 102.231 63.4976 98.9907 56.6776 95.7507 13.6976 78.3407 5.92758 74.6207 2.04758 72.7707.00756836 71.2007.00756836 69.7207V54.9306S56.0876 42.7607 65.1376 39.4707 77.3176 36.1107 85.0276 38.9407C92.7376 41.7707 138.798 50.0607 146.408 52.8507v14.64C146.488 68.9607 144.698 70.4907 140.708 72.5807z" fill="#a32422"></path><path d="M140.708 57.7808c-7.81 4.08-48.2904 20.7099-57.0004 25.1999S70.3176 87.4407 63.4976 84.1807s-49.8-20.65-57.57001-24.36C-1.84241 56.1107-2.0024 53.5607 5.6176 50.5807s50.47-19.78 59.52-23S77.3176 24.2208 85.0276 27.0308C92.7376 29.8408 132.968 45.9508 140.578 48.6608 148.188 51.3708 148.488 53.7408 140.668 57.7908L140.708 57.7808z" fill="#dc382c"></path><path d="M140.708 47.5508c-7.81 4.08-48.2904 20.73-57.0004 25.22C74.9976 77.2608 70.3176 77.2107 63.4976 73.9507 56.6776 70.6907 13.6976 53.3007 5.92758 49.5907c-3.88-1.84-5.92001164-3.41-5.92001164-4.89V29.9008S56.0876 17.7207 65.1376 14.4507c9.05-3.27 12.18-3.3599 19.89-.549899999999999C92.7376 16.7108 138.798 25.0407 146.408 27.8307V42.4208C146.488 43.9408 144.698 45.4908 140.708 47.5508z" fill="#a32422"></path><path d="M140.708 32.7607c-7.81 4-48.2904 20.7599-57.0004 25.1999s-13.39 4.4401-20.21 1.2001-49.8-20.66-57.57001-24.36c-7.77-3.7-7.92999-6.27-.30999-9.26 7.62-2.99 50.47-19.77998 59.52-22.99998 9.05-3.219996 12.18-3.360025 19.89-.53003C92.7376 4.84069 132.968 20.8507 140.578 23.6407 148.188 26.4307 148.488 28.7207 140.668 32.7707L140.708 32.7607z" fill="#dc382c"></path><path d="M140.708 96.7107c-7.81 4.0703-48.2904 20.7203-57.0004 25.2903C74.9976 126.571 70.3176 126.441 63.4976 123.191s-49.8-20.73-57.57002-24.4403C2.04758 96.9007.00756836 95.3407.00756836 93.8607V79.0508S56.0876 66.8807 65.1376 63.6107 77.3176 60.2406 85.0276 63.0606C92.7376 65.8806 138.798 74.2007 146.408 76.9807V91.5606C146.408 93.0806 144.658 94.5606 140.668 96.6907L140.708 96.7107z" fill="#a32422"></path><path d="M140.708 81.9108C132.898 85.9808 92.4176 102.631 83.7076 107.121 74.9976 111.611 70.3176 111.561 63.4976 108.321c-6.82-3.24-49.8-20.6703-57.57001-24.3703-7.77-3.7-7.92999-6.27-.30999-9.25s50.47-19.78 59.52-23S77.3176 48.3408 85.0276 51.1708C92.7376 54.0008 132.968 70.0108 140.578 72.7908 148.188 75.5708 148.488 77.8808 140.668 81.9208L140.708 81.9108z" fill="#dc382c"></path><path d="M140.708 72.5807C132.898 76.6507 92.4176 93.3008 83.7076 97.7908 74.9976 102.281 70.3176 102.231 63.4976 98.9907 56.6776 95.7507 13.6976 78.3407 5.92758 74.6207 2.04758 72.7707.00756836 71.2007.00756836 69.7207V54.9306S56.0876 42.7607 65.1376 39.4707 77.3176 36.1107 85.0276 38.9407C92.7376 41.7707 138.798 50.0607 146.408 52.8507v14.64C146.488 68.9607 144.698 70.4907 140.708 72.5807z" fill="#a32422"></path><path d="M140.708 57.7808c-7.81 4.08-48.2904 20.7099-57.0004 25.1999S70.3176 87.4407 63.4976 84.1807s-49.8-20.65-57.57001-24.36C-1.84241 56.1107-2.0024 53.5607 5.6176 50.5807s50.47-19.78 59.52-23S77.3176 24.2208 85.0276 27.0308C92.7376 29.8408 132.968 45.9508 140.578 48.6608 148.188 51.3708 148.488 53.7408 140.668 57.7908L140.708 57.7808z" fill="#dc382c"></path><path d="M140.708 47.5508c-7.81 4.08-48.2904 20.73-57.0004 25.22C74.9976 77.2608 70.3176 77.2107 63.4976 73.9507 56.6776 70.6907 13.6976 53.3007 5.92758 49.5907c-3.88-1.84-5.92001164-3.41-5.92001164-4.89V29.9008S56.0876 17.7207 65.1376 14.4507c9.05-3.27 12.18-3.3599 19.89-.549899999999999C92.7376 16.7108 138.798 25.0407 146.408 27.8307V42.4208C146.488 43.9408 144.698 45.4908 140.708 47.5508z" fill="#a32422"></path><path d="M140.708 32.7607c-7.81 4-48.2904 20.7599-57.0004 25.1999s-13.39 4.4401-20.21 1.2001-49.8-20.66-57.57001-24.36c-7.77-3.7-7.92999-6.27-.30999-9.26 7.62-2.99 50.47-19.77998 59.52-22.99998 9.05-3.219996 12.18-3.360025 19.89-.53003C92.7376 4.84069 132.968 20.8507 140.578 23.6407 148.188 26.4307 148.488 28.7207 140.668 32.7707L140.708 32.7607z" fill="#dc382c"></path><path d="M75.5476 11.7307l9.66-3.17-2.62 6.26 9.83 3.68-12.67 1.32L76.8976 26.6607l-4.58-7.63-14.65-1.32 10.94-3.94L65.3176 7.71069l10.23 4.02001z" fill="#fff"></path><path d="M76.1575 51.6607l-23.68-9.83 33.92-5.2-10.24 15.03z" fill="#fff"></path><path d="M43.3276 22.3008c10 0 18.12 3.15 18.12 7s-8.14 7-18.12 7c-9.98.0-18.14-3.15000000000001-18.14-7s8.13-7 18.14-7z" fill="#fff"></path><path d="M107.428 20.3707l20.07 7.93-20.05 7.93L107.428 20.3707z" fill="#741113"></path><path d="M107.428 20.3707 107.448 36.2307 105.268 37.0807l-20.0605-7.93 22.2205-8.78z" fill="#ac2724"></path></svg>
                      </span>
                    
                    Redis
                  </a>
                  
                    <a href="../getting-started.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Get started
                    </a>
                  
                    <a href="../data-types.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Data types
                    </a>
                  
                    <a href="../ui/cli.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Redis CLI
                    </a>
                  
                    <a href="../clients.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Redis clients
                    </a>
                  
                    <a href="./persistence.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Persistence
                    </a>
                  
                    <a href="./scaling.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Scaling
                    </a>
                  
                </div>
              
            
              
                <div class="-my-2 pr-3 py-4 col-start-2  border-l pl-5 ">
                  <a href="../stack.html" class=" font-semibold text-[0.9375rem] text-slate-900 flex items-center whitespace-nowrap min-w-[10rem] hover:text-slate-600 focus:text-slate-600 transition-colors">
                    
                      <span class="grid place-items-center w-5 h-5 mr-2.5">
                        
                        <svg viewBox="0 0 39 31" fill="none"><path d="M21.7371 15.2903C21.5759 15.2895 21.4198 15.2337 21.2947 15.1321 21.1695 15.0305 21.0828 14.8892 21.049 14.7316S21.0362 14.4096 21.1086 14.2655C21.1811 14.1215 21.3005 14.0066 21.4472 13.9397L35.7199 7.47338 21.4578 1.34289C21.2943 1.26329 21.1678 1.12377 21.1045.953307 21.0412.78285 21.046.594558 21.1179.427547 21.1898.260535 21.3233.127641 21.4906.0564719 21.6579-.0146977 21.8462-.0186728 22.0164.045373L37.7492 6.80518C37.8747 6.8605 37.9814 6.95112 38.0563 7.06599S38.171 7.31503 38.171 7.45216 38.1312 7.72347 38.0563 7.83834C37.9814 7.95321 37.8747 8.04383 37.7492 8.09915L22.0306 15.2266C21.9388 15.2698 21.8385 15.2916 21.7371 15.2903z" fill="#db2e2e"></path><path d="M16.4339 15.2903C16.3379 15.2906 16.2429 15.2714 16.1546 15.2337L.421813 8.47393C.296339 8.41861.18966 8.32799.114767 8.21312.0398745 8.09825.0 7.96407.0 7.82694.0 7.68981.0398745 7.55564.114767 7.44077.18966 7.3259.296339 7.23528.421813 7.17995L16.1546.052465C16.3235-.0111265 16.5104-.00772359 16.6768.0619772 16.8433.131678 16.9768.2624 17.0501.427363 17.1233.592325 17.1306.779042 17.0706.949259 17.0106 1.11948 16.8878 1.26031 16.7274 1.34291L2.44763 7.80573 16.7132 13.9362C16.8612 14.0015 16.9823 14.1154 17.0565 14.2592 17.1306 14.4029 17.1532 14.5677 17.1205 14.7261 17.0878 14.8845 17.0019 15.0269 16.8769 15.1295 16.752 15.2322 16.5956 15.2889 16.4339 15.2903z" fill="#db2e2e"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 17.4328c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 13.9539C37.3908 13.8108 37.6564 13.6514 37.9118 13.4766 37.972 13.8833 37.972 14.2967 37.9118 14.7034 37.8022 15.1312 37.4875 15.4847 36.289 16.061 35.4617 16.4605 33.1531 17.408 30.5792 18.4687c-3.6167 1.4884-7.778 3.1819-9.0826 3.889C19.2587 23.4183 18.0284 23.4183 16.3137 22.644 15.4864 22.2021 12.4918 20.9117 9.39476 19.5611c-3.3198-1.446-6.75627-2.945-7.77802-3.4753C.22377 15.3575.153061 15.1948.160132 14.8271V13.8655L.513678 14.0564c1.311652.6647 7.219412 3.1819 11.486722 5.0204 2.1142.898 3.8112 1.6298 4.3769 1.8844C18.092 21.7319 19.3082 21.8733 21.5603 20.6748 22.7022 20.0808 25.9619 18.7409 29.1651 17.4328z" fill="#494c4d"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 24.5037c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 21.0248C37.3908 20.8817 37.6564 20.7223 37.9118 20.5475 37.972 20.9542 37.972 21.3676 37.9118 21.7743 37.8022 22.2021 37.4875 22.5557 36.289 23.1319 35.4617 23.5314 33.1531 24.4789 30.5792 25.5396c-3.6167 1.4884-7.778 3.1819-9.0826 3.889-2.2379 1.0606-3.4682 1.0606-5.1829.2864C15.4864 29.2801 12.4918 27.9755 9.39476 26.625c-3.3198-1.446-6.75627-2.9451-7.77802-3.4754C.22377 22.4213.153061 22.2587.160132 21.891V20.9364L.513678 21.1273C1.82533 21.792 7.73309 24.3092 12.0004 26.1477c2.1001.898 3.8006 1.6298 4.3663 1.8844C18.0814 28.8028 19.2976 28.9442 21.5497 27.7457 22.7022 27.1518 25.9619 25.8118 29.1651 24.5037z" fill="#494c4d"></path></svg>
                      </span>
                    
                    Redis Stack
                  </a>
                  
                    <a href="../stack/get-started.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Get started
                    </a>
                  
                    <a href="../stack/get-started/clients.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Stack clients
                    </a>
                  
                    <a href="../ui/insight.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      RedisInsight
                    </a>
                  
                    <a href="../stack/json.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      JSON
                    </a>
                  
                    <a href="../stack/search.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Search
                    </a>
                  
                    <a href="../stack/bloom.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Probabilistic
                    </a>
                  
                </div>
              
            
          </dd>
        </dl>
        
        
        <dl class="lg:hidden">
          <dt class="sr-only">
            Docs
          </dt>
          <dd class="lg:hidden flex flex-col">
            
              
                <a href="../about.html" class="flex items-center mt-2">
                  Redis
                </a>
                
                  <a href="../getting-started.html" class="mt-2">
                    Get started
                  </a>
                
                  <a href="../data-types.html" class="mt-2">
                    Data types
                  </a>
                
                  <a href="../ui/cli.html" class="mt-2">
                    Redis CLI
                  </a>
                
                  <a href="../clients.html" class="mt-2">
                    Redis clients
                  </a>
                
                  <a href="./persistence.html" class="mt-2">
                    Persistence
                  </a>
                
                  <a href="./scaling.html" class="mt-2">
                    Scaling
                  </a>
                
                <hr class="opacity-10 mt-4 mb-2">
              
            
              
                <a href="../stack.html" class="flex items-center mt-2">
                  Redis Stack
                </a>
                
                  <a href="../stack/get-started.html" class="mt-2">
                    Get started
                  </a>
                
                  <a href="../stack/get-started/clients.html" class="mt-2">
                    Stack clients
                  </a>
                
                  <a href="../ui/insight.html" class="mt-2">
                    RedisInsight
                  </a>
                
                  <a href="../stack/json.html" class="mt-2">
                    JSON
                  </a>
                
                  <a href="../stack/search.html" class="mt-2">
                    Search
                  </a>
                
                  <a href="../stack/bloom.html" class="mt-2">
                    Probabilistic
                  </a>
                
                <hr class="opacity-10 mt-4 mb-2">
              
            
          </dd>
        </dl>
      
    
      

        
        <a href="../../commands.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Commands
        </a>

        
        <a href="../../commands.html" class="flex lg:hidden items-center mt-1.5">
          Commands
        </a>
      
    
      
        
        
        <dl class="hidden lg:flex group relative first:ml-auto ml-1 mt-3 mb-0 px-3 pt-2 pb-5 cursor-pointer">
          <dt class="sr-only uppercase lg:not-sr-only flex items-center justify-items-center group-hover:text-white/50 group-focus-within:text-white/50 whitespace-nowrap transition-colors" href="#">
            
            Resources
          </dt>
          <dd class="hidden lg:grid text-[0.8rem] lg:text-sm text-redis-neutral-800 absolute top-full -mt-1 right-[1000rem] p-2 group-hover:right-[unset] group-hover:-left-3 group-focus-within:right-[unset] group-focus-within:-left-3 bg-white rounded-lg border border-slate-500/10 bg-clip-padding shadow-md">
            
              
              <a href="../../resources/clients.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Clients
              </a>
              
            
              
              <a href="../../resources/libraries.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Libraries
              </a>
              
            
              
              <a href="../../resources/tools.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Tools
              </a>
              
            
              
              <a href="../../resources/modules.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Modules
              </a>
              
            
          </dd>
        </dl>
        
        
        <dl class="lg:hidden">
          <dt class="sr-only">
            Resources
          </dt>
          <dd class="lg:hidden flex flex-col">
            
              
              <a href="../../resources/clients.html" class="mt-2">
                Clients
              </a>
              
            
              
              <a href="../../resources/libraries.html" class="mt-2">
                Libraries
              </a>
              
            
              
              <a href="../../resources/tools.html" class="mt-2">
                Tools
              </a>
              
            
              
              <a href="../../resources/modules.html" class="mt-2">
                Modules
              </a>
              
            
          </dd>
        </dl>
      
    
      

        
        <a href="../../community.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Community
        </a>

        
        <a href="../../community.html" class="flex lg:hidden items-center mt-1.5">
          Community
        </a>
      
    
      

        
        <a href="../../support.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Support
        </a>

        
        <a href="../../support.html" class="flex lg:hidden items-center mt-1.5">
          Support
        </a>
      
    
    
    <div class="flex flex-col lg:flex-row lg:ml-auto lg:space-x-2">
      <button id="search-button" type="button" class="rounded-sm w-full lg:w-auto transition-colors shrink-0 flex-1 lg:flex-none lg:ml-2 lg:mr-0 mt-4 lg:mt-0 inline-flex items-center px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 border-white/50 hover:text-indigo-600 focus:text-indigo-600 hover:bg-white focus:bg-white focus:ring-white">
        <svg class="w-[0.875rem] h-[0.875rem] mr-0.5" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <circle cx="10" cy="10" r="7"></circle>
          <line x1="21" y1="21" x2="15" y2="15"></line>
        </svg>
        <span class="sr-only">Quick search&amp;hellip…</span>
        <span class="lg:hidden xl:block flex-auto ml-1 mr-4" aria-hidden="">Search…</span>
        <script>
          if (navigator.appVersion.indexOf("Win") != -1 || navigator.appVersion.indexOf("Linux") != -1) {
            document.querySelector('[title="Command"]').textContent = "&#8963;";
          } 
        </script>
        <kbd class="font-sans font-semibold">
          <abbr title="Command" class="no-underline">⌘</abbr>&nbsp;K
        </kbd>
      </button>
      
        <a class="rounded-sm transition-colors shrink-0 inline-flex items-center justify-center mt-2 lg:mt-0 px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900
         border-transparent bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 focus:ring-indigo-600
        " href="../../download.html">
          Download
        </a>
      
        <a class="rounded-sm transition-colors shrink-0 inline-flex items-center justify-center mt-2 lg:mt-0 px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900
        
         border-white/50 hover:text-indigo-600 focus:text-indigo-600 hover:bg-white focus:bg-white focus:ring-white" href="http://redis.com/try-free/">
          Try Redis Cloud
        </a>
      
    </div>
	</nav>

  <button data-menu-toggle="" aria-expanded="false" class="menu-toggle block ml-auto lg:hidden relative z-50"> 
    <span class="sr-only">Open main menu</span> 
    <svg aria-hidden="true" role="img" viewBox="0 0 24 24" style="pointer-events: none; width: 24px; height: 24px;" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <line x1="4" y1="6" x2="20" y2="6"></line>
      <line x1="4" y1="12" x2="20" y2="12"></line>
      <line x1="4" y1="18" x2="20" y2="18"></line>
    </svg>
  </button>
</div>
    </header>

    
  <main class="docs w-full max-w-[85rem] mx-auto px-4 sm:px-6 lg:px-8 md:flex gap-16">
    

<div class="hidden md:block w-52 h-full shrink-0">
  <nav class="w-52 z-40 bg-white hidden md:block fixed top-28 pb-16 h-full max-h-[calc(100vh-7rem)] text-[0.8125rem] leading-7 font">
    <div class="absolute right-0 -top-28 z-[-1] h-screen border-r border-slate-200/50 bg-gradient-to-bl from-slate-50 via-slate-50 to-indigo-100 w-[17rem] xl:w-[calc(50vw-23rem)]"></div>
    <ul class="h-full max-h-[calc(100vh-7rem)] overflow-y-auto pr-6">
      
    <li>
      <a class="flex justify-between items-center truncate font-semibold text-slate-900" href="../../docs.html">
          <span>Documentation</span>
          
      </a>
        <ul class="">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../about.html">
          <span>About</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../getting-started.html">
          <span>Getting started</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../ui.html">
          <span>User interfaces</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../data-types.html">
          <span>Data types</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../clients.html">
          <span>Client quickstarts</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../manual.html">
          <span>Using Redis</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../management.html">
          <span>Managing Redis</span>
          
            
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400 rotate-90" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./admin.html">
          <span>Administration</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./security.html">
          <span>Security</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./config.html">
          <span>Configuration</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./config-file.html">
          <span>Configuration example</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./sentinel.html">
          <span>High availability with Sentinel</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./replication.html">
          <span>Replication</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate active text-indigo-600" href="./scaling.html">
          <span>Scaling</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./persistence.html">
          <span>Persistence</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./optimization.html">
          <span>Optimization</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./troubleshooting.html">
          <span>Troubleshooting</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./debugging.html">
          <span>Debugging</span>
          
      </a>
    </li>
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../reference.html">
          <span>Reference</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../stack.html">
          <span>Redis Stack</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
        </ul>
    </li>
    </ul>
  </nav>
</div>
    <div class="w-full max-w-[47rem] py-12">
      <nav class="flex" aria-label="Breadcrumb">
  <ol role="list" class="flex items-center space-x-2">
    
  
    
  
    
  
    
  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <a class="text-gray-400 hover:text-gray-500" href="../../../redis.io.html">
        <svg class="flex-shrink-0 h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
        </svg>
        <span class="sr-only">Home</span>
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../../docs.html">
        Documentation
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../management.html">
        Managing Redis
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 pointer-events-none">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="./scaling.html">
        Scaling with Redis Cluster
      </a>
    
  </li>

  </ol>
</nav>


      <section class="prose prose-slate w-full max-w-[47rem] py-12">
        <h1>Scaling with Redis Cluster</h1>
        <p class="text-lg -mt-5 mb-10">Horizontal scaling with Redis Cluster</p>
        <p>Redis scales horizontally with a deployment topology called Redis Cluster.
This topic will teach you how to set up, test, and operate Redis Cluster in production.
You will learn about the availability and consistency characteristics of Redis Cluster from the end user's point of view.</p>
<p>If you plan to run a production Redis Cluster deployment or want to understand better how Redis Cluster works internally, consult the <a href="../reference/cluster-spec.html">Redis Cluster specification</a>. To learn how Redis Enterprise handles scaling, see <a href="https://redis.com/redis-enterprise/technology/linear-scaling-redis-enterprise/">Linear Scaling with Redis Enterprise</a>.</p>
<a class="dashAnchor" name="//apple_ref/Section/Redis%20Cluster%20101"></a><h2 id="redis-cluster-101">Redis Cluster 101</h2>
<p>Redis Cluster provides a way to run a Redis installation where data is automatically sharded across multiple Redis nodes.
Redis Cluster also provides some degree of availability during partitions—in practical terms, the ability to continue operations when some nodes fail or are unable to communicate.
However, the cluster will become unavailable in the event of larger failures (for example, when the majority of masters are unavailable).</p>
<p>So, with Redis Cluster, you get the ability to:</p>
<ul>
<li>Automatically split your dataset among multiple nodes.</li>
<li>Continue operations when a subset of the nodes are experiencing failures or are unable to communicate with the rest of the cluster.</li>
</ul>
<h4 id="redis-cluster-tcp-ports">Redis Cluster TCP ports</h4>
<p>Every Redis Cluster node requires two open TCP connections: a Redis TCP port used to serve clients, e.g., 6379, and second port known as the <em>cluster bus port</em>.
By default, the cluster bus port is set by adding 10000 to the data port (e.g., 16379); however, you can override this in the <code>cluster-port</code> configuration.</p>
<p>Cluster bus is a node-to-node communication channel that uses a binary protocol, which is more suited to exchanging information between nodes due to
little bandwidth and processing time.
Nodes use the cluster bus for failure detection, configuration updates, failover authorization, and so forth.
Clients should never try to communicate with the cluster bus port, but rather use the Redis command port.
However, make sure you open both ports in your firewall, otherwise Redis cluster nodes won't be able to communicate.</p>
<p>For a Redis Cluster to work properly you need, for each node:</p>
<ol>
<li>The client communication port (usually 6379) used to communicate with clients and be open to all the clients that need to reach the cluster, plus all the other cluster nodes that use the client port for key migrations.</li>
<li>The cluster bus port must be reachable from all the other cluster nodes.</li>
</ol>
<p>If you don't open both TCP ports, your cluster will not work as expected.</p>
<h4 id="redis-cluster-and-docker">Redis Cluster and Docker</h4>
<p>Currently, Redis Cluster does not support NATted environments and in general
environments where IP addresses or TCP ports are remapped.</p>
<p>Docker uses a technique called <em>port mapping</em>: programs running inside Docker containers may be exposed with a different port compared to the one the program believes to be using.
This is useful for running multiple containers using the same ports, at the same time, in the same server.</p>
<p>To make Docker compatible with Redis Cluster, you need to use Docker's <em>host networking mode</em>.
Please see the <code>--net=host</code> option in the <a href="https://docs.docker.com/engine/userguide/networking/dockernetworks/">Docker documentation</a> for more information.</p>
<h4 id="redis-cluster-data-sharding">Redis Cluster data sharding</h4>
<p>Redis Cluster does not use consistent hashing, but a different form of sharding
where every key is conceptually part of what we call a <strong>hash slot</strong>.</p>
<p>There are 16384 hash slots in Redis Cluster, and to compute the hash
slot for a given key, we simply take the CRC16 of the key modulo
16384.</p>
<p>Every node in a Redis Cluster is responsible for a subset of the hash slots,
so, for example, you may have a cluster with 3 nodes, where:</p>
<ul>
<li>Node A contains hash slots from 0 to 5500.</li>
<li>Node B contains hash slots from 5501 to 11000.</li>
<li>Node C contains hash slots from 11001 to 16383.</li>
</ul>
<p>This makes it easy to add and remove cluster nodes. For example, if
I want to add a new node D, I need to move some hash slots from nodes A, B, C
to D. Similarly, if I want to remove node A from the cluster, I can just
move the hash slots served by A to B and C. Once node A is empty,
I can remove it from the cluster completely.</p>
<p>Moving hash slots from a node to another does not require stopping
any operations; therefore, adding and removing nodes, or changing the percentage of hash slots held by a node, requires no downtime.</p>
<p>Redis Cluster supports multiple key operations as long as all of the keys involved in a single command execution (or whole transaction, or Lua script
execution) belong to the same hash slot. The user can force multiple keys
to be part of the same hash slot by using a feature called <em>hash tags</em>.</p>
<p>Hash tags are documented in the Redis Cluster specification, but the gist is
that if there is a substring between {} brackets in a key, only what is
inside the string is hashed. For example, the keys <code>user:{123}:profile</code> and <code>user:{123}:account</code> are guaranteed to be in the same hash slot because they share the same hash tag. As a result, you can operate on these two keys in the same multi-key operation.</p>
<h4 id="redis-cluster-master-replica-model">Redis Cluster master-replica model</h4>
<p>To remain available when a subset of master nodes are failing or are
not able to communicate with the majority of nodes, Redis Cluster uses a
master-replica model where every hash slot has from 1 (the master itself) to N
replicas (N-1 additional replica nodes).</p>
<p>In our example cluster with nodes A, B, C, if node B fails the cluster is not
able to continue, since we no longer have a way to serve hash slots in the
range 5501-11000.</p>
<p>However, when the cluster is created (or at a later time), we add a replica
node to every master, so that the final cluster is composed of A, B, C
that are master nodes, and A1, B1, C1 that are replica nodes.
This way, the system can continue if node B fails.</p>
<p>Node B1 replicates B, and B fails, the cluster will promote node B1 as the new
master and will continue to operate correctly.</p>
<p>However, note that if nodes B and B1 fail at the same time, Redis Cluster will not be able to continue to operate.</p>
<h4 id="redis-cluster-consistency-guarantees">Redis Cluster consistency guarantees</h4>
<p>Redis Cluster does not guarantee <strong>strong consistency</strong>. In practical
terms this means that under certain conditions it is possible that Redis
Cluster will lose writes that were acknowledged by the system to the client.</p>
<p>The first reason why Redis Cluster can lose writes is because it uses
asynchronous replication. This means that during writes the following
happens:</p>
<ul>
<li>Your client writes to the master B.</li>
<li>The master B replies OK to your client.</li>
<li>The master B propagates the write to its replicas B1, B2 and B3.</li>
</ul>
<p>As you can see, B does not wait for an acknowledgement from B1, B2, B3 before
replying to the client, since this would be a prohibitive latency penalty
for Redis, so if your client writes something, B acknowledges the write,
but crashes before being able to send the write to its replicas, one of the
replicas (that did not receive the write) can be promoted to master, losing
the write forever.</p>
<p>This is very similar to what happens with most databases that are
configured to flush data to disk every second, so it is a scenario you
are already able to reason about because of past experiences with traditional
database systems not involving distributed systems. Similarly you can
improve consistency by forcing the database to flush data to disk before
replying to the client, but this usually results in prohibitively low
performance. That would be the equivalent of synchronous replication in
the case of Redis Cluster.</p>
<p>Basically, there is a trade-off to be made between performance and consistency.</p>
<p>Redis Cluster has support for synchronous writes when absolutely needed,
implemented via the <a href="../../commands/wait.html"><code>WAIT</code></a> command. This makes losing writes a lot less
likely. However, note that Redis Cluster does not implement strong consistency
even when synchronous replication is used: it is always possible, under more
complex failure scenarios, that a replica that was not able to receive the write
will be elected as master.</p>
<p>There is another notable scenario where Redis Cluster will lose writes, that
happens during a network partition where a client is isolated with a minority
of instances including at least a master.</p>
<p>Take as an example our 6 nodes cluster composed of A, B, C, A1, B1, C1,
with 3 masters and 3 replicas. There is also a client, that we will call Z1.</p>
<p>After a partition occurs, it is possible that in one side of the
partition we have A, C, A1, B1, C1, and in the other side we have B and Z1.</p>
<p>Z1 is still able to write to B, which will accept its writes. If the
partition heals in a very short time, the cluster will continue normally.
However, if the partition lasts enough time for B1 to be promoted to master
on the majority side of the partition, the writes that Z1 has sent to B
in the meantime will be lost.</p>
<div class="pl-4 border-l-8">
<div class="font-semibold text-slate-900">Note</div>
<p>There is a <strong>maximum window</strong> to the amount of writes Z1 will be able
to send to B: if enough time has elapsed for the majority side of the
partition to elect a replica as master, every master node in the minority
side will have stopped accepting writes.</p>
</div>
<p>This amount of time is a very important configuration directive of Redis
Cluster, and is called the <strong>node timeout</strong>.</p>
<p>After node timeout has elapsed, a master node is considered to be failing,
and can be replaced by one of its replicas.
Similarly, after node timeout has elapsed without a master node to be able
to sense the majority of the other master nodes, it enters an error state
and stops accepting writes.</p>
<a class="dashAnchor" name="//apple_ref/Section/Redis%20Cluster%20configuration%20parameters"></a><h2 id="redis-cluster-configuration-parameters">Redis Cluster configuration parameters</h2>
<p>We are about to create an example cluster deployment.
Before we continue, let's introduce the configuration parameters that Redis Cluster introduces
in the <code>redis.conf</code> file.</p>
<ul>
<li><strong>cluster-enabled <code>&lt;yes/no&gt;</code></strong>: If yes, enables Redis Cluster support in a specific Redis instance. Otherwise the instance starts as a standalone instance as usual.</li>
<li><strong>cluster-config-file <code>&lt;filename&gt;</code></strong>: Note that despite the name of this option, this is not a user editable configuration file, but the file where a Redis Cluster node automatically persists the cluster configuration (the state, basically) every time there is a change, in order to be able to re-read it at startup. The file lists things like the other nodes in the cluster, their state, persistent variables, and so forth. Often this file is rewritten and flushed on disk as a result of some message reception.</li>
<li><strong>cluster-node-timeout <code>&lt;milliseconds&gt;</code></strong>: The maximum amount of time a Redis Cluster node can be unavailable, without it being considered as failing. If a master node is not reachable for more than the specified amount of time, it will be failed over by its replicas. This parameter controls other important things in Redis Cluster. Notably, every node that can't reach the majority of master nodes for the specified amount of time, will stop accepting queries.</li>
<li><strong>cluster-slave-validity-factor <code>&lt;factor&gt;</code></strong>: If set to zero, a replica will always consider itself valid, and will therefore always try to failover a master, regardless of the amount of time the link between the master and the replica remained disconnected. If the value is positive, a maximum disconnection time is calculated as the <em>node timeout</em> value multiplied by the factor provided with this option, and if the node is a replica, it will not try to start a failover if the master link was disconnected for more than the specified amount of time. For example, if the node timeout is set to 5 seconds and the validity factor is set to 10, a replica disconnected from the master for more than 50 seconds will not try to failover its master. Note that any value different than zero may result in Redis Cluster being unavailable after a master failure if there is no replica that is able to failover it. In that case the cluster will return to being available only when the original master rejoins the cluster.</li>
<li><strong>cluster-migration-barrier <code>&lt;count&gt;</code></strong>: Minimum number of replicas a master will remain connected with, for another replica to migrate to a master which is no longer covered by any replica. See the appropriate section about replica migration in this tutorial for more information.</li>
<li><strong>cluster-require-full-coverage <code>&lt;yes/no&gt;</code></strong>: If this is set to yes, as it is by default, the cluster stops accepting writes if some percentage of the key space is not covered by any node. If the option is set to no, the cluster will still serve queries even if only requests about a subset of keys can be processed.</li>
<li><strong>cluster-allow-reads-when-down <code>&lt;yes/no&gt;</code></strong>: If this is set to no, as it is by default, a node in a Redis Cluster will stop serving all traffic when the cluster is marked as failed, either when a node can't reach a quorum of masters or when full coverage is not met. This prevents reading potentially inconsistent data from a node that is unaware of changes in the cluster. This option can be set to yes to allow reads from a node during the fail state, which is useful for applications that want to prioritize read availability but still want to prevent inconsistent writes. It can also be used for when using Redis Cluster with only one or two shards, as it allows the nodes to continue serving writes when a master fails but automatic failover is impossible.</li>
</ul>
<a class="dashAnchor" name="//apple_ref/Section/Create%20and%20use%20a%20Redis%20Cluster"></a><h2 id="create-and-use-a-redis-cluster">Create and use a Redis Cluster</h2>
<p>To create and use a Redis Cluster, follow these steps:</p>
<ul>
<li><a href="#create-a-redis-cluster">Create a Redis Cluster</a></li>
<li><a href="#interact-with-the-cluster">Interact with the cluster</a></li>
<li><a href="#write-an-example-app-with-redis-rb-cluster">Write an example app with redis-rb-cluster</a></li>
<li><a href="#reshard-the-cluster">Reshard the cluster</a></li>
<li><a href="#a-more-interesting-example-application">A more interesting example application</a></li>
<li><a href="#test-the-failover">Test the failover</a></li>
<li><a href="#manual-failover">Manual failover</a></li>
<li><a href="#add-a-new-node">Add a new node</a></li>
<li><a href="#remove-a-node">Remove a node</a></li>
<li><a href="#replica-migration">Replica migration</a></li>
<li><a href="#upgrade-nodes-in-a-redis-cluster">Upgrade nodes in a Redis Cluster</a></li>
<li><a href="#migrate-to-redis-cluster">Migrate to Redis Cluster</a></li>
</ul>
<p>But, first, familiarize yourself with the requirements for creating a cluster.</p>
<h4 id="requirements-to-create-a-redis-cluster">Requirements to create a Redis Cluster</h4>
<p>To create a cluster, the first thing you need is to have a few empty Redis instances running in <em>cluster mode</em>.</p>
<p>At minimum, set the following directives in the <code>redis.conf</code> file:</p>
<pre tabindex="0"><code>port 7000
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 5000
appendonly yes
</code></pre><p>To enable cluster mode, set the <code>cluster-enabled</code> directive to <code>yes</code>.
Every instance also contains the path of a file where the
configuration for this node is stored, which by default is <code>nodes.conf</code>.
This file is never touched by humans; it is simply generated at startup
by the Redis Cluster instances, and updated every time it is needed.</p>
<p>Note that the <strong>minimal cluster</strong> that works as expected must contain
at least three master nodes. For deployment, we strongly recommend
a six-node cluster, with three masters and three replicas.</p>
<p>You can test this locally by creating the following directories named
after the port number of the instance you'll run inside any given directory.</p>
<p>For example:</p>
<pre tabindex="0"><code>mkdir cluster-test
cd cluster-test
mkdir 7000 7001 7002 7003 7004 7005
</code></pre><p>Create a <code>redis.conf</code> file inside each of the directories, from 7000 to 7005.
As a template for your configuration file just use the small example above,
but make sure to replace the port number <code>7000</code> with the right port number
according to the directory name.</p>
<p>You can start each instance as follows, each running in a separate terminal tab:</p>
<pre tabindex="0"><code>cd 7000
redis-server ./redis.conf
</code></pre><p>You'll see from the logs that every node assigns itself a new ID:</p>
<pre><code>[82462] 26 Nov 11:56:55.329 * No cluster configuration found, I'm 97a3a64667477371c4479320d683e4c8db5858b1
</code></pre>
<p>This ID will be used forever by this specific instance in order for the instance
to have a unique name in the context of the cluster. Every node
remembers every other node using this IDs, and not by IP or port.
IP addresses and ports may change, but the unique node identifier will never
change for all the life of the node. We call this identifier simply <strong>Node ID</strong>.</p>
<h4 id="create-a-redis-cluster">Create a Redis Cluster</h4>
<p>Now that we have a number of instances running, you need to create your cluster by writing some meaningful configuration to the nodes.</p>
<p>You can configure and execute individual instances manually or use the create-cluster script.
Let's go over how you do it manually.</p>
<p>To create the cluster, run:</p>
<pre><code>redis-cli --cluster create 127.0.0.1:7000 127.0.0.1:7001 \
127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 \
--cluster-replicas 1
</code></pre>
<p>The command used here is <strong>create</strong>, since we want to create a new cluster.
The option <code>--cluster-replicas 1</code> means that we want a replica for every master created.</p>
<p>The other arguments are the list of addresses of the instances I want to use
to create the new cluster.</p>
<p><code>redis-cli</code> will propose a configuration. Accept the proposed configuration by typing <strong>yes</strong>.
The cluster will be configured and <em>joined</em>, which means that instances will be
bootstrapped into talking with each other. Finally, if everything has gone well, you'll see a message like this:</p>
<pre><code>[OK] All 16384 slots covered
</code></pre>
<p>This means that there is at least one master instance serving each of the
16384 available slots.</p>
<p>If you don't want to create a Redis Cluster by configuring and executing
individual instances manually as explained above, there is a much simpler
system (but you'll not learn the same amount of operational details).</p>
<p>Find the <code>utils/create-cluster</code> directory in the Redis distribution.
There is a script called <code>create-cluster</code> inside (same name as the directory
it is contained into), it's a simple bash script. In order to start
a 6 nodes cluster with 3 masters and 3 replicas just type the following
commands:</p>
<ol>
<li><code>create-cluster start</code></li>
<li><code>create-cluster create</code></li>
</ol>
<p>Reply to <code>yes</code> in step 2 when the <code>redis-cli</code> utility wants you to accept
the cluster layout.</p>
<p>You can now interact with the cluster, the first node will start at port 30001
by default. When you are done, stop the cluster with:</p>
<ol start="3">
<li><code>create-cluster stop</code></li>
</ol>
<p>Please read the <code>README</code> inside this directory for more information on how
to run the script.</p>
<h4 id="interact-with-the-cluster">Interact with the cluster</h4>
<p>To connect to Redis Cluster, you'll need a cluster-aware Redis client.
See the <a href="../clients.html">documentation</a> for your client of choice to determine its cluster support.</p>
<p>You can also test your Redis Cluster using the <code>redis-cli</code> command line utility:</p>
<pre tabindex="0"><code>$ redis-cli -c -p 7000
redis 127.0.0.1:7000&gt; set foo bar
-&gt; Redirected to slot [12182] located at 127.0.0.1:7002
OK
redis 127.0.0.1:7002&gt; set hello world
-&gt; Redirected to slot [866] located at 127.0.0.1:7000
OK
redis 127.0.0.1:7000&gt; get foo
-&gt; Redirected to slot [12182] located at 127.0.0.1:7002
"bar"
redis 127.0.0.1:7002&gt; get hello
-&gt; Redirected to slot [866] located at 127.0.0.1:7000
"world"
</code></pre><div class="pl-4 border-l-8">
<div class="font-semibold text-slate-900">Note</div>
<p>If you created the cluster using the script, your nodes may listen
on different ports, starting from 30001 by default.</p>
</div>
<p>The <code>redis-cli</code> cluster support is very basic, so it always uses the fact that
Redis Cluster nodes are able to redirect a client to the right node.
A serious client is able to do better than that, and cache the map between
hash slots and nodes addresses, to directly use the right connection to the
right node. The map is refreshed only when something changed in the cluster
configuration, for example after a failover or after the system administrator
changed the cluster layout by adding or removing nodes.</p>
<h4 id="write-an-example-app-with-redis-rb-cluster">Write an example app with redis-rb-cluster</h4>
<p>Before going forward showing how to operate the Redis Cluster, doing things
like a failover, or a resharding, we need to create some example application
or at least to be able to understand the semantics of a simple Redis Cluster
client interaction.</p>
<p>In this way we can run an example and at the same time try to make nodes
failing, or start a resharding, to see how Redis Cluster behaves under real
world conditions. It is not very helpful to see what happens while nobody
is writing to the cluster.</p>
<p>This section explains some basic usage of
<a href="https://github.com/antirez/redis-rb-cluster">redis-rb-cluster</a> showing two
examples.
The first is the following, and is the
<a href="https://github.com/antirez/redis-rb-cluster/blob/master/example.rb"><code>example.rb</code></a>
file inside the redis-rb-cluster distribution:</p>
<pre tabindex="0"><code>   1  require './cluster'
   2
   3  if ARGV.length != 2
   4      startup_nodes = [
   5          {:host =&gt; "127.0.0.1", :port =&gt; 7000},
   6          {:host =&gt; "127.0.0.1", :port =&gt; 7001}
   7      ]
   8  else
   9      startup_nodes = [
  10          {:host =&gt; ARGV[0], :port =&gt; ARGV[1].to_i}
  11      ]
  12  end
  13
  14  rc = RedisCluster.new(startup_nodes,32,:timeout =&gt; 0.1)
  15
  16  last = false
  17
  18  while not last
  19      begin
  20          last = rc.get("__last__")
  21          last = 0 if !last
  22      rescue =&gt; e
  23          puts "error #{e.to_s}"
  24          sleep 1
  25      end
  26  end
  27
  28  ((last.to_i+1)..1000000000).each{|x|
  29      begin
  30          rc.set("foo#{x}",x)
  31          puts rc.get("foo#{x}")
  32          rc.set("__last__",x)
  33      rescue =&gt; e
  34          puts "error #{e.to_s}"
  35      end
  36      sleep 0.1
  37  }
</code></pre><p>The application does a very simple thing, it sets keys in the form <code>foo&lt;number&gt;</code> to <code>number</code>, one after the other. So if you run the program the result is the
following stream of commands:</p>
<ul>
<li>SET foo0 0</li>
<li>SET foo1 1</li>
<li>SET foo2 2</li>
<li>And so forth...</li>
</ul>
<p>The program looks more complex than it should usually as it is designed to
show errors on the screen instead of exiting with an exception, so every
operation performed with the cluster is wrapped by <code>begin</code> <code>rescue</code> blocks.</p>
<p>The <strong>line 14</strong> is the first interesting line in the program. It creates the
Redis Cluster object, using as argument a list of <em>startup nodes</em>, the maximum
number of connections this object is allowed to take against different nodes,
and finally the timeout after a given operation is considered to be failed.</p>
<p>The startup nodes don't need to be all the nodes of the cluster. The important
thing is that at least one node is reachable. Also note that redis-rb-cluster
updates this list of startup nodes as soon as it is able to connect with the
first node. You should expect such a behavior with any other serious client.</p>
<p>Now that we have the Redis Cluster object instance stored in the <strong>rc</strong> variable,
we are ready to use the object like if it was a normal Redis object instance.</p>
<p>This is exactly what happens in <strong>line 18 to 26</strong>: when we restart the example
we don't want to start again with <code>foo0</code>, so we store the counter inside
Redis itself. The code above is designed to read this counter, or if the
counter does not exist, to assign it the value of zero.</p>
<p>However note how it is a while loop, as we want to try again and again even
if the cluster is down and is returning errors. Normal applications don't need
to be so careful.</p>
<p><strong>Lines between 28 and 37</strong> start the main loop where the keys are set or
an error is displayed.</p>
<p>Note the <code>sleep</code> call at the end of the loop. In your tests you can remove
the sleep if you want to write to the cluster as fast as possible (relatively
to the fact that this is a busy loop without real parallelism of course, so
you'll get the usually 10k ops/second in the best of the conditions).</p>
<p>Normally writes are slowed down in order for the example application to be
easier to follow by humans.</p>
<p>Starting the application produces the following output:</p>
<pre tabindex="0"><code>ruby ./example.rb
1
2
3
4
5
6
7
8
9
^C (I stopped the program here)
</code></pre><p>This is not a very interesting program and we'll use a better one in a moment
but we can already see what happens during a resharding when the program
is running.</p>
<h4 id="reshard-the-cluster">Reshard the cluster</h4>
<p>Now we are ready to try a cluster resharding. To do this, please
keep the example.rb program running, so that you can see if there is some
impact on the program running. Also, you may want to comment the <code>sleep</code>
call to have some more serious write load during resharding.</p>
<p>Resharding basically means to move hash slots from a set of nodes to another
set of nodes.
Like cluster creation, it is accomplished using the redis-cli utility.</p>
<p>To start a resharding, just type:</p>
<pre><code>redis-cli --cluster reshard 127.0.0.1:7000
</code></pre>
<p>You only need to specify a single node, redis-cli will find the other nodes
automatically.</p>
<p>Currently redis-cli is only able to reshard with the administrator support,
you can't just say move 5% of slots from this node to the other one (but
this is pretty trivial to implement). So it starts with questions. The first
is how much of a resharding do you want to do:</p>
<pre><code>How many slots do you want to move (from 1 to 16384)?
</code></pre>
<p>We can try to reshard 1000 hash slots, that should already contain a non
trivial amount of keys if the example is still running without the sleep
call.</p>
<p>Then redis-cli needs to know what is the target of the resharding, that is,
the node that will receive the hash slots.
I'll use the first master node, that is, 127.0.0.1:7000, but I need
to specify the Node ID of the instance. This was already printed in a
list by redis-cli, but I can always find the ID of a node with the following
command if I need:</p>
<pre tabindex="0"><code>$ redis-cli -p 7000 cluster nodes | grep myself
97a3a64667477371c4479320d683e4c8db5858b1 :0 myself,master - 0 0 0 connected 0-5460
</code></pre><p>Ok so my target node is 97a3a64667477371c4479320d683e4c8db5858b1.</p>
<p>Now you'll get asked from what nodes you want to take those keys.
I'll just type <code>all</code> in order to take a bit of hash slots from all the
other master nodes.</p>
<p>After the final confirmation you'll see a message for every slot that
redis-cli is going to move from a node to another, and a dot will be printed
for every actual key moved from one side to the other.</p>
<p>While the resharding is in progress you should be able to see your
example program running unaffected. You can stop and restart it multiple times
during the resharding if you want.</p>
<p>At the end of the resharding, you can test the health of the cluster with
the following command:</p>
<pre><code>redis-cli --cluster check 127.0.0.1:7000
</code></pre>
<p>All the slots will be covered as usual, but this time the master at
127.0.0.1:7000 will have more hash slots, something around 6461.</p>
<p>Resharding can be performed automatically without the need to manually
enter the parameters in an interactive way. This is possible using a command
line like the following:</p>
<pre><code>redis-cli --cluster reshard &lt;host&gt;:&lt;port&gt; --cluster-from &lt;node-id&gt; --cluster-to &lt;node-id&gt; --cluster-slots &lt;number of slots&gt; --cluster-yes
</code></pre>
<p>This allows to build some automatism if you are likely to reshard often,
however currently there is no way for <code>redis-cli</code> to automatically
rebalance the cluster checking the distribution of keys across the cluster
nodes and intelligently moving slots as needed. This feature will be added
in the future.</p>
<p>The <code>--cluster-yes</code> option instructs the cluster manager to automatically answer
"yes" to the command's prompts, allowing it to run in a non-interactive mode.
Note that this option can also be activated by setting the
<code>REDISCLI_CLUSTER_YES</code> environment variable.</p>
<h4 id="a-more-interesting-example-application">A more interesting example application</h4>
<p>The example application we wrote early is not very good.
It writes to the cluster in a simple way without even checking if what was
written is the right thing.</p>
<p>From our point of view the cluster receiving the writes could just always
write the key <code>foo</code> to <code>42</code> to every operation, and we would not notice at
all.</p>
<p>So in the <code>redis-rb-cluster</code> repository, there is a more interesting application
that is called <code>consistency-test.rb</code>. It uses a set of counters, by default 1000, and sends <a href="../../commands/incr.html"><code>INCR</code></a> commands in order to increment the counters.</p>
<p>However instead of just writing, the application does two additional things:</p>
<ul>
<li>When a counter is updated using <a href="../../commands/incr.html"><code>INCR</code></a>, the application remembers the write.</li>
<li>It also reads a random counter before every write, and check if the value is what we expected it to be, comparing it with the value it has in memory.</li>
</ul>
<p>What this means is that this application is a simple <strong>consistency checker</strong>,
and is able to tell you if the cluster lost some write, or if it accepted
a write that we did not receive acknowledgment for. In the first case we'll
see a counter having a value that is smaller than the one we remember, while
in the second case the value will be greater.</p>
<p>Running the consistency-test application produces a line of output every
second:</p>
<pre tabindex="0"><code>$ ruby consistency-test.rb
925 R (0 err) | 925 W (0 err) |
5030 R (0 err) | 5030 W (0 err) |
9261 R (0 err) | 9261 W (0 err) |
13517 R (0 err) | 13517 W (0 err) |
17780 R (0 err) | 17780 W (0 err) |
22025 R (0 err) | 22025 W (0 err) |
25818 R (0 err) | 25818 W (0 err) |
</code></pre><p>The line shows the number of <strong>R</strong>eads and <strong>W</strong>rites performed, and the
number of errors (query not accepted because of errors since the system was
not available).</p>
<p>If some inconsistency is found, new lines are added to the output.
This is what happens, for example, if I reset a counter manually while
the program is running:</p>
<pre tabindex="0"><code>$ redis-cli -h 127.0.0.1 -p 7000 set key_217 0
OK

(in the other tab I see...)

94774 R (0 err) | 94774 W (0 err) |
98821 R (0 err) | 98821 W (0 err) |
102886 R (0 err) | 102886 W (0 err) | 114 lost |
107046 R (0 err) | 107046 W (0 err) | 114 lost |
</code></pre><p>When I set the counter to 0 the real value was 114, so the program reports
114 lost writes (<a href="../../commands/incr.html"><code>INCR</code></a> commands that are not remembered by the cluster).</p>
<p>This program is much more interesting as a test case, so we'll use it
to test the Redis Cluster failover.</p>
<h4 id="test-the-failover">Test the failover</h4>
<p>To trigger the failover, the simplest thing we can do (that is also
the semantically simplest failure that can occur in a distributed system)
is to crash a single process, in our case a single master.</p>
<div class="pl-4 border-l-8">
<div class="font-semibold text-slate-900">Note</div>
<p>During this test, you should take a tab open with the consistency test
application running.</p>
</div> 
<p>We can identify a master and crash it with the following command:</p>
<pre tabindex="0"><code>$ redis-cli -p 7000 cluster nodes | grep master
3e3a6cb0d9a9a87168e266b0a0b24026c0aae3f0 127.0.0.1:7001 master - 0 1385482984082 0 connected 5960-10921
2938205e12de373867bf38f1ca29d31d0ddb3e46 127.0.0.1:7002 master - 0 1385482983582 0 connected 11423-16383
97a3a64667477371c4479320d683e4c8db5858b1 :0 myself,master - 0 0 0 connected 0-5959 10922-11422
</code></pre><p>Ok, so 7000, 7001, and 7002 are masters. Let's crash node 7002 with the
<strong>DEBUG SEGFAULT</strong> command:</p>
<pre tabindex="0"><code>$ redis-cli -p 7002 debug segfault
Error: Server closed the connection
</code></pre><p>Now we can look at the output of the consistency test to see what it reported.</p>
<pre tabindex="0"><code>18849 R (0 err) | 18849 W (0 err) |
23151 R (0 err) | 23151 W (0 err) |
27302 R (0 err) | 27302 W (0 err) |

... many error warnings here ...

29659 R (578 err) | 29660 W (577 err) |
33749 R (578 err) | 33750 W (577 err) |
37918 R (578 err) | 37919 W (577 err) |
42077 R (578 err) | 42078 W (577 err) |
</code></pre><p>As you can see during the failover the system was not able to accept 578 reads and 577 writes, however no inconsistency was created in the database. This may
sound unexpected as in the first part of this tutorial we stated that Redis
Cluster can lose writes during the failover because it uses asynchronous
replication. What we did not say is that this is not very likely to happen
because Redis sends the reply to the client, and the commands to replicate
to the replicas, about at the same time, so there is a very small window to
lose data. However the fact that it is hard to trigger does not mean that it
is impossible, so this does not change the consistency guarantees provided
by Redis cluster.</p>
<p>We can now check what is the cluster setup after the failover (note that
in the meantime I restarted the crashed instance so that it rejoins the
cluster as a replica):</p>
<pre tabindex="0"><code>$ redis-cli -p 7000 cluster nodes
3fc783611028b1707fd65345e763befb36454d73 127.0.0.1:7004 slave 3e3a6cb0d9a9a87168e266b0a0b24026c0aae3f0 0 1385503418521 0 connected
a211e242fc6b22a9427fed61285e85892fa04e08 127.0.0.1:7003 slave 97a3a64667477371c4479320d683e4c8db5858b1 0 1385503419023 0 connected
97a3a64667477371c4479320d683e4c8db5858b1 :0 myself,master - 0 0 0 connected 0-5959 10922-11422
3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e 127.0.0.1:7005 master - 0 1385503419023 3 connected 11423-16383
3e3a6cb0d9a9a87168e266b0a0b24026c0aae3f0 127.0.0.1:7001 master - 0 1385503417005 0 connected 5960-10921
2938205e12de373867bf38f1ca29d31d0ddb3e46 127.0.0.1:7002 slave 3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e 0 1385503418016 3 connected
</code></pre><p>Now the masters are running on ports 7000, 7001 and 7005. What was previously
a master, that is the Redis instance running on port 7002, is now a replica of
7005.</p>
<p>The output of the <a href="../../commands/cluster-nodes.html"><code>CLUSTER NODES</code></a> command may look intimidating, but it is actually pretty simple, and is composed of the following tokens:</p>
<ul>
<li>Node ID</li>
<li>ip:port</li>
<li>flags: master, replica, myself, fail, ...</li>
<li>if it is a replica, the Node ID of the master</li>
<li>Time of the last pending PING still waiting for a reply.</li>
<li>Time of the last PONG received.</li>
<li>Configuration epoch for this node (see the Cluster specification).</li>
<li>Status of the link to this node.</li>
<li>Slots served...</li>
</ul>
<h4 id="manual-failover">Manual failover</h4>
<p>Sometimes it is useful to force a failover without actually causing any problem
on a master. For example, to upgrade the Redis process of one of the
master nodes it is a good idea to failover it to turn it into a replica
with minimal impact on availability.</p>
<p>Manual failovers are supported by Redis Cluster using the <a href="../../commands/cluster-failover.html"><code>CLUSTER FAILOVER</code></a>
command, that must be executed in one of the replicas of the master you want
to failover.</p>
<p>Manual failovers are special and are safer compared to failovers resulting from
actual master failures. They occur in a way that avoids data loss in the
process, by switching clients from the original master to the new master only
when the system is sure that the new master processed all the replication stream
from the old one.</p>
<p>This is what you see in the replica log when you perform a manual failover:</p>
<pre><code># Manual failover user request accepted.
# Received replication offset for paused master manual failover: 347540
# All master replication stream processed, manual failover can start.
# Start of election delayed for 0 milliseconds (rank #0, offset 347540).
# Starting a failover election for epoch 7545.
# Failover election won: I'm the new master.
</code></pre>
<p>Basically clients connected to the master we are failing over are stopped.
At the same time the master sends its replication offset to the replica, that
waits to reach the offset on its side. When the replication offset is reached,
the failover starts, and the old master is informed about the configuration
switch. When the clients are unblocked on the old master, they are redirected
to the new master.</p>
<div class="pl-4 border-l-8">
<div class="font-semibold text-slate-900">Note</div>
<p>To promote a replica to master, it must first be known as a replica by a majority of the masters in the cluster.
Otherwise, it cannot win the failover election.
If the replica has just been added to the cluster (see <a href="#add-a-new-node-as-a-replica">Add a new node as a replica</a>), you may need to wait a while before sending the <a href="../../commands/cluster-failover.html"><code>CLUSTER FAILOVER</code></a> command, to make sure the masters in cluster are aware of the new replica.</p>
</div> 
<h4 id="add-a-new-node">Add a new node</h4>
<p>Adding a new node is basically the process of adding an empty node and then
moving some data into it, in case it is a new master, or telling it to
setup as a replica of a known node, in case it is a replica.</p>
<p>We'll show both, starting with the addition of a new master instance.</p>
<p>In both cases the first step to perform is <strong>adding an empty node</strong>.</p>
<p>This is as simple as to start a new node in port 7006 (we already used
from 7000 to 7005 for our existing 6 nodes) with the same configuration
used for the other nodes, except for the port number, so what you should
do in order to conform with the setup we used for the previous nodes:</p>
<ul>
<li>Create a new tab in your terminal application.</li>
<li>Enter the <code>cluster-test</code> directory.</li>
<li>Create a directory named <code>7006</code>.</li>
<li>Create a redis.conf file inside, similar to the one used for the other nodes but using 7006 as port number.</li>
<li>Finally start the server with <code>../redis-server ./redis.conf</code></li>
</ul>
<p>At this point the server should be running.</p>
<p>Now we can use <strong>redis-cli</strong> as usual in order to add the node to
the existing cluster.</p>
<pre><code>redis-cli --cluster add-node 127.0.0.1:7006 127.0.0.1:7000
</code></pre>
<p>As you can see I used the <strong>add-node</strong> command specifying the address of the
new node as first argument, and the address of a random existing node in the
cluster as second argument.</p>
<p>In practical terms redis-cli here did very little to help us, it just
sent a <a href="../../commands/cluster-meet.html"><code>CLUSTER MEET</code></a> message to the node, something that is also possible
to accomplish manually. However redis-cli also checks the state of the
cluster before to operate, so it is a good idea to perform cluster operations
always via redis-cli even when you know how the internals work.</p>
<p>Now we can connect to the new node to see if it really joined the cluster:</p>
<pre tabindex="0"><code>redis 127.0.0.1:7006&gt; cluster nodes
3e3a6cb0d9a9a87168e266b0a0b24026c0aae3f0 127.0.0.1:7001 master - 0 1385543178575 0 connected 5960-10921
3fc783611028b1707fd65345e763befb36454d73 127.0.0.1:7004 slave 3e3a6cb0d9a9a87168e266b0a0b24026c0aae3f0 0 1385543179583 0 connected
f093c80dde814da99c5cf72a7dd01590792b783b :0 myself,master - 0 0 0 connected
2938205e12de373867bf38f1ca29d31d0ddb3e46 127.0.0.1:7002 slave 3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e 0 1385543178072 3 connected
a211e242fc6b22a9427fed61285e85892fa04e08 127.0.0.1:7003 slave 97a3a64667477371c4479320d683e4c8db5858b1 0 1385543178575 0 connected
97a3a64667477371c4479320d683e4c8db5858b1 127.0.0.1:7000 master - 0 1385543179080 0 connected 0-5959 10922-11422
3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e 127.0.0.1:7005 master - 0 1385543177568 3 connected 11423-16383
</code></pre><p>Note that since this node is already connected to the cluster it is already
able to redirect client queries correctly and is generally speaking part of
the cluster. However it has two peculiarities compared to the other masters:</p>
<ul>
<li>It holds no data as it has no assigned hash slots.</li>
<li>Because it is a master without assigned slots, it does not participate in the election process when a replica wants to become a master.</li>
</ul>
<p>Now it is possible to assign hash slots to this node using the resharding
feature of <code>redis-cli</code>.
It is basically useless to show this as we already
did in a previous section, there is no difference, it is just a resharding
having as a target the empty node.</p>
<h5 id="add-a-new-node-as-a-replica">Add a new node as a replica</h5>
<p>Adding a new replica can be performed in two ways. The obvious one is to
use redis-cli again, but with the --cluster-slave option, like this:</p>
<pre><code>redis-cli --cluster add-node 127.0.0.1:7006 127.0.0.1:7000 --cluster-slave
</code></pre>
<p>Note that the command line here is exactly like the one we used to add
a new master, so we are not specifying to which master we want to add
the replica. In this case, what happens is that redis-cli will add the new
node as replica of a random master among the masters with fewer replicas.</p>
<p>However you can specify exactly what master you want to target with your
new replica with the following command line:</p>
<pre><code>redis-cli --cluster add-node 127.0.0.1:7006 127.0.0.1:7000 --cluster-slave --cluster-master-id 3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e
</code></pre>
<p>This way we assign the new replica to a specific master.</p>
<p>A more manual way to add a replica to a specific master is to add the new
node as an empty master, and then turn it into a replica using the
<a href="../../commands/cluster-replicate.html"><code>CLUSTER REPLICATE</code></a> command. This also works if the node was added as a replica
but you want to move it as a replica of a different master.</p>
<p>For example in order to add a replica for the node 127.0.0.1:7005 that is
currently serving hash slots in the range 11423-16383, that has a Node ID
3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e, all I need to do is to connect
with the new node (already added as empty master) and send the command:</p>
<pre><code>redis 127.0.0.1:7006&gt; cluster replicate 3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e
</code></pre>
<p>That's it. Now we have a new replica for this set of hash slots, and all
the other nodes in the cluster already know (after a few seconds needed to
update their config). We can verify with the following command:</p>
<pre tabindex="0"><code>$ redis-cli -p 7000 cluster nodes | grep slave | grep 3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e
f093c80dde814da99c5cf72a7dd01590792b783b 127.0.0.1:7006 slave 3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e 0 1385543617702 3 connected
2938205e12de373867bf38f1ca29d31d0ddb3e46 127.0.0.1:7002 slave 3c3a0c74aae0b56170ccb03a76b60cfe7dc1912e 0 1385543617198 3 connected
</code></pre><p>The node 3c3a0c... now has two replicas, running on ports 7002 (the existing one) and 7006 (the new one).</p>
<h4 id="remove-a-node">Remove a node</h4>
<p>To remove a replica node just use the <code>del-node</code> command of redis-cli:</p>
<pre><code>redis-cli --cluster del-node 127.0.0.1:7000 `&lt;node-id&gt;`
</code></pre>
<p>The first argument is just a random node in the cluster, the second argument
is the ID of the node you want to remove.</p>
<p>You can remove a master node in the same way as well, <strong>however in order to
remove a master node it must be empty</strong>. If the master is not empty you need
to reshard data away from it to all the other master nodes before.</p>
<p>An alternative to remove a master node is to perform a manual failover of it
over one of its replicas and remove the node after it turned into a replica of the
new master. Obviously this does not help when you want to reduce the actual
number of masters in your cluster, in that case, a resharding is needed.</p>
<h4 id="replica-migration">Replica migration</h4>
<p>In Redis Cluster, you can reconfigure a replica to replicate with a
different master at any time just using this command:</p>
<pre><code>CLUSTER REPLICATE &lt;master-node-id&gt;
</code></pre>
<p>However there is a special scenario where you want replicas to move from one
master to another one automatically, without the help of the system administrator.
The automatic reconfiguration of replicas is called <em>replicas migration</em> and is
able to improve the reliability of a Redis Cluster.</p>
<div class="pl-4 border-l-8">
<div class="font-semibold text-slate-900">Note</div>
<p>You can read the details of replicas migration in the <a href="../reference/cluster-spec.html">Redis Cluster Specification</a>, here we'll only provide some information about the
general idea and what you should do in order to benefit from it.</p>
</div> 
<p>The reason why you may want to let your cluster replicas to move from one master
to another under certain condition, is that usually the Redis Cluster is as
resistant to failures as the number of replicas attached to a given master.</p>
<p>For example a cluster where every master has a single replica can't continue
operations if the master and its replica fail at the same time, simply because
there is no other instance to have a copy of the hash slots the master was
serving. However while net-splits are likely to isolate a number of nodes
at the same time, many other kind of failures, like hardware or software failures
local to a single node, are a very notable class of failures that are unlikely
to happen at the same time, so it is possible that in your cluster where
every master has a replica, the replica is killed at 4am, and the master is killed
at 6am. This still will result in a cluster that can no longer operate.</p>
<p>To improve reliability of the system we have the option to add additional
replicas to every master, but this is expensive. Replica migration allows to
add more replicas to just a few masters. So you have 10 masters with 1 replica
each, for a total of 20 instances. However you add, for example, 3 instances
more as replicas of some of your masters, so certain masters will have more
than a single replica.</p>
<p>With replicas migration what happens is that if a master is left without
replicas, a replica from a master that has multiple replicas will migrate to
the <em>orphaned</em> master. So after your replica goes down at 4am as in the example
we made above, another replica will take its place, and when the master
will fail as well at 5am, there is still a replica that can be elected so that
the cluster can continue to operate.</p>
<p>So what you should know about replicas migration in short?</p>
<ul>
<li>The cluster will try to migrate a replica from the master that has the greatest number of replicas in a given moment.</li>
<li>To benefit from replica migration you have just to add a few more replicas to a single master in your cluster, it does not matter what master.</li>
<li>There is a configuration parameter that controls the replica migration feature that is called <code>cluster-migration-barrier</code>: you can read more about it in the example <code>redis.conf</code> file provided with Redis Cluster.</li>
</ul>
<h4 id="upgrade-nodes-in-a-redis-cluster">Upgrade nodes in a Redis Cluster</h4>
<p>Upgrading replica nodes is easy since you just need to stop the node and restart
it with an updated version of Redis. If there are clients scaling reads using
replica nodes, they should be able to reconnect to a different replica if a given
one is not available.</p>
<p>Upgrading masters is a bit more complex, and the suggested procedure is:</p>
<ol>
<li>Use <a href="../../commands/cluster-failover.html"><code>CLUSTER FAILOVER</code></a> to trigger a manual failover of the master to one of its replicas.
(See the <a href="#manual-failover">Manual failover</a> in this topic.)</li>
<li>Wait for the master to turn into a replica.</li>
<li>Finally upgrade the node as you do for replicas.</li>
<li>If you want the master to be the node you just upgraded, trigger a new manual failover in order to turn back the upgraded node into a master.</li>
</ol>
<p>Following this procedure you should upgrade one node after the other until
all the nodes are upgraded.</p>
<h4 id="migrate-to-redis-cluster">Migrate to Redis Cluster</h4>
<p>Users willing to migrate to Redis Cluster may have just a single master, or
may already using a preexisting sharding setup, where keys
are split among N nodes, using some in-house algorithm or a sharding algorithm
implemented by their client library or Redis proxy.</p>
<p>In both cases it is possible to migrate to Redis Cluster easily, however
what is the most important detail is if multiple-keys operations are used
by the application, and how. There are three different cases:</p>
<ol>
<li>Multiple keys operations, or transactions, or Lua scripts involving multiple keys, are not used. Keys are accessed independently (even if accessed via transactions or Lua scripts grouping multiple commands, about the same key, together).</li>
<li>Multiple keys operations, or transactions, or Lua scripts involving multiple keys are used but only with keys having the same <strong>hash tag</strong>, which means that the keys used together all have a <code>{...}</code> sub-string that happens to be identical. For example the following multiple keys operation is defined in the context of the same hash tag: <code>SUNION {user:1000}.foo {user:1000}.bar</code>.</li>
<li>Multiple keys operations, or transactions, or Lua scripts involving multiple keys are used with key names not having an explicit, or the same, hash tag.</li>
</ol>
<p>The third case is not handled by Redis Cluster: the application requires to
be modified in order to don't use multi keys operations or only use them in
the context of the same hash tag.</p>
<p>Case 1 and 2 are covered, so we'll focus on those two cases, that are handled
in the same way, so no distinction will be made in the documentation.</p>
<p>Assuming you have your preexisting data set split into N masters, where
N=1 if you have no preexisting sharding, the following steps are needed
in order to migrate your data set to Redis Cluster:</p>
<ol>
<li>Stop your clients. No automatic live-migration to Redis Cluster is currently possible. You may be able to do it orchestrating a live migration in the context of your application / environment.</li>
<li>Generate an append only file for all of your N masters using the <a href="../../commands/bgrewriteaof.html"><code>BGREWRITEAOF</code></a> command, and waiting for the AOF file to be completely generated.</li>
<li>Save your AOF files from aof-1 to aof-N somewhere. At this point you can stop your old instances if you wish (this is useful since in non-virtualized deployments you often need to reuse the same computers).</li>
<li>Create a Redis Cluster composed of N masters and zero replicas. You'll add replicas later. Make sure all your nodes are using the append only file for persistence.</li>
<li>Stop all the cluster nodes, substitute their append only file with your pre-existing append only files, aof-1 for the first node, aof-2 for the second node, up to aof-N.</li>
<li>Restart your Redis Cluster nodes with the new AOF files. They'll complain that there are keys that should not be there according to their configuration.</li>
<li>Use <code>redis-cli --cluster fix</code> command in order to fix the cluster so that keys will be migrated according to the hash slots each node is authoritative or not.</li>
<li>Use <code>redis-cli --cluster check</code> at the end to make sure your cluster is ok.</li>
<li>Restart your clients modified to use a Redis Cluster aware client library.</li>
</ol>
<p>There is an alternative way to import data from external instances to a Redis
Cluster, which is to use the <code>redis-cli --cluster import</code> command.</p>
<p>The command moves all the keys of a running instance (deleting the keys from
the source instance) to the specified pre-existing Redis Cluster. However
note that if you use a Redis 2.8 instance as source instance the operation
may be slow since 2.8 does not implement migrate connection caching, so you
may want to restart your source instance with a Redis 3.x version before
to perform such operation.</p>
<div class="pl-4 border-l-8">
<div class="font-semibold text-slate-900">Note</div>
<p>Starting with Redis 5, if not for backward compatibility, the Redis project no longer uses the word slave. Unfortunately in this command the word slave is part of the protocol, so we'll be able to remove such occurrences only when this API will be naturally deprecated.</p>
</div> 
<a class="dashAnchor" name="//apple_ref/Section/Learn%20more"></a><h2 id="learn-more">Learn more</h2>
<ul>
<li><a href="../reference/cluster-spec.html">Redis Cluster specification</a></li>
<li><a href="https://redis.com/redis-enterprise/technology/linear-scaling-redis-enterprise/">Linear Scaling with Redis Enterprise</a></li>
<li><a href="https://docs.docker.com/engine/userguide/networking/dockernetworks/">Docker documentation</a></li>
</ul>

          
  <form class="page-feedback" method="POST" name="page-feedback"><input type="hidden" name="form-name" value="page-feedback">
    <input name="origin" value="https://redis.io/docs/management/scaling/" class="hidden">
  <div class="grid justify-center mt-10 pt-10 border-t-2">
    <span class="font-bold font-small">Rate this page</span>
    <div class="star-rating">
      
      <input type="radio" id="5-stars" name="rating" value="5" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="5-stars" class="star">★</label>
      
      <input type="radio" id="4-stars" name="rating" value="4" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="4-stars" class="star">★</label>
      
      <input type="radio" id="3-stars" name="rating" value="3" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="3-stars" class="star">★</label>
      
      <input type="radio" id="2-stars" name="rating" value="2" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="2-stars" class="star">★</label>
      
      <input type="radio" id="1-stars" name="rating" value="1" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="1-stars" class="star">★</label>
      
    </div>  
  </div>
  <div id="feedback-form" class="hidden">
    <div class="feedback-submit">
      <textarea name="comment" placeholder="Why did you choose this rating?" class="border border-neutral-500 p-2 mt-1 block w-full h-24" rows="3"></textarea>
      <button class="button button-indigo w-min justify-self-end" type="submit">
        Submit
      </button>
    </div>
  </div>
</form>
      </section>
    </div>
    

  <section class="hidden xl:block w-52 h-full shrink-0">
    <div class="w-52 z-40 hidden bg-white/75 md:block overflow-auto fixed top-28 h-full max-h-[calc(100vh-15rem)] text-[0.8125rem]">
      





<nav class="flex flex-col gap-1 mb-6 pb-2 border-b-2">
  <a href="https://github.com/redis/redis-doc/edit/master/docs/management/scaling.md" target="_blank" class="group inline-flex items-center gap-1 text-sm text-slate-700 hover:text-indigo-600 mt-auto self-start">
    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
      <path d="M11 44q-1.2 0-2.1-.9Q8 42.2 8 41V7q0-1.2.9-2.1Q9.8 4 11 4h17l12 12v7.8h-3V18H26V7H11v34h15v3Zm0-3V7v34Zm26.8-11.15 1.4 1.4-8.2 8.2V42h2.55l8.2-8.2 1.4 1.4-8.8 8.8H29v-5.35Zm5.35 5.35-5.35-5.35 3.05-3.05q.45-.45 1.05-.45.6 0 1.05.45l3.25 3.25q.45.45.45 1.05 0 .6-.45 1.05Z" fill="currentColor"></path>
    </svg>
    Edit this page
  </a>
  <a href="https://github.com/redis/redis-doc/issues/new?title=Scaling%20with%20Redis%20Cluster" target="_blank" class="group inline-flex items-center gap-1 text-sm text-slate-700 hover:text-indigo-600 mt-auto self-start">
    <svg class="w-4 h-4" viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="currentColor"></path>
    </svg>
    Create an issue
  </a>
</nav>


      
        <h1 class="font-semibold my-3">On This Page</h1>
        <nav class="text-slate-700">
          <nav id="TableOfContents">
  <ul>
    <li><a href="#redis-cluster-101">Redis Cluster 101</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#redis-cluster-configuration-parameters">Redis Cluster configuration parameters</a></li>
    <li><a href="#create-and-use-a-redis-cluster">Create and use a Redis Cluster</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#learn-more">Learn more</a></li>
  </ul>
</nav>
        </nav>
        
    </div>
  </section>


  </main>


    <footer class="bg-midnight-700 relative z-50">
      <p class="container max-w-[85rem] mx-auto px-4 sm:px-8 py-8 text-slate-400 text-sm text-center">
  This is a community website sponsored by <a href="https://redis.com/" class="text-white underline underline-offset-1 decoration-transparent hover:decoration-slate-500 transition-colors">Redis Ltd.</a> © 2023. Redis and the cube logo are registered trademarks of Redis Ltd. <a href="../../terms.html" class="text-white underline underline-offset-1 decoration-transparent hover:decoration-slate-500 transition-colors">Terms of use &amp; privacy policy</a>.
</p>

      <script>
  
  document.addEventListener('DOMContentLoaded', () => {

    const TableOfContents = {
      container: document.querySelector('#TableOfContents'),
      links: null,
      headings: null,
      intersectionOptions: {
        rootMargin: '0px',
        threshold: 1
      },
      previousSection: null,
      observer: null,

      init() {
        if (!this.container) return false

        this.handleObserver = this.handleObserver.bind(this)
        this.setUpObserver()
        this.findLinksAndHeadings()
        this.observeSections()
      },

      handleObserver(entries, observer) {
        entries.forEach(entry => {
          let href = `#${entry.target.getAttribute('id')}`
          let link = this.links.find(l => l.getAttribute('href') === href)

          if (entry.isIntersecting && entry.intersectionRatio >= 1) {
            link.classList.add('visible')
            this.previousSection = entry.target.getAttribute('id')
          } else {
            link.classList.remove('visible')
          }

          this.highlightFirstActive()
        })
      },

      highlightFirstActive() {
        let firstVisibleLink = this.container.querySelector('.visible')

        this.links.forEach(link => {
          link.classList.remove('active')
        })

        if (firstVisibleLink) {
          firstVisibleLink.classList.add('active')
        }

        if (!firstVisibleLink && this.previousSection) {
          this.container.querySelector(
            `a[href="#${this.previousSection}"]`
          ).classList.add('active')
        }
      },

      observeSections() {
        this.headings.forEach(heading => {
          this.observer.observe(heading)
        })
      },

      setUpObserver() {
        this.observer = new IntersectionObserver(
          this.handleObserver,
          this.intersectionOptions
        )
      },

      findLinksAndHeadings() {
        this.links = [...this.container.querySelectorAll('a')]
        this.headings = this.links.map(link => {
          let id = link.getAttribute('href')
          return document.querySelector(id)
        })
      }
    }

    TableOfContents.init()

})
</script>
    </footer>

    
<div class="sr-only w-screen h-screen fixed z-[200] top-0 left-0 cursor-auto flex flex-col bg-slate-900/75 p-4 sm:p-6 md:p-[10vh] lg:p-[12vh]" id="search-container" role="button" aria-expanded="true" aria-haspopup="listbox" aria-labelledby="search-label" tabindex="0">
  <div class="search-modal">
    <header class="search-bar">
      <form id="search-form" class="search-form">
        <label class="search-magnifier-label" for="search-input" id="search-label">
          <svg width="20" height="20" class="search-icon" viewBox="0 0 20 20">
            <path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </label>
        <div class="search-loading-indicator">
          <svg viewBox="0 0 38 38" stroke="currentColor" stroke-opacity=".5">
            <g fill="none" fill-rule="evenodd">
              <g transform="translate(1 1)" stroke-width="2">
                <circle stroke-opacity=".3" cx="18" cy="18" r="18"></circle>
                <path d="M36 18c0-9.94-8.06-18-18-18">
                  <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"></animateTransform>
                </path>
              </g>
            </g>
          </svg>
        </div>
        <input class="search-input" aria-autocomplete="both" aria-labelledby="search-label" id="search-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search…" maxlength="64" type="search" value="">
        <button type="reset" title="Clear the query" class="search-reset" aria-label="Clear the query" hidden="">
          <svg width="20" height="20" viewBox="0 0 20 20">
            <path d="M10 10l5.09-5.09L10 10l5.09 5.09L10 10zm0 0L4.91 4.91 10 10l-5.09 5.09L10 10z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </button>
      </form>
      <button id="search-cancel" type="reset" aria-label="Cancel">
        Cancel
      </button>
    </header>
    <dl id="search-results" class="search-results" role="listbox"></dl>
    <footer class="search-footer">
      <a href="../stack/search.html" target="_blank" rel="noopener noreferrer">
        <span class="logo-label">Powered by Redis Stack</span>
        
        <svg viewBox="0 0 39 31" fill="none"><path d="M21.7371 15.2903C21.5759 15.2895 21.4198 15.2337 21.2947 15.1321 21.1695 15.0305 21.0828 14.8892 21.049 14.7316S21.0362 14.4096 21.1086 14.2655C21.1811 14.1215 21.3005 14.0066 21.4472 13.9397L35.7199 7.47338 21.4578 1.34289C21.2943 1.26329 21.1678 1.12377 21.1045.953307 21.0412.78285 21.046.594558 21.1179.427547 21.1898.260535 21.3233.127641 21.4906.0564719 21.6579-.0146977 21.8462-.0186728 22.0164.045373L37.7492 6.80518C37.8747 6.8605 37.9814 6.95112 38.0563 7.06599S38.171 7.31503 38.171 7.45216 38.1312 7.72347 38.0563 7.83834C37.9814 7.95321 37.8747 8.04383 37.7492 8.09915L22.0306 15.2266C21.9388 15.2698 21.8385 15.2916 21.7371 15.2903z" fill="#db2e2e"></path><path d="M16.4339 15.2903C16.3379 15.2906 16.2429 15.2714 16.1546 15.2337L.421813 8.47393C.296339 8.41861.18966 8.32799.114767 8.21312.0398745 8.09825.0 7.96407.0 7.82694.0 7.68981.0398745 7.55564.114767 7.44077.18966 7.3259.296339 7.23528.421813 7.17995L16.1546.052465C16.3235-.0111265 16.5104-.00772359 16.6768.0619772 16.8433.131678 16.9768.2624 17.0501.427363 17.1233.592325 17.1306.779042 17.0706.949259 17.0106 1.11948 16.8878 1.26031 16.7274 1.34291L2.44763 7.80573 16.7132 13.9362C16.8612 14.0015 16.9823 14.1154 17.0565 14.2592 17.1306 14.4029 17.1532 14.5677 17.1205 14.7261 17.0878 14.8845 17.0019 15.0269 16.8769 15.1295 16.752 15.2322 16.5956 15.2889 16.4339 15.2903z" fill="#db2e2e"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 17.4328c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 13.9539C37.3908 13.8108 37.6564 13.6514 37.9118 13.4766 37.972 13.8833 37.972 14.2967 37.9118 14.7034 37.8022 15.1312 37.4875 15.4847 36.289 16.061 35.4617 16.4605 33.1531 17.408 30.5792 18.4687c-3.6167 1.4884-7.778 3.1819-9.0826 3.889C19.2587 23.4183 18.0284 23.4183 16.3137 22.644 15.4864 22.2021 12.4918 20.9117 9.39476 19.5611c-3.3198-1.446-6.75627-2.945-7.77802-3.4753C.22377 15.3575.153061 15.1948.160132 14.8271V13.8655L.513678 14.0564c1.311652.6647 7.219412 3.1819 11.486722 5.0204 2.1142.898 3.8112 1.6298 4.3769 1.8844C18.092 21.7319 19.3082 21.8733 21.5603 20.6748 22.7022 20.0808 25.9619 18.7409 29.1651 17.4328z" fill="#494c4d"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 24.5037c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 21.0248C37.3908 20.8817 37.6564 20.7223 37.9118 20.5475 37.972 20.9542 37.972 21.3676 37.9118 21.7743 37.8022 22.2021 37.4875 22.5557 36.289 23.1319 35.4617 23.5314 33.1531 24.4789 30.5792 25.5396c-3.6167 1.4884-7.778 3.1819-9.0826 3.889-2.2379 1.0606-3.4682 1.0606-5.1829.2864C15.4864 29.2801 12.4918 27.9755 9.39476 26.625c-3.3198-1.446-6.75627-2.9451-7.77802-3.4754C.22377 22.4213.153061 22.2587.160132 21.891V20.9364L.513678 21.1273C1.82533 21.792 7.73309 24.3092 12.0004 26.1477c2.1001.898 3.8006 1.6298 4.3663 1.8844C18.0814 28.8028 19.2976 28.9442 21.5497 27.7457 22.7022 27.1518 25.9619 25.8118 29.1651 24.5037z" fill="#494c4d"></path></svg>
      </a>
    </footer>
  </div>
</div>

<script>
  const searchModal = (() => {
    const searchButton = document.querySelector('#search-button')
    const searchContainer = document.querySelector('#search-container')
    const searchInput = searchContainer.querySelector('#search-input')
    const resultsContainer = searchContainer.querySelector('#search-results')
    const style = document.createElement('style')
    
    let keys = {}
    let focusable
    let firstFocusable
    let lastFocusable
  
    function next (elem, selector) {
      let nextElem = elem.nextElementSibling
      if (!selector) return nextElem
      if (nextElem && nextElem.matches(selector)) return nextElem
      return null
    }
  
    function debounce(callback, delay) {
      let timeout
      
      return function() {
        clearTimeout(timeout)
        timeout = setTimeout(callback, delay)
      }
    }
  
    function searchSubmit(form) {
      if (form.id !== 'search-form') return false
  
      const searchTerm = searchInput.value
  
      if (searchTerm.length < 1) {
        resultsContainer.innerHTML = ''
        return
      }
  
      function search(url) {
        let promise = new Promise((resolve, reject) => {
          const req = new XMLHttpRequest()
          req.open('GET', url)
          req.onload = function() {
            if (req.status === 200) {
              resolve(JSON.parse(req.response))
            } else {
              reject(Error(req.status))
            }
          }
          req.send()
        })
  
        return promise
      }
  
      function sortData(data) {
        
        const getCategories = (data) =>
          data.reduce((a, c) => {
            if (!a.includes(c.hierarchy[0])) {
              a.push(c.hierarchy[0])
            }
  
            return a
          }, [])

        
        const constructSectionTitle = (record) => {
          if (record.hierarchy && record.hierarchy.length > 2) {
            return record.hierarchy[1]
          } else {
            return record.title
          }
        }

        
        const mergeData = (data, categories) =>
          categories.map((category) => {
            const obj = {}
            obj.category = category
  
            data.forEach((record) => {
              if (record.hierarchy[0] === category) {
                obj[record.title] = {
                  path: constructSectionTitle(record),
                  url: record.url,
                }
              }
            })
  
            return obj
          })
  
        return mergeData(data.results, getCategories(data.results))
      }
  
      function escape_evil_chars(str_in) {
        return str_in.replaceAll('>','&gt;').replaceAll('<', '&lt;').replaceAll('&', '&amp;').replaceAll('"','&quot;').replaceAll("'",'&#x27;')
      }   
      
      function displayData(data) {
        resultsContainer.innerHTML = ''
        
        if (data.results.length < 1) {
          escapedSearchTerm = escape_evil_chars(searchTerm)
          resultsContainer.insertAdjacentHTML(
            'beforeend',
            `<dt class="sr-only">${escapedSearchTerm}:</dt>
            <dd class="search-no-results">
              No results for \"<span class="search-title">${escapedSearchTerm}</span>\"
            </dd>`
          )
        } else {
          sortData(data).forEach((result) => {
            resultsContainer.insertAdjacentHTML(
              'beforeend', 
              `<dt class="search-item-source">
                ${result.category}
              </dt>`
            )
    
            delete result.category
    
            Object.keys(result).forEach((key, index) => {
              resultsContainer.insertAdjacentHTML(
                'beforeend',
                `<dd class="search-item" role="option">
                  <a href="${result[key].url}">
                    <span class="search-item-icon"></span>
                    <span class="search-item-content">
                      ${result[key].path ? `<span class="search-item-path">${result[key].path}</span>` : ''}
                      <span class="search-item-title">${key.replace(new RegExp(`(^|)(${searchTerm})(|$)`, 'ig'), '$1<b class="search-term-match">$2</b>$3')}</span>
                    </span>
                    <span class="search-item-action"></span>
                  </a>
                </dd>`
              )
            })
            
            if (!resultsContainer.querySelector('[aria-selected]')) resultsContainer.querySelector('.search-item').setAttribute('aria-selected', '')
          })
        }
        return
      }
  
      function displayError(error) {
        console.log(error)
      }
  
      search(`https://search-service.redislabs.com/search?q=${searchTerm}*&site=https://redis.io`)
        .then(displayData)
        .catch(displayError)
    }
  
    function loadHandler(event) {
      style.innerHTML = `
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      `
  
      document.head.appendChild(style)
      document.documentElement.dataset.searchState = 'off'
    }
  
    function getNextSibling(elem, selector, direction) {
      let sibling = direction === 'down' ? elem.nextElementSibling : elem.previousElementSibling
    
      while (sibling) {
        if (sibling.matches(selector)) return sibling
        sibling = direction === 'down' ? sibling.nextElementSibling : sibling.previousElementSibling
      }
    }
  
    function tabSelection(direction) {
      const currentSelection = resultsContainer.querySelector('[aria-selected]')
      if (!currentSelection || direction === 'down' && !currentSelection.nextElementSibling || direction === 'up' && !currentSelection.previousElementSibling) return false
        
      const nextSelection = getNextSibling(currentSelection, '.search-item', direction)
      if (!nextSelection) return false
      
      nextSelection.setAttribute('aria-selected', '')
      currentSelection.removeAttribute('aria-selected')
      resultsContainer.scrollTop = nextSelection.offsetTop - resultsContainer.offsetTop
    }
    
    function keyDownHandler(event) {
      switch (event.key) {
  
        // Arrow keys
        case 'ArrowDown':
          if (document.documentElement.dataset.searchState === 'off' || !document.querySelector('.search-item')) return false
          event.preventDefault()
          tabSelection('down')
          break
  
        case 'ArrowUp':
          if (document.documentElement.dataset.searchState === 'off' || !document.querySelector('.search-item')) return false
          event.preventDefault()
          tabSelection('up')
          break
  
        // Tab
        case 'Tab':
          if (document.documentElement.dataset.searchState === 'off') return false
  
          if (focusable.length === 1) {
            event.preventDefault()
            break
          }
  
          // If shift is fired, tab backward
          if (event.shiftKey) {
            if (document.activeElement === firstFocusable) {
              event.preventDefault()
              lastFocusable.focus()
            }
  
            // Otherwise tab forward
          } else {
            if (document.activeElement === lastFocusable) {
              event.preventDefault()
              firstFocusable.focus()
            }
          }
          break
  
        // Esc
        case 'Escape':
          if (document.documentElement.dataset.searchState === 'off') return false
          stopSearch()
          break
        
        // Enter
        case 'Enter':
          if (!document.querySelector('.search-item:focus-within') && document.querySelector('.search-item[aria-selected]')) {
            event.preventDefault()
            document.querySelector('.search-item[aria-selected] a').click()
          }
          break
  
        // Forward slash
        case '/':
          if (document.documentElement.dataset.searchState === 'on') return false
          event.preventDefault()
          startSearch()
          break
      
        // Default
        default:
          return false
          break
      }
    }
  
    function keyUpHandler(event) {
      if (document.documentElement.dataset.searchState === 'off' || !document.activeElement.matches('.search-input')) return false
      
      switch (event.key) {
        case 'ArrowDown':
          return false
          break
        case 'ArrowUp':
          return false
          break
        case 'ArrowLeft':
          return false
          break
        case 'ArrowRight':
          return false
          break
        case 'Tab':
          return false
          break
        case 'Escape':
          return false
          break
        case 'Enter':
          return false
          break
        case '/':
          return false
          break
        default:
          searchSubmit(document.activeElement.closest('form'))
          break
      }
    }
  
    function multiKeyHandler(event) {
      if (document.documentElement.dataset.searchState === 'on') return false
  
      let { key, type } = event
      let isKeyDown = (type == 'keydown')
      keys[key] = isKeyDown
  
      // Both (cmd || cntrl) & k pressed
      if (isKeyDown && (keys.Control || keys.Meta) && keys.k) {
        event.preventDefault()
        startSearch()
      }
    }
  
    // Click handler function
    function clickHandler(event) {
      if (event.target.closest('#search-button')) {
        startSearch()
      } else if (event.target.closest('#search-cancel') || event.target.matches('#search-container')) {
        stopSearch()
      }
    }
  
    function startSearch() {
      sessionStorage.setItem('scroll-position', document.documentElement.scrollTop)
      document.documentElement.dataset.scrollDisabled = 'on'
      document.documentElement.dataset.searchState = 'on'
      allowFocus(searchContainer, true)
      trapFocus(searchContainer)
      searchInput.focus()
    }
  
    function stopSearch() {
      document.documentElement.dataset.searchState = 'off'
      document.documentElement.dataset.scrollDisabled = 'off'
      document.documentElement.scrollTop = sessionStorage.getItem('scroll-position')
      allowFocus(searchContainer, false)
      document.activeElement.blur()
      resultsContainer.innerHTML = ''
      searchInput.value = ''
      keys = {}
    }
  
    function submitHandler(event) {
      if (event.target.id === 'search-form') {
        event.preventDefault()
        return false
      }
    }
  
    function allowFocus(selector, state) {
      const focusable = selector.querySelectorAll('button, [href], input, select, textarea')
      focusable.forEach(el => el.setAttribute('tabindex', state ? '' : '-1'))
      selector.classList.toggle('sr-only')
    }
  
    function trapFocus(selector) {
      focusable = selector.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"]')
      firstFocusable = focusable[0]
      lastFocusable = focusable[focusable.length - 1]
    }
  
    // Attach event listeners
    document.addEventListener('DOMContentLoaded', loadHandler)
    document.addEventListener('click', clickHandler)
    document.addEventListener('keydown', event => debounce(keyDownHandler(event), 100))
    document.addEventListener('keyup', event => debounce(keyUpHandler(event), 100))
    document.addEventListener('keydown', multiKeyHandler)
    document.addEventListener('keyup', multiKeyHandler)
    document.addEventListener('submit', submitHandler)
  })()
</script>
  

</body></html>