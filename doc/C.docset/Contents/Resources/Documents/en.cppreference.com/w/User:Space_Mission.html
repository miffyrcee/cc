<html><!-- Online page at https://en.cppreference.com/w/User:Space_Mission --><head><meta charset="utf-8"><title>User:Space Mission</title><link rel="stylesheet" href="./css_1.css" type="text/css"><link rel="stylesheet" href="./css_2.css" type="text/css"><link rel="stylesheet" href="./css_3.css" type="text/css"><link rel="stylesheet" href="./css_4.css" type="text/css"><link rel="stylesheet" href="./css_5.css" type="text/css"><link rel="stylesheet" href="./css_6.css" type="text/css"><link rel="stylesheet" href="./css_8.css" type="text/css"><link rel="stylesheet" href="./css_9.css" type="text/css"><link rel="stylesheet" href="./css_10.css" type="text/css"><link rel="stylesheet" href="./css_11.css" type="text/css"><script type="text/javascript" src="./js_1.js"></script><script type="text/javascript" src="./js_2.js"></script><script type="text/javascript" src="./js_5959.js"></script><script type="text/javascript" src="./js_4.js"></script><script type="text/javascript" src="./js_5.js"></script><script type="text/javascript" src="./js_6.js"></script><script type="text/javascript" src="./js_7.js"></script><script type="text/javascript" src="./js_8.js"></script><script type="text/javascript" src="./js_9.js"></script><script type="text/javascript" src="./js_10.js"></script><script type="text/javascript" src="./js_11.js"></script><script type="text/javascript" src="./js_12.js"></script><script type="text/javascript" src="./js_13.js"></script><script type="text/javascript" src="./js_14.js"></script><script type="text/javascript" src="./js_15.js"></script><style>.t-example-live-link {display:none !important} .t-sidebar-body {display:none}\nbody{min-width:0}\ndiv.mw-geshi{width:95%}\ndiv#content {width:auto !important} div#content{background-image:none; margin-left:0px;} .t-lines {background:inherit !important} pre, div.mw-geshi {width: 100% !important} body {background:white !important} div#content {width:100% !important} pre, div.mw-geshi {width:auto !important} .t-example-live-link, #mw-head, #cpp-footer-base {display:none !important} .t-navbar-menu > div {position:relative !important}</style></head><body class="mediawiki ltr sitedir-ltr ns-2 ns-subject page-User_Space_Mission skin-cppreference2 action-view">
        <!-- header -->
        <div id="mw-head" class="noprint">
            <div id="cpp-head-first-base">
                <div id="cpp-head-first">
                    <h5><a href="https://en.cppreference.com/">
                        cppreference.com                        </a></h5>
                    <div id="cpp-head-search">
                        
<!-- 0 -->
<div id="p-search">
<form action="https://duckduckgo.com/" method="get">
  <input type="hidden" name="sites" value="cppreference.com">
  <input type="search" name="q">
  <input type="submit" value="Search">
</form>
</div>

<!-- /0 -->
                    </div>
                    <div id="cpp-head-personal">
                        
<!-- 0 -->
<div id="p-personal" class="">
<span id="pt-createaccount"><a href="https://en.cppreference.com/mwiki/index.php?title=Special:UserLogin&amp;returnto=User%3ASpace+Mission&amp;type=signup">Create account</a></span>	<div class="menu">
        <ul>
<li id="pt-login"><a href="https://en.cppreference.com/mwiki/index.php?title=Special:UserLogin&amp;returnto=User%3ASpace+Mission" title="You are encouraged to log in; however, it is not mandatory [ctrl-option-o]" accesskey="o">Log in</a></li>        </ul>
    </div>
</div>

<!-- /0 -->
                    </div>

                </div>
            </div>
            <div id="cpp-head-second-base">
                <div id="cpp-head-second">
                    <div id="cpp-head-tools-left">
                        
<!-- 0 -->
<div id="p-namespaces" class="vectorTabs">
	<h5>Namespaces</h5>
	<ul>
					<li id="ca-nstab-user" class="selected"><span><a href="./User:Space_Mission.html" title="View the user page [ctrl-option-c]" accesskey="c">User page</a></span></li>
					<li id="ca-talk"><span><a href="./User_talk:Space_Mission.html" title="Discussion about the content page [ctrl-option-t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>

<!-- /0 -->

<!-- 1 -->
<div id="p-variants" class="vectorMenu emptyPortlet">
		<h5><span>Variants</span><a href="#"></a></h5>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>

<!-- /1 -->
                    </div>
                    <div id="cpp-head-tools-right">
                        
<!-- 0 -->
<div id="p-views" class="vectorTabs">
	<h5>Views</h5>
	<ul>
					<li id="ca-view" class="selected"><span><a href="./User:Space_Mission.html">View</a></span></li>
					<li id="ca-viewsource"><span><a href="https://en.cppreference.com/mwiki/index.php?title=User:Space_Mission&amp;action=edit" title="This page is protected.
You can view its source [ctrl-option-e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="https://en.cppreference.com/mwiki/index.php?title=User:Space_Mission&amp;action=history" title="Past revisions of this page [ctrl-option-h]" accesskey="h">History</a></span></li>
			</ul>
</div>

<!-- /0 -->

<!-- 1 -->
<div id="p-cactions" class="vectorMenu emptyPortlet">
	<h5><span>Actions</span><a href="#"></a></h5>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>

<!-- /1 -->
                    </div>
                </div>
            </div>
        </div>
        <!-- /header -->
        <!-- content -->
<style type="text/css">
#carbonads {
  display: block;
  overflow: hidden;
  position: absolute;
  text-align: center;
  left: -170px;
  max-width: 150px;
  border-radius: 4px;
  border: solid 1px hsla(0, 0%, 0%, .1);
  background-color: hsl(0, 0%, 98%);
  font-size: 12px;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu,
  Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: inherit;
  text-decoration: none;
}

#carbonads a:hover {
  color: inherit;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  display: block;
  margin-bottom: 8px;
  max-width: 150px;
  line-height: 1;
}

.carbon-img img {
  display: block;
  margin: 0 auto;
  max-width: 150px !important;
  width: 150px;
  height: auto;
}

.carbon-text {
  display: block;
  padding: 0 1em 8px;
}

.carbon-poweredby {
  display: block;
  padding: 8px 12px;
  background: repeating-linear-gradient(-45deg, transparent, transparent 5px, hsla(0, 0%, 0%, .025) 5px, hsla(0, 0%, 0%, .025) 10px) hsla(203, 11%, 95%, .4);
  text-transform: uppercase;
  letter-spacing: .5px;
  font-weight: 600;
  font-size: 9px;
  line-height: 1;
}
html { font-variant-ligatures: no-common-ligatures; }
</style>
        <div id="cpp-content-base">
            <div id="content">
                <a id="top"></a>
                <div id="mw-js-message" style="display:none;"></div>
                                <!-- firstHeading -->
<script async="" type="text/javascript" src="../../cdn.carbonads.com/carbon.js" id="_carbonads_js"></script>
                <h1 id="firstHeading" class="firstHeading">User:Space Mission</h1>
                <!-- /firstHeading -->
                <!-- bodyContent -->
                <div id="bodyContent">
                                        <!-- tagline -->
                    <div id="siteSub">From cppreference.com</div>
                    <!-- /tagline -->
                                        <!-- subtitle -->
                    <div id="contentSub"></div>
                    <!-- /subtitle -->
                                                            <!-- bodycontent -->
                    <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><table id="toc" class="toc"><tbody><tr><td><div id="toctitle"><h2>Contents</h2><span class="toctoggle">&nbsp;[<a href="#" class="internal" id="togglelink">hide</a>]&nbsp;</span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Today_is_2022.2F02.2F2_yesterday.27s_tomorrow."><span class="tocnumber">1</span> <span class="toctext">Today is 2022/02/2 yesterday's tomorrow.</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Update_routinely_.28A_reminder.29:"><span class="tocnumber">1.1</span> <span class="toctext">Update routinely (A reminder):</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#TODO"><span class="tocnumber">1.2</span> <span class="toctext">TODO</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Useful_WikiMedia_links"><span class="tocnumber">1.3</span> <span class="toctext">Useful WikiMedia links</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="#A_note_on_syntax_highlight"><span class="tocnumber">1.3.1</span> <span class="toctext">A note on syntax highlight</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</td></tr></tbody></table>
<h4> <span class="mw-headline" id="Today_is_2022.2F02.2F2_yesterday.27s_tomorrow."> Today is 2022/02/2 yesterday's tomorrow. </span></h4>
<h5> <span class="mw-headline" id="Update_routinely_.28A_reminder.29:"> Update routinely (A reminder): </span></h5>
<p>(check/fill/synchronize the following feature-test-macro pages)
</p>
<ol><li> <a href="./cpp/feature_test.html#Library_features" title="cpp/feature test">cpp/feature_test#Library_features</a>
</li><li> <a href="./cpp/feature_test.html#Example" title="cpp/feature test">cpp/feature_test#Example</a>
</li><li> <a href="./cpp/utility/feature_test.html" title="cpp/utility/feature test">cpp/utility/feature_test</a>
</li><li> <a href="./cpp/symbol_index/macro.html" title="cpp/symbol index/macro">cpp/symbol_index/macro</a>
</li><li> <a href="./cpp/compiler_support/23.html" title="cpp/compiler support/23">cpp/compiler_support/23</a>
</li></ol>
<h5> <span class="mw-headline" id="TODO"> TODO </span></h5>
<ul><li> add new range adaptors pages...
</li></ul>
<h5> <span class="mw-headline" id="Useful_WikiMedia_links"> Useful WikiMedia links </span></h5>
<ul><li> <a rel="nofollow" class="external text" href="https://meta.wikimedia.org/wiki/Help:Variable">Variables</a>
</li><li> <a rel="nofollow" class="external text" href="https://meta.wikimedia.org/wiki/Help:Advanced_templates">Advanced templates</a>
</li><li> <a rel="nofollow" class="external text" href="https://www.mediawiki.org/wiki/Help:Extension:ParserFunctions">Parser Functions</a>
</li><li> <a rel="nofollow" class="external text" href="https://www.mediawiki.org/wiki/Help:Magic_words">Enchantment</a>
</li><li> <a rel="nofollow" class="external text" href="https://www.mediawiki.org/wiki/Extension:SyntaxHighlight">SyntaxHighlight</a>
</li></ul>
<h6> <span class="mw-headline" id="A_note_on_syntax_highlight"> A note on syntax highlight </span></h6>
<p>cppreference uses <i>GeShi</i> syntax highlighter, which does not "know" new (C++17/20) keywords. However, it is still possible to make them be highlighted (in the <i>source</i> blocks) by editing an 'on-server' file that is a copy of <a rel="nofollow" class="external text" href="https://raw.githubusercontent.com/GeSHi/geshi-1.0/master/src/geshi/cpp.php">geshi/cpp.php</a>. The new keywords (e.g. <span class="t-c"><span class="mw-geshi cpp source-cpp">char8_t</span></span>, <span class="t-c"><span class="mw-geshi cpp source-cpp">consteval</span></span>, etc.) should be added into <span class="t-c"><span class="mw-geshi cpp source-cpp"><span class="st0">'KEYWORDS'</span> <span class="sy1">=&gt;</span> array</span></span> of that file.
</p><p><br>
</p><p><i><small>Not to be lost:</small></i>
</p>
<div style="margin-left:0px">
<table class="mw-collapsible mw-collapsed" style="background: transparent; text-align: left; border: 1px solid silver; margin: 0.2em auto auto; width:100%; clear: both; padding: 1px;">

<tbody><tr>
<th style="background: #CFC; font-size:87%; padding:0.2em 0.3em; text-align:center;"><span class="mw-collapsible-toggle mw-collapsible-toggle-collapsed">&nbsp;[<a href="#">Expand</a>]&nbsp;</span> <span style="font-size:115%">Feature test extractor for <a href="./cpp/utility/feature_test.html" title="cpp/utility/feature test">cpp/utility/feature_test</a> </span>
</th></tr>
<tr style="display: none;">
<td style="border: solid 1px silver; padding: 8px; background: white;">
<pre>//!
//! \abstract This program downloads the "Language support library macros"
//! [page](https://eel.is/c++draft/version.syn), parses it, and then generates the
//! wiki-source for the [page](https://en.cppreference.com/w/cpp/utility/feature_test).
//!
//! \usage: just compile &amp; run, the wiki-page will be sent to terminal.
//!
//! \dependencies: the `curl` program, C++20.
//!
//! \author: (c) 2021. Space Mission. For cppreference.com internal usage.
//! \license: [CC-BY-SA](https://en.cppreference.com/w/Cppreference:Copyright/CC-BY-SA).
//!
//! \news:
//! 2021-06-12&nbsp;: initial release (used an array that contains the plain text copied from
//!           &nbsp;: the eel page).
//! 2021-12-19&nbsp;: added options and means to generate the whole wiki-page instead of only
//!           &nbsp;: the wiki-table. Note that this requires updates if the original
//!           &nbsp;: [page](cppreference.com/w/cpp/utility/feature_test) was changed.
//! 2021-12-20&nbsp;: (optimizations) e.g. the output is generated w/o a temporary vector.
//! 2021-12-21&nbsp;: added "curl" downloading of the source html file from
//!           &nbsp;: [the site](https://eel.is/c++draft/version.syn).
//! 2021-12-23&nbsp;: added data extractor from the html using std::regex library.
//! 2021-12-27&nbsp;: added more test.
//! 2022-01-29&nbsp;: fixed SourceDownloader::load() always returned `false`; nonetheless,
//!           &nbsp;: everything worked due to try_local_file_if_download_failed == true.
//!
//! TODO: add "freestanding" support, see P2198R4 (Freestanding Feature-Test Macros)

#include &lt;algorithm&gt;
#include &lt;cassert&gt;
#include &lt;cstdlib&gt;
#include &lt;filesystem&gt;
#include &lt;fstream&gt;
#include &lt;iomanip&gt;
#include &lt;iostream&gt;
#include &lt;regex&gt;
#include &lt;stdexcept&gt;
#include &lt;sstream&gt;
#include &lt;string&gt;
#include &lt;string_view&gt;

using namespace std::literals;

/**
 * @brief      global options
 */
struct option {
    //
    //! A command to download the source html page. This string will be appended with the
    //! target file and then executed by std::system( command / tmp-dir / file-name );
    //!
    static inline constexpr auto command{
        "curl https://eel.is/c++draft/version.syn --silent -o "sv};
    //
    //! If set to `true` - generate the whole target page:
    //! [page](cppreference.com/w/cpp/utility/feature_test).
    //! Otherwise (`false`) generate the table only.
    static inline constexpr bool generate_the_whole_wiki_page {true};
    //
    //! Do not fail if the source html file was not loaded (due to Internet problems) in
    //! this session but, still exists locally (left from a previous session).
    //! Useful mostly for debugging.
    static inline constexpr bool try_local_file_if_download_failed {false};
    //
    //! Remove downloaded source html file (only if it was downloaded in this session).
    static inline constexpr bool remove_downloaded_file_at_exit {false};
    //
    //! Print additional info, such as success/failure.
    static inline constexpr bool verbose {false};
    //
    //! Test mode only.
    static inline constexpr bool enable_tests {false};
};

//!
//! \brief A downloader: gets the source file from the Internet.
//!
class SourceDownloader final {
    std::string downloaded_file_name_;

  public:
    SourceDownloader() = default;
    SourceDownloader(SourceDownloader const&amp;) = default;
    SourceDownloader&amp; operator=(SourceDownloader const&amp;) = default;
    ~SourceDownloader() { cleanup(); }

  public:
    [[nodiscard]] bool load();
    [[nodiscard]] const std::string&amp; file_name() const noexcept {
        return downloaded_file_name_;
    }
    void cleanup();
};

/**
 * @brief      Loads source html file from the "https://eel.is/c++draft/".
 * @return     return true if the file was downloaded successfully.
 */
inline bool SourceDownloader::load() {
    constexpr auto html {"eel_cpp_header_version.html"sv};

    downloaded_file_name_ = std::filesystem::temp_directory_path() / html;

    const std::string command {option::command.data() + downloaded_file_name_};

    if constexpr (option::verbose) {
        std::cout &lt;&lt; "Downloading with: [" &lt;&lt; command &lt;&lt; "]\n";
        std::cout &lt;&lt; "Destination file: " &lt;&lt; downloaded_file_name_ &lt;&lt; '\n';
    }

    if (const int ret_code {std::system(command.data())}; ret_code&nbsp;!= 0) {
        if constexpr (option::verbose) {
            std::cout &lt;&lt; "Can't download the file: error #" &lt;&lt; ret_code &lt;&lt; '\n';
            // TODO: maybe decipher the error return code.
        }
        return false;
    }
    if constexpr (option::verbose)
        std::cout &lt;&lt; "OK. The file was downloaded successfully.\n";

    return true;
}

/**
 * @brief    Reset file and (conditionally) remove downloaded html source file.
 */
inline void SourceDownloader::cleanup() {
    if constexpr (option::remove_downloaded_file_at_exit) {
        if (!downloaded_file_name_.empty()) {
            std::filesystem::remove(downloaded_file_name_);
            downloaded_file_name_.clear();
        }
    }
}

/**
 * @brief class FeatureTestTable.
 *  Extracts data from a given string, that must be a part of
 *  [table entry](https://eel.is/c++draft/version.syn) html page
 *  and generates the the page [or (conditionally) only the table]:
 *  [page](https://en.cppreference.com/w/cpp/utility/feature_test)
 */
class FeatureTestTable {
  public:
    FeatureTestTable() = default;

  public:
    [[nodiscard]] std::string generate_entry(std::string_view source);

  private:
    [[nodiscard]] bool parse_line(std::string_view source);

  public:
    static bool generate();

  public:
    [[nodiscard]] static bool self_test();

  private:
    [[nodiscard]] static std::string_view page_head();
    [[nodiscard]] static std::string_view page_tail();
    [[nodiscard]] static std::string_view table_head();
    [[nodiscard]] static std::string_view table_tail();

  private:
    using string_view_vector = std::vector&lt;std::string_view&gt;;

  private:
    string_view_vector headers_;  // e.g. {"vector", "type_traits"}
    std::string_view macro_;      // e.g. "__cpp_lib_any"
    std::string_view date_;       // e.g. "201606L"
};

/**
 * @brief      Parses the source line and sets internal values for macro_, date_, headers_
 * @param[in]  source  - The source html line
 * @exception  std::logic_error - throws if the source html has a wrong format.
 * @return     true - if line was parsed successfully.
 */
inline bool FeatureTestTable::parse_line(std::string_view source) {
    headers_.clear();
    macro_ = date_ = "";

    const char* suffix;
    std::cmatch m;
    constexpr std::regex::flag_type flags{std::regex_constants::ECMAScript |
                                          std::regex_constants::optimize};

    /* Obtain macro (e.g. "__cpp_lib_byte") and date (e.g. "201603L")
     * HTML example:
    &lt;span class='preprocessordirective'&gt;#define&lt;/span&gt; &lt;span id='lib:__cpp_lib_byte'&gt;...
    ...&lt;span class='literal'&gt;202011L&lt;/span&gt;...
     */
    static const std::regex re_get_macro_and_date{
        "'lib:(__cpp_lib_[_a-z0-9]{3,50})'.*'literal'&gt;(20[1-4][0-9]{3}L)",
        flags
    };
    if (!std::regex_search(source.data(), m, re_get_macro_and_date) or m.size()&nbsp;!= 3)
        return false;
    macro_ = std::string_view(m[1].first, m[1].second - m[1].first);
    date_ = std::string_view(m[2].first, m[2].second - m[2].first);
    suffix = m.suffix().first;  // contains the tail with at least one header

    if (macro_.length() &lt; "__cpp_lib_xxx"sv.length() or
        date_.length()&nbsp;!= (/*a sample:*/ "202002L"sv).length())
        return false;

    /* Obtain header(s) in the cycle.
     * HTML example:
    ...&lt;span id='headerref:&lt;string_view&gt;___'&gt;...
     */
    static const std::regex re_find_header{
        R"regex((?:headerref:&lt;)([_a-z\d]+(?:\.h)?)&gt;)regex", flags};
    for (; std::regex_search(suffix, m, re_find_header) and m.size() == 2;
         suffix = m.suffix().first)  // contains the tail with zero or more headers
        headers_.emplace_back(m[1].first, m[1].second - m[1].first);

    return not headers_.empty();
}

/**
 * @brief      Performs self test and returns.
 *
 * @return     `true` if self-test passed.
 */
inline bool FeatureTestTable::self_test() {
    FeatureTestTable tab;

    constexpr auto fake_html =
    "&lt;span class='preprocessordirective'&gt;#define&lt;/span&gt; &lt;span id='lib:__cpp_lib_byte'&gt;..."
    "...&lt;span class='literal'&gt;202011L&lt;/span&gt;..."
    "...&lt;span id='headerref:&lt;string&gt;___'&gt;..."
    "...&lt;span id='headerref:&lt;string_view&gt;___'&gt;..."sv;

    return tab.parse_line(fake_html) and tab.macro_ == "__cpp_lib_byte" and
           tab.date_ == "202011L" and tab.headers_.size() == 2 and
           tab.headers_[0] == "string" and tab.headers_[1] == "string_view";
}


/**
 * @brief   cppreference page and table on the page related heads and tails.
 */
inline std::string_view FeatureTestTable::page_head() {
    if constexpr (option::generate_the_whole_wiki_page)
        return
    "{{title|Library feature-test macros {{mark c++20}}}}\n"
    "{{cpp/utility/navbar}}\n"
    "\n"
    "Each of following macros is defined if the header {{header|version}} or one of "
    "the corresponding headers specified in the table is included.\n"sv;
    else
        return ""sv;
}

inline std::string_view FeatureTestTable::page_tail() {
    if constexpr (option::generate_the_whole_wiki_page)
        return
    "\n"
    "===See also===\n"
    "{{dsc begin}}\n"
    "{{dsc | [[cpp/feature_test|'''Feature testing''']] {{mark c++20}} | A set of "
    "preprocessor macros to test the corresponding to C++ language and library "
    "features }}\n"
    "{{dsc end}}\n"
    "\n"
    "{{langlinks|es|ja|ru|zh}}\n"sv;
    else
        return ""sv;
}

inline std::string_view FeatureTestTable::table_head() {
        return
R"--(
{| class="wikitable sortable"
|-
! Macro name
! Value
! Header
)--"sv;
}

inline std::string_view FeatureTestTable::table_tail() { return "|}"sv; }

/**
 * @brief      Generates cppreference table entry.
 * @param      source - source string to parse.
 * @return     non-empty table entry string, if success. An empty string otherwise.
 */
inline std::string FeatureTestTable::generate_entry(std::string_view source) {
    if (!parse_line(source))
        return {};

    /* cppreference table entry sample:
    |-
    |  {{tt|__cpp_lib_byte}}
    | 201603L
    | {{header|atomic}} {{header|filesystem}} ...
    */
    std::ostringstream str("", std::ios_base::ate);
    str &lt;&lt; "|-\n"
           "| {{tt|" &lt;&lt; macro_ &lt;&lt; "}}\n"
           "| " &lt;&lt; date_ &lt;&lt; "\n"
           "|";
    for (auto const&amp; header&nbsp;: headers_) {
        str &lt;&lt; " {{header|" &lt;&lt; header &lt;&lt; "}}";
    }
    return str.str();
}

// TODO:&nbsp;? implement input_iterator interface for SourceFileReader:
// begin(), end() [i.e. sentinel] operator*, and operator++.
class SourceFileReader {
public:
    SourceFileReader(SourceFileReader const&amp;) = delete;
    SourceFileReader&amp; operator=(SourceFileReader const&amp;) = delete;

    explicit SourceFileReader(std::string_view const file_name);

    [[nodiscard]] bool is_open() const { return ok_; }
    [[nodiscard]] bool goto_next_line();
    [[nodiscard]] std::string_view get_line() const { return cur_; }

    operator std::ifstream&amp; () noexcept { return file_; }

  private:
    std::ifstream file_;
    std::string cur_;
    std::string next_;
    bool ok_{false};
};

/**
 * @brief      Opens the source html file.
 *             Sets the success-flag that should be checked with is_open().
 * @param      file_name - the source html file name.
 */
inline SourceFileReader::SourceFileReader(std::string_view const file_name) {

    const auto file = std::filesystem::path{file_name};

    auto ec = std::error_code{};

    if (!std::filesystem::exists(file, ec)) {
        std::cerr &lt;&lt; "ERROR: source html file not found: " &lt;&lt; file &lt;&lt; '\n';
        return;
    }

    constexpr auto min_file_size = std::uintmax_t{90'000}; // bytes
    if (auto size = std::uintmax_t{0};
        (size = std::filesystem::file_size(file, ec)) &lt; min_file_size) {
        std::cerr &lt;&lt; "ERROR: source html file: " &lt;&lt; file &lt;&lt; '\n'
                  &lt;&lt; "  is too small, size = " &lt;&lt; size &lt;&lt; " bytes;\n"
                  &lt;&lt; "  expected size &gt;= " &lt;&lt; min_file_size &lt;&lt; " bytes\n";
        return;
    }

    file_.open(file_name.data());
    if (not(ok_ = file_.is_open())) {
        std::cerr &lt;&lt; "ERROR: can't open the source html file: " &lt;&lt; file &lt;&lt; '\n';
        return;
    }
}

/**
 * @brief      Go to the next line, if it is available.
 * @exception  may throw std::logic_error in case of wrong file format
 * @return     true, if next line is available
 */
inline bool SourceFileReader::goto_next_line() {
    if (not ok_)
        return false;

    constexpr auto significant {"preprocessordirective"sv};

    if (cur_.empty()) { // This is a first run. Find the next valid line.
        while ((ok_ =&nbsp;!!std::getline(file_, cur_)) &amp;&amp; cur_.find(significant) == ""sv.npos)
           &nbsp;;
        if (not ok_) throw std::logic_error("Invalid file format.");
    } else {  // This is not the first run. Thus next_ contains the begin.
        cur_ = std::move(next_);
    }

    // Find the next begin (or EOF), appending the dependent lines.
    while ((ok_ =&nbsp;!!std::getline(file_, next_)) &amp;&amp; next_.find(significant) == ""sv.npos) {
        cur_ += next_;
    }
    return true;
}

/**
 * @brief   Generates the whole cppreference page (or only the table) and prints it out.
 * @note    The format of the output is the wiki-media language. The printed result is to
 *          be applied to [page](https://en.cppreference.com/w/cpp/utility/feature_test).
 * @note    What will be printed (the page or mere the table) depends on the flag:
 *          option::generate_the_whole_wiki_page.
 */
inline bool FeatureTestTable::generate() {
    SourceDownloader html;
    if (not html.load()) {
        if constexpr (option::try_local_file_if_download_failed) {
            if constexpr (option::verbose)
                std::cerr &lt;&lt; "Trying to use local source file: " &lt;&lt; html.file_name()
                          &lt;&lt; "\n\n";
        } else {
            return false;
        }
    }

    auto lines {SourceFileReader{html.file_name()}};
    if (not lines.is_open()) {
        return false;
    }

    std::cout &lt;&lt; FeatureTestTable::page_head() &lt;&lt; FeatureTestTable::table_head();

    auto entry_count {0U};

    try {
        for (FeatureTestTable table; lines.goto_next_line(); ) {
            const std::string line{ table.generate_entry(lines.get_line()) };
            if (not line.empty()) {
                std::cout &lt;&lt; line &lt;&lt; '\n';
                ++entry_count;
            }
        }
    } catch (std::logic_error const&amp; ex) {
        if constexpr (option::verbose)
            std::cerr &lt;&lt; "ERROR: " &lt;&lt; ex.what() &lt;&lt; '\n';
        return false;
    }

    std::cout &lt;&lt; FeatureTestTable::table_tail() &lt;&lt; '\n'
              &lt;&lt; "&lt;!-- Entries count: " &lt;&lt; entry_count &lt;&lt; " --&gt;\n"
              &lt;&lt; FeatureTestTable::page_tail();

    // Some sanity checks:
    constexpr auto min_entries {146u}; // as per 2021-12-24
    if (entry_count &lt; min_entries) {
        std::cerr &lt;&lt; "\nWARNING: Not enough entries! Expected at least " &lt;&lt;
            min_entries &lt;&lt; '\n';
    }

    return true;
}

/**
 * @brief      Performs self test and returns.
 *
 * @return     `true` if self-tests passed.
 */
inline bool self_tests() {
    if constexpr (not option::enable_tests)
        return true;

    bool ok = FeatureTestTable::self_test();

    if (ok) {
        if constexpr (option::verbose)
            std::cerr &lt;&lt; "OK. Tests passed.\n";
    } else {
        std::cerr &lt;&lt; "TESTS FAILED.\n";
    }

    return ok;
}

int main() {
    return self_tests() and FeatureTestTable::generate()&nbsp;? EXIT_SUCCESS&nbsp;: EXIT_FAILURE;
}
</pre>
</td></tr></tbody></table></div>

<!-- 
NewPP limit report
Preprocessor visited node count: 155/1000000
Preprocessor generated node count: 806/1000000
Postâ€expand include size: 969/2097152 bytes
Template argument size: 129/2097152 bytes
Highest expansion depth: 6/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mwiki1-mwiki_en_:pcache:idhash:19975-0!*!0!!en!*!* and timestamp 20220202064753 -->
</div>                    <!-- /bodycontent -->
                                        <!-- printfooter -->
                    <div class="printfooter">
                    Retrieved from "<a href="https://en.cppreference.com/mwiki/index.php?title=User:Space_Mission&amp;oldid=137805">https://en.cppreference.com/mwiki/index.php?title=User:Space_Mission&amp;oldid=137805</a>"                    </div>
                    <!-- /printfooter -->
                                                            <!-- catlinks -->
                    <div id="catlinks" class="catlinks catlinks-allhidden"></div>                    <!-- /catlinks -->
                                                            <div class="visualClear"></div>
                    <!-- debughtml -->
                                        <!-- /debughtml -->
                </div>
                <!-- /bodyContent -->
            </div>
        </div>
        <!-- /content -->
        <!-- footer -->
        <div id="cpp-footer-base" class="noprint">
            <div id="footer">
                        <div id="cpp-navigation">
            <h5>Navigation</h5>
            <ul>
<li id="n-Support-us"><a href="http://www.cppreference.com/support" rel="nofollow">Support us</a></li><li id="n-recentchanges"><a href="https://en.cppreference.com/w/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-FAQ"><a href="https://en.cppreference.com/w/Cppreference:FAQ">FAQ</a></li><li id="n-Offline-version"><a href="https://en.cppreference.com/w/Cppreference:Archives">Offline version</a></li>            </ul>
        </div>
                        <div id="cpp-toolbox">
            <h5><span>Toolbox</span><a href="#"></a></h5>
            <ul>
<li id="t-whatlinkshere"><a href="https://en.cppreference.com/w/Special:WhatLinksHere/User:Space_Mission" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="https://en.cppreference.com/w/Special:RecentChangesLinked/User:Space_Mission" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-contributions"><a href="https://en.cppreference.com/w/Special:Contributions/Space_Mission" title="A list of contributions of this user">User contributions</a></li><li id="t-log"><a href="https://en.cppreference.com/w/Special:Log/Space_Mission">Logs</a></li><li id="t-upload"><a href="http://upload.cppreference.com/w/Special:Upload" title="Upload files [u]" accesskey="u">Upload file</a></li><li id="t-specialpages"><a href="https://en.cppreference.com/w/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://en.cppreference.com/mwiki/index.php?title=User:Space_Mission&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://en.cppreference.com/mwiki/index.php?title=User:Space_Mission&amp;oldid=137805" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://en.cppreference.com/mwiki/index.php?title=User:Space_Mission&amp;action=info">Page information</a></li>            </ul>
        </div>
                            <ul id="footer-info">
                                    <li id="footer-info-lastmod"> This page was last modified on 1 February 2022, at 02:23.</li>
                                    <li id="footer-info-viewcount">This page has been accessed 1,704 times.</li>
                            </ul>
                    <ul id="footer-places">
                                    <li id="footer-places-privacy"><a href="https://en.cppreference.com/w/Cppreference:Privacy_policy" title="Cppreference:Privacy policy">Privacy policy</a></li>
                                    <li id="footer-places-about"><a href="https://en.cppreference.com/w/Cppreference:About" title="Cppreference:About">About cppreference.com</a></li>
                                    <li id="footer-places-disclaimer"><a href="https://en.cppreference.com/w/Cppreference:General_disclaimer" title="Cppreference:General disclaimer">Disclaimers</a></li>
                            </ul>
                                    <ul id="footer-icons" class="noprint">
                                    <li id="footer-poweredbyico">
                                            <a href="https://www.mediawiki.org/"><img src="../mwiki/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31"></a>                                            <a href="http://qbnz.com/highlighter/"><img src="../../upload.cppreference.com/mwiki/images/2/2b/powered_by_geshi_88x31.png" alt="Powered by GeSHi" height="31" width="88"></a>                                            <a href="http://www.tigertech.net/referral/cppreference.com"><img src="../../upload.cppreference.com/mwiki/images/9/94/powered_by_tigertech_88x31.png" alt="Hosted by Tiger Technologies" height="31" width="88"></a>                                        </li>
                                </ul>
                        <div style="clear:both">
            </div>
            </div>
        </div>
        <!-- /footer -->
        



<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-2828341-1']);
_gaq.push(['_setDomainName', 'cppreference.com']);
_gaq.push(['_trackPageview']);
</script><!-- Served in 0.248 secs. -->
	
<!-- Cached 20220202064753 -->

</body></html>