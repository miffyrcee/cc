
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Fixtures reference — pytest documentation</title>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../_static/basic.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments_pytest.css" rel="stylesheet" type="text/css"/>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
<script src="../_static/jquery.js"></script>
<script src="../_static/underscore.js"></script>
<script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="../_static/doctools.js"></script>
<script src="../_static/sphinx_highlight.js"></script>
<link href="../_static/favicon.png" rel="shortcut icon"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="plugin_list.html" rel="next" title="Plugin List"/>
<link href="../how-to/bash-completion.html" rel="prev" title="How to set up bash completion"/>
<script>DOCUMENTATION_OPTIONS.URL_ROOT = '';</script>
</head><body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>Navigation</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../py-modindex.html" title="Python Module Index">modules</a></li>
<li class="right">
<a accesskey="N" href="plugin_list.html" title="Plugin List">next</a> |</li>
<li class="right">
<a accesskey="P" href="../how-to/bash-completion.html" title="How to set up bash completion">previous</a> |</li>
<li class="nav-item nav-item-0"><a href="../contents.html">pytest-7.3</a> »</li>
<li class="nav-item nav-item-this"><a href="">Fixtures reference</a></li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="body" role="main">
<section id="fixtures-reference">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Fixtures reference"></a><span id="id1"></span><a class="dashAnchor" name="//apple_ref/cpp/Section/Fixtures reference"></a><span id="pytest-fixture"></span><a class="dashAnchor" name="//apple_ref/cpp/Section/Fixtures reference"></a><span id="fixtures"></span><a class="dashAnchor" name="//apple_ref/cpp/Section/Fixtures reference"></a><span id="fixture"></span><a class="dashAnchor" name="//apple_ref/cpp/Section/Fixtures reference"></a><span id="reference-fixtures"></span><h1>Fixtures reference<a class="headerlink" href="#fixtures-reference" title="Permalink to this heading">¶</a></h1>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../explanation/fixtures.html#about-fixtures"><span class="std std-ref">About fixtures</span></a></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../how-to/fixtures.html#how-to-fixtures"><span class="std std-ref">How to use fixtures</span></a></p>
</div>
<section id="built-in-fixtures">
<h2>Built-in fixtures<a class="headerlink" href="#built-in-fixtures" title="Permalink to this heading">¶</a></h2>
<p><a class="reference internal" href="reference.html#fixtures-api"><span class="std std-ref">Fixtures</span></a> are defined using the <a class="reference internal" href="reference.html#pytest-fixture-api"><span class="std std-ref">@pytest.fixture</span></a> decorator. Pytest has several useful built-in fixtures:</p>
<blockquote>
<div><dl class="simple">
<dt><a class="reference internal" href="reference.html#std-fixture-capfd"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">capfd</span></code></a></dt><dd><p>Capture, as text, output to file descriptors <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-capfdbinary"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">capfdbinary</span></code></a></dt><dd><p>Capture, as bytes, output to file descriptors <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-caplog"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">caplog</span></code></a></dt><dd><p>Control logging and access log entries.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-capsys"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">capsys</span></code></a></dt><dd><p>Capture, as text, output to <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code> and <code class="docutils literal notranslate"><span class="pre">sys.stderr</span></code>.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-capsysbinary"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">capsysbinary</span></code></a></dt><dd><p>Capture, as bytes, output to <code class="docutils literal notranslate"><span class="pre">sys.stdout</span></code> and <code class="docutils literal notranslate"><span class="pre">sys.stderr</span></code>.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-cache"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">cache</span></code></a></dt><dd><p>Store and retrieve values across pytest runs.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-doctest_namespace"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">doctest_namespace</span></code></a></dt><dd><p>Provide a dict injected into the docstests namespace.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-monkeypatch"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">monkeypatch</span></code></a></dt><dd><p>Temporarily modify classes, functions, dictionaries,
<code class="docutils literal notranslate"><span class="pre">os.environ</span></code>, and other objects.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-pytestconfig"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">pytestconfig</span></code></a></dt><dd><p>Access to configuration values, pluginmanager and plugin hooks.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-record_property"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">record_property</span></code></a></dt><dd><p>Add extra properties to the test.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-record_testsuite_property"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">record_testsuite_property</span></code></a></dt><dd><p>Add extra properties to the test suite.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-recwarn"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">recwarn</span></code></a></dt><dd><p>Record warnings emitted by test functions.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-request"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">request</span></code></a></dt><dd><p>Provide information on the executing test function.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-testdir"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">testdir</span></code></a></dt><dd><p>Provide a temporary test directory to aid in running, and
testing, pytest plugins.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-tmp_path"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">tmp_path</span></code></a></dt><dd><p>Provide a <a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a> object to a temporary directory
which is unique to each test function.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-tmp_path_factory"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">tmp_path_factory</span></code></a></dt><dd><p>Make session-scoped temporary directories and return
<a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a> objects.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-tmpdir"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">tmpdir</span></code></a></dt><dd><p>Provide a <code class="xref py py-class docutils literal notranslate"><span class="pre">py.path.local</span></code> object to a temporary
directory which is unique to each test function;
replaced by <a class="reference internal" href="reference.html#std-fixture-tmp_path"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">tmp_path</span></code></a>.</p>
</dd>
<dt><a class="reference internal" href="reference.html#std-fixture-tmpdir_factory"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">tmpdir_factory</span></code></a></dt><dd><p>Make session-scoped temporary directories and return
<code class="xref py py-class docutils literal notranslate"><span class="pre">py.path.local</span></code> objects;
replaced by <a class="reference internal" href="reference.html#std-fixture-tmp_path_factory"><code class="xref std std-fixture docutils literal notranslate"><span class="pre">tmp_path_factory</span></code></a>.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="fixture-availability">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Fixture availability"></a><span id="conftest"></span><a class="dashAnchor" name="//apple_ref/cpp/Section/Fixture availability"></a><span id="conftest-py"></span><h2>Fixture availability<a class="headerlink" href="#fixture-availability" title="Permalink to this heading">¶</a></h2>
<p>Fixture availability is determined from the perspective of the test. A fixture
is only available for tests to request if they are in the scope that fixture is
defined in. If a fixture is defined inside a class, it can only be requested by
tests inside that class. But if a fixture is defined inside the global scope of
the module, than every test in that module, even if it’s defined inside a class,
can request it.</p>
<p>Similarly, a test can also only be affected by an autouse fixture if that test
is in the same scope that autouse fixture is defined in (see
<a class="reference internal" href="#autouse-order"><span class="std std-ref">Autouse fixtures are executed first within their scope</span></a>).</p>
<p>A fixture can also request any other fixture, no matter where it’s defined, so
long as the test requesting them can see all fixtures involved.</p>
<p>For example, here’s a test file with a fixture (<code class="docutils literal notranslate"><span class="pre">outer</span></code>) that requests a
fixture (<code class="docutils literal notranslate"><span class="pre">inner</span></code>) from a scope it wasn’t defined in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">order</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[]</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">outer</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">inner</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"outer"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TestOne</span><span class="p">:</span>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"one"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"one"</span><span class="p">,</span> <span class="s2">"outer"</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">TestTwo</span><span class="p">:</span>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"two"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">outer</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"two"</span><span class="p">,</span> <span class="s2">"outer"</span><span class="p">]</span>
</pre></div>
</div>
<p>From the tests’ perspectives, they have no problem seeing each of the fixtures
they’re dependent on:</p>
<img alt="../_images/test_fixtures_request_different_scope.svg" class="align-center" src="../_images/test_fixtures_request_different_scope.svg"/><p>So when they run, <code class="docutils literal notranslate"><span class="pre">outer</span></code> will have no problem finding <code class="docutils literal notranslate"><span class="pre">inner</span></code>, because
pytest searched from the tests’ perspectives.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The scope a fixture is defined in has no bearing on the order it will be
instantiated in: the order is mandated by the logic described
<a class="reference internal" href="#fixture-order"><span class="std std-ref">here</span></a>.</p>
</div>
<section id="conftest-py-sharing-fixtures-across-multiple-files">
<h3><code class="docutils literal notranslate"><span class="pre">conftest.py</span></code>: sharing fixtures across multiple files<a class="headerlink" href="#conftest-py-sharing-fixtures-across-multiple-files" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> file serves as a means of providing fixtures for an entire
directory. Fixtures defined in a <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> can be used by any test
in that package without needing to import them (pytest will automatically
discover them).</p>
<p>You can have multiple nested directories/packages containing your tests, and
each directory can have its own <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> with its own fixtures, adding on
to the ones provided by the <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> files in parent directories.</p>
<p>For example, given a test file structure like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tests</span><span class="o">/</span>
    <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>

    <span class="n">conftest</span><span class="o">.</span><span class="n">py</span>
        <span class="c1"># content of tests/conftest.py</span>
        <span class="kn">import</span> <span class="nn">pytest</span>

        <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
        <span class="k">def</span> <span class="nf">order</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
        <span class="k">def</span> <span class="nf">top</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">innermost</span><span class="p">):</span>
            <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"top"</span><span class="p">)</span>

    <span class="n">test_top</span><span class="o">.</span><span class="n">py</span>
        <span class="c1"># content of tests/test_top.py</span>
        <span class="kn">import</span> <span class="nn">pytest</span>

        <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
        <span class="k">def</span> <span class="nf">innermost</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
            <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"innermost top"</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">test_order</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">top</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"innermost top"</span><span class="p">,</span> <span class="s2">"top"</span><span class="p">]</span>

    <span class="n">subpackage</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>

        <span class="n">conftest</span><span class="o">.</span><span class="n">py</span>
            <span class="c1"># content of tests/subpackage/conftest.py</span>
            <span class="kn">import</span> <span class="nn">pytest</span>

            <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
            <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
                <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"mid subpackage"</span><span class="p">)</span>

        <span class="n">test_subpackage</span><span class="o">.</span><span class="n">py</span>
            <span class="c1"># content of tests/subpackage/test_subpackage.py</span>
            <span class="kn">import</span> <span class="nn">pytest</span>

            <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
            <span class="k">def</span> <span class="nf">innermost</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mid</span><span class="p">):</span>
                <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"innermost subpackage"</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">test_order</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">top</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"mid subpackage"</span><span class="p">,</span> <span class="s2">"innermost subpackage"</span><span class="p">,</span> <span class="s2">"top"</span><span class="p">]</span>
</pre></div>
</div>
<p>The boundaries of the scopes can be visualized like this:</p>
<img alt="../_images/fixture_availability.svg" class="align-center" src="../_images/fixture_availability.svg"/><p>The directories become their own sort of scope where fixtures that are defined
in a <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> file in that directory become available for that whole
scope.</p>
<p>Tests are allowed to search upward (stepping outside a circle) for fixtures, but
can never go down (stepping inside a circle) to continue their search. So
<code class="docutils literal notranslate"><span class="pre">tests/subpackage/test_subpackage.py::test_order</span></code> would be able to find the
<code class="docutils literal notranslate"><span class="pre">innermost</span></code> fixture defined in <code class="docutils literal notranslate"><span class="pre">tests/subpackage/test_subpackage.py</span></code>, but
the one defined in <code class="docutils literal notranslate"><span class="pre">tests/test_top.py</span></code> would be unavailable to it because it
would have to step down a level (step inside a circle) to find it.</p>
<p>The first fixture the test finds is the one that will be used, so
<a class="reference internal" href="../how-to/fixtures.html#override-fixtures"><span class="std std-ref">fixtures can be overridden</span></a> if you need to change or
extend what one does for a particular scope.</p>
<p>You can also use the <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> file to implement
<a class="reference internal" href="../how-to/writing_plugins.html#conftest-py-plugins"><span class="std std-ref">local per-directory plugins</span></a>.</p>
</section>
<section id="fixtures-from-third-party-plugins">
<h3>Fixtures from third-party plugins<a class="headerlink" href="#fixtures-from-third-party-plugins" title="Permalink to this heading">¶</a></h3>
<p>Fixtures don’t have to be defined in this structure to be available for tests,
though. They can also be provided by third-party plugins that are installed, and
this is how many pytest plugins operate. As long as those plugins are installed,
the fixtures they provide can be requested from anywhere in your test suite.</p>
<p>Because they’re provided from outside the structure of your test suite,
third-party plugins don’t really provide a scope like <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code> files and
the directories in your test suite do. As a result, pytest will search for
fixtures stepping out through scopes as explained previously, only reaching
fixtures defined in plugins <em>last</em>.</p>
<p>For example, given the following file structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tests</span><span class="o">/</span>
    <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>

    <span class="n">conftest</span><span class="o">.</span><span class="n">py</span>
        <span class="c1"># content of tests/conftest.py</span>
        <span class="kn">import</span> <span class="nn">pytest</span>

        <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
        <span class="k">def</span> <span class="nf">order</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="n">subpackage</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>

        <span class="n">conftest</span><span class="o">.</span><span class="n">py</span>
            <span class="c1"># content of tests/subpackage/conftest.py</span>
            <span class="kn">import</span> <span class="nn">pytest</span>

            <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">b_fix</span><span class="p">):</span>
                <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"mid subpackage"</span><span class="p">)</span>

        <span class="n">test_subpackage</span><span class="o">.</span><span class="n">py</span>
            <span class="c1"># content of tests/subpackage/test_subpackage.py</span>
            <span class="kn">import</span> <span class="nn">pytest</span>

            <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
            <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">a_fix</span><span class="p">):</span>
                <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"inner subpackage"</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">test_order</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">inner</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"b_fix"</span><span class="p">,</span> <span class="s2">"mid subpackage"</span><span class="p">,</span> <span class="s2">"a_fix"</span><span class="p">,</span> <span class="s2">"inner subpackage"</span><span class="p">]</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">plugin_a</span></code> is installed and provides the fixture <code class="docutils literal notranslate"><span class="pre">a_fix</span></code>, and
<code class="docutils literal notranslate"><span class="pre">plugin_b</span></code> is installed and provides the fixture <code class="docutils literal notranslate"><span class="pre">b_fix</span></code>, then this is what
the test’s search for fixtures would look like:</p>
<img alt="../_images/fixture_availability_plugins.svg" class="align-center" src="../_images/fixture_availability_plugins.svg"/><p>pytest will only search for <code class="docutils literal notranslate"><span class="pre">a_fix</span></code> and <code class="docutils literal notranslate"><span class="pre">b_fix</span></code> in the plugins after
searching for them first in the scopes inside <code class="docutils literal notranslate"><span class="pre">tests/</span></code>.</p>
</section>
</section>
<section id="fixture-instantiation-order">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Fixture instantiation order"></a><span id="fixture-order"></span><h2>Fixture instantiation order<a class="headerlink" href="#fixture-instantiation-order" title="Permalink to this heading">¶</a></h2>
<p>When pytest wants to execute a test, once it knows what fixtures will be
executed, it has to figure out the order they’ll be executed in. To do this, it
considers 3 factors:</p>
<ol class="arabic simple">
<li><p>scope</p></li>
<li><p>dependencies</p></li>
<li><p>autouse</p></li>
</ol>
<p>Names of fixtures or tests, where they’re defined, the order they’re defined in,
and the order fixtures are requested in have no bearing on execution order
beyond coincidence. While pytest will try to make sure coincidences like these
stay consistent from run to run, it’s not something that should be depended on.
If you want to control the order, it’s safest to rely on these 3 things and make
sure dependencies are clearly established.</p>
<section id="higher-scoped-fixtures-are-executed-first">
<h3>Higher-scoped fixtures are executed first<a class="headerlink" href="#higher-scoped-fixtures-are-executed-first" title="Permalink to this heading">¶</a></h3>
<p>Within a function request for fixtures, those of higher-scopes (such as
<code class="docutils literal notranslate"><span class="pre">session</span></code>) are executed before lower-scoped fixtures (such as <code class="docutils literal notranslate"><span class="pre">function</span></code> or
<code class="docutils literal notranslate"><span class="pre">class</span></code>).</p>
<p>Here’s an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"session"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">order</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[]</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"function"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"class"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cls</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"class"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"module"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">mod</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"module"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"package"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"package"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"session"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sess</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"session"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TestClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">pack</span><span class="p">,</span> <span class="n">sess</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"session"</span><span class="p">,</span> <span class="s2">"package"</span><span class="p">,</span> <span class="s2">"module"</span><span class="p">,</span> <span class="s2">"class"</span><span class="p">,</span> <span class="s2">"function"</span><span class="p">]</span>
</pre></div>
</div>
<p>The test will pass because the larger scoped fixtures are executing first.</p>
<p>The order breaks down to this:</p>
<img alt="../_images/test_fixtures_order_scope.svg" class="align-center" src="../_images/test_fixtures_order_scope.svg"/></section>
<section id="fixtures-of-the-same-order-execute-based-on-dependencies">
<h3>Fixtures of the same order execute based on dependencies<a class="headerlink" href="#fixtures-of-the-same-order-execute-based-on-dependencies" title="Permalink to this heading">¶</a></h3>
<p>When a fixture requests another fixture, the other fixture is executed first.
So if fixture <code class="docutils literal notranslate"><span class="pre">a</span></code> requests fixture <code class="docutils literal notranslate"><span class="pre">b</span></code>, fixture <code class="docutils literal notranslate"><span class="pre">b</span></code> will execute first,
because <code class="docutils literal notranslate"><span class="pre">a</span></code> depends on <code class="docutils literal notranslate"><span class="pre">b</span></code> and can’t operate without it. Even if <code class="docutils literal notranslate"><span class="pre">a</span></code>
doesn’t need the result of <code class="docutils literal notranslate"><span class="pre">b</span></code>, it can still request <code class="docutils literal notranslate"><span class="pre">b</span></code> if it needs to make
sure it is executed after <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">order</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[]</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"b"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"c"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">d</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"d"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">e</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"e"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"g"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_order</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">,</span> <span class="s2">"g"</span><span class="p">]</span>
</pre></div>
</div>
<p>If we map out what depends on what, we get something that looks like this:</p>
<img alt="../_images/test_fixtures_order_dependencies.svg" class="align-center" src="../_images/test_fixtures_order_dependencies.svg"/><p>The rules provided by each fixture (as to what fixture(s) each one has to come
after) are comprehensive enough that it can be flattened to this:</p>
<img alt="../_images/test_fixtures_order_dependencies_flat.svg" class="align-center" src="../_images/test_fixtures_order_dependencies_flat.svg"/><p>Enough information has to be provided through these requests in order for pytest
to be able to figure out a clear, linear chain of dependencies, and as a result,
an order of operations for a given test. If there’s any ambiguity, and the order
of operations can be interpreted more than one way, you should assume pytest
could go with any one of those interpretations at any point.</p>
<p>For example, if <code class="docutils literal notranslate"><span class="pre">d</span></code> didn’t request <code class="docutils literal notranslate"><span class="pre">c</span></code>, i.e.the graph would look like this:</p>
<img alt="../_images/test_fixtures_order_dependencies_unclear.svg" class="align-center" src="../_images/test_fixtures_order_dependencies_unclear.svg"/><p>Because nothing requested <code class="docutils literal notranslate"><span class="pre">c</span></code> other than <code class="docutils literal notranslate"><span class="pre">g</span></code>, and <code class="docutils literal notranslate"><span class="pre">g</span></code> also requests <code class="docutils literal notranslate"><span class="pre">f</span></code>,
it’s now unclear if <code class="docutils literal notranslate"><span class="pre">c</span></code> should go before/after <code class="docutils literal notranslate"><span class="pre">f</span></code>, <code class="docutils literal notranslate"><span class="pre">e</span></code>, or <code class="docutils literal notranslate"><span class="pre">d</span></code>. The
only rules that were set for <code class="docutils literal notranslate"><span class="pre">c</span></code> is that it must execute after <code class="docutils literal notranslate"><span class="pre">b</span></code> and
before <code class="docutils literal notranslate"><span class="pre">g</span></code>.</p>
<p>pytest doesn’t know where <code class="docutils literal notranslate"><span class="pre">c</span></code> should go in the case, so it should be assumed
that it could go anywhere between <code class="docutils literal notranslate"><span class="pre">g</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<p>This isn’t necessarily bad, but it’s something to keep in mind. If the order
they execute in could affect the behavior a test is targeting, or could
otherwise influence the result of a test, then the order should be defined
explicitly in a way that allows pytest to linearize/”flatten” that order.</p>
</section>
<section id="autouse-fixtures-are-executed-first-within-their-scope">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Autouse fixtures are executed first within their scope"></a><span id="autouse-order"></span><h3>Autouse fixtures are executed first within their scope<a class="headerlink" href="#autouse-fixtures-are-executed-first-within-their-scope" title="Permalink to this heading">¶</a></h3>
<p>Autouse fixtures are assumed to apply to every test that could reference them,
so they are executed before other fixtures in that scope. Fixtures that are
requested by autouse fixtures effectively become autouse fixtures themselves for
the tests that the real autouse fixture applies to.</p>
<p>So if fixture <code class="docutils literal notranslate"><span class="pre">a</span></code> is autouse and fixture <code class="docutils literal notranslate"><span class="pre">b</span></code> is not, but fixture <code class="docutils literal notranslate"><span class="pre">a</span></code>
requests fixture <code class="docutils literal notranslate"><span class="pre">b</span></code>, then fixture <code class="docutils literal notranslate"><span class="pre">b</span></code> will effectively be an autouse
fixture as well, but only for the tests that <code class="docutils literal notranslate"><span class="pre">a</span></code> applies to.</p>
<p>In the last example, the graph became unclear if <code class="docutils literal notranslate"><span class="pre">d</span></code> didn’t request <code class="docutils literal notranslate"><span class="pre">c</span></code>. But
if <code class="docutils literal notranslate"><span class="pre">c</span></code> was autouse, then <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">a</span></code> would effectively also be autouse
because <code class="docutils literal notranslate"><span class="pre">c</span></code> depends on them. As a result, they would all be shifted above
non-autouse fixtures within that scope.</p>
<p>So if the test file looked like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">order</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[]</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"b"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"c"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">d</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"d"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">e</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"e"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"g"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_order_and_g</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">,</span> <span class="s2">"g"</span><span class="p">]</span>
</pre></div>
</div>
<p>the graph would look like this:</p>
<img alt="../_images/test_fixtures_order_autouse.svg" class="align-center" src="../_images/test_fixtures_order_autouse.svg"/><p>Because <code class="docutils literal notranslate"><span class="pre">c</span></code> can now be put above <code class="docutils literal notranslate"><span class="pre">d</span></code> in the graph, pytest can once again
linearize the graph to this:</p>
<img alt="../_images/test_fixtures_order_autouse_flat.svg" class="align-center" src="../_images/test_fixtures_order_autouse_flat.svg"/><p>In this example, <code class="docutils literal notranslate"><span class="pre">c</span></code> makes <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">a</span></code> effectively autouse fixtures as
well.</p>
<p>Be careful with autouse, though, as an autouse fixture will automatically
execute for every test that can reach it, even if they don’t request it. For
example, consider this file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"class"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">order</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[]</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"class"</span><span class="p">,</span> <span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">c1</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"c1"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"class"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">c2</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"c2"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">"class"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">c3</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">c1</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"c3"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TestClassWithC1Request</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c3</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"c1"</span><span class="p">,</span> <span class="s2">"c3"</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">TestClassWithoutC1Request</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"c1"</span><span class="p">,</span> <span class="s2">"c2"</span><span class="p">]</span>
</pre></div>
</div>
<p>Even though nothing in <code class="docutils literal notranslate"><span class="pre">TestClassWithoutC1Request</span></code> is requesting <code class="docutils literal notranslate"><span class="pre">c1</span></code>, it still
is executed for the tests inside it anyway:</p>
<img alt="../_images/test_fixtures_order_autouse_multiple_scopes.svg" class="align-center" src="../_images/test_fixtures_order_autouse_multiple_scopes.svg"/><p>But just because one autouse fixture requested a non-autouse fixture, that
doesn’t mean the non-autouse fixture becomes an autouse fixture for all contexts
that it can apply to. It only effectively becomes an autouse fixture for the
contexts the real autouse fixture (the one that requested the non-autouse
fixture) can apply to.</p>
<p>For example, take a look at this test file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">order</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[]</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">c1</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"c1"</span><span class="p">)</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">c2</span><span class="p">(</span><span class="n">order</span><span class="p">):</span>
    <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"c2"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TestClassWithAutouse</span><span class="p">:</span>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">c3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
        <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"c3"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_req</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">c1</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"c2"</span><span class="p">,</span> <span class="s2">"c3"</span><span class="p">,</span> <span class="s2">"c1"</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">test_no_req</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"c2"</span><span class="p">,</span> <span class="s2">"c3"</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">TestClassWithoutAutouse</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test_req</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">c1</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[</span><span class="s2">"c1"</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">test_no_req</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">order</span> <span class="o">==</span> <span class="p">[]</span>
</pre></div>
</div>
<p>It would break down to something like this:</p>
<img alt="../_images/test_fixtures_order_autouse_temp_effects.svg" class="align-center" src="../_images/test_fixtures_order_autouse_temp_effects.svg"/><p>For <code class="docutils literal notranslate"><span class="pre">test_req</span></code> and <code class="docutils literal notranslate"><span class="pre">test_no_req</span></code> inside <code class="docutils literal notranslate"><span class="pre">TestClassWithAutouse</span></code>, <code class="docutils literal notranslate"><span class="pre">c3</span></code>
effectively makes <code class="docutils literal notranslate"><span class="pre">c2</span></code> an autouse fixture, which is why <code class="docutils literal notranslate"><span class="pre">c2</span></code> and <code class="docutils literal notranslate"><span class="pre">c3</span></code> are
executed for both tests, despite not being requested, and why <code class="docutils literal notranslate"><span class="pre">c2</span></code> and <code class="docutils literal notranslate"><span class="pre">c3</span></code>
are executed before <code class="docutils literal notranslate"><span class="pre">c1</span></code> for <code class="docutils literal notranslate"><span class="pre">test_req</span></code>.</p>
<p>If this made <code class="docutils literal notranslate"><span class="pre">c2</span></code> an <em>actual</em> autouse fixture, then <code class="docutils literal notranslate"><span class="pre">c2</span></code> would also execute
for the tests inside <code class="docutils literal notranslate"><span class="pre">TestClassWithoutAutouse</span></code>, since they can reference
<code class="docutils literal notranslate"><span class="pre">c2</span></code> if they wanted to. But it doesn’t, because from the perspective of the
<code class="docutils literal notranslate"><span class="pre">TestClassWithoutAutouse</span></code> tests, <code class="docutils literal notranslate"><span class="pre">c2</span></code> isn’t an autouse fixture, since they
can’t see <code class="docutils literal notranslate"><span class="pre">c3</span></code>.</p>
</section>
</section>
</section>
<div class="clearer"></div>
</div>
</div>
<span id="sidebar-top"></span>
<div class="clearer"></div>
</div>
<div class="footer" role="contentinfo">
        © Copyright 2015, holger krekel and pytest-dev team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
<script src="../_static/version_warning_offset.js"></script>
</body>
</html>