<html><!-- Online page at https://redis.io/docs/reference/modules/modules-api-ref/ --><head><meta charset="utf-8"><title>Modules API reference</title><link rel="stylesheet" href="../../../css_1.css" type="text/css"><link rel="stylesheet" href="../../../css_2.css" type="text/css"><link rel="stylesheet" href="../../../css_3.css" type="text/css"><link rel="stylesheet" href="../../../css_4.css" type="text/css"><link rel="stylesheet" href="../../../css_5.css" type="text/css"><script type="text/javascript" src="../../../js_1.js"></script><script type="text/javascript" src="../../../js_10.js"></script><script type="text/javascript" src="../../../js_3.js"></script><script type="text/javascript" src="../../../js_4.js"></script><script type="text/javascript" src="../../../js_5.js"></script><script type="text/javascript" src="../../../js_6.js"></script><script type="text/javascript" src="../../../js_7.js"></script><script type="text/javascript" src="../../../js_8.js"></script><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style></head><body class="antialiased tracking-[-0.01em]">
    <noscript>&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;lt;iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T4MTBKP"
        height="0" width="0" style="display:none;visibility:hidden"&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;lt;/iframe&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;gt;</noscript>
    <header class="sticky top-0 z-50 flex items-center w-full text-xs lg:text-sm font-semibold lg:font-medium text-white shadow bg-midnight-700">
      <div class="flex items-center w-full h-16 container max-w-[85rem] mx-auto px-4 sm:px-8">
  <a class="relative z-50 mr-auto" href="../../../../redis.io.html">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 368.69 125.59" class="w-auto h-8">
  <defs>
    <style>
      .cls-1 {
        fill: none;
      }

      .cls-2 {
        clip-path: url(#clip-path);
      }

      .cls-3 {
        fill: #a32422;
      }

      .cls-4 {
        fill: #dc382c;
      }

      .cls-5 {
        fill: #fff;
      }

      .cls-6 {
        fill: #741113;
      }

      .cls-7 {
        fill: #ac2724;
      }
    </style>
    <clipPath id="clip-path" transform="translate(0.01 0.01)">
      <rect class="cls-1" width="146.42" height="125.48"></rect>
    </clipPath>
  </defs>
  <g id="Layer_2" data-name="Layer 2">
    <g id="Layer_1-2" data-name="Layer 1">
      <g class="cls-2">
        <path class="cls-3" d="M140.66,96.74c-7.8,4.08-48.28,20.73-57,25.3s-13.39,4.44-20.21,1.18S13.7,102.5,5.92,98.78C2,96.94,0,95.37,0,93.9V79.09S56.08,66.92,65.13,63.64,77.31,60.28,85,63.1,138.79,74.24,146.4,77V91.6c0,1.52-1.75,3-5.74,5.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,82c-7.8,4.06-48.28,20.71-57,25.2s-13.39,4.45-20.21,1.2S13.7,87.69,5.92,84s-7.93-6.27-.3-9.25S56.08,55,65.13,51.7,77.31,48.33,85,51.16,133,70,140.57,72.79s7.92,5.08.09,9.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-3" d="M140.66,72.62c-7.8,4.07-48.28,20.71-57,25.2S70.31,102.27,63.49,99,13.7,78.37,5.92,74.66C2,72.8,0,71.24,0,69.76V55S56.08,42.79,65.13,39.51,77.31,36.14,85,39,138.79,50.1,146.4,52.88v14.6C146.4,69,144.65,70.52,140.66,72.62Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,57.81c-7.8,4.08-48.28,20.72-57,25.21s-13.39,4.46-20.21,1.2S13.7,63.57,5.92,59.85-2,53.6,5.62,50.62s50.46-19.79,59.51-23S77.31,24.21,85,27,133,45.94,140.57,48.65s7.92,5.09.09,9.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-3" d="M140.66,47.59c-7.8,4.08-48.28,20.73-57,25.21S70.31,77.25,63.49,74,13.7,53.34,5.92,49.63C2,47.79,0,46.22,0,44.74V29.93S56.08,17.76,65.13,14.49,77.31,11.12,85,13.94s53.77,11.14,61.38,13.92v14.6C146.4,44,144.65,45.5,140.66,47.59Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,32.8c-7.8,4-48.28,20.75-57,25.2s-13.39,4.44-20.21,1.2S13.7,38.53,5.92,34.83s-7.93-6.27-.3-9.25S56.08,5.8,65.13,2.54,77.31-.82,85,2,133,20.85,140.57,23.63s7.92,5.09.09,9.14Z" transform="translate(0.01 0.01)"></path>
      </g>
      <polygon class="cls-5" points="75.51 11.78 85.17 8.61 82.55 14.87 92.38 18.55 79.71 19.87 76.86 26.71 72.28 19.08 57.63 17.76 68.57 13.82 65.28 7.76 75.51 11.78 75.51 11.78 75.51 11.78"></polygon>
      <polygon class="cls-5" points="76.12 51.71 52.44 41.88 86.36 36.67 76.12 51.71 76.12 51.71 76.12 51.71"></polygon>
      <path class="cls-5" d="M43.28,22.34c10,0,18.13,3.15,18.13,7s-8.15,7-18.13,7-18.14-3.15-18.14-7S33.27,22.34,43.28,22.34Z" transform="translate(0.01 0.01)"></path>
      <polygon class="cls-6" points="107.39 20.42 127.46 28.35 107.41 36.28 107.39 20.42 107.39 20.42 107.39 20.42"></polygon>
      <polygon class="cls-7" points="107.39 20.42 107.41 36.28 105.23 37.13 85.17 29.2 107.39 20.42 107.39 20.42 107.39 20.42"></polygon>
      <path class="cls-5" d="M193,41.4a17.36,17.36,0,0,1,6.23-4.34,20,20,0,0,1,7.3-1.61,6.71,6.71,0,0,1,5,1.61,5,5,0,0,1,1.52,3.79,5.39,5.39,0,0,1-1.52,3.79,4.9,4.9,0,0,1-3.79,1.63c-6.24.55-14.9,6.77-14.9,15.22V80.67a5.57,5.57,0,0,1-5.42,5.41,4.92,4.92,0,0,1-3.87-1.67,5.36,5.36,0,0,1-1.62-3.79v-40a5.35,5.35,0,0,1,1.62-3.79,7.2,7.2,0,0,1,4.07-1.36,5.52,5.52,0,0,1,5.41,5.4Z" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M258.71,59a5.25,5.25,0,0,1-1.35,3.54,6.11,6.11,0,0,1-3.79,1.62h-32a10.31,10.31,0,0,0,3.47,6.56,14.46,14.46,0,0,0,9.48,4.57,14.07,14.07,0,0,0,10.56-2.44,5.52,5.52,0,0,1,4.07-1.63,4.65,4.65,0,0,1,3.51,1.36,4.41,4.41,0,0,1,.26,6.24c-.08.09-.17.17-.26.26a24.49,24.49,0,0,1-17.59,6.5A23,23,0,0,1,217.5,78a26.67,26.67,0,0,1-7.3-17.9,24.31,24.31,0,0,1,7.3-17.88,22.59,22.59,0,0,1,17.06-7.31,22,22,0,0,1,16.74,6.78,24.78,24.78,0,0,1,7.61,16.74v.53Zm-24.1-14.35a14.2,14.2,0,0,0-9.13,3.53,13.17,13.17,0,0,0-4.33,7h28.43a12.39,12.39,0,0,0-4.88-6.76,17.3,17.3,0,0,0-10-3.81" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M309.66,80.12a5.57,5.57,0,0,1-5.41,5.42,5.85,5.85,0,0,1-5.42-4.34A23.23,23.23,0,0,1,285,85.54a23.57,23.57,0,0,1-17.33-7.31,24.14,24.14,0,0,1-7.05-17.88,25.75,25.75,0,0,1,7.05-17.87A23.85,23.85,0,0,1,285,34.87a22.34,22.34,0,0,1,13.53,4.34V20.28a4.92,4.92,0,0,1,1.63-3.79A5.37,5.37,0,0,1,304,14.86a4.92,4.92,0,0,1,3.79,1.63,5.36,5.36,0,0,1,1.63,3.79V80.12ZM285.31,74.7a12,12,0,0,0,9.47-4.32,14.4,14.4,0,0,0,0-20A13,13,0,0,0,285.31,46a11.65,11.65,0,0,0-9.48,4.34,14.4,14.4,0,0,0,0,20,12.49,12.49,0,0,0,9.48,4.32" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M325.67,20.28v2.18A5.5,5.5,0,0,1,324,26.58a4.64,4.64,0,0,1-3.79,1.35,4.86,4.86,0,0,1-3.78-1.61,5.44,5.44,0,0,1-1.63-4.06v-2a5.28,5.28,0,0,1,1.63-3.79,5.33,5.33,0,0,1,3.78-1.63A5,5,0,0,1,324,16.49a4.9,4.9,0,0,1,1.66,3.79m-9.13,16.53a5.28,5.28,0,0,1,3.79-1.63,4.85,4.85,0,0,1,3.79,1.63,5.48,5.48,0,0,1,1.55,4V80.42A4.55,4.55,0,0,1,324,84.21a5.33,5.33,0,0,1-3.78,1.63,4.9,4.9,0,0,1-3.79-1.63,5.28,5.28,0,0,1-1.63-3.79V40.85a5.39,5.39,0,0,1,1.63-4" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M364.08,40.6a5.29,5.29,0,0,1,2.17,3.24,7.17,7.17,0,0,1-.54,4.06,5.4,5.4,0,0,1-3.25,2.16,5.61,5.61,0,0,1-4.07-.81c-3.79-2.43-6.75-3.78-9.2-3.78a8.74,8.74,0,0,0-6,1.88c-1.08.82-1.62,1.36-1.62,1.9a2,2,0,0,0,.27,1.36,3.74,3.74,0,0,0,1.08.81,16.19,16.19,0,0,0,7.32,2.43h0a37.75,37.75,0,0,1,9.74,3,13.57,13.57,0,0,1,6.5,5.7,13.46,13.46,0,0,1-4.06,18.67,21.79,21.79,0,0,1-13,4.06c-6.23,0-12.18-2.43-17.87-7a5.77,5.77,0,0,1-1.9-3.53,5.2,5.2,0,0,1,8.4-4.56,15.73,15.73,0,0,0,11.1,4.33,11.61,11.61,0,0,0,6.77-1.9c1.08-1.08,1.9-1.89,1.9-2.71s0-1.08-.27-1.35c0-.28-.55-.81-1.36-1.08a20.15,20.15,0,0,0-8.13-2.86h0a28.26,28.26,0,0,1-9.2-3,16.56,16.56,0,0,1-6.5-5.67,12.61,12.61,0,0,1-1.61-6.23,13.3,13.3,0,0,1,5.95-11.11,21.82,21.82,0,0,1,12.45-3.79c4.56.28,9.48,2.16,14.89,5.69" transform="translate(0.01 0.01)"></path>
    </g>
  </g>
</svg>
  </a>

	<nav data-menu="" class="hidden lg:flex items-center justify-center content-start lg:content-center lg:gap-y-4 flex-1 z-40 fixed inset-0 lg:static bg-slate-900 lg:bg-transparent text-sm max-h-screen lg:max-w-none pt-20 pb-8 lg:py-0 overflow-y-auto lg:overflow-y-visible">
    
    
      

        
        <a href="../../getting-started.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Get started
        </a>

        
        <a href="../../getting-started.html" class="flex lg:hidden items-center mt-1.5">
          Get started
        </a>
      
    
      
        
        
        <dl class="hidden lg:flex group relative first:ml-auto ml-1 mt-3 mb-0 px-3 pt-2 pb-5 cursor-pointer">
          <dt class="sr-only uppercase lg:not-sr-only flex items-center justify-items-center group-hover:text-white/50 group-focus-within:text-white/50 whitespace-nowrap transition-colors" href="#">
            
            Docs
          </dt>
          <dd class="hidden lg:grid text-[0.8rem] lg:text-sm text-redis-neutral-800 absolute top-full -mt-1 right-[1000rem] p-2 group-hover:right-[unset] group-hover:-left-3 group-focus-within:right-[unset] group-focus-within:-left-3 bg-white rounded-lg border border-slate-500/10 bg-clip-padding shadow-md">
            
              
                <div class="-my-2 pr-3 py-4 col-start-1  pl-3 ">
                  <a href="../../about.html" class=" font-semibold text-[0.9375rem] text-slate-900 flex items-center whitespace-nowrap min-w-[10rem] hover:text-slate-600 focus:text-slate-600 transition-colors">
                    
                      <span class="grid place-items-center w-5 h-5 mr-2.5">
                        
                        <svg viewBox="0 0 147 126" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M140.708 96.7107c-7.81 4.0703-48.2904 20.7203-57.0004 25.2903C74.9976 126.571 70.3176 126.441 63.4976 123.191s-49.8-20.73-57.57002-24.4403C2.04758 96.9007.00756836 95.3407.00756836 93.8607V79.0508S56.0876 66.8807 65.1376 63.6107 77.3176 60.2406 85.0276 63.0606C92.7376 65.8806 138.798 74.2007 146.408 76.9807V91.5606C146.408 93.0806 144.658 94.5606 140.668 96.6907L140.708 96.7107z" fill="#a32422"></path><path d="M140.708 81.9108C132.898 85.9808 92.4176 102.631 83.7076 107.121 74.9976 111.611 70.3176 111.561 63.4976 108.321c-6.82-3.24-49.8-20.6703-57.57001-24.3703-7.77-3.7-7.92999-6.27-.30999-9.25s50.47-19.78 59.52-23S77.3176 48.3408 85.0276 51.1708C92.7376 54.0008 132.968 70.0108 140.578 72.7908 148.188 75.5708 148.488 77.8808 140.668 81.9208L140.708 81.9108z" fill="#dc382c"></path><path d="M140.708 72.5807C132.898 76.6507 92.4176 93.3008 83.7076 97.7908 74.9976 102.281 70.3176 102.231 63.4976 98.9907 56.6776 95.7507 13.6976 78.3407 5.92758 74.6207 2.04758 72.7707.00756836 71.2007.00756836 69.7207V54.9306S56.0876 42.7607 65.1376 39.4707 77.3176 36.1107 85.0276 38.9407C92.7376 41.7707 138.798 50.0607 146.408 52.8507v14.64C146.488 68.9607 144.698 70.4907 140.708 72.5807z" fill="#a32422"></path><path d="M140.708 57.7808c-7.81 4.08-48.2904 20.7099-57.0004 25.1999S70.3176 87.4407 63.4976 84.1807s-49.8-20.65-57.57001-24.36C-1.84241 56.1107-2.0024 53.5607 5.6176 50.5807s50.47-19.78 59.52-23S77.3176 24.2208 85.0276 27.0308C92.7376 29.8408 132.968 45.9508 140.578 48.6608 148.188 51.3708 148.488 53.7408 140.668 57.7908L140.708 57.7808z" fill="#dc382c"></path><path d="M140.708 47.5508c-7.81 4.08-48.2904 20.73-57.0004 25.22C74.9976 77.2608 70.3176 77.2107 63.4976 73.9507 56.6776 70.6907 13.6976 53.3007 5.92758 49.5907c-3.88-1.84-5.92001164-3.41-5.92001164-4.89V29.9008S56.0876 17.7207 65.1376 14.4507c9.05-3.27 12.18-3.3599 19.89-.549899999999999C92.7376 16.7108 138.798 25.0407 146.408 27.8307V42.4208C146.488 43.9408 144.698 45.4908 140.708 47.5508z" fill="#a32422"></path><path d="M140.708 32.7607c-7.81 4-48.2904 20.7599-57.0004 25.1999s-13.39 4.4401-20.21 1.2001-49.8-20.66-57.57001-24.36c-7.77-3.7-7.92999-6.27-.30999-9.26 7.62-2.99 50.47-19.77998 59.52-22.99998 9.05-3.219996 12.18-3.360025 19.89-.53003C92.7376 4.84069 132.968 20.8507 140.578 23.6407 148.188 26.4307 148.488 28.7207 140.668 32.7707L140.708 32.7607z" fill="#dc382c"></path><path d="M140.708 96.7107c-7.81 4.0703-48.2904 20.7203-57.0004 25.2903C74.9976 126.571 70.3176 126.441 63.4976 123.191s-49.8-20.73-57.57002-24.4403C2.04758 96.9007.00756836 95.3407.00756836 93.8607V79.0508S56.0876 66.8807 65.1376 63.6107 77.3176 60.2406 85.0276 63.0606C92.7376 65.8806 138.798 74.2007 146.408 76.9807V91.5606C146.408 93.0806 144.658 94.5606 140.668 96.6907L140.708 96.7107z" fill="#a32422"></path><path d="M140.708 81.9108C132.898 85.9808 92.4176 102.631 83.7076 107.121 74.9976 111.611 70.3176 111.561 63.4976 108.321c-6.82-3.24-49.8-20.6703-57.57001-24.3703-7.77-3.7-7.92999-6.27-.30999-9.25s50.47-19.78 59.52-23S77.3176 48.3408 85.0276 51.1708C92.7376 54.0008 132.968 70.0108 140.578 72.7908 148.188 75.5708 148.488 77.8808 140.668 81.9208L140.708 81.9108z" fill="#dc382c"></path><path d="M140.708 72.5807C132.898 76.6507 92.4176 93.3008 83.7076 97.7908 74.9976 102.281 70.3176 102.231 63.4976 98.9907 56.6776 95.7507 13.6976 78.3407 5.92758 74.6207 2.04758 72.7707.00756836 71.2007.00756836 69.7207V54.9306S56.0876 42.7607 65.1376 39.4707 77.3176 36.1107 85.0276 38.9407C92.7376 41.7707 138.798 50.0607 146.408 52.8507v14.64C146.488 68.9607 144.698 70.4907 140.708 72.5807z" fill="#a32422"></path><path d="M140.708 57.7808c-7.81 4.08-48.2904 20.7099-57.0004 25.1999S70.3176 87.4407 63.4976 84.1807s-49.8-20.65-57.57001-24.36C-1.84241 56.1107-2.0024 53.5607 5.6176 50.5807s50.47-19.78 59.52-23S77.3176 24.2208 85.0276 27.0308C92.7376 29.8408 132.968 45.9508 140.578 48.6608 148.188 51.3708 148.488 53.7408 140.668 57.7908L140.708 57.7808z" fill="#dc382c"></path><path d="M140.708 47.5508c-7.81 4.08-48.2904 20.73-57.0004 25.22C74.9976 77.2608 70.3176 77.2107 63.4976 73.9507 56.6776 70.6907 13.6976 53.3007 5.92758 49.5907c-3.88-1.84-5.92001164-3.41-5.92001164-4.89V29.9008S56.0876 17.7207 65.1376 14.4507c9.05-3.27 12.18-3.3599 19.89-.549899999999999C92.7376 16.7108 138.798 25.0407 146.408 27.8307V42.4208C146.488 43.9408 144.698 45.4908 140.708 47.5508z" fill="#a32422"></path><path d="M140.708 32.7607c-7.81 4-48.2904 20.7599-57.0004 25.1999s-13.39 4.4401-20.21 1.2001-49.8-20.66-57.57001-24.36c-7.77-3.7-7.92999-6.27-.30999-9.26 7.62-2.99 50.47-19.77998 59.52-22.99998 9.05-3.219996 12.18-3.360025 19.89-.53003C92.7376 4.84069 132.968 20.8507 140.578 23.6407 148.188 26.4307 148.488 28.7207 140.668 32.7707L140.708 32.7607z" fill="#dc382c"></path><path d="M75.5476 11.7307l9.66-3.17-2.62 6.26 9.83 3.68-12.67 1.32L76.8976 26.6607l-4.58-7.63-14.65-1.32 10.94-3.94L65.3176 7.71069l10.23 4.02001z" fill="#fff"></path><path d="M76.1575 51.6607l-23.68-9.83 33.92-5.2-10.24 15.03z" fill="#fff"></path><path d="M43.3276 22.3008c10 0 18.12 3.15 18.12 7s-8.14 7-18.12 7c-9.98.0-18.14-3.15000000000001-18.14-7s8.13-7 18.14-7z" fill="#fff"></path><path d="M107.428 20.3707l20.07 7.93-20.05 7.93L107.428 20.3707z" fill="#741113"></path><path d="M107.428 20.3707 107.448 36.2307 105.268 37.0807l-20.0605-7.93 22.2205-8.78z" fill="#ac2724"></path></svg>
                      </span>
                    
                    Redis
                  </a>
                  
                    <a href="../../getting-started.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Get started
                    </a>
                  
                    <a href="../../data-types.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Data types
                    </a>
                  
                    <a href="../../ui/cli.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Redis CLI
                    </a>
                  
                    <a href="../../clients.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Redis clients
                    </a>
                  
                    <a href="../../management/persistence.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Persistence
                    </a>
                  
                    <a href="../../management/scaling.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Scaling
                    </a>
                  
                </div>
              
            
              
                <div class="-my-2 pr-3 py-4 col-start-2  border-l pl-5 ">
                  <a href="../../stack.html" class=" font-semibold text-[0.9375rem] text-slate-900 flex items-center whitespace-nowrap min-w-[10rem] hover:text-slate-600 focus:text-slate-600 transition-colors">
                    
                      <span class="grid place-items-center w-5 h-5 mr-2.5">
                        
                        <svg viewBox="0 0 39 31" fill="none"><path d="M21.7371 15.2903C21.5759 15.2895 21.4198 15.2337 21.2947 15.1321 21.1695 15.0305 21.0828 14.8892 21.049 14.7316S21.0362 14.4096 21.1086 14.2655C21.1811 14.1215 21.3005 14.0066 21.4472 13.9397L35.7199 7.47338 21.4578 1.34289C21.2943 1.26329 21.1678 1.12377 21.1045.953307 21.0412.78285 21.046.594558 21.1179.427547 21.1898.260535 21.3233.127641 21.4906.0564719 21.6579-.0146977 21.8462-.0186728 22.0164.045373L37.7492 6.80518C37.8747 6.8605 37.9814 6.95112 38.0563 7.06599S38.171 7.31503 38.171 7.45216 38.1312 7.72347 38.0563 7.83834C37.9814 7.95321 37.8747 8.04383 37.7492 8.09915L22.0306 15.2266C21.9388 15.2698 21.8385 15.2916 21.7371 15.2903z" fill="#db2e2e"></path><path d="M16.4339 15.2903C16.3379 15.2906 16.2429 15.2714 16.1546 15.2337L.421813 8.47393C.296339 8.41861.18966 8.32799.114767 8.21312.0398745 8.09825.0 7.96407.0 7.82694.0 7.68981.0398745 7.55564.114767 7.44077.18966 7.3259.296339 7.23528.421813 7.17995L16.1546.052465C16.3235-.0111265 16.5104-.00772359 16.6768.0619772 16.8433.131678 16.9768.2624 17.0501.427363 17.1233.592325 17.1306.779042 17.0706.949259 17.0106 1.11948 16.8878 1.26031 16.7274 1.34291L2.44763 7.80573 16.7132 13.9362C16.8612 14.0015 16.9823 14.1154 17.0565 14.2592 17.1306 14.4029 17.1532 14.5677 17.1205 14.7261 17.0878 14.8845 17.0019 15.0269 16.8769 15.1295 16.752 15.2322 16.5956 15.2889 16.4339 15.2903z" fill="#db2e2e"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 17.4328c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 13.9539C37.3908 13.8108 37.6564 13.6514 37.9118 13.4766 37.972 13.8833 37.972 14.2967 37.9118 14.7034 37.8022 15.1312 37.4875 15.4847 36.289 16.061 35.4617 16.4605 33.1531 17.408 30.5792 18.4687c-3.6167 1.4884-7.778 3.1819-9.0826 3.889C19.2587 23.4183 18.0284 23.4183 16.3137 22.644 15.4864 22.2021 12.4918 20.9117 9.39476 19.5611c-3.3198-1.446-6.75627-2.945-7.77802-3.4753C.22377 15.3575.153061 15.1948.160132 14.8271V13.8655L.513678 14.0564c1.311652.6647 7.219412 3.1819 11.486722 5.0204 2.1142.898 3.8112 1.6298 4.3769 1.8844C18.092 21.7319 19.3082 21.8733 21.5603 20.6748 22.7022 20.0808 25.9619 18.7409 29.1651 17.4328z" fill="#494c4d"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 24.5037c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 21.0248C37.3908 20.8817 37.6564 20.7223 37.9118 20.5475 37.972 20.9542 37.972 21.3676 37.9118 21.7743 37.8022 22.2021 37.4875 22.5557 36.289 23.1319 35.4617 23.5314 33.1531 24.4789 30.5792 25.5396c-3.6167 1.4884-7.778 3.1819-9.0826 3.889-2.2379 1.0606-3.4682 1.0606-5.1829.2864C15.4864 29.2801 12.4918 27.9755 9.39476 26.625c-3.3198-1.446-6.75627-2.9451-7.77802-3.4754C.22377 22.4213.153061 22.2587.160132 21.891V20.9364L.513678 21.1273C1.82533 21.792 7.73309 24.3092 12.0004 26.1477c2.1001.898 3.8006 1.6298 4.3663 1.8844C18.0814 28.8028 19.2976 28.9442 21.5497 27.7457 22.7022 27.1518 25.9619 25.8118 29.1651 24.5037z" fill="#494c4d"></path></svg>
                      </span>
                    
                    Redis Stack
                  </a>
                  
                    <a href="../../stack/get-started.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Get started
                    </a>
                  
                    <a href="../../stack/get-started/clients.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Stack clients
                    </a>
                  
                    <a href="../../ui/insight.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      RedisInsight
                    </a>
                  
                    <a href="../../stack/json.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      JSON
                    </a>
                  
                    <a href="../../stack/search.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Search
                    </a>
                  
                    <a href="../../stack/bloom.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Probabilistic
                    </a>
                  
                </div>
              
            
          </dd>
        </dl>
        
        
        <dl class="lg:hidden">
          <dt class="sr-only">
            Docs
          </dt>
          <dd class="lg:hidden flex flex-col">
            
              
                <a href="../../about.html" class="flex items-center mt-2">
                  Redis
                </a>
                
                  <a href="../../getting-started.html" class="mt-2">
                    Get started
                  </a>
                
                  <a href="../../data-types.html" class="mt-2">
                    Data types
                  </a>
                
                  <a href="../../ui/cli.html" class="mt-2">
                    Redis CLI
                  </a>
                
                  <a href="../../clients.html" class="mt-2">
                    Redis clients
                  </a>
                
                  <a href="../../management/persistence.html" class="mt-2">
                    Persistence
                  </a>
                
                  <a href="../../management/scaling.html" class="mt-2">
                    Scaling
                  </a>
                
                <hr class="opacity-10 mt-4 mb-2">
              
            
              
                <a href="../../stack.html" class="flex items-center mt-2">
                  Redis Stack
                </a>
                
                  <a href="../../stack/get-started.html" class="mt-2">
                    Get started
                  </a>
                
                  <a href="../../stack/get-started/clients.html" class="mt-2">
                    Stack clients
                  </a>
                
                  <a href="../../ui/insight.html" class="mt-2">
                    RedisInsight
                  </a>
                
                  <a href="../../stack/json.html" class="mt-2">
                    JSON
                  </a>
                
                  <a href="../../stack/search.html" class="mt-2">
                    Search
                  </a>
                
                  <a href="../../stack/bloom.html" class="mt-2">
                    Probabilistic
                  </a>
                
                <hr class="opacity-10 mt-4 mb-2">
              
            
          </dd>
        </dl>
      
    
      

        
        <a href="../../../commands.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Commands
        </a>

        
        <a href="../../../commands.html" class="flex lg:hidden items-center mt-1.5">
          Commands
        </a>
      
    
      
        
        
        <dl class="hidden lg:flex group relative first:ml-auto ml-1 mt-3 mb-0 px-3 pt-2 pb-5 cursor-pointer">
          <dt class="sr-only uppercase lg:not-sr-only flex items-center justify-items-center group-hover:text-white/50 group-focus-within:text-white/50 whitespace-nowrap transition-colors" href="#">
            
            Resources
          </dt>
          <dd class="hidden lg:grid text-[0.8rem] lg:text-sm text-redis-neutral-800 absolute top-full -mt-1 right-[1000rem] p-2 group-hover:right-[unset] group-hover:-left-3 group-focus-within:right-[unset] group-focus-within:-left-3 bg-white rounded-lg border border-slate-500/10 bg-clip-padding shadow-md">
            
              
              <a href="../../../resources/clients.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Clients
              </a>
              
            
              
              <a href="../../../resources/libraries.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Libraries
              </a>
              
            
              
              <a href="../../../resources/tools.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Tools
              </a>
              
            
              
              <a href="../../../resources/modules.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Modules
              </a>
              
            
          </dd>
        </dl>
        
        
        <dl class="lg:hidden">
          <dt class="sr-only">
            Resources
          </dt>
          <dd class="lg:hidden flex flex-col">
            
              
              <a href="../../../resources/clients.html" class="mt-2">
                Clients
              </a>
              
            
              
              <a href="../../../resources/libraries.html" class="mt-2">
                Libraries
              </a>
              
            
              
              <a href="../../../resources/tools.html" class="mt-2">
                Tools
              </a>
              
            
              
              <a href="../../../resources/modules.html" class="mt-2">
                Modules
              </a>
              
            
          </dd>
        </dl>
      
    
      

        
        <a href="../../../community.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Community
        </a>

        
        <a href="../../../community.html" class="flex lg:hidden items-center mt-1.5">
          Community
        </a>
      
    
      

        
        <a href="../../../support.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Support
        </a>

        
        <a href="../../../support.html" class="flex lg:hidden items-center mt-1.5">
          Support
        </a>
      
    
    
    <div class="flex flex-col lg:flex-row lg:ml-auto lg:space-x-2">
      <button id="search-button" type="button" class="rounded-sm w-full lg:w-auto transition-colors shrink-0 flex-1 lg:flex-none lg:ml-2 lg:mr-0 mt-4 lg:mt-0 inline-flex items-center px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 border-white/50 hover:text-indigo-600 focus:text-indigo-600 hover:bg-white focus:bg-white focus:ring-white">
        <svg class="w-[0.875rem] h-[0.875rem] mr-0.5" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <circle cx="10" cy="10" r="7"></circle>
          <line x1="21" y1="21" x2="15" y2="15"></line>
        </svg>
        <span class="sr-only">Quick search&amp;hellip…</span>
        <span class="lg:hidden xl:block flex-auto ml-1 mr-4" aria-hidden="">Search…</span>
        <script>
          if (navigator.appVersion.indexOf("Win") != -1 || navigator.appVersion.indexOf("Linux") != -1) {
            document.querySelector('[title="Command"]').textContent = "&#8963;";
          } 
        </script>
        <kbd class="font-sans font-semibold">
          <abbr title="Command" class="no-underline">⌘</abbr>&nbsp;K
        </kbd>
      </button>
      
        <a class="rounded-sm transition-colors shrink-0 inline-flex items-center justify-center mt-2 lg:mt-0 px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900
         border-transparent bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 focus:ring-indigo-600
        " href="../../../download.html">
          Download
        </a>
      
        <a class="rounded-sm transition-colors shrink-0 inline-flex items-center justify-center mt-2 lg:mt-0 px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900
        
         border-white/50 hover:text-indigo-600 focus:text-indigo-600 hover:bg-white focus:bg-white focus:ring-white" href="http://redis.com/try-free/">
          Try Redis Cloud
        </a>
      
    </div>
	</nav>

  <button data-menu-toggle="" aria-expanded="false" class="menu-toggle block ml-auto lg:hidden relative z-50"> 
    <span class="sr-only">Open main menu</span> 
    <svg aria-hidden="true" role="img" viewBox="0 0 24 24" style="pointer-events: none; width: 24px; height: 24px;" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <line x1="4" y1="6" x2="20" y2="6"></line>
      <line x1="4" y1="12" x2="20" y2="12"></line>
      <line x1="4" y1="18" x2="20" y2="18"></line>
    </svg>
  </button>
</div>
    </header>

    
  <main class="docs w-full max-w-[85rem] mx-auto px-4 sm:px-6 lg:px-8 md:flex gap-16">
    

<div class="hidden md:block w-52 h-full shrink-0">
  <nav class="w-52 z-40 bg-white hidden md:block fixed top-28 pb-16 h-full max-h-[calc(100vh-7rem)] text-[0.8125rem] leading-7 font">
    <div class="absolute right-0 -top-28 z-[-1] h-screen border-r border-slate-200/50 bg-gradient-to-bl from-slate-50 via-slate-50 to-indigo-100 w-[17rem] xl:w-[calc(50vw-23rem)]"></div>
    <ul class="h-full max-h-[calc(100vh-7rem)] overflow-y-auto pr-6">
      
    <li>
      <a class="flex justify-between items-center truncate font-semibold text-slate-900" href="../../../docs.html">
          <span>Documentation</span>
          
      </a>
        <ul class="">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../about.html">
          <span>About</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../getting-started.html">
          <span>Getting started</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../ui.html">
          <span>User interfaces</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../data-types.html">
          <span>Data types</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../clients.html">
          <span>Client quickstarts</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../manual.html">
          <span>Using Redis</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../management.html">
          <span>Managing Redis</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../reference.html">
          <span>Reference</span>
          
            
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400 rotate-90" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../command-tips.html">
          <span>Command tips</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../modules.html">
          <span>Modules API</span>
          
            
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400 rotate-90" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
    <li>
      <a class="flex justify-between items-center truncate active text-indigo-600" href="./modules-api-ref.html">
          <span>API reference</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./modules-blocking-ops.html">
          <span>Blocking commands</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./modules-native-types.html">
          <span>Native types API</span>
          
      </a>
    </li>
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../sentinel-clients.html">
          <span>Sentinel clients</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../key-specs.html">
          <span>Command key specifications</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../protocol-spec.html">
          <span>Protocol spec</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../clients.html">
          <span>Client handling</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../eviction.html">
          <span>Eviction</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../command-arguments.html">
          <span>Command arguments</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../signals.html">
          <span>Signal handling</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../cluster-spec.html">
          <span>Cluster spec</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../gopher.html">
          <span>Gopher protocol</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../arm.html">
          <span>ARM support</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../internals.html">
          <span>Internals</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../stack.html">
          <span>Redis Stack</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
        </ul>
    </li>
    </ul>
  </nav>
</div>
    <div class="w-full max-w-[47rem] py-12">
      <nav class="flex" aria-label="Breadcrumb">
  <ol role="list" class="flex items-center space-x-2">
    
  
    
  
    
  
    
  
    
  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <a class="text-gray-400 hover:text-gray-500" href="../../../../redis.io.html">
        <svg class="flex-shrink-0 h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
        </svg>
        <span class="sr-only">Home</span>
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../../../docs.html">
        Documentation
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../../reference.html">
        Redis reference
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../modules.html">
        Redis modules API
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 pointer-events-none">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="./modules-api-ref.html">
        Modules API reference
      </a>
    
  </li>

  </ol>
</nav>


      <section class="prose prose-slate w-full max-w-[47rem] py-12">
        <h1>Modules API reference</h1>
        <p class="text-lg -mt-5 mb-10">Reference for the Redis Modules API</p>
        <!-- This file is generated from module.c using
     utils/generate-module-api-doc.rb -->
<a class="dashAnchor" name="//apple_ref/Section/Sections"></a><h2 id="sections">Sections</h2>
<ul>
<li><a href="#section-heap-allocation-raw-functions">Heap allocation raw functions</a></li>
<li><a href="#section-commands-api">Commands API</a></li>
<li><a href="#section-module-information-and-time-measurement">Module information and time measurement</a></li>
<li><a href="#section-automatic-memory-management-for-modules">Automatic memory management for modules</a></li>
<li><a href="#section-string-objects-apis">String objects APIs</a></li>
<li><a href="#section-reply-apis">Reply APIs</a></li>
<li><a href="#section-commands-replication-api">Commands replication API</a></li>
<li><a href="#section-db-and-key-apis-generic-api">DB and Key APIs – Generic API</a></li>
<li><a href="#section-key-api-for-string-type">Key API for String type</a></li>
<li><a href="#section-key-api-for-list-type">Key API for List type</a></li>
<li><a href="#section-key-api-for-sorted-set-type">Key API for Sorted Set type</a></li>
<li><a href="#section-key-api-for-sorted-set-iterator">Key API for Sorted Set iterator</a></li>
<li><a href="#section-key-api-for-hash-type">Key API for Hash type</a></li>
<li><a href="#section-key-api-for-stream-type">Key API for Stream type</a></li>
<li><a href="#section-calling-redis-commands-from-modules">Calling Redis commands from modules</a></li>
<li><a href="#section-modules-data-types">Modules data types</a></li>
<li><a href="#section-rdb-loading-and-saving-functions">RDB loading and saving functions</a></li>
<li><a href="#section-key-digest-api-debug-digest-interface-for-modules-types">Key digest API (DEBUG DIGEST interface for modules types)</a></li>
<li><a href="#section-aof-api-for-modules-data-types">AOF API for modules data types</a></li>
<li><a href="#section-io-context-handling">IO context handling</a></li>
<li><a href="#section-logging">Logging</a></li>
<li><a href="#section-blocking-clients-from-modules">Blocking clients from modules</a></li>
<li><a href="#section-thread-safe-contexts">Thread Safe Contexts</a></li>
<li><a href="#section-module-keyspace-notifications-api">Module Keyspace Notifications API</a></li>
<li><a href="#section-modules-cluster-api">Modules Cluster API</a></li>
<li><a href="#section-modules-timers-api">Modules Timers API</a></li>
<li><a href="#section-modules-eventloop-api">Modules EventLoop API</a></li>
<li><a href="#section-modules-acl-api">Modules ACL API</a></li>
<li><a href="#section-modules-dictionary-api">Modules Dictionary API</a></li>
<li><a href="#section-modules-info-fields">Modules Info fields</a></li>
<li><a href="#section-modules-utility-apis">Modules utility APIs</a></li>
<li><a href="#section-modules-api-exporting-importing">Modules API exporting / importing</a></li>
<li><a href="#section-module-command-filter-api">Module Command Filter API</a></li>
<li><a href="#section-scanning-keyspace-and-hashes">Scanning keyspace and hashes</a></li>
<li><a href="#section-module-fork-api">Module fork API</a></li>
<li><a href="#section-server-hooks-implementation">Server hooks implementation</a></li>
<li><a href="#section-module-configurations-api">Module Configurations API</a></li>
<li><a href="#section-key-eviction-api">Key eviction API</a></li>
<li><a href="#section-miscellaneous-apis">Miscellaneous APIs</a></li>
<li><a href="#section-defrag-api">Defrag API</a></li>
<li><a href="#section-function-index">Function index</a></li>
</ul>
<p><span id="section-heap-allocation-raw-functions"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Heap%20allocation%20raw%20functions"></a><h2 id="heap-allocation-raw-functions">Heap allocation raw functions</h2>
<p>Memory allocated with these functions are taken into account by Redis key
eviction algorithms and are reported in Redis memory usage information.</p>
<p><span id="RedisModule_Alloc"></span></p>
<h3 id="redismodule_alloc"><code>RedisModule_Alloc</code></h3>
<pre><code>void *RedisModule_Alloc(size_t bytes);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Use like <code>malloc()</code>. Memory allocated with this function is reported in
Redis INFO memory, used for keys eviction according to maxmemory settings
and in general is taken into account as memory allocated by Redis.
You should avoid using <code>malloc()</code>.
This function panics if unable to allocate enough memory.</p>
<p><span id="RedisModule_TryAlloc"></span></p>
<h3 id="redismodule_tryalloc"><code>RedisModule_TryAlloc</code></h3>
<pre><code>void *RedisModule_TryAlloc(size_t bytes);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Similar to <a href="#RedisModule_Alloc"><code>RedisModule_Alloc</code></a>, but returns NULL in case of allocation failure, instead
of panicking.</p>
<p><span id="RedisModule_Calloc"></span></p>
<h3 id="redismodule_calloc"><code>RedisModule_Calloc</code></h3>
<pre><code>void *RedisModule_Calloc(size_t nmemb, size_t size);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Use like <code>calloc()</code>. Memory allocated with this function is reported in
Redis INFO memory, used for keys eviction according to maxmemory settings
and in general is taken into account as memory allocated by Redis.
You should avoid using <code>calloc()</code> directly.</p>
<p><span id="RedisModule_Realloc"></span></p>
<h3 id="redismodule_realloc"><code>RedisModule_Realloc</code></h3>
<pre><code>void* RedisModule_Realloc(void *ptr, size_t bytes);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Use like <code>realloc()</code> for memory obtained with <a href="#RedisModule_Alloc"><code>RedisModule_Alloc()</code></a>.</p>
<p><span id="RedisModule_Free"></span></p>
<h3 id="redismodule_free"><code>RedisModule_Free</code></h3>
<pre><code>void RedisModule_Free(void *ptr);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Use like <code>free()</code> for memory obtained by <a href="#RedisModule_Alloc"><code>RedisModule_Alloc()</code></a> and
<a href="#RedisModule_Realloc"><code>RedisModule_Realloc()</code></a>. However you should never try to free with
<a href="#RedisModule_Free"><code>RedisModule_Free()</code></a> memory allocated with <code>malloc()</code> inside your module.</p>
<p><span id="RedisModule_Strdup"></span></p>
<h3 id="redismodule_strdup"><code>RedisModule_Strdup</code></h3>
<pre><code>char *RedisModule_Strdup(const char *str);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Like <code>strdup()</code> but returns memory allocated with <a href="#RedisModule_Alloc"><code>RedisModule_Alloc()</code></a>.</p>
<p><span id="RedisModule_PoolAlloc"></span></p>
<h3 id="redismodule_poolalloc"><code>RedisModule_PoolAlloc</code></h3>
<pre><code>void *RedisModule_PoolAlloc(RedisModuleCtx *ctx, size_t bytes);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return heap allocated memory that will be freed automatically when the
module callback function returns. Mostly suitable for small allocations
that are short living and must be released when the callback returns
anyway. The returned memory is aligned to the architecture word size
if at least word size bytes are requested, otherwise it is just
aligned to the next power of two, so for example a 3 bytes request is
4 bytes aligned while a 2 bytes request is 2 bytes aligned.</p>
<p>There is no realloc style function since when this is needed to use the
pool allocator is not a good idea.</p>
<p>The function returns NULL if <code>bytes</code> is 0.</p>
<p><span id="section-commands-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Commands%20API"></a><h2 id="commands-api">Commands API</h2>
<p>These functions are used to implement custom Redis commands.</p>
<p>For examples, see <a href="../modules.html">https://redis.io/topics/modules-intro</a>.</p>
<p><span id="RedisModule_IsKeysPositionRequest"></span></p>
<h3 id="redismodule_iskeyspositionrequest"><code>RedisModule_IsKeysPositionRequest</code></h3>
<pre><code>int RedisModule_IsKeysPositionRequest(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return non-zero if a module command, that was declared with the
flag "getkeys-api", is called in a special way to get the keys positions
and not to get executed. Otherwise zero is returned.</p>
<p><span id="RedisModule_KeyAtPosWithFlags"></span></p>
<h3 id="redismodule_keyatposwithflags"><code>RedisModule_KeyAtPosWithFlags</code></h3>
<pre><code>void RedisModule_KeyAtPosWithFlags(RedisModuleCtx *ctx, int pos, int flags);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>When a module command is called in order to obtain the position of
keys, since it was flagged as "getkeys-api" during the registration,
the command implementation checks for this special call using the
<a href="#RedisModule_IsKeysPositionRequest"><code>RedisModule_IsKeysPositionRequest()</code></a> API and uses this function in
order to report keys.</p>
<p>The supported flags are the ones used by <a href="#RedisModule_SetCommandInfo"><code>RedisModule_SetCommandInfo</code></a>, see <code>REDISMODULE_CMD_KEY_</code>*.</p>
<p>The following is an example of how it could be used:</p>
<pre><code>if (RedisModule_IsKeysPositionRequest(ctx)) {
    RedisModule_KeyAtPosWithFlags(ctx, 2, REDISMODULE_CMD_KEY_RO | REDISMODULE_CMD_KEY_ACCESS);
    RedisModule_KeyAtPosWithFlags(ctx, 1, REDISMODULE_CMD_KEY_RW | REDISMODULE_CMD_KEY_UPDATE | REDISMODULE_CMD_KEY_ACCESS);
}
</code></pre>
<p>Note: in the example above the get keys API could have been handled by key-specs (preferred).
Implementing the getkeys-api is required only when is it not possible to declare key-specs that cover all keys.</p>
<p><span id="RedisModule_KeyAtPos"></span></p>
<h3 id="redismodule_keyatpos"><code>RedisModule_KeyAtPos</code></h3>
<pre><code>void RedisModule_KeyAtPos(RedisModuleCtx *ctx, int pos);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>This API existed before <a href="#RedisModule_KeyAtPosWithFlags"><code>RedisModule_KeyAtPosWithFlags</code></a> was added, now deprecated and
can be used for compatibility with older versions, before key-specs and flags
were introduced.</p>
<p><span id="RedisModule_IsChannelsPositionRequest"></span></p>
<h3 id="redismodule_ischannelspositionrequest"><code>RedisModule_IsChannelsPositionRequest</code></h3>
<pre><code>int RedisModule_IsChannelsPositionRequest(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Return non-zero if a module command, that was declared with the
flag "getchannels-api", is called in a special way to get the channel positions
and not to get executed. Otherwise zero is returned.</p>
<p><span id="RedisModule_ChannelAtPosWithFlags"></span></p>
<h3 id="redismodule_channelatposwithflags"><code>RedisModule_ChannelAtPosWithFlags</code></h3>
<pre><code>void RedisModule_ChannelAtPosWithFlags(RedisModuleCtx *ctx,
                                       int pos,
                                       int flags);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>When a module command is called in order to obtain the position of
channels, since it was flagged as "getchannels-api" during the
registration, the command implementation checks for this special call
using the <a href="#RedisModule_IsChannelsPositionRequest"><code>RedisModule_IsChannelsPositionRequest()</code></a> API and uses this
function in order to report the channels.</p>
<p>The supported flags are:</p>
<ul>
<li><code>REDISMODULE_CMD_CHANNEL_SUBSCRIBE</code>: This command will subscribe to the channel.</li>
<li><code>REDISMODULE_CMD_CHANNEL_UNSUBSCRIBE</code>: This command will unsubscribe from this channel.</li>
<li><code>REDISMODULE_CMD_CHANNEL_PUBLISH</code>: This command will publish to this channel.</li>
<li><code>REDISMODULE_CMD_CHANNEL_PATTERN</code>: Instead of acting on a specific channel, will act on any
channel specified by the pattern. This is the same access
used by the PSUBSCRIBE and PUNSUBSCRIBE commands available
in Redis. Not intended to be used with PUBLISH permissions.</li>
</ul>
<p>The following is an example of how it could be used:</p>
<pre><code>if (RedisModule_IsChannelsPositionRequest(ctx)) {
    RedisModule_ChannelAtPosWithFlags(ctx, 1, REDISMODULE_CMD_CHANNEL_SUBSCRIBE | REDISMODULE_CMD_CHANNEL_PATTERN);
    RedisModule_ChannelAtPosWithFlags(ctx, 1, REDISMODULE_CMD_CHANNEL_PUBLISH);
}
</code></pre>
<p>Note: One usage of declaring channels is for evaluating ACL permissions. In this context,
unsubscribing is always allowed, so commands will only be checked against subscribe and
publish permissions. This is preferred over using <a href="#RedisModule_ACLCheckChannelPermissions"><code>RedisModule_ACLCheckChannelPermissions</code></a>, since
it allows the ACLs to be checked before the command is executed.</p>
<p><span id="RedisModule_CreateCommand"></span></p>
<h3 id="redismodule_createcommand"><code>RedisModule_CreateCommand</code></h3>
<pre><code>int RedisModule_CreateCommand(RedisModuleCtx *ctx,
                              const char *name,
                              RedisModuleCmdFunc cmdfunc,
                              const char *strflags,
                              int firstkey,
                              int lastkey,
                              int keystep);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Register a new command in the Redis server, that will be handled by
calling the function pointer 'cmdfunc' using the RedisModule calling
convention.</p>
<p>The function returns <code>REDISMODULE_ERR</code> in these cases:</p>
<ul>
<li>If creation of module command is called outside the <code>RedisModule_OnLoad</code>.</li>
<li>The specified command is already busy.</li>
<li>The command name contains some chars that are not allowed.</li>
<li>A set of invalid flags were passed.</li>
</ul>
<p>Otherwise <code>REDISMODULE_OK</code> is returned and the new command is registered.</p>
<p>This function must be called during the initialization of the module
inside the <code>RedisModule_OnLoad()</code> function. Calling this function outside
of the initialization function is not defined.</p>
<p>The command function type is the following:</p>
<pre><code> int MyCommand_RedisCommand(RedisModuleCtx *ctx, RedisModuleString **argv, int argc);
</code></pre>
<p>And is supposed to always return <code>REDISMODULE_OK</code>.</p>
<p>The set of flags 'strflags' specify the behavior of the command, and should
be passed as a C string composed of space separated words, like for
example "write deny-oom". The set of flags are:</p>
<ul>
<li><strong>"write"</strong>:     The command may modify the data set (it may also read
from it).</li>
<li><strong>"readonly"</strong>:  The command returns data from keys but never writes.</li>
<li><strong>"admin"</strong>:     The command is an administrative command (may change
replication or perform similar tasks).</li>
<li><strong>"deny-oom"</strong>:  The command may use additional memory and should be
denied during out of memory conditions.</li>
<li><strong>"deny-script"</strong>:   Don't allow this command in Lua scripts.</li>
<li><strong>"allow-loading"</strong>: Allow this command while the server is loading data.
Only commands not interacting with the data set
should be allowed to run in this mode. If not sure
don't use this flag.</li>
<li><strong>"pubsub"</strong>:    The command publishes things on Pub/Sub channels.</li>
<li><strong>"random"</strong>:    The command may have different outputs even starting
from the same input arguments and key values.
Starting from Redis 7.0 this flag has been deprecated.
Declaring a command as "random" can be done using
command tips, see <a href="../command-tips.html">https://redis.io/topics/command-tips</a>.</li>
<li><strong>"allow-stale"</strong>: The command is allowed to run on slaves that don't
serve stale data. Don't use if you don't know what
this means.</li>
<li><strong>"no-monitor"</strong>: Don't propagate the command on monitor. Use this if
the command has sensitive data among the arguments.</li>
<li><strong>"no-slowlog"</strong>: Don't log this command in the slowlog. Use this if
the command has sensitive data among the arguments.</li>
<li><strong>"fast"</strong>:      The command time complexity is not greater
than O(log(N)) where N is the size of the collection or
anything else representing the normal scalability
issue with the command.</li>
<li><strong>"getkeys-api"</strong>: The command implements the interface to return
the arguments that are keys. Used when start/stop/step
is not enough because of the command syntax.</li>
<li><strong>"no-cluster"</strong>: The command should not register in Redis Cluster
since is not designed to work with it because, for
example, is unable to report the position of the
keys, programmatically creates key names, or any
other reason.</li>
<li><strong>"no-auth"</strong>:    This command can be run by an un-authenticated client.
Normally this is used by a command that is used
to authenticate a client.</li>
<li><strong>"may-replicate"</strong>: This command may generate replication traffic, even
though it's not a write command.</li>
<li><strong>"no-mandatory-keys"</strong>: All the keys this command may take are optional</li>
<li><strong>"blocking"</strong>: The command has the potential to block the client.</li>
<li><strong>"allow-busy"</strong>: Permit the command while the server is blocked either by
a script or by a slow module command, see
RedisModule_Yield.</li>
<li><strong>"getchannels-api"</strong>: The command implements the interface to return
the arguments that are channels.</li>
</ul>
<p>The last three parameters specify which arguments of the new command are
Redis keys. See <a href="../../../commands/command.html">https://redis.io/commands/command</a> for more information.</p>
<ul>
<li><code>firstkey</code>: One-based index of the first argument that's a key.
Position 0 is always the command name itself.
0 for commands with no keys.</li>
<li><code>lastkey</code>:  One-based index of the last argument that's a key.
Negative numbers refer to counting backwards from the last
argument (-1 means the last argument provided)
0 for commands with no keys.</li>
<li><code>keystep</code>:  Step between first and last key indexes.
0 for commands with no keys.</li>
</ul>
<p>This information is used by ACL, Cluster and the <a href="../../../commands/command.html"><code>COMMAND</code></a> command.</p>
<p>NOTE: The scheme described above serves a limited purpose and can
only be used to find keys that exist at constant indices.
For non-trivial key arguments, you may pass 0,0,0 and use
<a href="#RedisModule_SetCommandInfo"><code>RedisModule_SetCommandInfo</code></a> to set key specs using a more advanced scheme and use
<a href="#RedisModule_SetCommandACLCategories"><code>RedisModule_SetCommandACLCategories</code></a> to set Redis ACL categories of the commands.</p>
<p><span id="RedisModule_GetCommand"></span></p>
<h3 id="redismodule_getcommand"><code>RedisModule_GetCommand</code></h3>
<pre><code>RedisModuleCommand *RedisModule_GetCommand(RedisModuleCtx *ctx,
                                           const char *name);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Get an opaque structure, representing a module command, by command name.
This structure is used in some of the command-related APIs.</p>
<p>NULL is returned in case of the following errors:</p>
<ul>
<li>Command not found</li>
<li>The command is not a module command</li>
<li>The command doesn't belong to the calling module</li>
</ul>
<p><span id="RedisModule_CreateSubcommand"></span></p>
<h3 id="redismodule_createsubcommand"><code>RedisModule_CreateSubcommand</code></h3>
<pre><code>int RedisModule_CreateSubcommand(RedisModuleCommand *parent,
                                 const char *name,
                                 RedisModuleCmdFunc cmdfunc,
                                 const char *strflags,
                                 int firstkey,
                                 int lastkey,
                                 int keystep);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Very similar to <a href="#RedisModule_CreateCommand"><code>RedisModule_CreateCommand</code></a> except that it is used to create
a subcommand, associated with another, container, command.</p>
<p>Example: If a module has a configuration command, MODULE.CONFIG, then
GET and SET should be individual subcommands, while MODULE.CONFIG is
a command, but should not be registered with a valid <code>funcptr</code>:</p>
<pre><code> if (RedisModule_CreateCommand(ctx,"module.config",NULL,"",0,0,0) == REDISMODULE_ERR)
     return REDISMODULE_ERR;

 RedisModuleCommand *parent = RedisModule_GetCommand(ctx,,"module.config");

 if (RedisModule_CreateSubcommand(parent,"set",cmd_config_set,"",0,0,0) == REDISMODULE_ERR)
    return REDISMODULE_ERR;

 if (RedisModule_CreateSubcommand(parent,"get",cmd_config_get,"",0,0,0) == REDISMODULE_ERR)
    return REDISMODULE_ERR;
</code></pre>
<p>Returns <code>REDISMODULE_OK</code> on success and <code>REDISMODULE_ERR</code> in case of the following errors:</p>
<ul>
<li>Error while parsing <code>strflags</code></li>
<li>Command is marked as <code>no-cluster</code> but cluster mode is enabled</li>
<li><code>parent</code> is already a subcommand (we do not allow more than one level of command nesting)</li>
<li><code>parent</code> is a command with an implementation (<code>RedisModuleCmdFunc</code>) (A parent command should be a pure container of subcommands)</li>
<li><code>parent</code> already has a subcommand called <code>name</code></li>
<li>Creating a subcommand is called outside of <code>RedisModule_OnLoad</code>.</li>
</ul>
<p><span id="RedisModule_SetCommandACLCategories"></span></p>
<h3 id="redismodule_setcommandaclcategories"><code>RedisModule_SetCommandACLCategories</code></h3>
<pre><code>int RedisModule_SetCommandACLCategories(RedisModuleCommand *command,
                                        const char *aclflags);
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p><a href="#RedisModule_SetCommandACLCategories"><code>RedisModule_SetCommandACLCategories</code></a> can be used to set ACL categories to module
commands and subcommands. The set of ACL categories should be passed as
a space separated C string 'aclflags'.</p>
<p>Example, the acl flags 'write slow' marks the command as part of the write and
slow ACL categories.</p>
<p>On success <code>REDISMODULE_OK</code> is returned. On error <code>REDISMODULE_ERR</code> is returned.</p>
<p>This function can only be called during the <code>RedisModule_OnLoad</code> function. If called
outside of this function, an error is returned.</p>
<p><span id="RedisModule_SetCommandInfo"></span></p>
<h3 id="redismodule_setcommandinfo"><code>RedisModule_SetCommandInfo</code></h3>
<pre><code>int RedisModule_SetCommandInfo(RedisModuleCommand *command,
                               const RedisModuleCommandInfo *info);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Set additional command information.</p>
<p>Affects the output of <a href="../../../commands/command.html"><code>COMMAND</code></a>, <a href="../../../commands/command-info.html"><code>COMMAND INFO</code></a> and <a href="../../../commands/command-docs.html"><code>COMMAND DOCS</code></a>, Cluster,
ACL and is used to filter commands with the wrong number of arguments before
the call reaches the module code.</p>
<p>This function can be called after creating a command using <a href="#RedisModule_CreateCommand"><code>RedisModule_CreateCommand</code></a>
and fetching the command pointer using <a href="#RedisModule_GetCommand"><code>RedisModule_GetCommand</code></a>. The information can
only be set once for each command and has the following structure:</p>
<pre><code>typedef struct RedisModuleCommandInfo {
    const RedisModuleCommandInfoVersion *version;
    const char *summary;
    const char *complexity;
    const char *since;
    RedisModuleCommandHistoryEntry *history;
    const char *tips;
    int arity;
    RedisModuleCommandKeySpec *key_specs;
    RedisModuleCommandArg *args;
} RedisModuleCommandInfo;
</code></pre>
<p>All fields except <code>version</code> are optional. Explanation of the fields:</p>
<ul>
<li>
<p><code>version</code>: This field enables compatibility with different Redis versions.
Always set this field to <code>REDISMODULE_COMMAND_INFO_VERSION</code>.</p>
</li>
<li>
<p><code>summary</code>: A short description of the command (optional).</p>
</li>
<li>
<p><code>complexity</code>: Complexity description (optional).</p>
</li>
<li>
<p><code>since</code>: The version where the command was introduced (optional).
Note: The version specified should be the module's, not Redis version.</p>
</li>
<li>
<p><code>history</code>: An array of <code>RedisModuleCommandHistoryEntry</code> (optional), which is
a struct with the following fields:</p>
<pre><code>  const char *since;
  const char *changes;
</code></pre>
<p><code>since</code> is a version string and <code>changes</code> is a string describing the
changes. The array is terminated by a zeroed entry, i.e. an entry with
both strings set to NULL.</p>
</li>
<li>
<p><code>tips</code>: A string of space-separated tips regarding this command, meant for
clients and proxies. See <a href="../command-tips.html">https://redis.io/topics/command-tips</a>.</p>
</li>
<li>
<p><code>arity</code>: Number of arguments, including the command name itself. A positive
number specifies an exact number of arguments and a negative number
specifies a minimum number of arguments, so use -N to say &gt;= N. Redis
validates a call before passing it to a module, so this can replace an
arity check inside the module command implementation. A value of 0 (or an
omitted arity field) is equivalent to -2 if the command has sub commands
and -1 otherwise.</p>
</li>
<li>
<p><code>key_specs</code>: An array of <code>RedisModuleCommandKeySpec</code>, terminated by an
element memset to zero. This is a scheme that tries to describe the
positions of key arguments better than the old <a href="#RedisModule_CreateCommand"><code>RedisModule_CreateCommand</code></a> arguments
<code>firstkey</code>, <code>lastkey</code>, <code>keystep</code> and is needed if those three are not
enough to describe the key positions. There are two steps to retrieve key
positions: <em>begin search</em> (BS) in which index should find the first key and
<em>find keys</em> (FK) which, relative to the output of BS, describes how can we
will which arguments are keys. Additionally, there are key specific flags.</p>
<p>Key-specs cause the triplet (firstkey, lastkey, keystep) given in
RedisModule_CreateCommand to be recomputed, but it is still useful to provide
these three parameters in RedisModule_CreateCommand, to better support old Redis
versions where RedisModule_SetCommandInfo is not available.</p>
<p>Note that key-specs don't fully replace the "getkeys-api" (see
RedisModule_CreateCommand, RedisModule_IsKeysPositionRequest and RedisModule_KeyAtPosWithFlags) so
it may be a good idea to supply both key-specs and implement the
getkeys-api.</p>
<p>A key-spec has the following structure:</p>
<pre><code>  typedef struct RedisModuleCommandKeySpec {
      const char *notes;
      uint64_t flags;
      RedisModuleKeySpecBeginSearchType begin_search_type;
      union {
          struct {
              int pos;
          } index;
          struct {
              const char *keyword;
              int startfrom;
          } keyword;
      } bs;
      RedisModuleKeySpecFindKeysType find_keys_type;
      union {
          struct {
              int lastkey;
              int keystep;
              int limit;
          } range;
          struct {
              int keynumidx;
              int firstkey;
              int keystep;
          } keynum;
      } fk;
  } RedisModuleCommandKeySpec;
</code></pre>
<p>Explanation of the fields of RedisModuleCommandKeySpec:</p>
<ul>
<li>
<p><code>notes</code>: Optional notes or clarifications about this key spec.</p>
</li>
<li>
<p><code>flags</code>: A bitwise or of key-spec flags described below.</p>
</li>
<li>
<p><code>begin_search_type</code>: This describes how the first key is discovered.
There are two ways to determine the first key:</p>
<ul>
<li><code>REDISMODULE_KSPEC_BS_UNKNOWN</code>: There is no way to tell where the
key args start.</li>
<li><code>REDISMODULE_KSPEC_BS_INDEX</code>: Key args start at a constant index.</li>
<li><code>REDISMODULE_KSPEC_BS_KEYWORD</code>: Key args start just after a
specific keyword.</li>
</ul>
</li>
<li>
<p><code>bs</code>: This is a union in which the <code>index</code> or <code>keyword</code> branch is used
depending on the value of the <code>begin_search_type</code> field.</p>
<ul>
<li>
<p><code>bs.index.pos</code>: The index from which we start the search for keys.
(<code>REDISMODULE_KSPEC_BS_INDEX</code> only.)</p>
</li>
<li>
<p><code>bs.keyword.keyword</code>: The keyword (string) that indicates the
beginning of key arguments. (<code>REDISMODULE_KSPEC_BS_KEYWORD</code> only.)</p>
</li>
<li>
<p><code>bs.keyword.startfrom</code>: An index in argv from which to start
searching. Can be negative, which means start search from the end,
in reverse. Example: -2 means to start in reverse from the
penultimate argument. (<code>REDISMODULE_KSPEC_BS_KEYWORD</code> only.)</p>
</li>
</ul>
</li>
<li>
<p><code>find_keys_type</code>: After the "begin search", this describes which
arguments are keys. The strategies are:</p>
<ul>
<li><code>REDISMODULE_KSPEC_BS_UNKNOWN</code>: There is no way to tell where the
key args are located.</li>
<li><code>REDISMODULE_KSPEC_FK_RANGE</code>: Keys end at a specific index (or
relative to the last argument).</li>
<li><code>REDISMODULE_KSPEC_FK_KEYNUM</code>: There's an argument that contains
the number of key args somewhere before the keys themselves.</li>
</ul>
<p><code>find_keys_type</code> and <code>fk</code> can be omitted if this keyspec describes
exactly one key.</p>
</li>
<li>
<p><code>fk</code>: This is a union in which the <code>range</code> or <code>keynum</code> branch is used
depending on the value of the <code>find_keys_type</code> field.</p>
<ul>
<li>
<p><code>fk.range</code> (for <code>REDISMODULE_KSPEC_FK_RANGE</code>): A struct with the
following fields:</p>
<ul>
<li>
<p><code>lastkey</code>: Index of the last key relative to the result of the
begin search step. Can be negative, in which case it's not
relative. -1 indicates the last argument, -2 one before the
last and so on.</p>
</li>
<li>
<p><code>keystep</code>: How many arguments should we skip after finding a
key, in order to find the next one?</p>
</li>
<li>
<p><code>limit</code>: If <code>lastkey</code> is -1, we use <code>limit</code> to stop the search
by a factor. 0 and 1 mean no limit. 2 means 1/2 of the
remaining args, 3 means 1/3, and so on.</p>
</li>
</ul>
</li>
<li>
<p><code>fk.keynum</code> (for <code>REDISMODULE_KSPEC_FK_KEYNUM</code>): A struct with the
following fields:</p>
<ul>
<li>
<p><code>keynumidx</code>: Index of the argument containing the number of
keys to come, relative to the result of the begin search step.</p>
</li>
<li>
<p><code>firstkey</code>: Index of the fist key relative to the result of the
begin search step. (Usually it's just after <code>keynumidx</code>, in
which case it should be set to <code>keynumidx + 1</code>.)</p>
</li>
<li>
<p><code>keystep</code>: How many arguments should we skip after finding a
key, in order to find the next one?</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Key-spec flags:</p>
<p>The first four refer to what the command actually does with the <em>value or
metadata of the key</em>, and not necessarily the user data or how it affects
it. Each key-spec may must have exactly one of these. Any operation
that's not distinctly deletion, overwrite or read-only would be marked as
RW.</p>
<ul>
<li>
<p><code>REDISMODULE_CMD_KEY_RO</code>: Read-Only. Reads the value of the key, but
doesn't necessarily return it.</p>
</li>
<li>
<p><code>REDISMODULE_CMD_KEY_RW</code>: Read-Write. Modifies the data stored in the
value of the key or its metadata.</p>
</li>
<li>
<p><code>REDISMODULE_CMD_KEY_OW</code>: Overwrite. Overwrites the data stored in the
value of the key.</p>
</li>
<li>
<p><code>REDISMODULE_CMD_KEY_RM</code>: Deletes the key.</p>
</li>
</ul>
<p>The next four refer to <em>user data inside the value of the key</em>, not the
metadata like LRU, type, cardinality. It refers to the logical operation
on the user's data (actual input strings or TTL), being
used/returned/copied/changed. It doesn't refer to modification or
returning of metadata (like type, count, presence of data). ACCESS can be
combined with one of the write operations INSERT, DELETE or UPDATE. Any
write that's not an INSERT or a DELETE would be UPDATE.</p>
<ul>
<li>
<p><code>REDISMODULE_CMD_KEY_ACCESS</code>: Returns, copies or uses the user data
from the value of the key.</p>
</li>
<li>
<p><code>REDISMODULE_CMD_KEY_UPDATE</code>: Updates data to the value, new value may
depend on the old value.</p>
</li>
<li>
<p><code>REDISMODULE_CMD_KEY_INSERT</code>: Adds data to the value with no chance of
modification or deletion of existing data.</p>
</li>
<li>
<p><code>REDISMODULE_CMD_KEY_DELETE</code>: Explicitly deletes some content from the
value of the key.</p>
</li>
</ul>
<p>Other flags:</p>
<ul>
<li>
<p><code>REDISMODULE_CMD_KEY_NOT_KEY</code>: The key is not actually a key, but
should be routed in cluster mode as if it was a key.</p>
</li>
<li>
<p><code>REDISMODULE_CMD_KEY_INCOMPLETE</code>: The keyspec might not point out all
the keys it should cover.</p>
</li>
<li>
<p><code>REDISMODULE_CMD_KEY_VARIABLE_FLAGS</code>: Some keys might have different
flags depending on arguments.</p>
</li>
</ul>
</li>
<li>
<p><code>args</code>: An array of <code>RedisModuleCommandArg</code>, terminated by an element memset
to zero. <code>RedisModuleCommandArg</code> is a structure with at the fields described
below.</p>
<pre><code>  typedef struct RedisModuleCommandArg {
      const char *name;
      RedisModuleCommandArgType type;
      int key_spec_index;
      const char *token;
      const char *summary;
      const char *since;
      int flags;
      struct RedisModuleCommandArg *subargs;
  } RedisModuleCommandArg;
</code></pre>
<p>Explanation of the fields:</p>
<ul>
<li>
<p><code>name</code>: Name of the argument.</p>
</li>
<li>
<p><code>type</code>: The type of the argument. See below for details. The types
<code>REDISMODULE_ARG_TYPE_ONEOF</code> and <code>REDISMODULE_ARG_TYPE_BLOCK</code> require
an argument to have sub-arguments, i.e. <code>subargs</code>.</p>
</li>
<li>
<p><code>key_spec_index</code>: If the <code>type</code> is <code>REDISMODULE_ARG_TYPE_KEY</code> you must
provide the index of the key-spec associated with this argument. See
<code>key_specs</code> above. If the argument is not a key, you may specify -1.</p>
</li>
<li>
<p><code>token</code>: The token preceding the argument (optional). Example: the
argument <code>seconds</code> in <a href="../../../commands/set.html"><code>SET</code></a> has a token <code>EX</code>. If the argument consists
of only a token (for example <code>NX</code> in <a href="../../../commands/set.html"><code>SET</code></a>) the type should be
<code>REDISMODULE_ARG_TYPE_PURE_TOKEN</code> and <code>value</code> should be NULL.</p>
</li>
<li>
<p><code>summary</code>: A short description of the argument (optional).</p>
</li>
<li>
<p><code>since</code>: The first version which included this argument (optional).</p>
</li>
<li>
<p><code>flags</code>: A bitwise or of the macros <code>REDISMODULE_CMD_ARG_*</code>. See below.</p>
</li>
<li>
<p><code>value</code>: The display-value of the argument. This string is what should
be displayed when creating the command syntax from the output of
<a href="../../../commands/command.html"><code>COMMAND</code></a>. If <code>token</code> is not NULL, it should also be displayed.</p>
</li>
</ul>
<p>Explanation of <code>RedisModuleCommandArgType</code>:</p>
<ul>
<li><code>REDISMODULE_ARG_TYPE_STRING</code>: String argument.</li>
<li><code>REDISMODULE_ARG_TYPE_INTEGER</code>: Integer argument.</li>
<li><code>REDISMODULE_ARG_TYPE_DOUBLE</code>: Double-precision float argument.</li>
<li><code>REDISMODULE_ARG_TYPE_KEY</code>: String argument representing a keyname.</li>
<li><code>REDISMODULE_ARG_TYPE_PATTERN</code>: String, but regex pattern.</li>
<li><code>REDISMODULE_ARG_TYPE_UNIX_TIME</code>: Integer, but Unix timestamp.</li>
<li><code>REDISMODULE_ARG_TYPE_PURE_TOKEN</code>: Argument doesn't have a placeholder.
It's just a token without a value. Example: the <code>KEEPTTL</code> option of the
<a href="../../../commands/set.html"><code>SET</code></a> command.</li>
<li><code>REDISMODULE_ARG_TYPE_ONEOF</code>: Used when the user can choose only one of
a few sub-arguments. Requires <code>subargs</code>. Example: the <code>NX</code> and <code>XX</code>
options of <a href="../../../commands/set.html"><code>SET</code></a>.</li>
<li><code>REDISMODULE_ARG_TYPE_BLOCK</code>: Used when one wants to group together
several sub-arguments, usually to apply something on all of them, like
making the entire group "optional". Requires <code>subargs</code>. Example: the
<code>LIMIT offset count</code> parameters in <a href="../../../commands/zrange.html"><code>ZRANGE</code></a>.</li>
</ul>
<p>Explanation of the command argument flags:</p>
<ul>
<li><code>REDISMODULE_CMD_ARG_OPTIONAL</code>: The argument is optional (like GET in
the SET command).</li>
<li><code>REDISMODULE_CMD_ARG_MULTIPLE</code>: The argument may repeat itself (like
key in DEL).</li>
<li><code>REDISMODULE_CMD_ARG_MULTIPLE_TOKEN</code>: The argument may repeat itself,
and so does its token (like <code>GET pattern</code> in SORT).</li>
</ul>
</li>
</ul>
<p>On success <code>REDISMODULE_OK</code> is returned. On error <code>REDISMODULE_ERR</code> is returned
and <code>errno</code> is set to EINVAL if invalid info was provided or EEXIST if info
has already been set. If the info is invalid, a warning is logged explaining
which part of the info is invalid and why.</p>
<p><span id="section-module-information-and-time-measurement"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Module%20information%20and%20time%20measurement"></a><h2 id="module-information-and-time-measurement">Module information and time measurement</h2>
<p><span id="RedisModule_IsModuleNameBusy"></span></p>
<h3 id="redismodule_ismodulenamebusy"><code>RedisModule_IsModuleNameBusy</code></h3>
<pre><code>int RedisModule_IsModuleNameBusy(const char *name);
</code></pre>
<p><strong>Available since:</strong> 4.0.3</p>
<p>Return non-zero if the module name is busy.
Otherwise zero is returned.</p>
<p><span id="RedisModule_Milliseconds"></span></p>
<h3 id="redismodule_milliseconds"><code>RedisModule_Milliseconds</code></h3>
<pre><code>mstime_t RedisModule_Milliseconds(void);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the current UNIX time in milliseconds.</p>
<p><span id="RedisModule_MonotonicMicroseconds"></span></p>
<h3 id="redismodule_monotonicmicroseconds"><code>RedisModule_MonotonicMicroseconds</code></h3>
<pre><code>uint64_t RedisModule_MonotonicMicroseconds(void);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Return counter of micro-seconds relative to an arbitrary point in time.</p>
<p><span id="RedisModule_Microseconds"></span></p>
<h3 id="redismodule_microseconds"><code>RedisModule_Microseconds</code></h3>
<pre><code>ustime_t RedisModule_Microseconds();
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>Return the current UNIX time in microseconds</p>
<p><span id="RedisModule_CachedMicroseconds"></span></p>
<h3 id="redismodule_cachedmicroseconds"><code>RedisModule_CachedMicroseconds</code></h3>
<pre><code>ustime_t RedisModule_CachedMicroseconds();
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>Return the cached UNIX time in microseconds.
It is updated in the server cron job and before executing a command.
It is useful for complex call stacks, such as a command causing a
key space notification, causing a module to execute a <a href="#RedisModule_Call"><code>RedisModule_Call</code></a>,
causing another notification, etc.
It makes sense that all this callbacks would use the same clock.</p>
<p><span id="RedisModule_BlockedClientMeasureTimeStart"></span></p>
<h3 id="redismodule_blockedclientmeasuretimestart"><code>RedisModule_BlockedClientMeasureTimeStart</code></h3>
<pre><code>int RedisModule_BlockedClientMeasureTimeStart(RedisModuleBlockedClient *bc);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Mark a point in time that will be used as the start time to calculate
the elapsed execution time when <a href="#RedisModule_BlockedClientMeasureTimeEnd"><code>RedisModule_BlockedClientMeasureTimeEnd()</code></a> is called.
Within the same command, you can call multiple times
<a href="#RedisModule_BlockedClientMeasureTimeStart"><code>RedisModule_BlockedClientMeasureTimeStart()</code></a> and <a href="#RedisModule_BlockedClientMeasureTimeEnd"><code>RedisModule_BlockedClientMeasureTimeEnd()</code></a>
to accumulate independent time intervals to the background duration.
This method always return <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_BlockedClientMeasureTimeEnd"></span></p>
<h3 id="redismodule_blockedclientmeasuretimeend"><code>RedisModule_BlockedClientMeasureTimeEnd</code></h3>
<pre><code>int RedisModule_BlockedClientMeasureTimeEnd(RedisModuleBlockedClient *bc);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Mark a point in time that will be used as the end time
to calculate the elapsed execution time.
On success <code>REDISMODULE_OK</code> is returned.
This method only returns <code>REDISMODULE_ERR</code> if no start time was
previously defined ( meaning <a href="#RedisModule_BlockedClientMeasureTimeStart"><code>RedisModule_BlockedClientMeasureTimeStart</code></a> was not called ).</p>
<p><span id="RedisModule_Yield"></span></p>
<h3 id="redismodule_yield"><code>RedisModule_Yield</code></h3>
<pre><code>void RedisModule_Yield(RedisModuleCtx *ctx, int flags, const char *busy_reply);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>This API allows modules to let Redis process background tasks, and some
commands during long blocking execution of a module command.
The module can call this API periodically.
The flags is a bit mask of these:</p>
<ul>
<li><code>REDISMODULE_YIELD_FLAG_NONE</code>: No special flags, can perform some background
operations, but not process client commands.</li>
<li><code>REDISMODULE_YIELD_FLAG_CLIENTS</code>: Redis can also process client commands.</li>
</ul>
<p>The <code>busy_reply</code> argument is optional, and can be used to control the verbose
error string after the <code>-BUSY</code> error code.</p>
<p>When the <code>REDISMODULE_YIELD_FLAG_CLIENTS</code> is used, Redis will only start
processing client commands after the time defined by the
<code>busy-reply-threshold</code> config, in which case Redis will start rejecting most
commands with <code>-BUSY</code> error, but allow the ones marked with the <code>allow-busy</code>
flag to be executed.
This API can also be used in thread safe context (while locked), and during
loading (in the <code>rdb_load</code> callback, in which case it'll reject commands with
the -LOADING error)</p>
<p><span id="RedisModule_SetModuleOptions"></span></p>
<h3 id="redismodule_setmoduleoptions"><code>RedisModule_SetModuleOptions</code></h3>
<pre><code>void RedisModule_SetModuleOptions(RedisModuleCtx *ctx, int options);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Set flags defining capabilities or behavior bit flags.</p>
<p><code>REDISMODULE_OPTIONS_HANDLE_IO_ERRORS</code>:
Generally, modules don't need to bother with this, as the process will just
terminate if a read error happens, however, setting this flag would allow
repl-diskless-load to work if enabled.
The module should use <a href="#RedisModule_IsIOError"><code>RedisModule_IsIOError</code></a> after reads, before using the
data that was read, and in case of error, propagate it upwards, and also be
able to release the partially populated value and all it's allocations.</p>
<p><code>REDISMODULE_OPTION_NO_IMPLICIT_SIGNAL_MODIFIED</code>:
See <a href="#RedisModule_SignalModifiedKey"><code>RedisModule_SignalModifiedKey()</code></a>.</p>
<p><code>REDISMODULE_OPTIONS_HANDLE_REPL_ASYNC_LOAD</code>:
Setting this flag indicates module awareness of diskless async replication (repl-diskless-load=swapdb)
and that redis could be serving reads during replication instead of blocking with LOADING status.</p>
<p><code>REDISMODULE_OPTIONS_ALLOW_NESTED_KEYSPACE_NOTIFICATIONS</code>:
Declare that the module wants to get nested key-space notifications.
By default, Redis will not fire key-space notifications that happened inside
a key-space notification callback. This flag allows to change this behavior
and fire nested key-space notifications. Notice: if enabled, the module
should protected itself from infinite recursion.</p>
<p><span id="RedisModule_SignalModifiedKey"></span></p>
<h3 id="redismodule_signalmodifiedkey"><code>RedisModule_SignalModifiedKey</code></h3>
<pre><code>int RedisModule_SignalModifiedKey(RedisModuleCtx *ctx,
                                  RedisModuleString *keyname);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Signals that the key is modified from user's perspective (i.e. invalidate WATCH
and client side caching).</p>
<p>This is done automatically when a key opened for writing is closed, unless
the option <code>REDISMODULE_OPTION_NO_IMPLICIT_SIGNAL_MODIFIED</code> has been set using
<a href="#RedisModule_SetModuleOptions"><code>RedisModule_SetModuleOptions()</code></a>.</p>
<p><span id="section-automatic-memory-management-for-modules"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Automatic%20memory%20management%20for%20modules"></a><h2 id="automatic-memory-management-for-modules">Automatic memory management for modules</h2>
<p><span id="RedisModule_AutoMemory"></span></p>
<h3 id="redismodule_automemory"><code>RedisModule_AutoMemory</code></h3>
<pre><code>void RedisModule_AutoMemory(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Enable automatic memory management.</p>
<p>The function must be called as the first function of a command implementation
that wants to use automatic memory.</p>
<p>When enabled, automatic memory management tracks and automatically frees
keys, call replies and Redis string objects once the command returns. In most
cases this eliminates the need of calling the following functions:</p>
<ol>
<li><a href="#RedisModule_CloseKey"><code>RedisModule_CloseKey()</code></a></li>
<li><a href="#RedisModule_FreeCallReply"><code>RedisModule_FreeCallReply()</code></a></li>
<li><a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a></li>
</ol>
<p>These functions can still be used with automatic memory management enabled,
to optimize loops that make numerous allocations for example.</p>
<p><span id="section-string-objects-apis"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/String%20objects%20APIs"></a><h2 id="string-objects-apis">String objects APIs</h2>
<p><span id="RedisModule_CreateString"></span></p>
<h3 id="redismodule_createstring"><code>RedisModule_CreateString</code></h3>
<pre><code>RedisModuleString *RedisModule_CreateString(RedisModuleCtx *ctx,
                                            const char *ptr,
                                            size_t len);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Create a new module string object. The returned string must be freed
with <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a>, unless automatic memory is enabled.</p>
<p>The string is created by copying the <code>len</code> bytes starting
at <code>ptr</code>. No reference is retained to the passed buffer.</p>
<p>The module context 'ctx' is optional and may be NULL if you want to create
a string out of the context scope. However in that case, the automatic
memory management will not be available, and the string memory must be
managed manually.</p>
<p><span id="RedisModule_CreateStringPrintf"></span></p>
<h3 id="redismodule_createstringprintf"><code>RedisModule_CreateStringPrintf</code></h3>
<pre><code>RedisModuleString *RedisModule_CreateStringPrintf(RedisModuleCtx *ctx,
                                                  const char *fmt,
                                                  ...);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Create a new module string object from a printf format and arguments.
The returned string must be freed with <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a>, unless
automatic memory is enabled.</p>
<p>The string is created using the sds formatter function <code>sdscatvprintf()</code>.</p>
<p>The passed context 'ctx' may be NULL if necessary, see the
<a href="#RedisModule_CreateString"><code>RedisModule_CreateString()</code></a> documentation for more info.</p>
<p><span id="RedisModule_CreateStringFromLongLong"></span></p>
<h3 id="redismodule_createstringfromlonglong"><code>RedisModule_CreateStringFromLongLong</code></h3>
<pre><code>RedisModuleString *RedisModule_CreateStringFromLongLong(RedisModuleCtx *ctx,
                                                        long long ll);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Like <a href="#RedisModule_CreateString"><code>RedisModule_CreateString()</code></a>, but creates a string starting from a <code>long long</code>
integer instead of taking a buffer and its length.</p>
<p>The returned string must be released with <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a> or by
enabling automatic memory management.</p>
<p>The passed context 'ctx' may be NULL if necessary, see the
<a href="#RedisModule_CreateString"><code>RedisModule_CreateString()</code></a> documentation for more info.</p>
<p><span id="RedisModule_CreateStringFromULongLong"></span></p>
<h3 id="redismodule_createstringfromulonglong"><code>RedisModule_CreateStringFromULongLong</code></h3>
<pre><code>RedisModuleString *RedisModule_CreateStringFromULongLong(RedisModuleCtx *ctx,
                                                         unsigned long long ull);
</code></pre>
<p><strong>Available since:</strong> 7.0.3</p>
<p>Like <a href="#RedisModule_CreateString"><code>RedisModule_CreateString()</code></a>, but creates a string starting from a <code>unsigned long long</code>
integer instead of taking a buffer and its length.</p>
<p>The returned string must be released with <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a> or by
enabling automatic memory management.</p>
<p>The passed context 'ctx' may be NULL if necessary, see the
<a href="#RedisModule_CreateString"><code>RedisModule_CreateString()</code></a> documentation for more info.</p>
<p><span id="RedisModule_CreateStringFromDouble"></span></p>
<h3 id="redismodule_createstringfromdouble"><code>RedisModule_CreateStringFromDouble</code></h3>
<pre><code>RedisModuleString *RedisModule_CreateStringFromDouble(RedisModuleCtx *ctx,
                                                      double d);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Like <a href="#RedisModule_CreateString"><code>RedisModule_CreateString()</code></a>, but creates a string starting from a double
instead of taking a buffer and its length.</p>
<p>The returned string must be released with <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a> or by
enabling automatic memory management.</p>
<p><span id="RedisModule_CreateStringFromLongDouble"></span></p>
<h3 id="redismodule_createstringfromlongdouble"><code>RedisModule_CreateStringFromLongDouble</code></h3>
<pre><code>RedisModuleString *RedisModule_CreateStringFromLongDouble(RedisModuleCtx *ctx,
                                                          long double ld,
                                                          int humanfriendly);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Like <a href="#RedisModule_CreateString"><code>RedisModule_CreateString()</code></a>, but creates a string starting from a long
double.</p>
<p>The returned string must be released with <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a> or by
enabling automatic memory management.</p>
<p>The passed context 'ctx' may be NULL if necessary, see the
<a href="#RedisModule_CreateString"><code>RedisModule_CreateString()</code></a> documentation for more info.</p>
<p><span id="RedisModule_CreateStringFromString"></span></p>
<h3 id="redismodule_createstringfromstring"><code>RedisModule_CreateStringFromString</code></h3>
<pre><code>RedisModuleString *RedisModule_CreateStringFromString(RedisModuleCtx *ctx,
                                                      const RedisModuleString *str);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Like <a href="#RedisModule_CreateString"><code>RedisModule_CreateString()</code></a>, but creates a string starting from another
<code>RedisModuleString</code>.</p>
<p>The returned string must be released with <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a> or by
enabling automatic memory management.</p>
<p>The passed context 'ctx' may be NULL if necessary, see the
<a href="#RedisModule_CreateString"><code>RedisModule_CreateString()</code></a> documentation for more info.</p>
<p><span id="RedisModule_CreateStringFromStreamID"></span></p>
<h3 id="redismodule_createstringfromstreamid"><code>RedisModule_CreateStringFromStreamID</code></h3>
<pre><code>RedisModuleString *RedisModule_CreateStringFromStreamID(RedisModuleCtx *ctx,
                                                        const RedisModuleStreamID *id);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Creates a string from a stream ID. The returned string must be released with
<a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a>, unless automatic memory is enabled.</p>
<p>The passed context <code>ctx</code> may be NULL if necessary. See the
<a href="#RedisModule_CreateString"><code>RedisModule_CreateString()</code></a> documentation for more info.</p>
<p><span id="RedisModule_FreeString"></span></p>
<h3 id="redismodule_freestring"><code>RedisModule_FreeString</code></h3>
<pre><code>void RedisModule_FreeString(RedisModuleCtx *ctx, RedisModuleString *str);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Free a module string object obtained with one of the Redis modules API calls
that return new string objects.</p>
<p>It is possible to call this function even when automatic memory management
is enabled. In that case the string will be released ASAP and removed
from the pool of string to release at the end.</p>
<p>If the string was created with a NULL context 'ctx', it is also possible to
pass ctx as NULL when releasing the string (but passing a context will not
create any issue). Strings created with a context should be freed also passing
the context, so if you want to free a string out of context later, make sure
to create it using a NULL context.</p>
<p><span id="RedisModule_RetainString"></span></p>
<h3 id="redismodule_retainstring"><code>RedisModule_RetainString</code></h3>
<pre><code>void RedisModule_RetainString(RedisModuleCtx *ctx, RedisModuleString *str);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Every call to this function, will make the string 'str' requiring
an additional call to <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a> in order to really
free the string. Note that the automatic freeing of the string obtained
enabling modules automatic memory management counts for one
<a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a> call (it is just executed automatically).</p>
<p>Normally you want to call this function when, at the same time
the following conditions are true:</p>
<ol>
<li>You have automatic memory management enabled.</li>
<li>You want to create string objects.</li>
<li>Those string objects you create need to live <em>after</em> the callback
function(for example a command implementation) creating them returns.</li>
</ol>
<p>Usually you want this in order to store the created string object
into your own data structure, for example when implementing a new data
type.</p>
<p>Note that when memory management is turned off, you don't need
any call to RetainString() since creating a string will always result
into a string that lives after the callback function returns, if
no FreeString() call is performed.</p>
<p>It is possible to call this function with a NULL context.</p>
<p>When strings are going to be retained for an extended duration, it is good
practice to also call <a href="#RedisModule_TrimStringAllocation"><code>RedisModule_TrimStringAllocation()</code></a> in order to
optimize memory usage.</p>
<p>Threaded modules that reference retained strings from other threads <em>must</em>
explicitly trim the allocation as soon as the string is retained. Not doing
so may result with automatic trimming which is not thread safe.</p>
<p><span id="RedisModule_HoldString"></span></p>
<h3 id="redismodule_holdstring"><code>RedisModule_HoldString</code></h3>
<pre><code>RedisModuleString* RedisModule_HoldString(RedisModuleCtx *ctx,
                                          RedisModuleString *str);
</code></pre>
<p><strong>Available since:</strong> 6.0.7</p>
<p>This function can be used instead of <a href="#RedisModule_RetainString"><code>RedisModule_RetainString()</code></a>.
The main difference between the two is that this function will always
succeed, whereas <a href="#RedisModule_RetainString"><code>RedisModule_RetainString()</code></a> may fail because of an
assertion.</p>
<p>The function returns a pointer to <code>RedisModuleString</code>, which is owned
by the caller. It requires a call to <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a> to free
the string when automatic memory management is disabled for the context.
When automatic memory management is enabled, you can either call
<a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a> or let the automation free it.</p>
<p>This function is more efficient than <a href="#RedisModule_CreateStringFromString"><code>RedisModule_CreateStringFromString()</code></a>
because whenever possible, it avoids copying the underlying
<code>RedisModuleString</code>. The disadvantage of using this function is that it
might not be possible to use <a href="#RedisModule_StringAppendBuffer"><code>RedisModule_StringAppendBuffer()</code></a> on the
returned <code>RedisModuleString</code>.</p>
<p>It is possible to call this function with a NULL context.</p>
<p>When strings are going to be held for an extended duration, it is good
practice to also call <a href="#RedisModule_TrimStringAllocation"><code>RedisModule_TrimStringAllocation()</code></a> in order to
optimize memory usage.</p>
<p>Threaded modules that reference held strings from other threads <em>must</em>
explicitly trim the allocation as soon as the string is held. Not doing
so may result with automatic trimming which is not thread safe.</p>
<p><span id="RedisModule_StringPtrLen"></span></p>
<h3 id="redismodule_stringptrlen"><code>RedisModule_StringPtrLen</code></h3>
<pre><code>const char *RedisModule_StringPtrLen(const RedisModuleString *str,
                                     size_t *len);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Given a string module object, this function returns the string pointer
and length of the string. The returned pointer and length should only
be used for read only accesses and never modified.</p>
<p><span id="RedisModule_StringToLongLong"></span></p>
<h3 id="redismodule_stringtolonglong"><code>RedisModule_StringToLongLong</code></h3>
<pre><code>int RedisModule_StringToLongLong(const RedisModuleString *str, long long *ll);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Convert the string into a <code>long long</code> integer, storing it at <code>*ll</code>.
Returns <code>REDISMODULE_OK</code> on success. If the string can't be parsed
as a valid, strict <code>long long</code> (no spaces before/after), <code>REDISMODULE_ERR</code>
is returned.</p>
<p><span id="RedisModule_StringToULongLong"></span></p>
<h3 id="redismodule_stringtoulonglong"><code>RedisModule_StringToULongLong</code></h3>
<pre><code>int RedisModule_StringToULongLong(const RedisModuleString *str,
                                  unsigned long long *ull);
</code></pre>
<p><strong>Available since:</strong> 7.0.3</p>
<p>Convert the string into a <code>unsigned long long</code> integer, storing it at <code>*ull</code>.
Returns <code>REDISMODULE_OK</code> on success. If the string can't be parsed
as a valid, strict <code>unsigned long long</code> (no spaces before/after), <code>REDISMODULE_ERR</code>
is returned.</p>
<p><span id="RedisModule_StringToDouble"></span></p>
<h3 id="redismodule_stringtodouble"><code>RedisModule_StringToDouble</code></h3>
<pre><code>int RedisModule_StringToDouble(const RedisModuleString *str, double *d);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Convert the string into a double, storing it at <code>*d</code>.
Returns <code>REDISMODULE_OK</code> on success or <code>REDISMODULE_ERR</code> if the string is
not a valid string representation of a double value.</p>
<p><span id="RedisModule_StringToLongDouble"></span></p>
<h3 id="redismodule_stringtolongdouble"><code>RedisModule_StringToLongDouble</code></h3>
<pre><code>int RedisModule_StringToLongDouble(const RedisModuleString *str,
                                   long double *ld);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Convert the string into a long double, storing it at <code>*ld</code>.
Returns <code>REDISMODULE_OK</code> on success or <code>REDISMODULE_ERR</code> if the string is
not a valid string representation of a double value.</p>
<p><span id="RedisModule_StringToStreamID"></span></p>
<h3 id="redismodule_stringtostreamid"><code>RedisModule_StringToStreamID</code></h3>
<pre><code>int RedisModule_StringToStreamID(const RedisModuleString *str,
                                 RedisModuleStreamID *id);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Convert the string into a stream ID, storing it at <code>*id</code>.
Returns <code>REDISMODULE_OK</code> on success and returns <code>REDISMODULE_ERR</code> if the string
is not a valid string representation of a stream ID. The special IDs "+" and
"-" are allowed.</p>
<p><span id="RedisModule_StringCompare"></span></p>
<h3 id="redismodule_stringcompare"><code>RedisModule_StringCompare</code></h3>
<pre><code>int RedisModule_StringCompare(const RedisModuleString *a,
                              const RedisModuleString *b);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Compare two string objects, returning -1, 0 or 1 respectively if
a &lt; b, a == b, a &gt; b. Strings are compared byte by byte as two
binary blobs without any encoding care / collation attempt.</p>
<p><span id="RedisModule_StringAppendBuffer"></span></p>
<h3 id="redismodule_stringappendbuffer"><code>RedisModule_StringAppendBuffer</code></h3>
<pre><code>int RedisModule_StringAppendBuffer(RedisModuleCtx *ctx,
                                   RedisModuleString *str,
                                   const char *buf,
                                   size_t len);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Append the specified buffer to the string 'str'. The string must be a
string created by the user that is referenced only a single time, otherwise
<code>REDISMODULE_ERR</code> is returned and the operation is not performed.</p>
<p><span id="RedisModule_TrimStringAllocation"></span></p>
<h3 id="redismodule_trimstringallocation"><code>RedisModule_TrimStringAllocation</code></h3>
<pre><code>void RedisModule_TrimStringAllocation(RedisModuleString *str);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Trim possible excess memory allocated for a <code>RedisModuleString</code>.</p>
<p>Sometimes a <code>RedisModuleString</code> may have more memory allocated for
it than required, typically for argv arguments that were constructed
from network buffers. This function optimizes such strings by reallocating
their memory, which is useful for strings that are not short lived but
retained for an extended duration.</p>
<p>This operation is <em>not thread safe</em> and should only be called when
no concurrent access to the string is guaranteed. Using it for an argv
string in a module command before the string is potentially available
to other threads is generally safe.</p>
<p>Currently, Redis may also automatically trim retained strings when a
module command returns. However, doing this explicitly should still be
a preferred option:</p>
<ol>
<li>Future versions of Redis may abandon auto-trimming.</li>
<li>Auto-trimming as currently implemented is <em>not thread safe</em>.
A background thread manipulating a recently retained string may end up
in a race condition with the auto-trim, which could result with
data corruption.</li>
</ol>
<p><span id="section-reply-apis"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Reply%20APIs"></a><h2 id="reply-apis">Reply APIs</h2>
<p>These functions are used for sending replies to the client.</p>
<p>Most functions always return <code>REDISMODULE_OK</code> so you can use it with
'return' in order to return from the command implementation with:</p>
<pre><code>if (... some condition ...)
    return RedisModule_ReplyWithLongLong(ctx,mycount);
</code></pre>
<h3 id="reply-with-collection-functions">Reply with collection functions</h3>
<p>After starting a collection reply, the module must make calls to other
<code>ReplyWith*</code> style functions in order to emit the elements of the collection.
Collection types include: Array, Map, Set and Attribute.</p>
<p>When producing collections with a number of elements that is not known
beforehand, the function can be called with a special flag
<code>REDISMODULE_POSTPONED_LEN</code> (<code>REDISMODULE_POSTPONED_ARRAY_LEN</code> in the past),
and the actual number of elements can be later set with <code>RedisModule_ReplySet</code>*Length()
call (which will set the latest "open" count if there are multiple ones).</p>
<p><span id="RedisModule_WrongArity"></span></p>
<h3 id="redismodule_wrongarity"><code>RedisModule_WrongArity</code></h3>
<pre><code>int RedisModule_WrongArity(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Send an error about the number of arguments given to the command,
citing the command name in the error message. Returns <code>REDISMODULE_OK</code>.</p>
<p>Example:</p>
<pre><code>if (argc != 3) return RedisModule_WrongArity(ctx);
</code></pre>
<p><span id="RedisModule_ReplyWithLongLong"></span></p>
<h3 id="redismodule_replywithlonglong"><code>RedisModule_ReplyWithLongLong</code></h3>
<pre><code>int RedisModule_ReplyWithLongLong(RedisModuleCtx *ctx, long long ll);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Send an integer reply to the client, with the specified <code>long long</code> value.
The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithError"></span></p>
<h3 id="redismodule_replywitherror"><code>RedisModule_ReplyWithError</code></h3>
<pre><code>int RedisModule_ReplyWithError(RedisModuleCtx *ctx, const char *err);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Reply with the error 'err'.</p>
<p>Note that 'err' must contain all the error, including
the initial error code. The function only provides the initial "-", so
the usage is, for example:</p>
<pre><code>RedisModule_ReplyWithError(ctx,"ERR Wrong Type");
</code></pre>
<p>and not just:</p>
<pre><code>RedisModule_ReplyWithError(ctx,"Wrong Type");
</code></pre>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithSimpleString"></span></p>
<h3 id="redismodule_replywithsimplestring"><code>RedisModule_ReplyWithSimpleString</code></h3>
<pre><code>int RedisModule_ReplyWithSimpleString(RedisModuleCtx *ctx, const char *msg);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Reply with a simple string (<code>+... \r\n</code> in RESP protocol). This replies
are suitable only when sending a small non-binary string with small
overhead, like "OK" or similar replies.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithArray"></span></p>
<h3 id="redismodule_replywitharray"><code>RedisModule_ReplyWithArray</code></h3>
<pre><code>int RedisModule_ReplyWithArray(RedisModuleCtx *ctx, long len);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Reply with an array type of 'len' elements.</p>
<p>After starting an array reply, the module must make <code>len</code> calls to other
<code>ReplyWith*</code> style functions in order to emit the elements of the array.
See Reply APIs section for more details.</p>
<p>Use <a href="#RedisModule_ReplySetArrayLength"><code>RedisModule_ReplySetArrayLength()</code></a> to set deferred length.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithMap"></span></p>
<h3 id="redismodule_replywithmap"><code>RedisModule_ReplyWithMap</code></h3>
<pre><code>int RedisModule_ReplyWithMap(RedisModuleCtx *ctx, long len);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Reply with a RESP3 Map type of 'len' pairs.
Visit <a href="https://github.com/antirez/RESP3/blob/master/spec.md">https://github.com/antirez/RESP3/blob/master/spec.md</a> for more info about RESP3.</p>
<p>After starting a map reply, the module must make <code>len*2</code> calls to other
<code>ReplyWith*</code> style functions in order to emit the elements of the map.
See Reply APIs section for more details.</p>
<p>If the connected client is using RESP2, the reply will be converted to a flat
array.</p>
<p>Use <a href="#RedisModule_ReplySetMapLength"><code>RedisModule_ReplySetMapLength()</code></a> to set deferred length.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithSet"></span></p>
<h3 id="redismodule_replywithset"><code>RedisModule_ReplyWithSet</code></h3>
<pre><code>int RedisModule_ReplyWithSet(RedisModuleCtx *ctx, long len);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Reply with a RESP3 Set type of 'len' elements.
Visit <a href="https://github.com/antirez/RESP3/blob/master/spec.md">https://github.com/antirez/RESP3/blob/master/spec.md</a> for more info about RESP3.</p>
<p>After starting a set reply, the module must make <code>len</code> calls to other
<code>ReplyWith*</code> style functions in order to emit the elements of the set.
See Reply APIs section for more details.</p>
<p>If the connected client is using RESP2, the reply will be converted to an
array type.</p>
<p>Use <a href="#RedisModule_ReplySetSetLength"><code>RedisModule_ReplySetSetLength()</code></a> to set deferred length.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithAttribute"></span></p>
<h3 id="redismodule_replywithattribute"><code>RedisModule_ReplyWithAttribute</code></h3>
<pre><code>int RedisModule_ReplyWithAttribute(RedisModuleCtx *ctx, long len);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Add attributes (metadata) to the reply. Should be done before adding the
actual reply. see <a href="https://github.com/antirez/RESP3/blob/master/spec.md">https://github.com/antirez/RESP3/blob/master/spec.md</a>#attribute-type</p>
<p>After starting an attribute's reply, the module must make <code>len*2</code> calls to other
<code>ReplyWith*</code> style functions in order to emit the elements of the attribute map.
See Reply APIs section for more details.</p>
<p>Use <a href="#RedisModule_ReplySetAttributeLength"><code>RedisModule_ReplySetAttributeLength()</code></a> to set deferred length.</p>
<p>Not supported by RESP2 and will return <code>REDISMODULE_ERR</code>, otherwise
the function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithNullArray"></span></p>
<h3 id="redismodule_replywithnullarray"><code>RedisModule_ReplyWithNullArray</code></h3>
<pre><code>int RedisModule_ReplyWithNullArray(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Reply to the client with a null array, simply null in RESP3,
null array in RESP2.</p>
<p>Note: In RESP3 there's no difference between Null reply and
NullArray reply, so to prevent ambiguity it's better to avoid
using this API and use <a href="#RedisModule_ReplyWithNull"><code>RedisModule_ReplyWithNull</code></a> instead.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithEmptyArray"></span></p>
<h3 id="redismodule_replywithemptyarray"><code>RedisModule_ReplyWithEmptyArray</code></h3>
<pre><code>int RedisModule_ReplyWithEmptyArray(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Reply to the client with an empty array.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplySetArrayLength"></span></p>
<h3 id="redismodule_replysetarraylength"><code>RedisModule_ReplySetArrayLength</code></h3>
<pre><code>void RedisModule_ReplySetArrayLength(RedisModuleCtx *ctx, long len);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>When <a href="#RedisModule_ReplyWithArray"><code>RedisModule_ReplyWithArray()</code></a> is used with the argument
<code>REDISMODULE_POSTPONED_LEN</code>, because we don't know beforehand the number
of items we are going to output as elements of the array, this function
will take care to set the array length.</p>
<p>Since it is possible to have multiple array replies pending with unknown
length, this function guarantees to always set the latest array length
that was created in a postponed way.</p>
<p>For example in order to output an array like [1,[10,20,30]] we
could write:</p>
<pre><code> RedisModule_ReplyWithArray(ctx,REDISMODULE_POSTPONED_LEN);
 RedisModule_ReplyWithLongLong(ctx,1);
 RedisModule_ReplyWithArray(ctx,REDISMODULE_POSTPONED_LEN);
 RedisModule_ReplyWithLongLong(ctx,10);
 RedisModule_ReplyWithLongLong(ctx,20);
 RedisModule_ReplyWithLongLong(ctx,30);
 RedisModule_ReplySetArrayLength(ctx,3); // Set len of 10,20,30 array.
 RedisModule_ReplySetArrayLength(ctx,2); // Set len of top array
</code></pre>
<p>Note that in the above example there is no reason to postpone the array
length, since we produce a fixed number of elements, but in the practice
the code may use an iterator or other ways of creating the output so
that is not easy to calculate in advance the number of elements.</p>
<p><span id="RedisModule_ReplySetMapLength"></span></p>
<h3 id="redismodule_replysetmaplength"><code>RedisModule_ReplySetMapLength</code></h3>
<pre><code>void RedisModule_ReplySetMapLength(RedisModuleCtx *ctx, long len);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Very similar to <a href="#RedisModule_ReplySetArrayLength"><code>RedisModule_ReplySetArrayLength</code></a> except <code>len</code> should
exactly half of the number of <code>ReplyWith*</code> functions called in the
context of the map.
Visit <a href="https://github.com/antirez/RESP3/blob/master/spec.md">https://github.com/antirez/RESP3/blob/master/spec.md</a> for more info about RESP3.</p>
<p><span id="RedisModule_ReplySetSetLength"></span></p>
<h3 id="redismodule_replysetsetlength"><code>RedisModule_ReplySetSetLength</code></h3>
<pre><code>void RedisModule_ReplySetSetLength(RedisModuleCtx *ctx, long len);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Very similar to <a href="#RedisModule_ReplySetArrayLength"><code>RedisModule_ReplySetArrayLength</code></a>
Visit <a href="https://github.com/antirez/RESP3/blob/master/spec.md">https://github.com/antirez/RESP3/blob/master/spec.md</a> for more info about RESP3.</p>
<p><span id="RedisModule_ReplySetAttributeLength"></span></p>
<h3 id="redismodule_replysetattributelength"><code>RedisModule_ReplySetAttributeLength</code></h3>
<pre><code>void RedisModule_ReplySetAttributeLength(RedisModuleCtx *ctx, long len);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Very similar to <a href="#RedisModule_ReplySetMapLength"><code>RedisModule_ReplySetMapLength</code></a>
Visit <a href="https://github.com/antirez/RESP3/blob/master/spec.md">https://github.com/antirez/RESP3/blob/master/spec.md</a> for more info about RESP3.</p>
<p>Must not be called if <a href="#RedisModule_ReplyWithAttribute"><code>RedisModule_ReplyWithAttribute</code></a> returned an error.</p>
<p><span id="RedisModule_ReplyWithStringBuffer"></span></p>
<h3 id="redismodule_replywithstringbuffer"><code>RedisModule_ReplyWithStringBuffer</code></h3>
<pre><code>int RedisModule_ReplyWithStringBuffer(RedisModuleCtx *ctx,
                                      const char *buf,
                                      size_t len);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Reply with a bulk string, taking in input a C buffer pointer and length.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithCString"></span></p>
<h3 id="redismodule_replywithcstring"><code>RedisModule_ReplyWithCString</code></h3>
<pre><code>int RedisModule_ReplyWithCString(RedisModuleCtx *ctx, const char *buf);
</code></pre>
<p><strong>Available since:</strong> 5.0.6</p>
<p>Reply with a bulk string, taking in input a C buffer pointer that is
assumed to be null-terminated.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithString"></span></p>
<h3 id="redismodule_replywithstring"><code>RedisModule_ReplyWithString</code></h3>
<pre><code>int RedisModule_ReplyWithString(RedisModuleCtx *ctx, RedisModuleString *str);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Reply with a bulk string, taking in input a <code>RedisModuleString</code> object.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithEmptyString"></span></p>
<h3 id="redismodule_replywithemptystring"><code>RedisModule_ReplyWithEmptyString</code></h3>
<pre><code>int RedisModule_ReplyWithEmptyString(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Reply with an empty string.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithVerbatimStringType"></span></p>
<h3 id="redismodule_replywithverbatimstringtype"><code>RedisModule_ReplyWithVerbatimStringType</code></h3>
<pre><code>int RedisModule_ReplyWithVerbatimStringType(RedisModuleCtx *ctx,
                                            const char *buf,
                                            size_t len,
                                            const char *ext);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Reply with a binary safe string, which should not be escaped or filtered
taking in input a C buffer pointer, length and a 3 character type/extension.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithVerbatimString"></span></p>
<h3 id="redismodule_replywithverbatimstring"><code>RedisModule_ReplyWithVerbatimString</code></h3>
<pre><code>int RedisModule_ReplyWithVerbatimString(RedisModuleCtx *ctx,
                                        const char *buf,
                                        size_t len);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Reply with a binary safe string, which should not be escaped or filtered
taking in input a C buffer pointer and length.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithNull"></span></p>
<h3 id="redismodule_replywithnull"><code>RedisModule_ReplyWithNull</code></h3>
<pre><code>int RedisModule_ReplyWithNull(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Reply to the client with a NULL.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithBool"></span></p>
<h3 id="redismodule_replywithbool"><code>RedisModule_ReplyWithBool</code></h3>
<pre><code>int RedisModule_ReplyWithBool(RedisModuleCtx *ctx, int b);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Reply with a RESP3 Boolean type.
Visit <a href="https://github.com/antirez/RESP3/blob/master/spec.md">https://github.com/antirez/RESP3/blob/master/spec.md</a> for more info about RESP3.</p>
<p>In RESP3, this is boolean type
In RESP2, it's a string response of "1" and "0" for true and false respectively.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithCallReply"></span></p>
<h3 id="redismodule_replywithcallreply"><code>RedisModule_ReplyWithCallReply</code></h3>
<pre><code>int RedisModule_ReplyWithCallReply(RedisModuleCtx *ctx,
                                   RedisModuleCallReply *reply);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Reply exactly what a Redis command returned us with <a href="#RedisModule_Call"><code>RedisModule_Call()</code></a>.
This function is useful when we use <a href="#RedisModule_Call"><code>RedisModule_Call()</code></a> in order to
execute some command, as we want to reply to the client exactly the
same reply we obtained by the command.</p>
<p>Return:</p>
<ul>
<li><code>REDISMODULE_OK</code> on success.</li>
<li><code>REDISMODULE_ERR</code> if the given reply is in RESP3 format but the client expects RESP2.
In case of an error, it's the module writer responsibility to translate the reply
to RESP2 (or handle it differently by returning an error). Notice that for
module writer convenience, it is possible to pass <code>0</code> as a parameter to the fmt
argument of <a href="#RedisModule_Call"><code>RedisModule_Call</code></a> so that the <code>RedisModuleCallReply</code> will return in the same
protocol (RESP2 or RESP3) as set in the current client's context.</li>
</ul>
<p><span id="RedisModule_ReplyWithDouble"></span></p>
<h3 id="redismodule_replywithdouble"><code>RedisModule_ReplyWithDouble</code></h3>
<pre><code>int RedisModule_ReplyWithDouble(RedisModuleCtx *ctx, double d);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Reply with a RESP3 Double type.
Visit <a href="https://github.com/antirez/RESP3/blob/master/spec.md">https://github.com/antirez/RESP3/blob/master/spec.md</a> for more info about RESP3.</p>
<p>Send a string reply obtained converting the double 'd' into a bulk string.
This function is basically equivalent to converting a double into
a string into a C buffer, and then calling the function
<a href="#RedisModule_ReplyWithStringBuffer"><code>RedisModule_ReplyWithStringBuffer()</code></a> with the buffer and length.</p>
<p>In RESP3 the string is tagged as a double, while in RESP2 it's just a plain string
that the user will have to parse.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithBigNumber"></span></p>
<h3 id="redismodule_replywithbignumber"><code>RedisModule_ReplyWithBigNumber</code></h3>
<pre><code>int RedisModule_ReplyWithBigNumber(RedisModuleCtx *ctx,
                                   const char *bignum,
                                   size_t len);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Reply with a RESP3 BigNumber type.
Visit <a href="https://github.com/antirez/RESP3/blob/master/spec.md">https://github.com/antirez/RESP3/blob/master/spec.md</a> for more info about RESP3.</p>
<p>In RESP3, this is a string of length <code>len</code> that is tagged as a BigNumber,
however, it's up to the caller to ensure that it's a valid BigNumber.
In RESP2, this is just a plain bulk string response.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="RedisModule_ReplyWithLongDouble"></span></p>
<h3 id="redismodule_replywithlongdouble"><code>RedisModule_ReplyWithLongDouble</code></h3>
<pre><code>int RedisModule_ReplyWithLongDouble(RedisModuleCtx *ctx, long double ld);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Send a string reply obtained converting the long double 'ld' into a bulk
string. This function is basically equivalent to converting a long double
into a string into a C buffer, and then calling the function
<a href="#RedisModule_ReplyWithStringBuffer"><code>RedisModule_ReplyWithStringBuffer()</code></a> with the buffer and length.
The double string uses human readable formatting (see
<code>addReplyHumanLongDouble</code> in networking.c).</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="section-commands-replication-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Commands%20replication%20API"></a><h2 id="commands-replication-api">Commands replication API</h2>
<p><span id="RedisModule_Replicate"></span></p>
<h3 id="redismodule_replicate"><code>RedisModule_Replicate</code></h3>
<pre><code>int RedisModule_Replicate(RedisModuleCtx *ctx,
                          const char *cmdname,
                          const char *fmt,
                          ...);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Replicate the specified command and arguments to slaves and AOF, as effect
of execution of the calling command implementation.</p>
<p>The replicated commands are always wrapped into the MULTI/EXEC that
contains all the commands replicated in a given module command
execution. However the commands replicated with <a href="#RedisModule_Call"><code>RedisModule_Call()</code></a>
are the first items, the ones replicated with <a href="#RedisModule_Replicate"><code>RedisModule_Replicate()</code></a>
will all follow before the EXEC.</p>
<p>Modules should try to use one interface or the other.</p>
<p>This command follows exactly the same interface of <a href="#RedisModule_Call"><code>RedisModule_Call()</code></a>,
so a set of format specifiers must be passed, followed by arguments
matching the provided format specifiers.</p>
<p>Please refer to <a href="#RedisModule_Call"><code>RedisModule_Call()</code></a> for more information.</p>
<p>Using the special "A" and "R" modifiers, the caller can exclude either
the AOF or the replicas from the propagation of the specified command.
Otherwise, by default, the command will be propagated in both channels.</p>
<h4 id="note-about-calling-this-function-from-a-thread-safe-context">Note about calling this function from a thread safe context:</h4>
<p>Normally when you call this function from the callback implementing a
module command, or any other callback provided by the Redis Module API,
Redis will accumulate all the calls to this function in the context of
the callback, and will propagate all the commands wrapped in a MULTI/EXEC
transaction. However when calling this function from a threaded safe context
that can live an undefined amount of time, and can be locked/unlocked in
at will, the behavior is different: MULTI/EXEC wrapper is not emitted
and the command specified is inserted in the AOF and replication stream
immediately.</p>
<h4 id="return-value">Return value</h4>
<p>The command returns <code>REDISMODULE_ERR</code> if the format specifiers are invalid
or the command name does not belong to a known command.</p>
<p><span id="RedisModule_ReplicateVerbatim"></span></p>
<h3 id="redismodule_replicateverbatim"><code>RedisModule_ReplicateVerbatim</code></h3>
<pre><code>int RedisModule_ReplicateVerbatim(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>This function will replicate the command exactly as it was invoked
by the client. Note that this function will not wrap the command into
a MULTI/EXEC stanza, so it should not be mixed with other replication
commands.</p>
<p>Basically this form of replication is useful when you want to propagate
the command to the slaves and AOF file exactly as it was called, since
the command can just be re-executed to deterministically re-create the
new state starting from the old one.</p>
<p>The function always returns <code>REDISMODULE_OK</code>.</p>
<p><span id="section-db-and-key-apis-generic-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/DB%20and%20Key%20APIs%20%E2%80%93%20Generic%20API"></a><h2 id="db-and-key-apis--generic-api">DB and Key APIs – Generic API</h2>
<p><span id="RedisModule_GetClientId"></span></p>
<h3 id="redismodule_getclientid"><code>RedisModule_GetClientId</code></h3>
<pre><code>unsigned long long RedisModule_GetClientId(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the ID of the current client calling the currently active module
command. The returned ID has a few guarantees:</p>
<ol>
<li>The ID is different for each different client, so if the same client
executes a module command multiple times, it can be recognized as
having the same ID, otherwise the ID will be different.</li>
<li>The ID increases monotonically. Clients connecting to the server later
are guaranteed to get IDs greater than any past ID previously seen.</li>
</ol>
<p>Valid IDs are from 1 to 2^64 - 1. If 0 is returned it means there is no way
to fetch the ID in the context the function was currently called.</p>
<p>After obtaining the ID, it is possible to check if the command execution
is actually happening in the context of AOF loading, using this macro:</p>
<pre><code> if (RedisModule_IsAOFClient(RedisModule_GetClientId(ctx)) {
     // Handle it differently.
 }
</code></pre>
<p><span id="RedisModule_GetClientUserNameById"></span></p>
<h3 id="redismodule_getclientusernamebyid"><code>RedisModule_GetClientUserNameById</code></h3>
<pre><code>RedisModuleString *RedisModule_GetClientUserNameById(RedisModuleCtx *ctx,
                                                     uint64_t id);
</code></pre>
<p><strong>Available since:</strong> 6.2.1</p>
<p>Return the ACL user name used by the client with the specified client ID.
Client ID can be obtained with <a href="#RedisModule_GetClientId"><code>RedisModule_GetClientId()</code></a> API. If the client does not
exist, NULL is returned and errno is set to ENOENT. If the client isn't
using an ACL user, NULL is returned and errno is set to ENOTSUP</p>
<p><span id="RedisModule_GetClientInfoById"></span></p>
<h3 id="redismodule_getclientinfobyid"><code>RedisModule_GetClientInfoById</code></h3>
<pre><code>int RedisModule_GetClientInfoById(void *ci, uint64_t id);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Return information about the client with the specified ID (that was
previously obtained via the <a href="#RedisModule_GetClientId"><code>RedisModule_GetClientId()</code></a> API). If the
client exists, <code>REDISMODULE_OK</code> is returned, otherwise <code>REDISMODULE_ERR</code>
is returned.</p>
<p>When the client exist and the <code>ci</code> pointer is not NULL, but points to
a structure of type <code>RedisModuleClientInfoV</code>1, previously initialized with
the correct <code>REDISMODULE_CLIENTINFO_INITIALIZER_V1</code>, the structure is populated
with the following fields:</p>
<pre><code> uint64_t flags;         // REDISMODULE_CLIENTINFO_FLAG_*
 uint64_t id;            // Client ID
 char addr[46];          // IPv4 or IPv6 address.
 uint16_t port;          // TCP port.
 uint16_t db;            // Selected DB.
</code></pre>
<p>Note: the client ID is useless in the context of this call, since we
already know, however the same structure could be used in other
contexts where we don't know the client ID, yet the same structure
is returned.</p>
<p>With flags having the following meaning:</p>
<pre><code>REDISMODULE_CLIENTINFO_FLAG_SSL          Client using SSL connection.
REDISMODULE_CLIENTINFO_FLAG_PUBSUB       Client in Pub/Sub mode.
REDISMODULE_CLIENTINFO_FLAG_BLOCKED      Client blocked in command.
REDISMODULE_CLIENTINFO_FLAG_TRACKING     Client with keys tracking on.
REDISMODULE_CLIENTINFO_FLAG_UNIXSOCKET   Client using unix domain socket.
REDISMODULE_CLIENTINFO_FLAG_MULTI        Client in MULTI state.
</code></pre>
<p>However passing NULL is a way to just check if the client exists in case
we are not interested in any additional information.</p>
<p>This is the correct usage when we want the client info structure
returned:</p>
<pre><code> RedisModuleClientInfo ci = REDISMODULE_CLIENTINFO_INITIALIZER;
 int retval = RedisModule_GetClientInfoById(&amp;ci,client_id);
 if (retval == REDISMODULE_OK) {
     printf("Address: %s\n", ci.addr);
 }
</code></pre>
<p><span id="RedisModule_GetClientNameById"></span></p>
<h3 id="redismodule_getclientnamebyid"><code>RedisModule_GetClientNameById</code></h3>
<pre><code>RedisModuleString *RedisModule_GetClientNameById(RedisModuleCtx *ctx,
                                                 uint64_t id);
</code></pre>
<p><strong>Available since:</strong> 7.0.3</p>
<p>Returns the name of the client connection with the given ID.</p>
<p>If the client ID does not exist or if the client has no name associated with
it, NULL is returned.</p>
<p><span id="RedisModule_SetClientNameById"></span></p>
<h3 id="redismodule_setclientnamebyid"><code>RedisModule_SetClientNameById</code></h3>
<pre><code>int RedisModule_SetClientNameById(uint64_t id, RedisModuleString *name);
</code></pre>
<p><strong>Available since:</strong> 7.0.3</p>
<p>Sets the name of the client with the given ID. This is equivalent to the client calling
<code>CLIENT SETNAME name</code>.</p>
<p>Returns <code>REDISMODULE_OK</code> on success. On failure, <code>REDISMODULE_ERR</code> is returned
and errno is set as follows:</p>
<ul>
<li>ENOENT if the client does not exist</li>
<li>EINVAL if the name contains invalid characters</li>
</ul>
<p><span id="RedisModule_PublishMessage"></span></p>
<h3 id="redismodule_publishmessage"><code>RedisModule_PublishMessage</code></h3>
<pre><code>int RedisModule_PublishMessage(RedisModuleCtx *ctx,
                               RedisModuleString *channel,
                               RedisModuleString *message);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Publish a message to subscribers (see PUBLISH command).</p>
<p><span id="RedisModule_PublishMessageShard"></span></p>
<h3 id="redismodule_publishmessageshard"><code>RedisModule_PublishMessageShard</code></h3>
<pre><code>int RedisModule_PublishMessageShard(RedisModuleCtx *ctx,
                                    RedisModuleString *channel,
                                    RedisModuleString *message);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Publish a message to shard-subscribers (see SPUBLISH command).</p>
<p><span id="RedisModule_GetSelectedDb"></span></p>
<h3 id="redismodule_getselecteddb"><code>RedisModule_GetSelectedDb</code></h3>
<pre><code>int RedisModule_GetSelectedDb(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the currently selected DB.</p>
<p><span id="RedisModule_GetContextFlags"></span></p>
<h3 id="redismodule_getcontextflags"><code>RedisModule_GetContextFlags</code></h3>
<pre><code>int RedisModule_GetContextFlags(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.3</p>
<p>Return the current context's flags. The flags provide information on the
current request context (whether the client is a Lua script or in a MULTI),
and about the Redis instance in general, i.e replication and persistence.</p>
<p>It is possible to call this function even with a NULL context, however
in this case the following flags will not be reported:</p>
<ul>
<li>LUA, MULTI, REPLICATED, DIRTY (see below for more info).</li>
</ul>
<p>Available flags and their meaning:</p>
<ul>
<li>
<p><code>REDISMODULE_CTX_FLAGS_LUA</code>: The command is running in a Lua script</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_MULTI</code>: The command is running inside a transaction</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_REPLICATED</code>: The command was sent over the replication
link by the MASTER</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_MASTER</code>: The Redis instance is a master</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_SLAVE</code>: The Redis instance is a slave</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_READONLY</code>: The Redis instance is read-only</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_CLUSTER</code>: The Redis instance is in cluster mode</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_AOF</code>: The Redis instance has AOF enabled</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_RDB</code>: The instance has RDB enabled</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_MAXMEMORY</code>:  The instance has Maxmemory set</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_EVICT</code>:  Maxmemory is set and has an eviction
policy that may delete keys</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_OOM</code>: Redis is out of memory according to the
maxmemory setting.</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_OOM_WARNING</code>: Less than 25% of memory remains before
reaching the maxmemory level.</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_LOADING</code>: Server is loading RDB/AOF</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_REPLICA_IS_STALE</code>: No active link with the master.</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_REPLICA_IS_CONNECTING</code>: The replica is trying to
connect with the master.</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_REPLICA_IS_TRANSFERRING</code>: Master -&gt; Replica RDB
transfer is in progress.</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_REPLICA_IS_ONLINE</code>: The replica has an active link
with its master. This is the
contrary of STALE state.</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_ACTIVE_CHILD</code>: There is currently some background
process active (RDB, AUX or module).</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_MULTI_DIRTY</code>: The next EXEC will fail due to dirty
CAS (touched keys).</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_IS_CHILD</code>: Redis is currently running inside
background child process.</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_RESP3</code>: Indicate the that client attached to this
context is using RESP3.</p>
</li>
<li>
<p><code>REDISMODULE_CTX_FLAGS_SERVER_STARTUP</code>: The Redis instance is starting</p>
</li>
</ul>
<p><span id="RedisModule_AvoidReplicaTraffic"></span></p>
<h3 id="redismodule_avoidreplicatraffic"><code>RedisModule_AvoidReplicaTraffic</code></h3>
<pre><code>int RedisModule_AvoidReplicaTraffic();
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Returns true if a client sent the CLIENT PAUSE command to the server or
if Redis Cluster does a manual failover, pausing the clients.
This is needed when we have a master with replicas, and want to write,
without adding further data to the replication channel, that the replicas
replication offset, match the one of the master. When this happens, it is
safe to failover the master without data loss.</p>
<p>However modules may generate traffic by calling <a href="#RedisModule_Call"><code>RedisModule_Call()</code></a> with
the "!" flag, or by calling <a href="#RedisModule_Replicate"><code>RedisModule_Replicate()</code></a>, in a context outside
commands execution, for instance in timeout callbacks, threads safe
contexts, and so forth. When modules will generate too much traffic, it
will be hard for the master and replicas offset to match, because there
is more data to send in the replication channel.</p>
<p>So modules may want to try to avoid very heavy background work that has
the effect of creating data to the replication channel, when this function
returns true. This is mostly useful for modules that have background
garbage collection tasks, or that do writes and replicate such writes
periodically in timer callbacks or other periodic callbacks.</p>
<p><span id="RedisModule_SelectDb"></span></p>
<h3 id="redismodule_selectdb"><code>RedisModule_SelectDb</code></h3>
<pre><code>int RedisModule_SelectDb(RedisModuleCtx *ctx, int newid);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Change the currently selected DB. Returns an error if the id
is out of range.</p>
<p>Note that the client will retain the currently selected DB even after
the Redis command implemented by the module calling this function
returns.</p>
<p>If the module command wishes to change something in a different DB and
returns back to the original one, it should call <a href="#RedisModule_GetSelectedDb"><code>RedisModule_GetSelectedDb()</code></a>
before in order to restore the old DB number before returning.</p>
<p><span id="RedisModule_KeyExists"></span></p>
<h3 id="redismodule_keyexists"><code>RedisModule_KeyExists</code></h3>
<pre><code>int RedisModule_KeyExists(RedisModuleCtx *ctx, robj *keyname);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Check if a key exists, without affecting its last access time.</p>
<p>This is equivalent to calling <a href="#RedisModule_OpenKey"><code>RedisModule_OpenKey</code></a> with the mode <code>REDISMODULE_READ</code> |
<code>REDISMODULE_OPEN_KEY_NOTOUCH</code>, then checking if NULL was returned and, if not,
calling <a href="#RedisModule_CloseKey"><code>RedisModule_CloseKey</code></a> on the opened key.</p>
<p><span id="RedisModule_OpenKey"></span></p>
<h3 id="redismodule_openkey"><code>RedisModule_OpenKey</code></h3>
<pre><code>RedisModuleKey *RedisModule_OpenKey(RedisModuleCtx *ctx,
                                    robj *keyname,
                                    int mode);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return a handle representing a Redis key, so that it is possible
to call other APIs with the key handle as argument to perform
operations on the key.</p>
<p>The return value is the handle representing the key, that must be
closed with <a href="#RedisModule_CloseKey"><code>RedisModule_CloseKey()</code></a>.</p>
<p>If the key does not exist and <code>REDISMODULE_WRITE</code> mode is requested, the handle
is still returned, since it is possible to perform operations on
a yet not existing key (that will be created, for example, after
a list push operation). If the mode is just <code>REDISMODULE_READ</code> instead, and the
key does not exist, NULL is returned. However it is still safe to
call <a href="#RedisModule_CloseKey"><code>RedisModule_CloseKey()</code></a> and <a href="#RedisModule_KeyType"><code>RedisModule_KeyType()</code></a> on a NULL
value.</p>
<p>Extra flags that can be pass to the API under the mode argument:</p>
<ul>
<li><code>REDISMODULE_OPEN_KEY_NOTOUCH</code> - Avoid touching the LRU/LFU of the key when opened.</li>
<li><code>REDISMODULE_OPEN_KEY_NONOTIFY</code> - Don't trigger keyspace event on key misses.</li>
<li><code>REDISMODULE_OPEN_KEY_NOSTATS</code> - Don't update keyspace hits/misses counters.</li>
<li><code>REDISMODULE_OPEN_KEY_NOEXPIRE</code> - Avoid deleting lazy expired keys.</li>
<li><code>REDISMODULE_OPEN_KEY_NOEFFECTS</code> - Avoid any effects from fetching the key.</li>
</ul>
<p><span id="RedisModule_GetOpenKeyModesAll"></span></p>
<h3 id="redismodule_getopenkeymodesall"><code>RedisModule_GetOpenKeyModesAll</code></h3>
<pre><code>int RedisModule_GetOpenKeyModesAll();
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>Returns the full OpenKey modes mask, using the return value
the module can check if a certain set of OpenKey modes are supported
by the redis server version in use.
Example:</p>
<pre><code>   int supportedMode = RedisModule_GetOpenKeyModesAll();
   if (supportedMode &amp; REDISMODULE_OPEN_KEY_NOTOUCH) {
         // REDISMODULE_OPEN_KEY_NOTOUCH is supported
   } else{
         // REDISMODULE_OPEN_KEY_NOTOUCH is not supported
   }
</code></pre>
<p><span id="RedisModule_CloseKey"></span></p>
<h3 id="redismodule_closekey"><code>RedisModule_CloseKey</code></h3>
<pre><code>void RedisModule_CloseKey(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Close a key handle.</p>
<p><span id="RedisModule_KeyType"></span></p>
<h3 id="redismodule_keytype"><code>RedisModule_KeyType</code></h3>
<pre><code>int RedisModule_KeyType(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the type of the key. If the key pointer is NULL then
<code>REDISMODULE_KEYTYPE_EMPTY</code> is returned.</p>
<p><span id="RedisModule_ValueLength"></span></p>
<h3 id="redismodule_valuelength"><code>RedisModule_ValueLength</code></h3>
<pre><code>size_t RedisModule_ValueLength(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the length of the value associated with the key.
For strings this is the length of the string. For all the other types
is the number of elements (just counting keys for hashes).</p>
<p>If the key pointer is NULL or the key is empty, zero is returned.</p>
<p><span id="RedisModule_DeleteKey"></span></p>
<h3 id="redismodule_deletekey"><code>RedisModule_DeleteKey</code></h3>
<pre><code>int RedisModule_DeleteKey(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>If the key is open for writing, remove it, and setup the key to
accept new writes as an empty key (that will be created on demand).
On success <code>REDISMODULE_OK</code> is returned. If the key is not open for
writing <code>REDISMODULE_ERR</code> is returned.</p>
<p><span id="RedisModule_UnlinkKey"></span></p>
<h3 id="redismodule_unlinkkey"><code>RedisModule_UnlinkKey</code></h3>
<pre><code>int RedisModule_UnlinkKey(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 4.0.7</p>
<p>If the key is open for writing, unlink it (that is delete it in a
non-blocking way, not reclaiming memory immediately) and setup the key to
accept new writes as an empty key (that will be created on demand).
On success <code>REDISMODULE_OK</code> is returned. If the key is not open for
writing <code>REDISMODULE_ERR</code> is returned.</p>
<p><span id="RedisModule_GetExpire"></span></p>
<h3 id="redismodule_getexpire"><code>RedisModule_GetExpire</code></h3>
<pre><code>mstime_t RedisModule_GetExpire(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the key expire value, as milliseconds of remaining TTL.
If no TTL is associated with the key or if the key is empty,
<code>REDISMODULE_NO_EXPIRE</code> is returned.</p>
<p><span id="RedisModule_SetExpire"></span></p>
<h3 id="redismodule_setexpire"><code>RedisModule_SetExpire</code></h3>
<pre><code>int RedisModule_SetExpire(RedisModuleKey *key, mstime_t expire);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Set a new expire for the key. If the special expire
<code>REDISMODULE_NO_EXPIRE</code> is set, the expire is cancelled if there was
one (the same as the PERSIST command).</p>
<p>Note that the expire must be provided as a positive integer representing
the number of milliseconds of TTL the key should have.</p>
<p>The function returns <code>REDISMODULE_OK</code> on success or <code>REDISMODULE_ERR</code> if
the key was not open for writing or is an empty key.</p>
<p><span id="RedisModule_GetAbsExpire"></span></p>
<h3 id="redismodule_getabsexpire"><code>RedisModule_GetAbsExpire</code></h3>
<pre><code>mstime_t RedisModule_GetAbsExpire(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 6.2.2</p>
<p>Return the key expire value, as absolute Unix timestamp.
If no TTL is associated with the key or if the key is empty,
<code>REDISMODULE_NO_EXPIRE</code> is returned.</p>
<p><span id="RedisModule_SetAbsExpire"></span></p>
<h3 id="redismodule_setabsexpire"><code>RedisModule_SetAbsExpire</code></h3>
<pre><code>int RedisModule_SetAbsExpire(RedisModuleKey *key, mstime_t expire);
</code></pre>
<p><strong>Available since:</strong> 6.2.2</p>
<p>Set a new expire for the key. If the special expire
<code>REDISMODULE_NO_EXPIRE</code> is set, the expire is cancelled if there was
one (the same as the PERSIST command).</p>
<p>Note that the expire must be provided as a positive integer representing
the absolute Unix timestamp the key should have.</p>
<p>The function returns <code>REDISMODULE_OK</code> on success or <code>REDISMODULE_ERR</code> if
the key was not open for writing or is an empty key.</p>
<p><span id="RedisModule_ResetDataset"></span></p>
<h3 id="redismodule_resetdataset"><code>RedisModule_ResetDataset</code></h3>
<pre><code>void RedisModule_ResetDataset(int restart_aof, int async);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Performs similar operation to FLUSHALL, and optionally start a new AOF file (if enabled)
If <code>restart_aof</code> is true, you must make sure the command that triggered this call is not
propagated to the AOF file.
When async is set to true, db contents will be freed by a background thread.</p>
<p><span id="RedisModule_DbSize"></span></p>
<h3 id="redismodule_dbsize"><code>RedisModule_DbSize</code></h3>
<pre><code>unsigned long long RedisModule_DbSize(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Returns the number of keys in the current db.</p>
<p><span id="RedisModule_RandomKey"></span></p>
<h3 id="redismodule_randomkey"><code>RedisModule_RandomKey</code></h3>
<pre><code>RedisModuleString *RedisModule_RandomKey(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Returns a name of a random key, or NULL if current db is empty.</p>
<p><span id="RedisModule_GetKeyNameFromOptCtx"></span></p>
<h3 id="redismodule_getkeynamefromoptctx"><code>RedisModule_GetKeyNameFromOptCtx</code></h3>
<pre><code>const RedisModuleString *RedisModule_GetKeyNameFromOptCtx(RedisModuleKeyOptCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Returns the name of the key currently being processed.</p>
<p><span id="RedisModule_GetToKeyNameFromOptCtx"></span></p>
<h3 id="redismodule_gettokeynamefromoptctx"><code>RedisModule_GetToKeyNameFromOptCtx</code></h3>
<pre><code>const RedisModuleString *RedisModule_GetToKeyNameFromOptCtx(RedisModuleKeyOptCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Returns the name of the target key currently being processed.</p>
<p><span id="RedisModule_GetDbIdFromOptCtx"></span></p>
<h3 id="redismodule_getdbidfromoptctx"><code>RedisModule_GetDbIdFromOptCtx</code></h3>
<pre><code>int RedisModule_GetDbIdFromOptCtx(RedisModuleKeyOptCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Returns the dbid currently being processed.</p>
<p><span id="RedisModule_GetToDbIdFromOptCtx"></span></p>
<h3 id="redismodule_gettodbidfromoptctx"><code>RedisModule_GetToDbIdFromOptCtx</code></h3>
<pre><code>int RedisModule_GetToDbIdFromOptCtx(RedisModuleKeyOptCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Returns the target dbid currently being processed.</p>
<p><span id="section-key-api-for-string-type"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Key%20API%20for%20String%20type"></a><h2 id="key-api-for-string-type">Key API for String type</h2>
<p>See also <a href="#RedisModule_ValueLength"><code>RedisModule_ValueLength()</code></a>, which returns the length of a string.</p>
<p><span id="RedisModule_StringSet"></span></p>
<h3 id="redismodule_stringset"><code>RedisModule_StringSet</code></h3>
<pre><code>int RedisModule_StringSet(RedisModuleKey *key, RedisModuleString *str);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>If the key is open for writing, set the specified string 'str' as the
value of the key, deleting the old value if any.
On success <code>REDISMODULE_OK</code> is returned. If the key is not open for
writing or there is an active iterator, <code>REDISMODULE_ERR</code> is returned.</p>
<p><span id="RedisModule_StringDMA"></span></p>
<h3 id="redismodule_stringdma"><code>RedisModule_StringDMA</code></h3>
<pre><code>char *RedisModule_StringDMA(RedisModuleKey *key, size_t *len, int mode);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Prepare the key associated string value for DMA access, and returns
a pointer and size (by reference), that the user can use to read or
modify the string in-place accessing it directly via pointer.</p>
<p>The 'mode' is composed by bitwise OR-ing the following flags:</p>
<pre><code>REDISMODULE_READ -- Read access
REDISMODULE_WRITE -- Write access
</code></pre>
<p>If the DMA is not requested for writing, the pointer returned should
only be accessed in a read-only fashion.</p>
<p>On error (wrong type) NULL is returned.</p>
<p>DMA access rules:</p>
<ol>
<li>
<p>No other key writing function should be called since the moment
the pointer is obtained, for all the time we want to use DMA access
to read or modify the string.</p>
</li>
<li>
<p>Each time <a href="#RedisModule_StringTruncate"><code>RedisModule_StringTruncate()</code></a> is called, to continue with the DMA
access, <a href="#RedisModule_StringDMA"><code>RedisModule_StringDMA()</code></a> should be called again to re-obtain
a new pointer and length.</p>
</li>
<li>
<p>If the returned pointer is not NULL, but the length is zero, no
byte can be touched (the string is empty, or the key itself is empty)
so a <a href="#RedisModule_StringTruncate"><code>RedisModule_StringTruncate()</code></a> call should be used if there is to enlarge
the string, and later call StringDMA() again to get the pointer.</p>
</li>
</ol>
<p><span id="RedisModule_StringTruncate"></span></p>
<h3 id="redismodule_stringtruncate"><code>RedisModule_StringTruncate</code></h3>
<pre><code>int RedisModule_StringTruncate(RedisModuleKey *key, size_t newlen);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>If the key is open for writing and is of string type, resize it, padding
with zero bytes if the new length is greater than the old one.</p>
<p>After this call, <a href="#RedisModule_StringDMA"><code>RedisModule_StringDMA()</code></a> must be called again to continue
DMA access with the new pointer.</p>
<p>The function returns <code>REDISMODULE_OK</code> on success, and <code>REDISMODULE_ERR</code> on
error, that is, the key is not open for writing, is not a string
or resizing for more than 512 MB is requested.</p>
<p>If the key is empty, a string key is created with the new string value
unless the new length value requested is zero.</p>
<p><span id="section-key-api-for-list-type"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Key%20API%20for%20List%20type"></a><h2 id="key-api-for-list-type">Key API for List type</h2>
<p>Many of the list functions access elements by index. Since a list is in
essence a doubly-linked list, accessing elements by index is generally an
O(N) operation. However, if elements are accessed sequentially or with
indices close together, the functions are optimized to seek the index from
the previous index, rather than seeking from the ends of the list.</p>
<p>This enables iteration to be done efficiently using a simple for loop:</p>
<pre><code>long n = RedisModule_ValueLength(key);
for (long i = 0; i &lt; n; i++) {
    RedisModuleString *elem = RedisModule_ListGet(key, i);
    // Do stuff...
}
</code></pre>
<p>Note that after modifying a list using <a href="#RedisModule_ListPop"><code>RedisModule_ListPop</code></a>, <a href="#RedisModule_ListSet"><code>RedisModule_ListSet</code></a> or
<a href="#RedisModule_ListInsert"><code>RedisModule_ListInsert</code></a>, the internal iterator is invalidated so the next operation
will require a linear seek.</p>
<p>Modifying a list in any another way, for example using <a href="#RedisModule_Call"><code>RedisModule_Call()</code></a>, while a key
is open will confuse the internal iterator and may cause trouble if the key
is used after such modifications. The key must be reopened in this case.</p>
<p>See also <a href="#RedisModule_ValueLength"><code>RedisModule_ValueLength()</code></a>, which returns the length of a list.</p>
<p><span id="RedisModule_ListPush"></span></p>
<h3 id="redismodule_listpush"><code>RedisModule_ListPush</code></h3>
<pre><code>int RedisModule_ListPush(RedisModuleKey *key,
                         int where,
                         RedisModuleString *ele);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Push an element into a list, on head or tail depending on 'where' argument
(<code>REDISMODULE_LIST_HEAD</code> or <code>REDISMODULE_LIST_TAIL</code>). If the key refers to an
empty key opened for writing, the key is created. On success, <code>REDISMODULE_OK</code>
is returned. On failure, <code>REDISMODULE_ERR</code> is returned and <code>errno</code> is set as
follows:</p>
<ul>
<li>EINVAL if key or ele is NULL.</li>
<li>ENOTSUP if the key is of another type than list.</li>
<li>EBADF if the key is not opened for writing.</li>
</ul>
<p>Note: Before Redis 7.0, <code>errno</code> was not set by this function.</p>
<p><span id="RedisModule_ListPop"></span></p>
<h3 id="redismodule_listpop"><code>RedisModule_ListPop</code></h3>
<pre><code>RedisModuleString *RedisModule_ListPop(RedisModuleKey *key, int where);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Pop an element from the list, and returns it as a module string object
that the user should be free with <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a> or by enabling
automatic memory. The <code>where</code> argument specifies if the element should be
popped from the beginning or the end of the list (<code>REDISMODULE_LIST_HEAD</code> or
<code>REDISMODULE_LIST_TAIL</code>). On failure, the command returns NULL and sets
<code>errno</code> as follows:</p>
<ul>
<li>EINVAL if key is NULL.</li>
<li>ENOTSUP if the key is empty or of another type than list.</li>
<li>EBADF if the key is not opened for writing.</li>
</ul>
<p>Note: Before Redis 7.0, <code>errno</code> was not set by this function.</p>
<p><span id="RedisModule_ListGet"></span></p>
<h3 id="redismodule_listget"><code>RedisModule_ListGet</code></h3>
<pre><code>RedisModuleString *RedisModule_ListGet(RedisModuleKey *key, long index);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Returns the element at index <code>index</code> in the list stored at <code>key</code>, like the
LINDEX command. The element should be free'd using <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a> or using
automatic memory management.</p>
<p>The index is zero-based, so 0 means the first element, 1 the second element
and so on. Negative indices can be used to designate elements starting at the
tail of the list. Here, -1 means the last element, -2 means the penultimate
and so forth.</p>
<p>When no value is found at the given key and index, NULL is returned and
<code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if key is NULL.</li>
<li>ENOTSUP if the key is not a list.</li>
<li>EBADF if the key is not opened for reading.</li>
<li>EDOM if the index is not a valid index in the list.</li>
</ul>
<p><span id="RedisModule_ListSet"></span></p>
<h3 id="redismodule_listset"><code>RedisModule_ListSet</code></h3>
<pre><code>int RedisModule_ListSet(RedisModuleKey *key,
                        long index,
                        RedisModuleString *value);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Replaces the element at index <code>index</code> in the list stored at <code>key</code>.</p>
<p>The index is zero-based, so 0 means the first element, 1 the second element
and so on. Negative indices can be used to designate elements starting at the
tail of the list. Here, -1 means the last element, -2 means the penultimate
and so forth.</p>
<p>On success, <code>REDISMODULE_OK</code> is returned. On failure, <code>REDISMODULE_ERR</code> is
returned and <code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if key or value is NULL.</li>
<li>ENOTSUP if the key is not a list.</li>
<li>EBADF if the key is not opened for writing.</li>
<li>EDOM if the index is not a valid index in the list.</li>
</ul>
<p><span id="RedisModule_ListInsert"></span></p>
<h3 id="redismodule_listinsert"><code>RedisModule_ListInsert</code></h3>
<pre><code>int RedisModule_ListInsert(RedisModuleKey *key,
                           long index,
                           RedisModuleString *value);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Inserts an element at the given index.</p>
<p>The index is zero-based, so 0 means the first element, 1 the second element
and so on. Negative indices can be used to designate elements starting at the
tail of the list. Here, -1 means the last element, -2 means the penultimate
and so forth. The index is the element's index after inserting it.</p>
<p>On success, <code>REDISMODULE_OK</code> is returned. On failure, <code>REDISMODULE_ERR</code> is
returned and <code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if key or value is NULL.</li>
<li>ENOTSUP if the key of another type than list.</li>
<li>EBADF if the key is not opened for writing.</li>
<li>EDOM if the index is not a valid index in the list.</li>
</ul>
<p><span id="RedisModule_ListDelete"></span></p>
<h3 id="redismodule_listdelete"><code>RedisModule_ListDelete</code></h3>
<pre><code>int RedisModule_ListDelete(RedisModuleKey *key, long index);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Removes an element at the given index. The index is 0-based. A negative index
can also be used, counting from the end of the list.</p>
<p>On success, <code>REDISMODULE_OK</code> is returned. On failure, <code>REDISMODULE_ERR</code> is
returned and <code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if key or value is NULL.</li>
<li>ENOTSUP if the key is not a list.</li>
<li>EBADF if the key is not opened for writing.</li>
<li>EDOM if the index is not a valid index in the list.</li>
</ul>
<p><span id="section-key-api-for-sorted-set-type"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Key%20API%20for%20Sorted%20Set%20type"></a><h2 id="key-api-for-sorted-set-type">Key API for Sorted Set type</h2>
<p>See also <a href="#RedisModule_ValueLength"><code>RedisModule_ValueLength()</code></a>, which returns the length of a sorted set.</p>
<p><span id="RedisModule_ZsetAdd"></span></p>
<h3 id="redismodule_zsetadd"><code>RedisModule_ZsetAdd</code></h3>
<pre><code>int RedisModule_ZsetAdd(RedisModuleKey *key,
                        double score,
                        RedisModuleString *ele,
                        int *flagsptr);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Add a new element into a sorted set, with the specified 'score'.
If the element already exists, the score is updated.</p>
<p>A new sorted set is created at value if the key is an empty open key
setup for writing.</p>
<p>Additional flags can be passed to the function via a pointer, the flags
are both used to receive input and to communicate state when the function
returns. 'flagsptr' can be NULL if no special flags are used.</p>
<p>The input flags are:</p>
<pre><code>REDISMODULE_ZADD_XX: Element must already exist. Do nothing otherwise.
REDISMODULE_ZADD_NX: Element must not exist. Do nothing otherwise.
REDISMODULE_ZADD_GT: If element exists, new score must be greater than the current score. 
                     Do nothing otherwise. Can optionally be combined with XX.
REDISMODULE_ZADD_LT: If element exists, new score must be less than the current score.
                     Do nothing otherwise. Can optionally be combined with XX.
</code></pre>
<p>The output flags are:</p>
<pre><code>REDISMODULE_ZADD_ADDED: The new element was added to the sorted set.
REDISMODULE_ZADD_UPDATED: The score of the element was updated.
REDISMODULE_ZADD_NOP: No operation was performed because XX or NX flags.
</code></pre>
<p>On success the function returns <code>REDISMODULE_OK</code>. On the following errors
<code>REDISMODULE_ERR</code> is returned:</p>
<ul>
<li>The key was not opened for writing.</li>
<li>The key is of the wrong type.</li>
<li>'score' double value is not a number (NaN).</li>
</ul>
<p><span id="RedisModule_ZsetIncrby"></span></p>
<h3 id="redismodule_zsetincrby"><code>RedisModule_ZsetIncrby</code></h3>
<pre><code>int RedisModule_ZsetIncrby(RedisModuleKey *key,
                           double score,
                           RedisModuleString *ele,
                           int *flagsptr,
                           double *newscore);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>This function works exactly like <a href="#RedisModule_ZsetAdd"><code>RedisModule_ZsetAdd()</code></a>, but instead of setting
a new score, the score of the existing element is incremented, or if the
element does not already exist, it is added assuming the old score was
zero.</p>
<p>The input and output flags, and the return value, have the same exact
meaning, with the only difference that this function will return
<code>REDISMODULE_ERR</code> even when 'score' is a valid double number, but adding it
to the existing score results into a NaN (not a number) condition.</p>
<p>This function has an additional field 'newscore', if not NULL is filled
with the new score of the element after the increment, if no error
is returned.</p>
<p><span id="RedisModule_ZsetRem"></span></p>
<h3 id="redismodule_zsetrem"><code>RedisModule_ZsetRem</code></h3>
<pre><code>int RedisModule_ZsetRem(RedisModuleKey *key,
                        RedisModuleString *ele,
                        int *deleted);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Remove the specified element from the sorted set.
The function returns <code>REDISMODULE_OK</code> on success, and <code>REDISMODULE_ERR</code>
on one of the following conditions:</p>
<ul>
<li>The key was not opened for writing.</li>
<li>The key is of the wrong type.</li>
</ul>
<p>The return value does NOT indicate the fact the element was really
removed (since it existed) or not, just if the function was executed
with success.</p>
<p>In order to know if the element was removed, the additional argument
'deleted' must be passed, that populates the integer by reference
setting it to 1 or 0 depending on the outcome of the operation.
The 'deleted' argument can be NULL if the caller is not interested
to know if the element was really removed.</p>
<p>Empty keys will be handled correctly by doing nothing.</p>
<p><span id="RedisModule_ZsetScore"></span></p>
<h3 id="redismodule_zsetscore"><code>RedisModule_ZsetScore</code></h3>
<pre><code>int RedisModule_ZsetScore(RedisModuleKey *key,
                          RedisModuleString *ele,
                          double *score);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>On success retrieve the double score associated at the sorted set element
'ele' and returns <code>REDISMODULE_OK</code>. Otherwise <code>REDISMODULE_ERR</code> is returned
to signal one of the following conditions:</p>
<ul>
<li>There is no such element 'ele' in the sorted set.</li>
<li>The key is not a sorted set.</li>
<li>The key is an open empty key.</li>
</ul>
<p><span id="section-key-api-for-sorted-set-iterator"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Key%20API%20for%20Sorted%20Set%20iterator"></a><h2 id="key-api-for-sorted-set-iterator">Key API for Sorted Set iterator</h2>
<p><span id="RedisModule_ZsetRangeStop"></span></p>
<h3 id="redismodule_zsetrangestop"><code>RedisModule_ZsetRangeStop</code></h3>
<pre><code>void RedisModule_ZsetRangeStop(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Stop a sorted set iteration.</p>
<p><span id="RedisModule_ZsetRangeEndReached"></span></p>
<h3 id="redismodule_zsetrangeendreached"><code>RedisModule_ZsetRangeEndReached</code></h3>
<pre><code>int RedisModule_ZsetRangeEndReached(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the "End of range" flag value to signal the end of the iteration.</p>
<p><span id="RedisModule_ZsetFirstInScoreRange"></span></p>
<h3 id="redismodule_zsetfirstinscorerange"><code>RedisModule_ZsetFirstInScoreRange</code></h3>
<pre><code>int RedisModule_ZsetFirstInScoreRange(RedisModuleKey *key,
                                      double min,
                                      double max,
                                      int minex,
                                      int maxex);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Setup a sorted set iterator seeking the first element in the specified
range. Returns <code>REDISMODULE_OK</code> if the iterator was correctly initialized
otherwise <code>REDISMODULE_ERR</code> is returned in the following conditions:</p>
<ol>
<li>The value stored at key is not a sorted set or the key is empty.</li>
</ol>
<p>The range is specified according to the two double values 'min' and 'max'.
Both can be infinite using the following two macros:</p>
<ul>
<li><code>REDISMODULE_POSITIVE_INFINITE</code> for positive infinite value</li>
<li><code>REDISMODULE_NEGATIVE_INFINITE</code> for negative infinite value</li>
</ul>
<p>'minex' and 'maxex' parameters, if true, respectively setup a range
where the min and max value are exclusive (not included) instead of
inclusive.</p>
<p><span id="RedisModule_ZsetLastInScoreRange"></span></p>
<h3 id="redismodule_zsetlastinscorerange"><code>RedisModule_ZsetLastInScoreRange</code></h3>
<pre><code>int RedisModule_ZsetLastInScoreRange(RedisModuleKey *key,
                                     double min,
                                     double max,
                                     int minex,
                                     int maxex);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Exactly like <a href="#RedisModule_ZsetFirstInScoreRange"><code>RedisModule_ZsetFirstInScoreRange()</code></a> but the last element of
the range is selected for the start of the iteration instead.</p>
<p><span id="RedisModule_ZsetFirstInLexRange"></span></p>
<h3 id="redismodule_zsetfirstinlexrange"><code>RedisModule_ZsetFirstInLexRange</code></h3>
<pre><code>int RedisModule_ZsetFirstInLexRange(RedisModuleKey *key,
                                    RedisModuleString *min,
                                    RedisModuleString *max);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Setup a sorted set iterator seeking the first element in the specified
lexicographical range. Returns <code>REDISMODULE_OK</code> if the iterator was correctly
initialized otherwise <code>REDISMODULE_ERR</code> is returned in the
following conditions:</p>
<ol>
<li>The value stored at key is not a sorted set or the key is empty.</li>
<li>The lexicographical range 'min' and 'max' format is invalid.</li>
</ol>
<p>'min' and 'max' should be provided as two <code>RedisModuleString</code> objects
in the same format as the parameters passed to the ZRANGEBYLEX command.
The function does not take ownership of the objects, so they can be released
ASAP after the iterator is setup.</p>
<p><span id="RedisModule_ZsetLastInLexRange"></span></p>
<h3 id="redismodule_zsetlastinlexrange"><code>RedisModule_ZsetLastInLexRange</code></h3>
<pre><code>int RedisModule_ZsetLastInLexRange(RedisModuleKey *key,
                                   RedisModuleString *min,
                                   RedisModuleString *max);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Exactly like <a href="#RedisModule_ZsetFirstInLexRange"><code>RedisModule_ZsetFirstInLexRange()</code></a> but the last element of
the range is selected for the start of the iteration instead.</p>
<p><span id="RedisModule_ZsetRangeCurrentElement"></span></p>
<h3 id="redismodule_zsetrangecurrentelement"><code>RedisModule_ZsetRangeCurrentElement</code></h3>
<pre><code>RedisModuleString *RedisModule_ZsetRangeCurrentElement(RedisModuleKey *key,
                                                       double *score);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the current sorted set element of an active sorted set iterator
or NULL if the range specified in the iterator does not include any
element.</p>
<p><span id="RedisModule_ZsetRangeNext"></span></p>
<h3 id="redismodule_zsetrangenext"><code>RedisModule_ZsetRangeNext</code></h3>
<pre><code>int RedisModule_ZsetRangeNext(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Go to the next element of the sorted set iterator. Returns 1 if there was
a next element, 0 if we are already at the latest element or the range
does not include any item at all.</p>
<p><span id="RedisModule_ZsetRangePrev"></span></p>
<h3 id="redismodule_zsetrangeprev"><code>RedisModule_ZsetRangePrev</code></h3>
<pre><code>int RedisModule_ZsetRangePrev(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Go to the previous element of the sorted set iterator. Returns 1 if there was
a previous element, 0 if we are already at the first element or the range
does not include any item at all.</p>
<p><span id="section-key-api-for-hash-type"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Key%20API%20for%20Hash%20type"></a><h2 id="key-api-for-hash-type">Key API for Hash type</h2>
<p>See also <a href="#RedisModule_ValueLength"><code>RedisModule_ValueLength()</code></a>, which returns the number of fields in a hash.</p>
<p><span id="RedisModule_HashSet"></span></p>
<h3 id="redismodule_hashset"><code>RedisModule_HashSet</code></h3>
<pre><code>int RedisModule_HashSet(RedisModuleKey *key, int flags, ...);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Set the field of the specified hash field to the specified value.
If the key is an empty key open for writing, it is created with an empty
hash value, in order to set the specified field.</p>
<p>The function is variadic and the user must specify pairs of field
names and values, both as <code>RedisModuleString</code> pointers (unless the
CFIELD option is set, see later). At the end of the field/value-ptr pairs,
NULL must be specified as last argument to signal the end of the arguments
in the variadic function.</p>
<p>Example to set the hash argv[1] to the value argv[2]:</p>
<pre><code> RedisModule_HashSet(key,REDISMODULE_HASH_NONE,argv[1],argv[2],NULL);
</code></pre>
<p>The function can also be used in order to delete fields (if they exist)
by setting them to the specified value of <code>REDISMODULE_HASH_DELETE</code>:</p>
<pre><code> RedisModule_HashSet(key,REDISMODULE_HASH_NONE,argv[1],
                     REDISMODULE_HASH_DELETE,NULL);
</code></pre>
<p>The behavior of the command changes with the specified flags, that can be
set to <code>REDISMODULE_HASH_NONE</code> if no special behavior is needed.</p>
<pre><code>REDISMODULE_HASH_NX: The operation is performed only if the field was not
                     already existing in the hash.
REDISMODULE_HASH_XX: The operation is performed only if the field was
                     already existing, so that a new value could be
                     associated to an existing filed, but no new fields
                     are created.
REDISMODULE_HASH_CFIELDS: The field names passed are null terminated C
                          strings instead of RedisModuleString objects.
REDISMODULE_HASH_COUNT_ALL: Include the number of inserted fields in the
                            returned number, in addition to the number of
                            updated and deleted fields. (Added in Redis
                            6.2.)
</code></pre>
<p>Unless NX is specified, the command overwrites the old field value with
the new one.</p>
<p>When using <code>REDISMODULE_HASH_CFIELDS</code>, field names are reported using
normal C strings, so for example to delete the field "foo" the following
code can be used:</p>
<pre><code> RedisModule_HashSet(key,REDISMODULE_HASH_CFIELDS,"foo",
                     REDISMODULE_HASH_DELETE,NULL);
</code></pre>
<p>Return value:</p>
<p>The number of fields existing in the hash prior to the call, which have been
updated (its old value has been replaced by a new value) or deleted. If the
flag <code>REDISMODULE_HASH_COUNT_ALL</code> is set, inserted fields not previously
existing in the hash are also counted.</p>
<p>If the return value is zero, <code>errno</code> is set (since Redis 6.2) as follows:</p>
<ul>
<li>EINVAL if any unknown flags are set or if key is NULL.</li>
<li>ENOTSUP if the key is associated with a non Hash value.</li>
<li>EBADF if the key was not opened for writing.</li>
<li>ENOENT if no fields were counted as described under Return value above.
This is not actually an error. The return value can be zero if all fields
were just created and the <code>COUNT_ALL</code> flag was unset, or if changes were held
back due to the NX and XX flags.</li>
</ul>
<p>NOTICE: The return value semantics of this function are very different
between Redis 6.2 and older versions. Modules that use it should determine
the Redis version and handle it accordingly.</p>
<p><span id="RedisModule_HashGet"></span></p>
<h3 id="redismodule_hashget"><code>RedisModule_HashGet</code></h3>
<pre><code>int RedisModule_HashGet(RedisModuleKey *key, int flags, ...);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Get fields from a hash value. This function is called using a variable
number of arguments, alternating a field name (as a <code>RedisModuleString</code>
pointer) with a pointer to a <code>RedisModuleString</code> pointer, that is set to the
value of the field if the field exists, or NULL if the field does not exist.
At the end of the field/value-ptr pairs, NULL must be specified as last
argument to signal the end of the arguments in the variadic function.</p>
<p>This is an example usage:</p>
<pre><code> RedisModuleString *first, *second;
 RedisModule_HashGet(mykey,REDISMODULE_HASH_NONE,argv[1],&amp;first,
                     argv[2],&amp;second,NULL);
</code></pre>
<p>As with <a href="#RedisModule_HashSet"><code>RedisModule_HashSet()</code></a> the behavior of the command can be specified
passing flags different than <code>REDISMODULE_HASH_NONE</code>:</p>
<p><code>REDISMODULE_HASH_CFIELDS</code>: field names as null terminated C strings.</p>
<p><code>REDISMODULE_HASH_EXISTS</code>: instead of setting the value of the field
expecting a <code>RedisModuleString</code> pointer to pointer, the function just
reports if the field exists or not and expects an integer pointer
as the second element of each pair.</p>
<p>Example of <code>REDISMODULE_HASH_CFIELDS</code>:</p>
<pre><code> RedisModuleString *username, *hashedpass;
 RedisModule_HashGet(mykey,REDISMODULE_HASH_CFIELDS,"username",&amp;username,"hp",&amp;hashedpass, NULL);
</code></pre>
<p>Example of <code>REDISMODULE_HASH_EXISTS</code>:</p>
<pre><code> int exists;
 RedisModule_HashGet(mykey,REDISMODULE_HASH_EXISTS,argv[1],&amp;exists,NULL);
</code></pre>
<p>The function returns <code>REDISMODULE_OK</code> on success and <code>REDISMODULE_ERR</code> if
the key is not a hash value.</p>
<p>Memory management:</p>
<p>The returned <code>RedisModuleString</code> objects should be released with
<a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a>, or by enabling automatic memory management.</p>
<p><span id="section-key-api-for-stream-type"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Key%20API%20for%20Stream%20type"></a><h2 id="key-api-for-stream-type">Key API for Stream type</h2>
<p>For an introduction to streams, see <a href="../../data-types/streams-tutorial.html">https://redis.io/topics/streams-intro</a>.</p>
<p>The type <code>RedisModuleStreamID</code>, which is used in stream functions, is a struct
with two 64-bit fields and is defined as</p>
<pre><code>typedef struct RedisModuleStreamID {
    uint64_t ms;
    uint64_t seq;
} RedisModuleStreamID;
</code></pre>
<p>See also <a href="#RedisModule_ValueLength"><code>RedisModule_ValueLength()</code></a>, which returns the length of a stream, and the
conversion functions <a href="#RedisModule_StringToStreamID"><code>RedisModule_StringToStreamID()</code></a> and <a href="#RedisModule_CreateStringFromStreamID"><code>RedisModule_CreateStringFromStreamID()</code></a>.</p>
<p><span id="RedisModule_StreamAdd"></span></p>
<h3 id="redismodule_streamadd"><code>RedisModule_StreamAdd</code></h3>
<pre><code>int RedisModule_StreamAdd(RedisModuleKey *key,
                          int flags,
                          RedisModuleStreamID *id,
                          RedisModuleString **argv,
                          long numfields);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Adds an entry to a stream. Like XADD without trimming.</p>
<ul>
<li><code>key</code>: The key where the stream is (or will be) stored</li>
<li><code>flags</code>: A bit field of
<ul>
<li><code>REDISMODULE_STREAM_ADD_AUTOID</code>: Assign a stream ID automatically, like
<code>*</code> in the XADD command.</li>
</ul>
</li>
<li><code>id</code>: If the <code>AUTOID</code> flag is set, this is where the assigned ID is
returned. Can be NULL if <code>AUTOID</code> is set, if you don't care to receive the
ID. If <code>AUTOID</code> is not set, this is the requested ID.</li>
<li><code>argv</code>: A pointer to an array of size <code>numfields * 2</code> containing the
fields and values.</li>
<li><code>numfields</code>: The number of field-value pairs in <code>argv</code>.</li>
</ul>
<p>Returns <code>REDISMODULE_OK</code> if an entry has been added. On failure,
<code>REDISMODULE_ERR</code> is returned and <code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if called with invalid arguments</li>
<li>ENOTSUP if the key refers to a value of a type other than stream</li>
<li>EBADF if the key was not opened for writing</li>
<li>EDOM if the given ID was 0-0 or not greater than all other IDs in the
stream (only if the AUTOID flag is unset)</li>
<li>EFBIG if the stream has reached the last possible ID</li>
<li>ERANGE if the elements are too large to be stored.</li>
</ul>
<p><span id="RedisModule_StreamDelete"></span></p>
<h3 id="redismodule_streamdelete"><code>RedisModule_StreamDelete</code></h3>
<pre><code>int RedisModule_StreamDelete(RedisModuleKey *key, RedisModuleStreamID *id);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Deletes an entry from a stream.</p>
<ul>
<li><code>key</code>: A key opened for writing, with no stream iterator started.</li>
<li><code>id</code>: The stream ID of the entry to delete.</li>
</ul>
<p>Returns <code>REDISMODULE_OK</code> on success. On failure, <code>REDISMODULE_ERR</code> is returned
and <code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if called with invalid arguments</li>
<li>ENOTSUP if the key refers to a value of a type other than stream or if the
key is empty</li>
<li>EBADF if the key was not opened for writing or if a stream iterator is
associated with the key</li>
<li>ENOENT if no entry with the given stream ID exists</li>
</ul>
<p>See also <a href="#RedisModule_StreamIteratorDelete"><code>RedisModule_StreamIteratorDelete()</code></a> for deleting the current entry while
iterating using a stream iterator.</p>
<p><span id="RedisModule_StreamIteratorStart"></span></p>
<h3 id="redismodule_streamiteratorstart"><code>RedisModule_StreamIteratorStart</code></h3>
<pre><code>int RedisModule_StreamIteratorStart(RedisModuleKey *key,
                                    int flags,
                                    RedisModuleStreamID *start,
                                    RedisModuleStreamID *end);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Sets up a stream iterator.</p>
<ul>
<li><code>key</code>: The stream key opened for reading using <a href="#RedisModule_OpenKey"><code>RedisModule_OpenKey()</code></a>.</li>
<li><code>flags</code>:
<ul>
<li><code>REDISMODULE_STREAM_ITERATOR_EXCLUSIVE</code>: Don't include <code>start</code> and <code>end</code>
in the iterated range.</li>
<li><code>REDISMODULE_STREAM_ITERATOR_REVERSE</code>: Iterate in reverse order, starting
from the <code>end</code> of the range.</li>
</ul>
</li>
<li><code>start</code>: The lower bound of the range. Use NULL for the beginning of the
stream.</li>
<li><code>end</code>: The upper bound of the range. Use NULL for the end of the stream.</li>
</ul>
<p>Returns <code>REDISMODULE_OK</code> on success. On failure, <code>REDISMODULE_ERR</code> is returned
and <code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if called with invalid arguments</li>
<li>ENOTSUP if the key refers to a value of a type other than stream or if the
key is empty</li>
<li>EBADF if the key was not opened for writing or if a stream iterator is
already associated with the key</li>
<li>EDOM if <code>start</code> or <code>end</code> is outside the valid range</li>
</ul>
<p>Returns <code>REDISMODULE_OK</code> on success and <code>REDISMODULE_ERR</code> if the key doesn't
refer to a stream or if invalid arguments were given.</p>
<p>The stream IDs are retrieved using <a href="#RedisModule_StreamIteratorNextID"><code>RedisModule_StreamIteratorNextID()</code></a> and
for each stream ID, the fields and values are retrieved using
<a href="#RedisModule_StreamIteratorNextField"><code>RedisModule_StreamIteratorNextField()</code></a>. The iterator is freed by calling
<a href="#RedisModule_StreamIteratorStop"><code>RedisModule_StreamIteratorStop()</code></a>.</p>
<p>Example (error handling omitted):</p>
<pre><code>RedisModule_StreamIteratorStart(key, 0, startid_ptr, endid_ptr);
RedisModuleStreamID id;
long numfields;
while (RedisModule_StreamIteratorNextID(key, &amp;id, &amp;numfields) ==
       REDISMODULE_OK) {
    RedisModuleString *field, *value;
    while (RedisModule_StreamIteratorNextField(key, &amp;field, &amp;value) ==
           REDISMODULE_OK) {
        //
        // ... Do stuff ...
        //
        RedisModule_FreeString(ctx, field);
        RedisModule_FreeString(ctx, value);
    }
}
RedisModule_StreamIteratorStop(key);
</code></pre>
<p><span id="RedisModule_StreamIteratorStop"></span></p>
<h3 id="redismodule_streamiteratorstop"><code>RedisModule_StreamIteratorStop</code></h3>
<pre><code>int RedisModule_StreamIteratorStop(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Stops a stream iterator created using <a href="#RedisModule_StreamIteratorStart"><code>RedisModule_StreamIteratorStart()</code></a> and
reclaims its memory.</p>
<p>Returns <code>REDISMODULE_OK</code> on success. On failure, <code>REDISMODULE_ERR</code> is returned
and <code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if called with a NULL key</li>
<li>ENOTSUP if the key refers to a value of a type other than stream or if the
key is empty</li>
<li>EBADF if the key was not opened for writing or if no stream iterator is
associated with the key</li>
</ul>
<p><span id="RedisModule_StreamIteratorNextID"></span></p>
<h3 id="redismodule_streamiteratornextid"><code>RedisModule_StreamIteratorNextID</code></h3>
<pre><code>int RedisModule_StreamIteratorNextID(RedisModuleKey *key,
                                     RedisModuleStreamID *id,
                                     long *numfields);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Finds the next stream entry and returns its stream ID and the number of
fields.</p>
<ul>
<li><code>key</code>: Key for which a stream iterator has been started using
<a href="#RedisModule_StreamIteratorStart"><code>RedisModule_StreamIteratorStart()</code></a>.</li>
<li><code>id</code>: The stream ID returned. NULL if you don't care.</li>
<li><code>numfields</code>: The number of fields in the found stream entry. NULL if you
don't care.</li>
</ul>
<p>Returns <code>REDISMODULE_OK</code> and sets <code>*id</code> and <code>*numfields</code> if an entry was found.
On failure, <code>REDISMODULE_ERR</code> is returned and <code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if called with a NULL key</li>
<li>ENOTSUP if the key refers to a value of a type other than stream or if the
key is empty</li>
<li>EBADF if no stream iterator is associated with the key</li>
<li>ENOENT if there are no more entries in the range of the iterator</li>
</ul>
<p>In practice, if <a href="#RedisModule_StreamIteratorNextID"><code>RedisModule_StreamIteratorNextID()</code></a> is called after a successful call
to <a href="#RedisModule_StreamIteratorStart"><code>RedisModule_StreamIteratorStart()</code></a> and with the same key, it is safe to assume that
an <code>REDISMODULE_ERR</code> return value means that there are no more entries.</p>
<p>Use <a href="#RedisModule_StreamIteratorNextField"><code>RedisModule_StreamIteratorNextField()</code></a> to retrieve the fields and values.
See the example at <a href="#RedisModule_StreamIteratorStart"><code>RedisModule_StreamIteratorStart()</code></a>.</p>
<p><span id="RedisModule_StreamIteratorNextField"></span></p>
<h3 id="redismodule_streamiteratornextfield"><code>RedisModule_StreamIteratorNextField</code></h3>
<pre><code>int RedisModule_StreamIteratorNextField(RedisModuleKey *key,
                                        RedisModuleString **field_ptr,
                                        RedisModuleString **value_ptr);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Retrieves the next field of the current stream ID and its corresponding value
in a stream iteration. This function should be called repeatedly after calling
<a href="#RedisModule_StreamIteratorNextID"><code>RedisModule_StreamIteratorNextID()</code></a> to fetch each field-value pair.</p>
<ul>
<li><code>key</code>: Key where a stream iterator has been started.</li>
<li><code>field_ptr</code>: This is where the field is returned.</li>
<li><code>value_ptr</code>: This is where the value is returned.</li>
</ul>
<p>Returns <code>REDISMODULE_OK</code> and points <code>*field_ptr</code> and <code>*value_ptr</code> to freshly
allocated <code>RedisModuleString</code> objects. The string objects are freed
automatically when the callback finishes if automatic memory is enabled. On
failure, <code>REDISMODULE_ERR</code> is returned and <code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if called with a NULL key</li>
<li>ENOTSUP if the key refers to a value of a type other than stream or if the
key is empty</li>
<li>EBADF if no stream iterator is associated with the key</li>
<li>ENOENT if there are no more fields in the current stream entry</li>
</ul>
<p>In practice, if <a href="#RedisModule_StreamIteratorNextField"><code>RedisModule_StreamIteratorNextField()</code></a> is called after a successful
call to <a href="#RedisModule_StreamIteratorNextID"><code>RedisModule_StreamIteratorNextID()</code></a> and with the same key, it is safe to assume
that an <code>REDISMODULE_ERR</code> return value means that there are no more fields.</p>
<p>See the example at <a href="#RedisModule_StreamIteratorStart"><code>RedisModule_StreamIteratorStart()</code></a>.</p>
<p><span id="RedisModule_StreamIteratorDelete"></span></p>
<h3 id="redismodule_streamiteratordelete"><code>RedisModule_StreamIteratorDelete</code></h3>
<pre><code>int RedisModule_StreamIteratorDelete(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Deletes the current stream entry while iterating.</p>
<p>This function can be called after <a href="#RedisModule_StreamIteratorNextID"><code>RedisModule_StreamIteratorNextID()</code></a> or after any
calls to <a href="#RedisModule_StreamIteratorNextField"><code>RedisModule_StreamIteratorNextField()</code></a>.</p>
<p>Returns <code>REDISMODULE_OK</code> on success. On failure, <code>REDISMODULE_ERR</code> is returned
and <code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if key is NULL</li>
<li>ENOTSUP if the key is empty or is of another type than stream</li>
<li>EBADF if the key is not opened for writing, if no iterator has been started</li>
<li>ENOENT if the iterator has no current stream entry</li>
</ul>
<p><span id="RedisModule_StreamTrimByLength"></span></p>
<h3 id="redismodule_streamtrimbylength"><code>RedisModule_StreamTrimByLength</code></h3>
<pre><code>long long RedisModule_StreamTrimByLength(RedisModuleKey *key,
                                         int flags,
                                         long long length);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Trim a stream by length, similar to XTRIM with MAXLEN.</p>
<ul>
<li><code>key</code>: Key opened for writing.</li>
<li><code>flags</code>: A bitfield of
<ul>
<li><code>REDISMODULE_STREAM_TRIM_APPROX</code>: Trim less if it improves performance,
like XTRIM with <code>~</code>.</li>
</ul>
</li>
<li><code>length</code>: The number of stream entries to keep after trimming.</li>
</ul>
<p>Returns the number of entries deleted. On failure, a negative value is
returned and <code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if called with invalid arguments</li>
<li>ENOTSUP if the key is empty or of a type other than stream</li>
<li>EBADF if the key is not opened for writing</li>
</ul>
<p><span id="RedisModule_StreamTrimByID"></span></p>
<h3 id="redismodule_streamtrimbyid"><code>RedisModule_StreamTrimByID</code></h3>
<pre><code>long long RedisModule_StreamTrimByID(RedisModuleKey *key,
                                     int flags,
                                     RedisModuleStreamID *id);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Trim a stream by ID, similar to XTRIM with MINID.</p>
<ul>
<li><code>key</code>: Key opened for writing.</li>
<li><code>flags</code>: A bitfield of
<ul>
<li><code>REDISMODULE_STREAM_TRIM_APPROX</code>: Trim less if it improves performance,
like XTRIM with <code>~</code>.</li>
</ul>
</li>
<li><code>id</code>: The smallest stream ID to keep after trimming.</li>
</ul>
<p>Returns the number of entries deleted. On failure, a negative value is
returned and <code>errno</code> is set as follows:</p>
<ul>
<li>EINVAL if called with invalid arguments</li>
<li>ENOTSUP if the key is empty or of a type other than stream</li>
<li>EBADF if the key is not opened for writing</li>
</ul>
<p><span id="section-calling-redis-commands-from-modules"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Calling%20Redis%20commands%20from%20modules"></a><h2 id="calling-redis-commands-from-modules">Calling Redis commands from modules</h2>
<p><a href="#RedisModule_Call"><code>RedisModule_Call()</code></a> sends a command to Redis. The remaining functions handle the reply.</p>
<p><span id="RedisModule_FreeCallReply"></span></p>
<h3 id="redismodule_freecallreply"><code>RedisModule_FreeCallReply</code></h3>
<pre><code>void RedisModule_FreeCallReply(RedisModuleCallReply *reply);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Free a Call reply and all the nested replies it contains if it's an
array.</p>
<p><span id="RedisModule_CallReplyType"></span></p>
<h3 id="redismodule_callreplytype"><code>RedisModule_CallReplyType</code></h3>
<pre><code>int RedisModule_CallReplyType(RedisModuleCallReply *reply);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the reply type as one of the following:</p>
<ul>
<li><code>REDISMODULE_REPLY_UNKNOWN</code></li>
<li><code>REDISMODULE_REPLY_STRING</code></li>
<li><code>REDISMODULE_REPLY_ERROR</code></li>
<li><code>REDISMODULE_REPLY_INTEGER</code></li>
<li><code>REDISMODULE_REPLY_ARRAY</code></li>
<li><code>REDISMODULE_REPLY_NULL</code></li>
<li><code>REDISMODULE_REPLY_MAP</code></li>
<li><code>REDISMODULE_REPLY_SET</code></li>
<li><code>REDISMODULE_REPLY_BOOL</code></li>
<li><code>REDISMODULE_REPLY_DOUBLE</code></li>
<li><code>REDISMODULE_REPLY_BIG_NUMBER</code></li>
<li><code>REDISMODULE_REPLY_VERBATIM_STRING</code></li>
<li><code>REDISMODULE_REPLY_ATTRIBUTE</code></li>
<li><code>REDISMODULE_REPLY_PROMISE</code></li>
</ul>
<p><span id="RedisModule_CallReplyLength"></span></p>
<h3 id="redismodule_callreplylength"><code>RedisModule_CallReplyLength</code></h3>
<pre><code>size_t RedisModule_CallReplyLength(RedisModuleCallReply *reply);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the reply type length, where applicable.</p>
<p><span id="RedisModule_CallReplyArrayElement"></span></p>
<h3 id="redismodule_callreplyarrayelement"><code>RedisModule_CallReplyArrayElement</code></h3>
<pre><code>RedisModuleCallReply *RedisModule_CallReplyArrayElement(RedisModuleCallReply *reply,
                                                        size_t idx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the 'idx'-th nested call reply element of an array reply, or NULL
if the reply type is wrong or the index is out of range.</p>
<p><span id="RedisModule_CallReplyInteger"></span></p>
<h3 id="redismodule_callreplyinteger"><code>RedisModule_CallReplyInteger</code></h3>
<pre><code>long long RedisModule_CallReplyInteger(RedisModuleCallReply *reply);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the <code>long long</code> of an integer reply.</p>
<p><span id="RedisModule_CallReplyDouble"></span></p>
<h3 id="redismodule_callreplydouble"><code>RedisModule_CallReplyDouble</code></h3>
<pre><code>double RedisModule_CallReplyDouble(RedisModuleCallReply *reply);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Return the double value of a double reply.</p>
<p><span id="RedisModule_CallReplyBigNumber"></span></p>
<h3 id="redismodule_callreplybignumber"><code>RedisModule_CallReplyBigNumber</code></h3>
<pre><code>const char *RedisModule_CallReplyBigNumber(RedisModuleCallReply *reply,
                                           size_t *len);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Return the big number value of a big number reply.</p>
<p><span id="RedisModule_CallReplyVerbatim"></span></p>
<h3 id="redismodule_callreplyverbatim"><code>RedisModule_CallReplyVerbatim</code></h3>
<pre><code>const char *RedisModule_CallReplyVerbatim(RedisModuleCallReply *reply,
                                          size_t *len,
                                          const char **format);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Return the value of a verbatim string reply,
An optional output argument can be given to get verbatim reply format.</p>
<p><span id="RedisModule_CallReplyBool"></span></p>
<h3 id="redismodule_callreplybool"><code>RedisModule_CallReplyBool</code></h3>
<pre><code>int RedisModule_CallReplyBool(RedisModuleCallReply *reply);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Return the Boolean value of a Boolean reply.</p>
<p><span id="RedisModule_CallReplySetElement"></span></p>
<h3 id="redismodule_callreplysetelement"><code>RedisModule_CallReplySetElement</code></h3>
<pre><code>RedisModuleCallReply *RedisModule_CallReplySetElement(RedisModuleCallReply *reply,
                                                      size_t idx);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Return the 'idx'-th nested call reply element of a set reply, or NULL
if the reply type is wrong or the index is out of range.</p>
<p><span id="RedisModule_CallReplyMapElement"></span></p>
<h3 id="redismodule_callreplymapelement"><code>RedisModule_CallReplyMapElement</code></h3>
<pre><code>int RedisModule_CallReplyMapElement(RedisModuleCallReply *reply,
                                    size_t idx,
                                    RedisModuleCallReply **key,
                                    RedisModuleCallReply **val);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Retrieve the 'idx'-th key and value of a map reply.</p>
<p>Returns:</p>
<ul>
<li><code>REDISMODULE_OK</code> on success.</li>
<li><code>REDISMODULE_ERR</code> if idx out of range or if the reply type is wrong.</li>
</ul>
<p>The <code>key</code> and <code>value</code> arguments are used to return by reference, and may be
NULL if not required.</p>
<p><span id="RedisModule_CallReplyAttribute"></span></p>
<h3 id="redismodule_callreplyattribute"><code>RedisModule_CallReplyAttribute</code></h3>
<pre><code>RedisModuleCallReply *RedisModule_CallReplyAttribute(RedisModuleCallReply *reply);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Return the attribute of the given reply, or NULL if no attribute exists.</p>
<p><span id="RedisModule_CallReplyAttributeElement"></span></p>
<h3 id="redismodule_callreplyattributeelement"><code>RedisModule_CallReplyAttributeElement</code></h3>
<pre><code>int RedisModule_CallReplyAttributeElement(RedisModuleCallReply *reply,
                                          size_t idx,
                                          RedisModuleCallReply **key,
                                          RedisModuleCallReply **val);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Retrieve the 'idx'-th key and value of an attribute reply.</p>
<p>Returns:</p>
<ul>
<li><code>REDISMODULE_OK</code> on success.</li>
<li><code>REDISMODULE_ERR</code> if idx out of range or if the reply type is wrong.</li>
</ul>
<p>The <code>key</code> and <code>value</code> arguments are used to return by reference, and may be
NULL if not required.</p>
<p><span id="RedisModule_CallReplyPromiseSetUnblockHandler"></span></p>
<h3 id="redismodule_callreplypromisesetunblockhandler"><code>RedisModule_CallReplyPromiseSetUnblockHandler</code></h3>
<pre><code>void RedisModule_CallReplyPromiseSetUnblockHandler(RedisModuleCallReply *reply,
                                                   RedisModuleOnUnblocked on_unblock,
                                                   void *private_data);
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>Set unblock handler (callback and private data) on the given promise <code>RedisModuleCallReply</code>.
The given reply must be of promise type (<code>REDISMODULE_REPLY_PROMISE</code>).</p>
<p><span id="RedisModule_CallReplyPromiseAbort"></span></p>
<h3 id="redismodule_callreplypromiseabort"><code>RedisModule_CallReplyPromiseAbort</code></h3>
<pre><code>int RedisModule_CallReplyPromiseAbort(RedisModuleCallReply *reply,
                                      void **private_data);
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>Abort the execution of a given promise <code>RedisModuleCallReply</code>.
return <code>REDMODULE_OK</code> in case the abort was done successfully and <code>REDISMODULE_ERR</code>
if its not possible to abort the execution (execution already finished).
In case the execution was aborted (<code>REDMODULE_OK</code> was returned), the <code>private_data</code> out parameter
will be set with the value of the private data that was given on '<a href="#RedisModule_CallReplyPromiseSetUnblockHandler"><code>RedisModule_CallReplyPromiseSetUnblockHandler</code></a>'
so the caller will be able to release the private data.</p>
<p>If the execution was aborted successfully, it is promised that the unblock handler will not be called.
That said, it is possible that the abort operation will successes but the operation will still continue.
This can happened if, for example, a module implements some blocking command and does not respect the
disconnect callback. For pure Redis commands this can not happened.</p>
<p><span id="RedisModule_CallReplyStringPtr"></span></p>
<h3 id="redismodule_callreplystringptr"><code>RedisModule_CallReplyStringPtr</code></h3>
<pre><code>const char *RedisModule_CallReplyStringPtr(RedisModuleCallReply *reply,
                                           size_t *len);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return the pointer and length of a string or error reply.</p>
<p><span id="RedisModule_CreateStringFromCallReply"></span></p>
<h3 id="redismodule_createstringfromcallreply"><code>RedisModule_CreateStringFromCallReply</code></h3>
<pre><code>RedisModuleString *RedisModule_CreateStringFromCallReply(RedisModuleCallReply *reply);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return a new string object from a call reply of type string, error or
integer. Otherwise (wrong reply type) return NULL.</p>
<p><span id="RedisModule_SetContextUser"></span></p>
<h3 id="redismodule_setcontextuser"><code>RedisModule_SetContextUser</code></h3>
<pre><code>void RedisModule_SetContextUser(RedisModuleCtx *ctx,
                                const RedisModuleUser *user);
</code></pre>
<p><strong>Available since:</strong> 7.0.6</p>
<p>Modifies the user that <a href="#RedisModule_Call"><code>RedisModule_Call</code></a> will use (e.g. for ACL checks)</p>
<p><span id="RedisModule_Call"></span></p>
<h3 id="redismodule_call"><code>RedisModule_Call</code></h3>
<pre><code>RedisModuleCallReply *RedisModule_Call(RedisModuleCtx *ctx,
                                       const char *cmdname,
                                       const char *fmt,
                                       ...);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Exported API to call any Redis command from modules.</p>
<ul>
<li>
<p><strong>cmdname</strong>: The Redis command to call.</p>
</li>
<li>
<p><strong>fmt</strong>: A format specifier string for the command's arguments. Each
of the arguments should be specified by a valid type specification. The
format specifier can also contain the modifiers <code>!</code>, <code>A</code>, <code>3</code> and <code>R</code> which
don't have a corresponding argument.</p>
<ul>
<li>
<p><code>b</code> -- The argument is a buffer and is immediately followed by another
argument that is the buffer's length.</p>
</li>
<li>
<p><code>c</code> -- The argument is a pointer to a plain C string (null-terminated).</p>
</li>
<li>
<p><code>l</code> -- The argument is a <code>long long</code> integer.</p>
</li>
<li>
<p><code>s</code> -- The argument is a RedisModuleString.</p>
</li>
<li>
<p><code>v</code> -- The argument(s) is a vector of RedisModuleString.</p>
</li>
<li>
<p><code>!</code> -- Sends the Redis command and its arguments to replicas and AOF.</p>
</li>
<li>
<p><code>A</code> -- Suppress AOF propagation, send only to replicas (requires <code>!</code>).</p>
</li>
<li>
<p><code>R</code> -- Suppress replicas propagation, send only to AOF (requires <code>!</code>).</p>
</li>
<li>
<p><code>3</code> -- Return a RESP3 reply. This will change the command reply.
e.g., HGETALL returns a map instead of a flat array.</p>
</li>
<li>
<p><code>0</code> -- Return the reply in auto mode, i.e. the reply format will be the
same as the client attached to the given RedisModuleCtx. This will
probably used when you want to pass the reply directly to the client.</p>
</li>
<li>
<p><code>C</code> -- Run a command as the user attached to the context.
User is either attached automatically via the client that directly
issued the command and created the context or via RedisModule_SetContextUser.
If the context is not directly created by an issued command (such as a
background context and no user was set on it via RedisModule_SetContextUser,
RedisModule_Call will fail.
Checks if the command can be executed according to ACL rules and causes
the command to run as the determined user, so that any future user
dependent activity, such as ACL checks within scripts will proceed as
expected.
Otherwise, the command will run as the Redis unrestricted user.</p>
</li>
<li>
<p><code>S</code> -- Run the command in a script mode, this means that it will raise
an error if a command which are not allowed inside a script
(flagged with the <code>deny-script</code> flag) is invoked (like SHUTDOWN).
In addition, on script mode, write commands are not allowed if there are
not enough good replicas (as configured with <code>min-replicas-to-write</code>)
or when the server is unable to persist to the disk.</p>
</li>
<li>
<p><code>W</code> -- Do not allow to run any write command (flagged with the <code>write</code> flag).</p>
</li>
<li>
<p><code>M</code> -- Do not allow <code>deny-oom</code> flagged commands when over the memory limit.</p>
</li>
<li>
<p><code>E</code> -- Return error as RedisModuleCallReply. If there is an error before
invoking the command, the error is returned using errno mechanism.
This flag allows to get the error also as an error CallReply with
relevant error message.</p>
</li>
<li>
<p>'D' -- A "Dry Run" mode. Return before executing the underlying call().
If everything succeeded, it will return with a NULL, otherwise it will
return with a CallReply object denoting the error, as if it was called with
the 'E' code.</p>
</li>
<li>
<p>'K' -- Allow running blocking commands. If enabled and the command gets blocked, a
special REDISMODULE_REPLY_PROMISE will be returned. This reply type
indicates that the command was blocked and the reply will be given asynchronously.
The module can use this reply object to set a handler which will be called when
the command gets unblocked using RedisModule_CallReplyPromiseSetUnblockHandler.
The handler must be set immediately after the command invocation (without releasing
the Redis lock in between). If the handler is not set, the blocking command will
still continue its execution but the reply will be ignored (fire and forget),
notice that this is dangerous in case of role change, as explained below.
The module can use RedisModule_CallReplyPromiseAbort to abort the command invocation
if it was not yet finished (see RedisModule_CallReplyPromiseAbort documentation for more
details). It is also the module's responsibility to abort the execution on role change, either by using
server event (to get notified when the instance becomes a replica) or relying on the disconnect
callback of the original client. Failing to do so can result in a write operation on a replica.
Unlike other call replies, promise call reply <strong>must</strong> be freed while the Redis GIL is locked.
Notice that on unblocking, the only promise is that the unblock handler will be called,
If the blocking RedisModule_Call caused the module to also block some real client (using RedisModule_BlockClient),
it is the module responsibility to unblock this client on the unblock handler.
On the unblock handler it is only allowed to perform the following:
* Calling additional Redis commands using RedisModule_Call
* Open keys using RedisModule_OpenKey
* Replicate data to the replica or AOF</p>
<pre><code>   Specifically, it is not allowed to call any Redis module API which are client related such as:
   * RedisModule_Reply* API's
   * RedisModule_BlockClient
   * RedisModule_GetCurrentUserName
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>...</strong>: The actual arguments to the Redis command.</p>
</li>
</ul>
<p>On success a <code>RedisModuleCallReply</code> object is returned, otherwise
NULL is returned and errno is set to the following values:</p>
<ul>
<li>EBADF: wrong format specifier.</li>
<li>EINVAL: wrong command arity.</li>
<li>ENOENT: command does not exist.</li>
<li>EPERM: operation in Cluster instance with key in non local slot.</li>
<li>EROFS: operation in Cluster instance when a write command is sent
in a readonly state.</li>
<li>ENETDOWN: operation in Cluster instance when cluster is down.</li>
<li>ENOTSUP: No ACL user for the specified module context</li>
<li>EACCES: Command cannot be executed, according to ACL rules</li>
<li>ENOSPC: Write or deny-oom command is not allowed</li>
<li>ESPIPE: Command not allowed on script mode</li>
</ul>
<p>Example code fragment:</p>
<pre><code> reply = RedisModule_Call(ctx,"INCRBY","sc",argv[1],"10");
 if (RedisModule_CallReplyType(reply) == REDISMODULE_REPLY_INTEGER) {
   long long myval = RedisModule_CallReplyInteger(reply);
   // Do something with myval.
 }
</code></pre>
<p>This API is documented here: <a href="../modules.html">https://redis.io/topics/modules-intro</a></p>
<p><span id="RedisModule_CallReplyProto"></span></p>
<h3 id="redismodule_callreplyproto"><code>RedisModule_CallReplyProto</code></h3>
<pre><code>const char *RedisModule_CallReplyProto(RedisModuleCallReply *reply,
                                       size_t *len);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return a pointer, and a length, to the protocol returned by the command
that returned the reply object.</p>
<p><span id="section-modules-data-types"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Modules%20data%20types"></a><h2 id="modules-data-types">Modules data types</h2>
<p>When String DMA or using existing data structures is not enough, it is
possible to create new data types from scratch and export them to
Redis. The module must provide a set of callbacks for handling the
new values exported (for example in order to provide RDB saving/loading,
AOF rewrite, and so forth). In this section we define this API.</p>
<p><span id="RedisModule_CreateDataType"></span></p>
<h3 id="redismodule_createdatatype"><code>RedisModule_CreateDataType</code></h3>
<pre><code>moduleType *RedisModule_CreateDataType(RedisModuleCtx *ctx,
                                       const char *name,
                                       int encver,
                                       void *typemethods_ptr);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Register a new data type exported by the module. The parameters are the
following. Please for in depth documentation check the modules API
documentation, especially <a href="./modules-native-types.html">https://redis.io/topics/modules-native-types</a>.</p>
<ul>
<li>
<p><strong>name</strong>: A 9 characters data type name that MUST be unique in the Redis
Modules ecosystem. Be creative... and there will be no collisions. Use
the charset A-Z a-z 9-0, plus the two "-_" characters. A good
idea is to use, for example <code>&lt;typename&gt;-&lt;vendor&gt;</code>. For example
"tree-AntZ" may mean "Tree data structure by @antirez". To use both
lower case and upper case letters helps in order to prevent collisions.</p>
</li>
<li>
<p><strong>encver</strong>: Encoding version, which is, the version of the serialization
that a module used in order to persist data. As long as the "name"
matches, the RDB loading will be dispatched to the type callbacks
whatever 'encver' is used, however the module can understand if
the encoding it must load are of an older version of the module.
For example the module "tree-AntZ" initially used encver=0. Later
after an upgrade, it started to serialize data in a different format
and to register the type with encver=1. However this module may
still load old data produced by an older version if the <code>rdb_load</code>
callback is able to check the encver value and act accordingly.
The encver must be a positive value between 0 and 1023.</p>
</li>
<li>
<p><strong>typemethods_ptr</strong> is a pointer to a <code>RedisModuleTypeMethods</code> structure
that should be populated with the methods callbacks and structure
version, like in the following example:</p>
<pre><code>  RedisModuleTypeMethods tm = {
      .version = REDISMODULE_TYPE_METHOD_VERSION,
      .rdb_load = myType_RDBLoadCallBack,
      .rdb_save = myType_RDBSaveCallBack,
      .aof_rewrite = myType_AOFRewriteCallBack,
      .free = myType_FreeCallBack,

      // Optional fields
      .digest = myType_DigestCallBack,
      .mem_usage = myType_MemUsageCallBack,
      .aux_load = myType_AuxRDBLoadCallBack,
      .aux_save = myType_AuxRDBSaveCallBack,
      .free_effort = myType_FreeEffortCallBack,
      .unlink = myType_UnlinkCallBack,
      .copy = myType_CopyCallback,
      .defrag = myType_DefragCallback

      // Enhanced optional fields
      .mem_usage2 = myType_MemUsageCallBack2,
      .free_effort2 = myType_FreeEffortCallBack2,
      .unlink2 = myType_UnlinkCallBack2,
      .copy2 = myType_CopyCallback2,
  }
</code></pre>
</li>
<li>
<p><strong>rdb_load</strong>: A callback function pointer that loads data from RDB files.</p>
</li>
<li>
<p><strong>rdb_save</strong>: A callback function pointer that saves data to RDB files.</p>
</li>
<li>
<p><strong>aof_rewrite</strong>: A callback function pointer that rewrites data as commands.</p>
</li>
<li>
<p><strong>digest</strong>: A callback function pointer that is used for <code>DEBUG DIGEST</code>.</p>
</li>
<li>
<p><strong>free</strong>: A callback function pointer that can free a type value.</p>
</li>
<li>
<p><strong>aux_save</strong>: A callback function pointer that saves out of keyspace data to RDB files.
'when' argument is either <code>REDISMODULE_AUX_BEFORE_RDB</code> or <code>REDISMODULE_AUX_AFTER_RDB</code>.</p>
</li>
<li>
<p><strong>aux_load</strong>: A callback function pointer that loads out of keyspace data from RDB files.
Similar to <code>aux_save</code>, returns <code>REDISMODULE_OK</code> on success, and ERR otherwise.</p>
</li>
<li>
<p><strong>free_effort</strong>: A callback function pointer that used to determine whether the module's
memory needs to be lazy reclaimed. The module should return the complexity involved by
freeing the value. for example: how many pointers are gonna be freed. Note that if it
returns 0, we'll always do an async free.</p>
</li>
<li>
<p><strong>unlink</strong>: A callback function pointer that used to notifies the module that the key has
been removed from the DB by redis, and may soon be freed by a background thread. Note that
it won't be called on FLUSHALL/FLUSHDB (both sync and async), and the module can use the
<code>RedisModuleEvent_FlushDB</code> to hook into that.</p>
</li>
<li>
<p><strong>copy</strong>: A callback function pointer that is used to make a copy of the specified key.
The module is expected to perform a deep copy of the specified value and return it.
In addition, hints about the names of the source and destination keys is provided.
A NULL return value is considered an error and the copy operation fails.
Note: if the target key exists and is being overwritten, the copy callback will be
called first, followed by a free callback to the value that is being replaced.</p>
</li>
<li>
<p><strong>defrag</strong>: A callback function pointer that is used to request the module to defrag
a key. The module should then iterate pointers and call the relevant <code>RedisModule_Defrag*()</code>
functions to defragment pointers or complex types. The module should continue
iterating as long as <a href="#RedisModule_DefragShouldStop"><code>RedisModule_DefragShouldStop()</code></a> returns a zero value, and return a
zero value if finished or non-zero value if more work is left to be done. If more work
needs to be done, <a href="#RedisModule_DefragCursorSet"><code>RedisModule_DefragCursorSet()</code></a> and <a href="#RedisModule_DefragCursorGet"><code>RedisModule_DefragCursorGet()</code></a> can be used to track
this work across different calls.
Normally, the defrag mechanism invokes the callback without a time limit, so
<a href="#RedisModule_DefragShouldStop"><code>RedisModule_DefragShouldStop()</code></a> always returns zero. The "late defrag" mechanism which has
a time limit and provides cursor support is used only for keys that are determined
to have significant internal complexity. To determine this, the defrag mechanism
uses the <code>free_effort</code> callback and the 'active-defrag-max-scan-fields' config directive.
NOTE: The value is passed as a <code>void**</code> and the function is expected to update the
pointer if the top-level value pointer is defragmented and consequently changes.</p>
</li>
<li>
<p><strong>mem_usage2</strong>: Similar to <code>mem_usage</code>, but provides the <code>RedisModuleKeyOptCtx</code> parameter
so that meta information such as key name and db id can be obtained, and
the <code>sample_size</code> for size estimation (see MEMORY USAGE command).</p>
</li>
<li>
<p><strong>free_effort2</strong>: Similar to <code>free_effort</code>, but provides the <code>RedisModuleKeyOptCtx</code> parameter
so that meta information such as key name and db id can be obtained.</p>
</li>
<li>
<p><strong>unlink2</strong>: Similar to <code>unlink</code>, but provides the <code>RedisModuleKeyOptCtx</code> parameter
so that meta information such as key name and db id can be obtained.</p>
</li>
<li>
<p><strong>copy2</strong>: Similar to <code>copy</code>, but provides the <code>RedisModuleKeyOptCtx</code> parameter
so that meta information such as key names and db ids can be obtained.</p>
</li>
<li>
<p><strong>aux_save2</strong>: Similar to <code>aux_save</code>, but with small semantic change, if the module
saves nothing on this callback then no data about this aux field will be written to the
RDB and it will be possible to load the RDB even if the module is not loaded.</p>
</li>
</ul>
<p>Note: the module name "AAAAAAAAA" is reserved and produces an error, it
happens to be pretty lame as well.</p>
<p>If <a href="#RedisModule_CreateDataType"><code>RedisModule_CreateDataType()</code></a> is called outside of <code>RedisModule_OnLoad()</code> function,
there is already a module registering a type with the same name,
or if the module name or encver is invalid, NULL is returned.
Otherwise the new type is registered into Redis, and a reference of
type <code>RedisModuleType</code> is returned: the caller of the function should store
this reference into a global variable to make future use of it in the
modules type API, since a single module may register multiple types.
Example code fragment:</p>
<pre><code> static RedisModuleType *BalancedTreeType;

 int RedisModule_OnLoad(RedisModuleCtx *ctx) {
     // some code here ...
     BalancedTreeType = RedisModule_CreateDataType(...);
 }
</code></pre>
<p><span id="RedisModule_ModuleTypeSetValue"></span></p>
<h3 id="redismodule_moduletypesetvalue"><code>RedisModule_ModuleTypeSetValue</code></h3>
<pre><code>int RedisModule_ModuleTypeSetValue(RedisModuleKey *key,
                                   moduleType *mt,
                                   void *value);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>If the key is open for writing, set the specified module type object
as the value of the key, deleting the old value if any.
On success <code>REDISMODULE_OK</code> is returned. If the key is not open for
writing or there is an active iterator, <code>REDISMODULE_ERR</code> is returned.</p>
<p><span id="RedisModule_ModuleTypeGetType"></span></p>
<h3 id="redismodule_moduletypegettype"><code>RedisModule_ModuleTypeGetType</code></h3>
<pre><code>moduleType *RedisModule_ModuleTypeGetType(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Assuming <a href="#RedisModule_KeyType"><code>RedisModule_KeyType()</code></a> returned <code>REDISMODULE_KEYTYPE_MODULE</code> on
the key, returns the module type pointer of the value stored at key.</p>
<p>If the key is NULL, is not associated with a module type, or is empty,
then NULL is returned instead.</p>
<p><span id="RedisModule_ModuleTypeGetValue"></span></p>
<h3 id="redismodule_moduletypegetvalue"><code>RedisModule_ModuleTypeGetValue</code></h3>
<pre><code>void *RedisModule_ModuleTypeGetValue(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Assuming <a href="#RedisModule_KeyType"><code>RedisModule_KeyType()</code></a> returned <code>REDISMODULE_KEYTYPE_MODULE</code> on
the key, returns the module type low-level value stored at key, as
it was set by the user via <a href="#RedisModule_ModuleTypeSetValue"><code>RedisModule_ModuleTypeSetValue()</code></a>.</p>
<p>If the key is NULL, is not associated with a module type, or is empty,
then NULL is returned instead.</p>
<p><span id="section-rdb-loading-and-saving-functions"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/RDB%20loading%20and%20saving%20functions"></a><h2 id="rdb-loading-and-saving-functions">RDB loading and saving functions</h2>
<p><span id="RedisModule_IsIOError"></span></p>
<h3 id="redismodule_isioerror"><code>RedisModule_IsIOError</code></h3>
<pre><code>int RedisModule_IsIOError(RedisModuleIO *io);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Returns true if any previous IO API failed.
for <code>Load*</code> APIs the <code>REDISMODULE_OPTIONS_HANDLE_IO_ERRORS</code> flag must be set with
<a href="#RedisModule_SetModuleOptions"><code>RedisModule_SetModuleOptions</code></a> first.</p>
<p><span id="RedisModule_SaveUnsigned"></span></p>
<h3 id="redismodule_saveunsigned"><code>RedisModule_SaveUnsigned</code></h3>
<pre><code>void RedisModule_SaveUnsigned(RedisModuleIO *io, uint64_t value);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Save an unsigned 64 bit value into the RDB file. This function should only
be called in the context of the <code>rdb_save</code> method of modules implementing new
data types.</p>
<p><span id="RedisModule_LoadUnsigned"></span></p>
<h3 id="redismodule_loadunsigned"><code>RedisModule_LoadUnsigned</code></h3>
<pre><code>uint64_t RedisModule_LoadUnsigned(RedisModuleIO *io);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Load an unsigned 64 bit value from the RDB file. This function should only
be called in the context of the <code>rdb_load</code> method of modules implementing
new data types.</p>
<p><span id="RedisModule_SaveSigned"></span></p>
<h3 id="redismodule_savesigned"><code>RedisModule_SaveSigned</code></h3>
<pre><code>void RedisModule_SaveSigned(RedisModuleIO *io, int64_t value);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Like <a href="#RedisModule_SaveUnsigned"><code>RedisModule_SaveUnsigned()</code></a> but for signed 64 bit values.</p>
<p><span id="RedisModule_LoadSigned"></span></p>
<h3 id="redismodule_loadsigned"><code>RedisModule_LoadSigned</code></h3>
<pre><code>int64_t RedisModule_LoadSigned(RedisModuleIO *io);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Like <a href="#RedisModule_LoadUnsigned"><code>RedisModule_LoadUnsigned()</code></a> but for signed 64 bit values.</p>
<p><span id="RedisModule_SaveString"></span></p>
<h3 id="redismodule_savestring"><code>RedisModule_SaveString</code></h3>
<pre><code>void RedisModule_SaveString(RedisModuleIO *io, RedisModuleString *s);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>In the context of the <code>rdb_save</code> method of a module type, saves a
string into the RDB file taking as input a <code>RedisModuleString</code>.</p>
<p>The string can be later loaded with <a href="#RedisModule_LoadString"><code>RedisModule_LoadString()</code></a> or
other Load family functions expecting a serialized string inside
the RDB file.</p>
<p><span id="RedisModule_SaveStringBuffer"></span></p>
<h3 id="redismodule_savestringbuffer"><code>RedisModule_SaveStringBuffer</code></h3>
<pre><code>void RedisModule_SaveStringBuffer(RedisModuleIO *io,
                                  const char *str,
                                  size_t len);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Like <a href="#RedisModule_SaveString"><code>RedisModule_SaveString()</code></a> but takes a raw C pointer and length
as input.</p>
<p><span id="RedisModule_LoadString"></span></p>
<h3 id="redismodule_loadstring"><code>RedisModule_LoadString</code></h3>
<pre><code>RedisModuleString *RedisModule_LoadString(RedisModuleIO *io);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>In the context of the <code>rdb_load</code> method of a module data type, loads a string
from the RDB file, that was previously saved with <a href="#RedisModule_SaveString"><code>RedisModule_SaveString()</code></a>
functions family.</p>
<p>The returned string is a newly allocated <code>RedisModuleString</code> object, and
the user should at some point free it with a call to <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a>.</p>
<p>If the data structure does not store strings as <code>RedisModuleString</code> objects,
the similar function <a href="#RedisModule_LoadStringBuffer"><code>RedisModule_LoadStringBuffer()</code></a> could be used instead.</p>
<p><span id="RedisModule_LoadStringBuffer"></span></p>
<h3 id="redismodule_loadstringbuffer"><code>RedisModule_LoadStringBuffer</code></h3>
<pre><code>char *RedisModule_LoadStringBuffer(RedisModuleIO *io, size_t *lenptr);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Like <a href="#RedisModule_LoadString"><code>RedisModule_LoadString()</code></a> but returns a heap allocated string that
was allocated with <a href="#RedisModule_Alloc"><code>RedisModule_Alloc()</code></a>, and can be resized or freed with
<a href="#RedisModule_Realloc"><code>RedisModule_Realloc()</code></a> or <a href="#RedisModule_Free"><code>RedisModule_Free()</code></a>.</p>
<p>The size of the string is stored at '*lenptr' if not NULL.
The returned string is not automatically NULL terminated, it is loaded
exactly as it was stored inside the RDB file.</p>
<p><span id="RedisModule_SaveDouble"></span></p>
<h3 id="redismodule_savedouble"><code>RedisModule_SaveDouble</code></h3>
<pre><code>void RedisModule_SaveDouble(RedisModuleIO *io, double value);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>In the context of the <code>rdb_save</code> method of a module data type, saves a double
value to the RDB file. The double can be a valid number, a NaN or infinity.
It is possible to load back the value with <a href="#RedisModule_LoadDouble"><code>RedisModule_LoadDouble()</code></a>.</p>
<p><span id="RedisModule_LoadDouble"></span></p>
<h3 id="redismodule_loaddouble"><code>RedisModule_LoadDouble</code></h3>
<pre><code>double RedisModule_LoadDouble(RedisModuleIO *io);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>In the context of the <code>rdb_save</code> method of a module data type, loads back the
double value saved by <a href="#RedisModule_SaveDouble"><code>RedisModule_SaveDouble()</code></a>.</p>
<p><span id="RedisModule_SaveFloat"></span></p>
<h3 id="redismodule_savefloat"><code>RedisModule_SaveFloat</code></h3>
<pre><code>void RedisModule_SaveFloat(RedisModuleIO *io, float value);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>In the context of the <code>rdb_save</code> method of a module data type, saves a float
value to the RDB file. The float can be a valid number, a NaN or infinity.
It is possible to load back the value with <a href="#RedisModule_LoadFloat"><code>RedisModule_LoadFloat()</code></a>.</p>
<p><span id="RedisModule_LoadFloat"></span></p>
<h3 id="redismodule_loadfloat"><code>RedisModule_LoadFloat</code></h3>
<pre><code>float RedisModule_LoadFloat(RedisModuleIO *io);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>In the context of the <code>rdb_save</code> method of a module data type, loads back the
float value saved by <a href="#RedisModule_SaveFloat"><code>RedisModule_SaveFloat()</code></a>.</p>
<p><span id="RedisModule_SaveLongDouble"></span></p>
<h3 id="redismodule_savelongdouble"><code>RedisModule_SaveLongDouble</code></h3>
<pre><code>void RedisModule_SaveLongDouble(RedisModuleIO *io, long double value);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>In the context of the <code>rdb_save</code> method of a module data type, saves a long double
value to the RDB file. The double can be a valid number, a NaN or infinity.
It is possible to load back the value with <a href="#RedisModule_LoadLongDouble"><code>RedisModule_LoadLongDouble()</code></a>.</p>
<p><span id="RedisModule_LoadLongDouble"></span></p>
<h3 id="redismodule_loadlongdouble"><code>RedisModule_LoadLongDouble</code></h3>
<pre><code>long double RedisModule_LoadLongDouble(RedisModuleIO *io);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>In the context of the <code>rdb_save</code> method of a module data type, loads back the
long double value saved by <a href="#RedisModule_SaveLongDouble"><code>RedisModule_SaveLongDouble()</code></a>.</p>
<p><span id="section-key-digest-api-debug-digest-interface-for-modules-types"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Key%20digest%20API%20%28DEBUG%20DIGEST%20interface%20for%20modules%20types%29"></a><h2 id="key-digest-api-debug-digest-interface-for-modules-types">Key digest API (DEBUG DIGEST interface for modules types)</h2>
<p><span id="RedisModule_DigestAddStringBuffer"></span></p>
<h3 id="redismodule_digestaddstringbuffer"><code>RedisModule_DigestAddStringBuffer</code></h3>
<pre><code>void RedisModule_DigestAddStringBuffer(RedisModuleDigest *md,
                                       const char *ele,
                                       size_t len);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Add a new element to the digest. This function can be called multiple times
one element after the other, for all the elements that constitute a given
data structure. The function call must be followed by the call to
<a href="#RedisModule_DigestEndSequence"><code>RedisModule_DigestEndSequence</code></a> eventually, when all the elements that are
always in a given order are added. See the Redis Modules data types
documentation for more info. However this is a quick example that uses Redis
data types as an example.</p>
<p>To add a sequence of unordered elements (for example in the case of a Redis
Set), the pattern to use is:</p>
<pre><code>foreach element {
    AddElement(element);
    EndSequence();
}
</code></pre>
<p>Because Sets are not ordered, so every element added has a position that
does not depend from the other. However if instead our elements are
ordered in pairs, like field-value pairs of a Hash, then one should
use:</p>
<pre><code>foreach key,value {
    AddElement(key);
    AddElement(value);
    EndSequence();
}
</code></pre>
<p>Because the key and value will be always in the above order, while instead
the single key-value pairs, can appear in any position into a Redis hash.</p>
<p>A list of ordered elements would be implemented with:</p>
<pre><code>foreach element {
    AddElement(element);
}
EndSequence();
</code></pre>
<p><span id="RedisModule_DigestAddLongLong"></span></p>
<h3 id="redismodule_digestaddlonglong"><code>RedisModule_DigestAddLongLong</code></h3>
<pre><code>void RedisModule_DigestAddLongLong(RedisModuleDigest *md, long long ll);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Like <a href="#RedisModule_DigestAddStringBuffer"><code>RedisModule_DigestAddStringBuffer()</code></a> but takes a <code>long long</code> as input
that gets converted into a string before adding it to the digest.</p>
<p><span id="RedisModule_DigestEndSequence"></span></p>
<h3 id="redismodule_digestendsequence"><code>RedisModule_DigestEndSequence</code></h3>
<pre><code>void RedisModule_DigestEndSequence(RedisModuleDigest *md);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>See the documentation for <code>RedisModule_DigestAddElement()</code>.</p>
<p><span id="RedisModule_LoadDataTypeFromStringEncver"></span></p>
<h3 id="redismodule_loaddatatypefromstringencver"><code>RedisModule_LoadDataTypeFromStringEncver</code></h3>
<pre><code>void *RedisModule_LoadDataTypeFromStringEncver(const RedisModuleString *str,
                                               const moduleType *mt,
                                               int encver);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Decode a serialized representation of a module data type 'mt', in a specific encoding version 'encver'
from string 'str' and return a newly allocated value, or NULL if decoding failed.</p>
<p>This call basically reuses the '<code>rdb_load</code>' callback which module data types
implement in order to allow a module to arbitrarily serialize/de-serialize
keys, similar to how the Redis 'DUMP' and 'RESTORE' commands are implemented.</p>
<p>Modules should generally use the <code>REDISMODULE_OPTIONS_HANDLE_IO_ERRORS</code> flag and
make sure the de-serialization code properly checks and handles IO errors
(freeing allocated buffers and returning a NULL).</p>
<p>If this is NOT done, Redis will handle corrupted (or just truncated) serialized
data by producing an error message and terminating the process.</p>
<p><span id="RedisModule_LoadDataTypeFromString"></span></p>
<h3 id="redismodule_loaddatatypefromstring"><code>RedisModule_LoadDataTypeFromString</code></h3>
<pre><code>void *RedisModule_LoadDataTypeFromString(const RedisModuleString *str,
                                         const moduleType *mt);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Similar to <a href="#RedisModule_LoadDataTypeFromStringEncver"><code>RedisModule_LoadDataTypeFromStringEncver</code></a>, original version of the API, kept
for backward compatibility.</p>
<p><span id="RedisModule_SaveDataTypeToString"></span></p>
<h3 id="redismodule_savedatatypetostring"><code>RedisModule_SaveDataTypeToString</code></h3>
<pre><code>RedisModuleString *RedisModule_SaveDataTypeToString(RedisModuleCtx *ctx,
                                                    void *data,
                                                    const moduleType *mt);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Encode a module data type 'mt' value 'data' into serialized form, and return it
as a newly allocated <code>RedisModuleString</code>.</p>
<p>This call basically reuses the '<code>rdb_save</code>' callback which module data types
implement in order to allow a module to arbitrarily serialize/de-serialize
keys, similar to how the Redis 'DUMP' and 'RESTORE' commands are implemented.</p>
<p><span id="RedisModule_GetKeyNameFromDigest"></span></p>
<h3 id="redismodule_getkeynamefromdigest"><code>RedisModule_GetKeyNameFromDigest</code></h3>
<pre><code>const RedisModuleString *RedisModule_GetKeyNameFromDigest(RedisModuleDigest *dig);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Returns the name of the key currently being processed.</p>
<p><span id="RedisModule_GetDbIdFromDigest"></span></p>
<h3 id="redismodule_getdbidfromdigest"><code>RedisModule_GetDbIdFromDigest</code></h3>
<pre><code>int RedisModule_GetDbIdFromDigest(RedisModuleDigest *dig);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Returns the database id of the key currently being processed.</p>
<p><span id="section-aof-api-for-modules-data-types"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/AOF%20API%20for%20modules%20data%20types"></a><h2 id="aof-api-for-modules-data-types">AOF API for modules data types</h2>
<p><span id="RedisModule_EmitAOF"></span></p>
<h3 id="redismodule_emitaof"><code>RedisModule_EmitAOF</code></h3>
<pre><code>void RedisModule_EmitAOF(RedisModuleIO *io,
                         const char *cmdname,
                         const char *fmt,
                         ...);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Emits a command into the AOF during the AOF rewriting process. This function
is only called in the context of the <code>aof_rewrite</code> method of data types exported
by a module. The command works exactly like <a href="#RedisModule_Call"><code>RedisModule_Call()</code></a> in the way
the parameters are passed, but it does not return anything as the error
handling is performed by Redis itself.</p>
<p><span id="section-io-context-handling"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/IO%20context%20handling"></a><h2 id="io-context-handling">IO context handling</h2>
<p><span id="RedisModule_GetKeyNameFromIO"></span></p>
<h3 id="redismodule_getkeynamefromio"><code>RedisModule_GetKeyNameFromIO</code></h3>
<pre><code>const RedisModuleString *RedisModule_GetKeyNameFromIO(RedisModuleIO *io);
</code></pre>
<p><strong>Available since:</strong> 5.0.5</p>
<p>Returns the name of the key currently being processed.
There is no guarantee that the key name is always available, so this may return NULL.</p>
<p><span id="RedisModule_GetKeyNameFromModuleKey"></span></p>
<h3 id="redismodule_getkeynamefrommodulekey"><code>RedisModule_GetKeyNameFromModuleKey</code></h3>
<pre><code>const RedisModuleString *RedisModule_GetKeyNameFromModuleKey(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Returns a <code>RedisModuleString</code> with the name of the key from <code>RedisModuleKey</code>.</p>
<p><span id="RedisModule_GetDbIdFromModuleKey"></span></p>
<h3 id="redismodule_getdbidfrommodulekey"><code>RedisModule_GetDbIdFromModuleKey</code></h3>
<pre><code>int RedisModule_GetDbIdFromModuleKey(RedisModuleKey *key);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Returns a database id of the key from <code>RedisModuleKey</code>.</p>
<p><span id="RedisModule_GetDbIdFromIO"></span></p>
<h3 id="redismodule_getdbidfromio"><code>RedisModule_GetDbIdFromIO</code></h3>
<pre><code>int RedisModule_GetDbIdFromIO(RedisModuleIO *io);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Returns the database id of the key currently being processed.
There is no guarantee that this info is always available, so this may return -1.</p>
<p><span id="section-logging"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Logging"></a><h2 id="logging">Logging</h2>
<p><span id="RedisModule_Log"></span></p>
<h3 id="redismodule_log"><code>RedisModule_Log</code></h3>
<pre><code>void RedisModule_Log(RedisModuleCtx *ctx,
                     const char *levelstr,
                     const char *fmt,
                     ...);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Produces a log message to the standard Redis log, the format accepts
printf-alike specifiers, while level is a string describing the log
level to use when emitting the log, and must be one of the following:</p>
<ul>
<li>"debug" (<code>REDISMODULE_LOGLEVEL_DEBUG</code>)</li>
<li>"verbose" (<code>REDISMODULE_LOGLEVEL_VERBOSE</code>)</li>
<li>"notice" (<code>REDISMODULE_LOGLEVEL_NOTICE</code>)</li>
<li>"warning" (<code>REDISMODULE_LOGLEVEL_WARNING</code>)</li>
</ul>
<p>If the specified log level is invalid, verbose is used by default.
There is a fixed limit to the length of the log line this function is able
to emit, this limit is not specified but is guaranteed to be more than
a few lines of text.</p>
<p>The ctx argument may be NULL if cannot be provided in the context of the
caller for instance threads or callbacks, in which case a generic "module"
will be used instead of the module name.</p>
<p><span id="RedisModule_LogIOError"></span></p>
<h3 id="redismodule_logioerror"><code>RedisModule_LogIOError</code></h3>
<pre><code>void RedisModule_LogIOError(RedisModuleIO *io,
                            const char *levelstr,
                            const char *fmt,
                            ...);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Log errors from RDB / AOF serialization callbacks.</p>
<p>This function should be used when a callback is returning a critical
error to the caller since cannot load or save the data for some
critical reason.</p>
<p><span id="RedisModule__Assert"></span></p>
<h3 id="redismodule__assert"><code>RedisModule__Assert</code></h3>
<pre><code>void RedisModule__Assert(const char *estr, const char *file, int line);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Redis-like assert function.</p>
<p>The macro <code>RedisModule_Assert(expression)</code> is recommended, rather than
calling this function directly.</p>
<p>A failed assertion will shut down the server and produce logging information
that looks identical to information generated by Redis itself.</p>
<p><span id="RedisModule_LatencyAddSample"></span></p>
<h3 id="redismodule_latencyaddsample"><code>RedisModule_LatencyAddSample</code></h3>
<pre><code>void RedisModule_LatencyAddSample(const char *event, mstime_t latency);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Allows adding event to the latency monitor to be observed by the LATENCY
command. The call is skipped if the latency is smaller than the configured
latency-monitor-threshold.</p>
<p><span id="section-blocking-clients-from-modules"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Blocking%20clients%20from%20modules"></a><h2 id="blocking-clients-from-modules">Blocking clients from modules</h2>
<p>For a guide about blocking commands in modules, see
<a href="./modules-blocking-ops.html">https://redis.io/topics/modules-blocking-ops</a>.</p>
<p><span id="RedisModule_RegisterAuthCallback"></span></p>
<h3 id="redismodule_registerauthcallback"><code>RedisModule_RegisterAuthCallback</code></h3>
<pre><code>void RedisModule_RegisterAuthCallback(RedisModuleCtx *ctx,
                                      RedisModuleAuthCallback cb);
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>This API registers a callback to execute in addition to normal password based authentication.
Multiple callbacks can be registered across different modules. When a Module is unloaded, all the
auth callbacks registered by it are unregistered.
The callbacks are attempted (in the order of most recently registered first) when the AUTH/HELLO
(with AUTH field provided) commands are called.
The callbacks will be called with a module context along with a username and a password, and are
expected to take one of the following actions:
(1) Authenticate - Use the <code>RedisModule_AuthenticateClient</code>* API and return <code>REDISMODULE_AUTH_HANDLED</code>.
This will immediately end the auth chain as successful and add the OK reply.
(2) Deny Authentication - Return <code>REDISMODULE_AUTH_HANDLED</code> without authenticating or blocking the
client. Optionally, <code>err</code> can be set to a custom error message and <code>err</code> will be automatically
freed by the server.
This will immediately end the auth chain as unsuccessful and add the ERR reply.
(3) Block a client on authentication - Use the <a href="#RedisModule_BlockClientOnAuth"><code>RedisModule_BlockClientOnAuth</code></a> API and return
<code>REDISMODULE_AUTH_HANDLED</code>. Here, the client will be blocked until the <a href="#RedisModule_UnblockClient"><code>RedisModule_UnblockClient</code></a> API is used
which will trigger the auth reply callback (provided through the <a href="#RedisModule_BlockClientOnAuth"><code>RedisModule_BlockClientOnAuth</code></a>).
In this reply callback, the Module should authenticate, deny or skip handling authentication.
(4) Skip handling Authentication - Return <code>REDISMODULE_AUTH_NOT_HANDLED</code> without blocking the
client. This will allow the engine to attempt the next module auth callback.
If none of the callbacks authenticate or deny auth, then password based auth is attempted and
will authenticate or add failure logs and reply to the clients accordingly.</p>
<p>Note: If a client is disconnected while it was in the middle of blocking module auth, that
occurrence of the AUTH or HELLO command will not be tracked in the INFO command stats.</p>
<p>The following is an example of how non-blocking module based authentication can be used:</p>
<pre><code> int auth_cb(RedisModuleCtx *ctx, RedisModuleString *username, RedisModuleString *password, RedisModuleString **err) {
     const char *user = RedisModule_StringPtrLen(username, NULL);
     const char *pwd = RedisModule_StringPtrLen(password, NULL);
     if (!strcmp(user,"foo") &amp;&amp; !strcmp(pwd,"valid_password")) {
         RedisModule_AuthenticateClientWithACLUser(ctx, "foo", 3, NULL, NULL, NULL);
         return REDISMODULE_AUTH_HANDLED;
     }

     else if (!strcmp(user,"foo") &amp;&amp; !strcmp(pwd,"wrong_password")) {
         RedisModuleString *log = RedisModule_CreateString(ctx, "Module Auth", 11);
         RedisModule_ACLAddLogEntryByUserName(ctx, username, log, REDISMODULE_ACL_LOG_AUTH);
         RedisModule_FreeString(ctx, log);
         const char *err_msg = "Auth denied by Misc Module.";
         *err = RedisModule_CreateString(ctx, err_msg, strlen(err_msg));
         return REDISMODULE_AUTH_HANDLED;
     }
     return REDISMODULE_AUTH_NOT_HANDLED;
  }

 int RedisModule_OnLoad(RedisModuleCtx *ctx, RedisModuleString **argv, int argc) {
     if (RedisModule_Init(ctx,"authmodule",1,REDISMODULE_APIVER_1)== REDISMODULE_ERR)
         return REDISMODULE_ERR;
     RedisModule_RegisterAuthCallback(ctx, auth_cb);
     return REDISMODULE_OK;
 }
</code></pre>
<p><span id="RedisModule_BlockClient"></span></p>
<h3 id="redismodule_blockclient"><code>RedisModule_BlockClient</code></h3>
<pre><code>RedisModuleBlockedClient *RedisModule_BlockClient(RedisModuleCtx *ctx,
                                                  RedisModuleCmdFunc reply_callback,
                                                  ;
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Block a client in the context of a blocking command, returning a handle
which will be used, later, in order to unblock the client with a call to
<a href="#RedisModule_UnblockClient"><code>RedisModule_UnblockClient()</code></a>. The arguments specify callback functions
and a timeout after which the client is unblocked.</p>
<p>The callbacks are called in the following contexts:</p>
<pre><code>reply_callback:   called after a successful RedisModule_UnblockClient()
                  call in order to reply to the client and unblock it.

timeout_callback: called when the timeout is reached or if [`CLIENT UNBLOCK`](/commands/client-unblock)
                  is invoked, in order to send an error to the client.

free_privdata:    called in order to free the private data that is passed
                  by RedisModule_UnblockClient() call.
</code></pre>
<p>Note: <a href="#RedisModule_UnblockClient"><code>RedisModule_UnblockClient</code></a> should be called for every blocked client,
even if client was killed, timed-out or disconnected. Failing to do so
will result in memory leaks.</p>
<p>There are some cases where <a href="#RedisModule_BlockClient"><code>RedisModule_BlockClient()</code></a> cannot be used:</p>
<ol>
<li>If the client is a Lua script.</li>
<li>If the client is executing a MULTI block.</li>
</ol>
<p>In these cases, a call to <a href="#RedisModule_BlockClient"><code>RedisModule_BlockClient()</code></a> will <strong>not</strong> block the
client, but instead produce a specific error reply.</p>
<p>A module that registers a <code>timeout_callback</code> function can also be unblocked
using the <a href="../../../commands/client-unblock.html"><code>CLIENT UNBLOCK</code></a> command, which will trigger the timeout callback.
If a callback function is not registered, then the blocked client will be
treated as if it is not in a blocked state and <a href="../../../commands/client-unblock.html"><code>CLIENT UNBLOCK</code></a> will return
a zero value.</p>
<p>Measuring background time: By default the time spent in the blocked command
is not account for the total command duration. To include such time you should
use <a href="#RedisModule_BlockedClientMeasureTimeStart"><code>RedisModule_BlockedClientMeasureTimeStart()</code></a> and <a href="#RedisModule_BlockedClientMeasureTimeEnd"><code>RedisModule_BlockedClientMeasureTimeEnd()</code></a> one,
or multiple times within the blocking command background work.</p>
<p><span id="RedisModule_BlockClientOnAuth"></span></p>
<h3 id="redismodule_blockclientonauth"><code>RedisModule_BlockClientOnAuth</code></h3>
<pre><code>RedisModuleBlockedClient *RedisModule_BlockClientOnAuth(RedisModuleCtx *ctx,
                                                        RedisModuleAuthCallback reply_callback,
                                                        ;
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>Block the current client for module authentication in the background. If module auth is not in
progress on the client, the API returns NULL. Otherwise, the client is blocked and the <code>RedisModule_BlockedClient</code>
is returned similar to the <a href="#RedisModule_BlockClient"><code>RedisModule_BlockClient</code></a> API.
Note: Only use this API from the context of a module auth callback.</p>
<p><span id="RedisModule_BlockClientGetPrivateData"></span></p>
<h3 id="redismodule_blockclientgetprivatedata"><code>RedisModule_BlockClientGetPrivateData</code></h3>
<pre><code>void *RedisModule_BlockClientGetPrivateData(RedisModuleBlockedClient *blocked_client);
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>Get the private data that was previusely set on a blocked client</p>
<p><span id="RedisModule_BlockClientSetPrivateData"></span></p>
<h3 id="redismodule_blockclientsetprivatedata"><code>RedisModule_BlockClientSetPrivateData</code></h3>
<pre><code>void RedisModule_BlockClientSetPrivateData(RedisModuleBlockedClient *blocked_client,
                                           void *private_data);
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>Set private data on a blocked client</p>
<p><span id="RedisModule_BlockClientOnKeys"></span></p>
<h3 id="redismodule_blockclientonkeys"><code>RedisModule_BlockClientOnKeys</code></h3>
<pre><code>RedisModuleBlockedClient *RedisModule_BlockClientOnKeys(RedisModuleCtx *ctx,
                                                        RedisModuleCmdFunc reply_callback,
                                                        ;
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>This call is similar to <a href="#RedisModule_BlockClient"><code>RedisModule_BlockClient()</code></a>, however in this case we
don't just block the client, but also ask Redis to unblock it automatically
once certain keys become "ready", that is, contain more data.</p>
<p>Basically this is similar to what a typical Redis command usually does,
like BLPOP or BZPOPMAX: the client blocks if it cannot be served ASAP,
and later when the key receives new data (a list push for instance), the
client is unblocked and served.</p>
<p>However in the case of this module API, when the client is unblocked?</p>
<ol>
<li>If you block on a key of a type that has blocking operations associated,
like a list, a sorted set, a stream, and so forth, the client may be
unblocked once the relevant key is targeted by an operation that normally
unblocks the native blocking operations for that type. So if we block
on a list key, an RPUSH command may unblock our client and so forth.</li>
<li>If you are implementing your native data type, or if you want to add new
unblocking conditions in addition to "1", you can call the modules API
<a href="#RedisModule_SignalKeyAsReady"><code>RedisModule_SignalKeyAsReady()</code></a>.</li>
</ol>
<p>Anyway we can't be sure if the client should be unblocked just because the
key is signaled as ready: for instance a successive operation may change the
key, or a client in queue before this one can be served, modifying the key
as well and making it empty again. So when a client is blocked with
<a href="#RedisModule_BlockClientOnKeys"><code>RedisModule_BlockClientOnKeys()</code></a> the reply callback is not called after
<a href="#RedisModule_UnblockClient"><code>RedisModule_UnblockClient()</code></a> is called, but every time a key is signaled as ready:
if the reply callback can serve the client, it returns <code>REDISMODULE_OK</code>
and the client is unblocked, otherwise it will return <code>REDISMODULE_ERR</code>
and we'll try again later.</p>
<p>The reply callback can access the key that was signaled as ready by
calling the API <a href="#RedisModule_GetBlockedClientReadyKey"><code>RedisModule_GetBlockedClientReadyKey()</code></a>, that returns
just the string name of the key as a <code>RedisModuleString</code> object.</p>
<p>Thanks to this system we can setup complex blocking scenarios, like
unblocking a client only if a list contains at least 5 items or other
more fancy logics.</p>
<p>Note that another difference with <a href="#RedisModule_BlockClient"><code>RedisModule_BlockClient()</code></a>, is that here
we pass the private data directly when blocking the client: it will
be accessible later in the reply callback. Normally when blocking with
<a href="#RedisModule_BlockClient"><code>RedisModule_BlockClient()</code></a> the private data to reply to the client is
passed when calling <a href="#RedisModule_UnblockClient"><code>RedisModule_UnblockClient()</code></a> but here the unblocking
is performed by Redis itself, so we need to have some private data before
hand. The private data is used to store any information about the specific
unblocking operation that you are implementing. Such information will be
freed using the <code>free_privdata</code> callback provided by the user.</p>
<p>However the reply callback will be able to access the argument vector of
the command, so the private data is often not needed.</p>
<p>Note: Under normal circumstances <a href="#RedisModule_UnblockClient"><code>RedisModule_UnblockClient</code></a> should not be
called for clients that are blocked on keys (Either the key will
become ready or a timeout will occur). If for some reason you do want
to call RedisModule_UnblockClient it is possible: Client will be
handled as if it were timed-out (You must implement the timeout
callback in that case).</p>
<p><span id="RedisModule_BlockClientOnKeysWithFlags"></span></p>
<h3 id="redismodule_blockclientonkeyswithflags"><code>RedisModule_BlockClientOnKeysWithFlags</code></h3>
<pre><code>RedisModuleBlockedClient *RedisModule_BlockClientOnKeysWithFlags(RedisModuleCtx *ctx,
                                                                 RedisModuleCmdFunc reply_callback,
                                                                 ;
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>Same as <a href="#RedisModule_BlockClientOnKeys"><code>RedisModule_BlockClientOnKeys</code></a>, but can take <code>REDISMODULE_BLOCK_</code>* flags
Can be either <code>REDISMODULE_BLOCK_UNBLOCK_DEFAULT</code>, which means default behavior (same
as calling <a href="#RedisModule_BlockClientOnKeys"><code>RedisModule_BlockClientOnKeys</code></a>)</p>
<p>The flags is a bit mask of these:</p>
<ul>
<li><code>REDISMODULE_BLOCK_UNBLOCK_DELETED</code>: The clients should to be awakened in case any of <code>keys</code> are deleted.
Mostly useful for commands that require the key to exist (like XREADGROUP)</li>
</ul>
<p><span id="RedisModule_SignalKeyAsReady"></span></p>
<h3 id="redismodule_signalkeyasready"><code>RedisModule_SignalKeyAsReady</code></h3>
<pre><code>void RedisModule_SignalKeyAsReady(RedisModuleCtx *ctx, RedisModuleString *key);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>This function is used in order to potentially unblock a client blocked
on keys with <a href="#RedisModule_BlockClientOnKeys"><code>RedisModule_BlockClientOnKeys()</code></a>. When this function is called,
all the clients blocked for this key will get their <code>reply_callback</code> called.</p>
<p><span id="RedisModule_UnblockClient"></span></p>
<h3 id="redismodule_unblockclient"><code>RedisModule_UnblockClient</code></h3>
<pre><code>int RedisModule_UnblockClient(RedisModuleBlockedClient *bc, void *privdata);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Unblock a client blocked by <code>RedisModule_BlockedClient</code>. This will trigger
the reply callbacks to be called in order to reply to the client.
The 'privdata' argument will be accessible by the reply callback, so
the caller of this function can pass any value that is needed in order to
actually reply to the client.</p>
<p>A common usage for 'privdata' is a thread that computes something that
needs to be passed to the client, included but not limited some slow
to compute reply or some reply obtained via networking.</p>
<p>Note 1: this function can be called from threads spawned by the module.</p>
<p>Note 2: when we unblock a client that is blocked for keys using the API
<a href="#RedisModule_BlockClientOnKeys"><code>RedisModule_BlockClientOnKeys()</code></a>, the privdata argument here is not used.
Unblocking a client that was blocked for keys using this API will still
require the client to get some reply, so the function will use the
"timeout" handler in order to do so (The privdata provided in
<a href="#RedisModule_BlockClientOnKeys"><code>RedisModule_BlockClientOnKeys()</code></a> is accessible from the timeout
callback via <a href="#RedisModule_GetBlockedClientPrivateData"><code>RedisModule_GetBlockedClientPrivateData</code></a>).</p>
<p><span id="RedisModule_AbortBlock"></span></p>
<h3 id="redismodule_abortblock"><code>RedisModule_AbortBlock</code></h3>
<pre><code>int RedisModule_AbortBlock(RedisModuleBlockedClient *bc);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Abort a blocked client blocking operation: the client will be unblocked
without firing any callback.</p>
<p><span id="RedisModule_SetDisconnectCallback"></span></p>
<h3 id="redismodule_setdisconnectcallback"><code>RedisModule_SetDisconnectCallback</code></h3>
<pre><code>void RedisModule_SetDisconnectCallback(RedisModuleBlockedClient *bc,
                                       RedisModuleDisconnectFunc callback);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Set a callback that will be called if a blocked client disconnects
before the module has a chance to call <a href="#RedisModule_UnblockClient"><code>RedisModule_UnblockClient()</code></a></p>
<p>Usually what you want to do there, is to cleanup your module state
so that you can call <a href="#RedisModule_UnblockClient"><code>RedisModule_UnblockClient()</code></a> safely, otherwise
the client will remain blocked forever if the timeout is large.</p>
<p>Notes:</p>
<ol>
<li>
<p>It is not safe to call Reply* family functions here, it is also
useless since the client is gone.</p>
</li>
<li>
<p>This callback is not called if the client disconnects because of
a timeout. In such a case, the client is unblocked automatically
and the timeout callback is called.</p>
</li>
</ol>
<p><span id="RedisModule_IsBlockedReplyRequest"></span></p>
<h3 id="redismodule_isblockedreplyrequest"><code>RedisModule_IsBlockedReplyRequest</code></h3>
<pre><code>int RedisModule_IsBlockedReplyRequest(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return non-zero if a module command was called in order to fill the
reply for a blocked client.</p>
<p><span id="RedisModule_IsBlockedTimeoutRequest"></span></p>
<h3 id="redismodule_isblockedtimeoutrequest"><code>RedisModule_IsBlockedTimeoutRequest</code></h3>
<pre><code>int RedisModule_IsBlockedTimeoutRequest(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return non-zero if a module command was called in order to fill the
reply for a blocked client that timed out.</p>
<p><span id="RedisModule_GetBlockedClientPrivateData"></span></p>
<h3 id="redismodule_getblockedclientprivatedata"><code>RedisModule_GetBlockedClientPrivateData</code></h3>
<pre><code>void *RedisModule_GetBlockedClientPrivateData(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Get the private data set by <a href="#RedisModule_UnblockClient"><code>RedisModule_UnblockClient()</code></a></p>
<p><span id="RedisModule_GetBlockedClientReadyKey"></span></p>
<h3 id="redismodule_getblockedclientreadykey"><code>RedisModule_GetBlockedClientReadyKey</code></h3>
<pre><code>RedisModuleString *RedisModule_GetBlockedClientReadyKey(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Get the key that is ready when the reply callback is called in the context
of a client blocked by <a href="#RedisModule_BlockClientOnKeys"><code>RedisModule_BlockClientOnKeys()</code></a>.</p>
<p><span id="RedisModule_GetBlockedClientHandle"></span></p>
<h3 id="redismodule_getblockedclienthandle"><code>RedisModule_GetBlockedClientHandle</code></h3>
<pre><code>RedisModuleBlockedClient *RedisModule_GetBlockedClientHandle(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Get the blocked client associated with a given context.
This is useful in the reply and timeout callbacks of blocked clients,
before sometimes the module has the blocked client handle references
around, and wants to cleanup it.</p>
<p><span id="RedisModule_BlockedClientDisconnected"></span></p>
<h3 id="redismodule_blockedclientdisconnected"><code>RedisModule_BlockedClientDisconnected</code></h3>
<pre><code>int RedisModule_BlockedClientDisconnected(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Return true if when the free callback of a blocked client is called,
the reason for the client to be unblocked is that it disconnected
while it was blocked.</p>
<p><span id="section-thread-safe-contexts"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Thread%20Safe%20Contexts"></a><h2 id="thread-safe-contexts">Thread Safe Contexts</h2>
<p><span id="RedisModule_GetThreadSafeContext"></span></p>
<h3 id="redismodule_getthreadsafecontext"><code>RedisModule_GetThreadSafeContext</code></h3>
<pre><code>RedisModuleCtx *RedisModule_GetThreadSafeContext(RedisModuleBlockedClient *bc);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Return a context which can be used inside threads to make Redis context
calls with certain modules APIs. If 'bc' is not NULL then the module will
be bound to a blocked client, and it will be possible to use the
<code>RedisModule_Reply*</code> family of functions to accumulate a reply for when the
client will be unblocked. Otherwise the thread safe context will be
detached by a specific client.</p>
<p>To call non-reply APIs, the thread safe context must be prepared with:</p>
<pre><code>RedisModule_ThreadSafeContextLock(ctx);
... make your call here ...
RedisModule_ThreadSafeContextUnlock(ctx);
</code></pre>
<p>This is not needed when using <code>RedisModule_Reply*</code> functions, assuming
that a blocked client was used when the context was created, otherwise
no <code>RedisModule_Reply</code>* call should be made at all.</p>
<p>NOTE: If you're creating a detached thread safe context (bc is NULL),
consider using <a href="#RedisModule_GetDetachedThreadSafeContext"><code>RedisModule_GetDetachedThreadSafeContext</code></a> which will also retain
the module ID and thus be more useful for logging.</p>
<p><span id="RedisModule_GetDetachedThreadSafeContext"></span></p>
<h3 id="redismodule_getdetachedthreadsafecontext"><code>RedisModule_GetDetachedThreadSafeContext</code></h3>
<pre><code>RedisModuleCtx *RedisModule_GetDetachedThreadSafeContext(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 6.0.9</p>
<p>Return a detached thread safe context that is not associated with any
specific blocked client, but is associated with the module's context.</p>
<p>This is useful for modules that wish to hold a global context over
a long term, for purposes such as logging.</p>
<p><span id="RedisModule_FreeThreadSafeContext"></span></p>
<h3 id="redismodule_freethreadsafecontext"><code>RedisModule_FreeThreadSafeContext</code></h3>
<pre><code>void RedisModule_FreeThreadSafeContext(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Release a thread safe context.</p>
<p><span id="RedisModule_ThreadSafeContextLock"></span></p>
<h3 id="redismodule_threadsafecontextlock"><code>RedisModule_ThreadSafeContextLock</code></h3>
<pre><code>void RedisModule_ThreadSafeContextLock(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Acquire the server lock before executing a thread safe API call.
This is not needed for <code>RedisModule_Reply*</code> calls when there is
a blocked client connected to the thread safe context.</p>
<p><span id="RedisModule_ThreadSafeContextTryLock"></span></p>
<h3 id="redismodule_threadsafecontexttrylock"><code>RedisModule_ThreadSafeContextTryLock</code></h3>
<pre><code>int RedisModule_ThreadSafeContextTryLock(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 6.0.8</p>
<p>Similar to <a href="#RedisModule_ThreadSafeContextLock"><code>RedisModule_ThreadSafeContextLock</code></a> but this function
would not block if the server lock is already acquired.</p>
<p>If successful (lock acquired) <code>REDISMODULE_OK</code> is returned,
otherwise <code>REDISMODULE_ERR</code> is returned and errno is set
accordingly.</p>
<p><span id="RedisModule_ThreadSafeContextUnlock"></span></p>
<h3 id="redismodule_threadsafecontextunlock"><code>RedisModule_ThreadSafeContextUnlock</code></h3>
<pre><code>void RedisModule_ThreadSafeContextUnlock(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 4.0.0</p>
<p>Release the server lock after a thread safe API call was executed.</p>
<p><span id="section-module-keyspace-notifications-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Module%20Keyspace%20Notifications%20API"></a><h2 id="module-keyspace-notifications-api">Module Keyspace Notifications API</h2>
<p><span id="RedisModule_SubscribeToKeyspaceEvents"></span></p>
<h3 id="redismodule_subscribetokeyspaceevents"><code>RedisModule_SubscribeToKeyspaceEvents</code></h3>
<pre><code>int RedisModule_SubscribeToKeyspaceEvents(RedisModuleCtx *ctx,
                                          int types,
                                          RedisModuleNotificationFunc callback);
</code></pre>
<p><strong>Available since:</strong> 4.0.9</p>
<p>Subscribe to keyspace notifications. This is a low-level version of the
keyspace-notifications API. A module can register callbacks to be notified
when keyspace events occur.</p>
<p>Notification events are filtered by their type (string events, set events,
etc), and the subscriber callback receives only events that match a specific
mask of event types.</p>
<p>When subscribing to notifications with <a href="#RedisModule_SubscribeToKeyspaceEvents"><code>RedisModule_SubscribeToKeyspaceEvents</code></a>
the module must provide an event type-mask, denoting the events the subscriber
is interested in. This can be an ORed mask of any of the following flags:</p>
<ul>
<li><code>REDISMODULE_NOTIFY_GENERIC</code>: Generic commands like DEL, EXPIRE, RENAME</li>
<li><code>REDISMODULE_NOTIFY_STRING</code>: String events</li>
<li><code>REDISMODULE_NOTIFY_LIST</code>: List events</li>
<li><code>REDISMODULE_NOTIFY_SET</code>: Set events</li>
<li><code>REDISMODULE_NOTIFY_HASH</code>: Hash events</li>
<li><code>REDISMODULE_NOTIFY_ZSET</code>: Sorted Set events</li>
<li><code>REDISMODULE_NOTIFY_EXPIRED</code>: Expiration events</li>
<li><code>REDISMODULE_NOTIFY_EVICTED</code>: Eviction events</li>
<li><code>REDISMODULE_NOTIFY_STREAM</code>: Stream events</li>
<li><code>REDISMODULE_NOTIFY_MODULE</code>: Module types events</li>
<li><code>REDISMODULE_NOTIFY_KEYMISS</code>: Key-miss events
Notice, key-miss event is the only type
of event that is fired from within a read command.
Performing RedisModule_Call with a write command from within
this notification is wrong and discourage. It will
cause the read command that trigger the event to be
replicated to the AOF/Replica.</li>
<li><code>REDISMODULE_NOTIFY_ALL</code>: All events (Excluding <code>REDISMODULE_NOTIFY_KEYMISS</code>)</li>
<li><code>REDISMODULE_NOTIFY_LOADED</code>: A special notification available only for modules,
indicates that the key was loaded from persistence.
Notice, when this event fires, the given key
can not be retained, use RedisModule_CreateStringFromString
instead.</li>
</ul>
<p>We do not distinguish between key events and keyspace events, and it is up
to the module to filter the actions taken based on the key.</p>
<p>The subscriber signature is:</p>
<pre><code>int (*RedisModuleNotificationFunc) (RedisModuleCtx *ctx, int type,
                                    const char *event,
                                    RedisModuleString *key);
</code></pre>
<p><code>type</code> is the event type bit, that must match the mask given at registration
time. The event string is the actual command being executed, and key is the
relevant Redis key.</p>
<p>Notification callback gets executed with a redis context that can not be
used to send anything to the client, and has the db number where the event
occurred as its selected db number.</p>
<p>Notice that it is not necessary to enable notifications in redis.conf for
module notifications to work.</p>
<p>Warning: the notification callbacks are performed in a synchronous manner,
so notification callbacks must to be fast, or they would slow Redis down.
If you need to take long actions, use threads to offload them.</p>
<p>Moreover, the fact that the notification is executed synchronously means
that the notification code will be executed in the middle on Redis logic
(commands logic, eviction, expire). Changing the key space while the logic
runs is dangerous and discouraged. In order to react to key space events with
write actions, please refer to <code>RedisModule_AddPostExecutionUnitJob</code>.</p>
<p>See <a href="../../manual/keyspace-notifications.html">https://redis.io/topics/notifications</a> for more information.</p>
<p><span id="RedisModule_AddPostNotificationJob"></span></p>
<h3 id="redismodule_addpostnotificationjob"><code>RedisModule_AddPostNotificationJob</code></h3>
<pre><code>int RedisModule_AddPostNotificationJob(RedisModuleCtx *ctx,
                                       RedisModulePostNotificationJobFunc callback,
                                       void *privdata,
                                       void (*free_privdata)(void*));
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>When running inside a key space notification callback, it is dangerous and highly discouraged to perform any write
operation (See <a href="#RedisModule_SubscribeToKeyspaceEvents"><code>RedisModule_SubscribeToKeyspaceEvents</code></a>). In order to still perform write actions in this scenario,
Redis provides <a href="#RedisModule_AddPostNotificationJob"><code>RedisModule_AddPostNotificationJob</code></a> API. The API allows to register a job callback which Redis will call
when the following condition are promised to be fulfilled:</p>
<ol>
<li>It is safe to perform any write operation.</li>
<li>The job will be called atomically along side the key space notification.</li>
</ol>
<p>Notice, one job might trigger key space notifications that will trigger more jobs.
This raises a concerns of entering an infinite loops, we consider infinite loops
as a logical bug that need to be fixed in the module, an attempt to protect against
infinite loops by halting the execution could result in violation of the feature correctness
and so Redis will make no attempt to protect the module from infinite loops.</p>
<p>'<code>free_pd</code>' can be NULL and in such case will not be used.</p>
<p><span id="RedisModule_GetNotifyKeyspaceEvents"></span></p>
<h3 id="redismodule_getnotifykeyspaceevents"><code>RedisModule_GetNotifyKeyspaceEvents</code></h3>
<pre><code>int RedisModule_GetNotifyKeyspaceEvents();
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Get the configured bitmap of notify-keyspace-events (Could be used
for additional filtering in <code>RedisModuleNotificationFunc</code>)</p>
<p><span id="RedisModule_NotifyKeyspaceEvent"></span></p>
<h3 id="redismodule_notifykeyspaceevent"><code>RedisModule_NotifyKeyspaceEvent</code></h3>
<pre><code>int RedisModule_NotifyKeyspaceEvent(RedisModuleCtx *ctx,
                                    int type,
                                    const char *event,
                                    RedisModuleString *key);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Expose notifyKeyspaceEvent to modules</p>
<p><span id="section-modules-cluster-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Modules%20Cluster%20API"></a><h2 id="modules-cluster-api">Modules Cluster API</h2>
<p><span id="RedisModule_RegisterClusterMessageReceiver"></span></p>
<h3 id="redismodule_registerclustermessagereceiver"><code>RedisModule_RegisterClusterMessageReceiver</code></h3>
<pre><code>void RedisModule_RegisterClusterMessageReceiver(RedisModuleCtx *ctx,
                                                uint8_t type,
                                                RedisModuleClusterMessageReceiver callback);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Register a callback receiver for cluster messages of type 'type'. If there
was already a registered callback, this will replace the callback function
with the one provided, otherwise if the callback is set to NULL and there
is already a callback for this function, the callback is unregistered
(so this API call is also used in order to delete the receiver).</p>
<p><span id="RedisModule_SendClusterMessage"></span></p>
<h3 id="redismodule_sendclustermessage"><code>RedisModule_SendClusterMessage</code></h3>
<pre><code>int RedisModule_SendClusterMessage(RedisModuleCtx *ctx,
                                   const char *target_id,
                                   uint8_t type,
                                   const char *msg,
                                   uint32_t len);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Send a message to all the nodes in the cluster if <code>target</code> is NULL, otherwise
at the specified target, which is a <code>REDISMODULE_NODE_ID_LEN</code> bytes node ID, as
returned by the receiver callback or by the nodes iteration functions.</p>
<p>The function returns <code>REDISMODULE_OK</code> if the message was successfully sent,
otherwise if the node is not connected or such node ID does not map to any
known cluster node, <code>REDISMODULE_ERR</code> is returned.</p>
<p><span id="RedisModule_GetClusterNodesList"></span></p>
<h3 id="redismodule_getclusternodeslist"><code>RedisModule_GetClusterNodesList</code></h3>
<pre><code>char **RedisModule_GetClusterNodesList(RedisModuleCtx *ctx, size_t *numnodes);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Return an array of string pointers, each string pointer points to a cluster
node ID of exactly <code>REDISMODULE_NODE_ID_LEN</code> bytes (without any null term).
The number of returned node IDs is stored into <code>*numnodes</code>.
However if this function is called by a module not running an a Redis
instance with Redis Cluster enabled, NULL is returned instead.</p>
<p>The IDs returned can be used with <a href="#RedisModule_GetClusterNodeInfo"><code>RedisModule_GetClusterNodeInfo()</code></a> in order
to get more information about single node.</p>
<p>The array returned by this function must be freed using the function
<a href="#RedisModule_FreeClusterNodesList"><code>RedisModule_FreeClusterNodesList()</code></a>.</p>
<p>Example:</p>
<pre><code>size_t count, j;
char **ids = RedisModule_GetClusterNodesList(ctx,&amp;count);
for (j = 0; j &lt; count; j++) {
    RedisModule_Log(ctx,"notice","Node %.*s",
        REDISMODULE_NODE_ID_LEN,ids[j]);
}
RedisModule_FreeClusterNodesList(ids);
</code></pre>
<p><span id="RedisModule_FreeClusterNodesList"></span></p>
<h3 id="redismodule_freeclusternodeslist"><code>RedisModule_FreeClusterNodesList</code></h3>
<pre><code>void RedisModule_FreeClusterNodesList(char **ids);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Free the node list obtained with <a href="#RedisModule_GetClusterNodesList"><code>RedisModule_GetClusterNodesList</code></a>.</p>
<p><span id="RedisModule_GetMyClusterID"></span></p>
<h3 id="redismodule_getmyclusterid"><code>RedisModule_GetMyClusterID</code></h3>
<pre><code>const char *RedisModule_GetMyClusterID(void);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Return this node ID (<code>REDISMODULE_CLUSTER_ID_LEN</code> bytes) or NULL if the cluster
is disabled.</p>
<p><span id="RedisModule_GetClusterSize"></span></p>
<h3 id="redismodule_getclustersize"><code>RedisModule_GetClusterSize</code></h3>
<pre><code>size_t RedisModule_GetClusterSize(void);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Return the number of nodes in the cluster, regardless of their state
(handshake, noaddress, ...) so that the number of active nodes may actually
be smaller, but not greater than this number. If the instance is not in
cluster mode, zero is returned.</p>
<p><span id="RedisModule_GetClusterNodeInfo"></span></p>
<h3 id="redismodule_getclusternodeinfo"><code>RedisModule_GetClusterNodeInfo</code></h3>
<pre><code>int RedisModule_GetClusterNodeInfo(RedisModuleCtx *ctx,
                                   const char *id,
                                   char *ip,
                                   char *master_id,
                                   int *port,
                                   int *flags);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Populate the specified info for the node having as ID the specified 'id',
then returns <code>REDISMODULE_OK</code>. Otherwise if the format of node ID is invalid
or the node ID does not exist from the POV of this local node, <code>REDISMODULE_ERR</code>
is returned.</p>
<p>The arguments <code>ip</code>, <code>master_id</code>, <code>port</code> and <code>flags</code> can be NULL in case we don't
need to populate back certain info. If an <code>ip</code> and <code>master_id</code> (only populated
if the instance is a slave) are specified, they point to buffers holding
at least <code>REDISMODULE_NODE_ID_LEN</code> bytes. The strings written back as <code>ip</code>
and <code>master_id</code> are not null terminated.</p>
<p>The list of flags reported is the following:</p>
<ul>
<li><code>REDISMODULE_NODE_MYSELF</code>:       This node</li>
<li><code>REDISMODULE_NODE_MASTER</code>:       The node is a master</li>
<li><code>REDISMODULE_NODE_SLAVE</code>:        The node is a replica</li>
<li><code>REDISMODULE_NODE_PFAIL</code>:        We see the node as failing</li>
<li><code>REDISMODULE_NODE_FAIL</code>:         The cluster agrees the node is failing</li>
<li><code>REDISMODULE_NODE_NOFAILOVER</code>:   The slave is configured to never failover</li>
</ul>
<p><span id="RedisModule_SetClusterFlags"></span></p>
<h3 id="redismodule_setclusterflags"><code>RedisModule_SetClusterFlags</code></h3>
<pre><code>void RedisModule_SetClusterFlags(RedisModuleCtx *ctx, uint64_t flags);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Set Redis Cluster flags in order to change the normal behavior of
Redis Cluster, especially with the goal of disabling certain functions.
This is useful for modules that use the Cluster API in order to create
a different distributed system, but still want to use the Redis Cluster
message bus. Flags that can be set:</p>
<ul>
<li><code>CLUSTER_MODULE_FLAG_NO_FAILOVER</code></li>
<li><code>CLUSTER_MODULE_FLAG_NO_REDIRECTION</code></li>
</ul>
<p>With the following effects:</p>
<ul>
<li>
<p><code>NO_FAILOVER</code>: prevent Redis Cluster slaves from failing over a dead master.
Also disables the replica migration feature.</p>
</li>
<li>
<p><code>NO_REDIRECTION</code>: Every node will accept any key, without trying to perform
partitioning according to the Redis Cluster algorithm.
Slots information will still be propagated across the
cluster, but without effect.</p>
</li>
</ul>
<p><span id="section-modules-timers-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Modules%20Timers%20API"></a><h2 id="modules-timers-api">Modules Timers API</h2>
<p>Module timers are a high precision "green timers" abstraction where
every module can register even millions of timers without problems, even if
the actual event loop will just have a single timer that is used to awake the
module timers subsystem in order to process the next event.</p>
<p>All the timers are stored into a radix tree, ordered by expire time, when
the main Redis event loop timer callback is called, we try to process all
the timers already expired one after the other. Then we re-enter the event
loop registering a timer that will expire when the next to process module
timer will expire.</p>
<p>Every time the list of active timers drops to zero, we unregister the
main event loop timer, so that there is no overhead when such feature is
not used.</p>
<p><span id="RedisModule_CreateTimer"></span></p>
<h3 id="redismodule_createtimer"><code>RedisModule_CreateTimer</code></h3>
<pre><code>RedisModuleTimerID RedisModule_CreateTimer(RedisModuleCtx *ctx,
                                           mstime_t period,
                                           RedisModuleTimerProc callback,
                                           void *data);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Create a new timer that will fire after <code>period</code> milliseconds, and will call
the specified function using <code>data</code> as argument. The returned timer ID can be
used to get information from the timer or to stop it before it fires.
Note that for the common use case of a repeating timer (Re-registration
of the timer inside the <code>RedisModuleTimerProc</code> callback) it matters when
this API is called:
If it is called at the beginning of 'callback' it means
the event will triggered every 'period'.
If it is called at the end of 'callback' it means
there will 'period' milliseconds gaps between events.
(If the time it takes to execute 'callback' is negligible the two
statements above mean the same)</p>
<p><span id="RedisModule_StopTimer"></span></p>
<h3 id="redismodule_stoptimer"><code>RedisModule_StopTimer</code></h3>
<pre><code>int RedisModule_StopTimer(RedisModuleCtx *ctx,
                          RedisModuleTimerID id,
                          void **data);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Stop a timer, returns <code>REDISMODULE_OK</code> if the timer was found, belonged to the
calling module, and was stopped, otherwise <code>REDISMODULE_ERR</code> is returned.
If not NULL, the data pointer is set to the value of the data argument when
the timer was created.</p>
<p><span id="RedisModule_GetTimerInfo"></span></p>
<h3 id="redismodule_gettimerinfo"><code>RedisModule_GetTimerInfo</code></h3>
<pre><code>int RedisModule_GetTimerInfo(RedisModuleCtx *ctx,
                             RedisModuleTimerID id,
                             uint64_t *remaining,
                             void **data);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Obtain information about a timer: its remaining time before firing
(in milliseconds), and the private data pointer associated with the timer.
If the timer specified does not exist or belongs to a different module
no information is returned and the function returns <code>REDISMODULE_ERR</code>, otherwise
<code>REDISMODULE_OK</code> is returned. The arguments remaining or data can be NULL if
the caller does not need certain information.</p>
<p><span id="section-modules-eventloop-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Modules%20EventLoop%20API"></a><h2 id="modules-eventloop-api">Modules EventLoop API</h2>
<p><span id="RedisModule_EventLoopAdd"></span></p>
<h3 id="redismodule_eventloopadd"><code>RedisModule_EventLoopAdd</code></h3>
<pre><code>int RedisModule_EventLoopAdd(int fd,
                             int mask,
                             RedisModuleEventLoopFunc func,
                             void *user_data);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Add a pipe / socket event to the event loop.</p>
<ul>
<li>
<p><code>mask</code> must be one of the following values:</p>
<ul>
<li><code>REDISMODULE_EVENTLOOP_READABLE</code></li>
<li><code>REDISMODULE_EVENTLOOP_WRITABLE</code></li>
<li><code>REDISMODULE_EVENTLOOP_READABLE | REDISMODULE_EVENTLOOP_WRITABLE</code></li>
</ul>
</li>
</ul>
<p>On success <code>REDISMODULE_OK</code> is returned, otherwise
<code>REDISMODULE_ERR</code> is returned and errno is set to the following values:</p>
<ul>
<li>ERANGE: <code>fd</code> is negative or higher than <code>maxclients</code> Redis config.</li>
<li>EINVAL: <code>callback</code> is NULL or <code>mask</code> value is invalid.</li>
</ul>
<p><code>errno</code> might take other values in case of an internal error.</p>
<p>Example:</p>
<pre><code>void onReadable(int fd, void *user_data, int mask) {
    char buf[32];
    int bytes = read(fd,buf,sizeof(buf));
    printf("Read %d bytes \n", bytes);
}
RedisModule_EventLoopAdd(fd, REDISMODULE_EVENTLOOP_READABLE, onReadable, NULL);
</code></pre>
<p><span id="RedisModule_EventLoopDel"></span></p>
<h3 id="redismodule_eventloopdel"><code>RedisModule_EventLoopDel</code></h3>
<pre><code>int RedisModule_EventLoopDel(int fd, int mask);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Delete a pipe / socket event from the event loop.</p>
<ul>
<li>
<p><code>mask</code> must be one of the following values:</p>
<ul>
<li><code>REDISMODULE_EVENTLOOP_READABLE</code></li>
<li><code>REDISMODULE_EVENTLOOP_WRITABLE</code></li>
<li><code>REDISMODULE_EVENTLOOP_READABLE | REDISMODULE_EVENTLOOP_WRITABLE</code></li>
</ul>
</li>
</ul>
<p>On success <code>REDISMODULE_OK</code> is returned, otherwise
<code>REDISMODULE_ERR</code> is returned and errno is set to the following values:</p>
<ul>
<li>ERANGE: <code>fd</code> is negative or higher than <code>maxclients</code> Redis config.</li>
<li>EINVAL: <code>mask</code> value is invalid.</li>
</ul>
<p><span id="RedisModule_EventLoopAddOneShot"></span></p>
<h3 id="redismodule_eventloopaddoneshot"><code>RedisModule_EventLoopAddOneShot</code></h3>
<pre><code>int RedisModule_EventLoopAddOneShot(RedisModuleEventLoopOneShotFunc func,
                                    void *user_data);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>This function can be called from other threads to trigger callback on Redis
main thread. On success <code>REDISMODULE_OK</code> is returned. If <code>func</code> is NULL
<code>REDISMODULE_ERR</code> is returned and errno is set to EINVAL.</p>
<p><span id="section-modules-acl-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Modules%20ACL%20API"></a><h2 id="modules-acl-api">Modules ACL API</h2>
<p>Implements a hook into the authentication and authorization within Redis.</p>
<p><span id="RedisModule_CreateModuleUser"></span></p>
<h3 id="redismodule_createmoduleuser"><code>RedisModule_CreateModuleUser</code></h3>
<pre><code>RedisModuleUser *RedisModule_CreateModuleUser(const char *name);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Creates a Redis ACL user that the module can use to authenticate a client.
After obtaining the user, the module should set what such user can do
using the <code>RedisModule_SetUserACL()</code> function. Once configured, the user
can be used in order to authenticate a connection, with the specified
ACL rules, using the <code>RedisModule_AuthClientWithUser()</code> function.</p>
<p>Note that:</p>
<ul>
<li>Users created here are not listed by the ACL command.</li>
<li>Users created here are not checked for duplicated name, so it's up to
the module calling this function to take care of not creating users
with the same name.</li>
<li>The created user can be used to authenticate multiple Redis connections.</li>
</ul>
<p>The caller can later free the user using the function
<a href="#RedisModule_FreeModuleUser"><code>RedisModule_FreeModuleUser()</code></a>. When this function is called, if there are
still clients authenticated with this user, they are disconnected.
The function to free the user should only be used when the caller really
wants to invalidate the user to define a new one with different
capabilities.</p>
<p><span id="RedisModule_FreeModuleUser"></span></p>
<h3 id="redismodule_freemoduleuser"><code>RedisModule_FreeModuleUser</code></h3>
<pre><code>int RedisModule_FreeModuleUser(RedisModuleUser *user);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Frees a given user and disconnects all of the clients that have been
authenticated with it. See <a href="#RedisModule_CreateModuleUser"><code>RedisModule_CreateModuleUser</code></a> for detailed usage.</p>
<p><span id="RedisModule_SetModuleUserACL"></span></p>
<h3 id="redismodule_setmoduleuseracl"><code>RedisModule_SetModuleUserACL</code></h3>
<pre><code>int RedisModule_SetModuleUserACL(RedisModuleUser *user, const char* acl);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Sets the permissions of a user created through the redis module
interface. The syntax is the same as ACL SETUSER, so refer to the
documentation in acl.c for more information. See <a href="#RedisModule_CreateModuleUser"><code>RedisModule_CreateModuleUser</code></a>
for detailed usage.</p>
<p>Returns <code>REDISMODULE_OK</code> on success and <code>REDISMODULE_ERR</code> on failure
and will set an errno describing why the operation failed.</p>
<p><span id="RedisModule_SetModuleUserACLString"></span></p>
<h3 id="redismodule_setmoduleuseraclstring"><code>RedisModule_SetModuleUserACLString</code></h3>
<pre><code>int RedisModule_SetModuleUserACLString(RedisModuleCtx *ctx,
                                       RedisModuleUser *user,
                                       const char *acl,
                                       RedisModuleString **error);
</code></pre>
<p><strong>Available since:</strong> 7.0.6</p>
<p>Sets the permission of a user with a complete ACL string, such as one
would use on the redis ACL SETUSER command line API. This differs from
<a href="#RedisModule_SetModuleUserACL"><code>RedisModule_SetModuleUserACL</code></a>, which only takes single ACL operations at a time.</p>
<p>Returns <code>REDISMODULE_OK</code> on success and <code>REDISMODULE_ERR</code> on failure
if a <code>RedisModuleString</code> is provided in error, a string describing the error
will be returned</p>
<p><span id="RedisModule_GetModuleUserACLString"></span></p>
<h3 id="redismodule_getmoduleuseraclstring"><code>RedisModule_GetModuleUserACLString</code></h3>
<pre><code>RedisModuleString *RedisModule_GetModuleUserACLString(RedisModuleUser *user);
</code></pre>
<p><strong>Available since:</strong> 7.0.6</p>
<p>Get the ACL string for a given user
Returns a <code>RedisModuleString</code></p>
<p><span id="RedisModule_GetCurrentUserName"></span></p>
<h3 id="redismodule_getcurrentusername"><code>RedisModule_GetCurrentUserName</code></h3>
<pre><code>RedisModuleString *RedisModule_GetCurrentUserName(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Retrieve the user name of the client connection behind the current context.
The user name can be used later, in order to get a <code>RedisModuleUser</code>.
See more information in <a href="#RedisModule_GetModuleUserFromUserName"><code>RedisModule_GetModuleUserFromUserName</code></a>.</p>
<p>The returned string must be released with <a href="#RedisModule_FreeString"><code>RedisModule_FreeString()</code></a> or by
enabling automatic memory management.</p>
<p><span id="RedisModule_GetModuleUserFromUserName"></span></p>
<h3 id="redismodule_getmoduleuserfromusername"><code>RedisModule_GetModuleUserFromUserName</code></h3>
<pre><code>RedisModuleUser *RedisModule_GetModuleUserFromUserName(RedisModuleString *name);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>A <code>RedisModuleUser</code> can be used to check if command, key or channel can be executed or
accessed according to the ACLs rules associated with that user.
When a Module wants to do ACL checks on a general ACL user (not created by <a href="#RedisModule_CreateModuleUser"><code>RedisModule_CreateModuleUser</code></a>),
it can get the <code>RedisModuleUser</code> from this API, based on the user name retrieved by <a href="#RedisModule_GetCurrentUserName"><code>RedisModule_GetCurrentUserName</code></a>.</p>
<p>Since a general ACL user can be deleted at any time, this <code>RedisModuleUser</code> should be used only in the context
where this function was called. In order to do ACL checks out of that context, the Module can store the user name,
and call this API at any other context.</p>
<p>Returns NULL if the user is disabled or the user does not exist.
The caller should later free the user using the function <a href="#RedisModule_FreeModuleUser"><code>RedisModule_FreeModuleUser()</code></a>.</p>
<p><span id="RedisModule_ACLCheckCommandPermissions"></span></p>
<h3 id="redismodule_aclcheckcommandpermissions"><code>RedisModule_ACLCheckCommandPermissions</code></h3>
<pre><code>int RedisModule_ACLCheckCommandPermissions(RedisModuleUser *user,
                                           RedisModuleString **argv,
                                           int argc);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Checks if the command can be executed by the user, according to the ACLs associated with it.</p>
<p>On success a <code>REDISMODULE_OK</code> is returned, otherwise
<code>REDISMODULE_ERR</code> is returned and errno is set to the following values:</p>
<ul>
<li>ENOENT: Specified command does not exist.</li>
<li>EACCES: Command cannot be executed, according to ACL rules</li>
</ul>
<p><span id="RedisModule_ACLCheckKeyPermissions"></span></p>
<h3 id="redismodule_aclcheckkeypermissions"><code>RedisModule_ACLCheckKeyPermissions</code></h3>
<pre><code>int RedisModule_ACLCheckKeyPermissions(RedisModuleUser *user,
                                       RedisModuleString *key,
                                       int flags);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Check if the key can be accessed by the user according to the ACLs attached to the user
and the flags representing the key access. The flags are the same that are used in the
keyspec for logical operations. These flags are documented in <a href="#RedisModule_SetCommandInfo"><code>RedisModule_SetCommandInfo</code></a> as
the <code>REDISMODULE_CMD_KEY_ACCESS</code>, <code>REDISMODULE_CMD_KEY_UPDATE</code>, <code>REDISMODULE_CMD_KEY_INSERT</code>,
and <code>REDISMODULE_CMD_KEY_DELETE</code> flags.</p>
<p>If no flags are supplied, the user is still required to have some access to the key for
this command to return successfully.</p>
<p>If the user is able to access the key then <code>REDISMODULE_OK</code> is returned, otherwise
<code>REDISMODULE_ERR</code> is returned and errno is set to one of the following values:</p>
<ul>
<li>EINVAL: The provided flags are invalid.</li>
<li>EACCESS: The user does not have permission to access the key.</li>
</ul>
<p><span id="RedisModule_ACLCheckChannelPermissions"></span></p>
<h3 id="redismodule_aclcheckchannelpermissions"><code>RedisModule_ACLCheckChannelPermissions</code></h3>
<pre><code>int RedisModule_ACLCheckChannelPermissions(RedisModuleUser *user,
                                           RedisModuleString *ch,
                                           int flags);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Check if the pubsub channel can be accessed by the user based off of the given
access flags. See <a href="#RedisModule_ChannelAtPosWithFlags"><code>RedisModule_ChannelAtPosWithFlags</code></a> for more information about the
possible flags that can be passed in.</p>
<p>If the user is able to access the pubsub channel then <code>REDISMODULE_OK</code> is returned, otherwise
<code>REDISMODULE_ERR</code> is returned and errno is set to one of the following values:</p>
<ul>
<li>EINVAL: The provided flags are invalid.</li>
<li>EACCESS: The user does not have permission to access the pubsub channel.</li>
</ul>
<p><span id="RedisModule_ACLAddLogEntry"></span></p>
<h3 id="redismodule_acladdlogentry"><code>RedisModule_ACLAddLogEntry</code></h3>
<pre><code>int RedisModule_ACLAddLogEntry(RedisModuleCtx *ctx,
                               RedisModuleUser *user,
                               RedisModuleString *object,
                               RedisModuleACLLogEntryReason reason);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Adds a new entry in the ACL log.
Returns <code>REDISMODULE_OK</code> on success and <code>REDISMODULE_ERR</code> on error.</p>
<p>For more information about ACL log, please refer to <a href="../../../commands/acl-log.html">https://redis.io/commands/acl-log</a></p>
<p><span id="RedisModule_ACLAddLogEntryByUserName"></span></p>
<h3 id="redismodule_acladdlogentrybyusername"><code>RedisModule_ACLAddLogEntryByUserName</code></h3>
<pre><code>int RedisModule_ACLAddLogEntryByUserName(RedisModuleCtx *ctx,
                                         RedisModuleString *username,
                                         RedisModuleString *object,
                                         RedisModuleACLLogEntryReason reason);
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>Adds a new entry in the ACL log with the <code>username</code> <code>RedisModuleString</code> provided.
Returns <code>REDISMODULE_OK</code> on success and <code>REDISMODULE_ERR</code> on error.</p>
<p>For more information about ACL log, please refer to <a href="../../../commands/acl-log.html">https://redis.io/commands/acl-log</a></p>
<p><span id="RedisModule_AuthenticateClientWithUser"></span></p>
<h3 id="redismodule_authenticateclientwithuser"><code>RedisModule_AuthenticateClientWithUser</code></h3>
<pre><code>int RedisModule_AuthenticateClientWithUser(RedisModuleCtx *ctx,
                                           RedisModuleUser *module_user,
                                           RedisModuleUserChangedFunc callback,
                                           void *privdata,
                                           uint64_t *client_id);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Authenticate the current context's user with the provided redis acl user.
Returns <code>REDISMODULE_ERR</code> if the user is disabled.</p>
<p>See authenticateClientWithUser for information about callback, <code>client_id</code>,
and general usage for authentication.</p>
<p><span id="RedisModule_AuthenticateClientWithACLUser"></span></p>
<h3 id="redismodule_authenticateclientwithacluser"><code>RedisModule_AuthenticateClientWithACLUser</code></h3>
<pre><code>int RedisModule_AuthenticateClientWithACLUser(RedisModuleCtx *ctx,
                                              const char *name,
                                              size_t len,
                                              RedisModuleUserChangedFunc callback,
                                              void *privdata,
                                              uint64_t *client_id);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Authenticate the current context's user with the provided redis acl user.
Returns <code>REDISMODULE_ERR</code> if the user is disabled or the user does not exist.</p>
<p>See authenticateClientWithUser for information about callback, <code>client_id</code>,
and general usage for authentication.</p>
<p><span id="RedisModule_DeauthenticateAndCloseClient"></span></p>
<h3 id="redismodule_deauthenticateandcloseclient"><code>RedisModule_DeauthenticateAndCloseClient</code></h3>
<pre><code>int RedisModule_DeauthenticateAndCloseClient(RedisModuleCtx *ctx,
                                             uint64_t client_id);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Deauthenticate and close the client. The client resources will not be
immediately freed, but will be cleaned up in a background job. This is
the recommended way to deauthenticate a client since most clients can't
handle users becoming deauthenticated. Returns <code>REDISMODULE_ERR</code> when the
client doesn't exist and <code>REDISMODULE_OK</code> when the operation was successful.</p>
<p>The client ID is returned from the <a href="#RedisModule_AuthenticateClientWithUser"><code>RedisModule_AuthenticateClientWithUser</code></a> and
<a href="#RedisModule_AuthenticateClientWithACLUser"><code>RedisModule_AuthenticateClientWithACLUser</code></a> APIs, but can be obtained through
the CLIENT api or through server events.</p>
<p>This function is not thread safe, and must be executed within the context
of a command or thread safe context.</p>
<p><span id="RedisModule_RedactClientCommandArgument"></span></p>
<h3 id="redismodule_redactclientcommandargument"><code>RedisModule_RedactClientCommandArgument</code></h3>
<pre><code>int RedisModule_RedactClientCommandArgument(RedisModuleCtx *ctx, int pos);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Redact the client command argument specified at the given position. Redacted arguments
are obfuscated in user facing commands such as SLOWLOG or MONITOR, as well as
never being written to server logs. This command may be called multiple times on the
same position.</p>
<p>Note that the command name, position 0, can not be redacted.</p>
<p>Returns <code>REDISMODULE_OK</code> if the argument was redacted and <code>REDISMODULE_ERR</code> if there
was an invalid parameter passed in or the position is outside the client
argument range.</p>
<p><span id="RedisModule_GetClientCertificate"></span></p>
<h3 id="redismodule_getclientcertificate"><code>RedisModule_GetClientCertificate</code></h3>
<pre><code>RedisModuleString *RedisModule_GetClientCertificate(RedisModuleCtx *ctx,
                                                    uint64_t client_id);
</code></pre>
<p><strong>Available since:</strong> 6.0.9</p>
<p>Return the X.509 client-side certificate used by the client to authenticate
this connection.</p>
<p>The return value is an allocated <code>RedisModuleString</code> that is a X.509 certificate
encoded in PEM (Base64) format. It should be freed (or auto-freed) by the caller.</p>
<p>A NULL value is returned in the following conditions:</p>
<ul>
<li>Connection ID does not exist</li>
<li>Connection is not a TLS connection</li>
<li>Connection is a TLS connection but no client certificate was used</li>
</ul>
<p><span id="section-modules-dictionary-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Modules%20Dictionary%20API"></a><h2 id="modules-dictionary-api">Modules Dictionary API</h2>
<p>Implements a sorted dictionary (actually backed by a radix tree) with
the usual get / set / del / num-items API, together with an iterator
capable of going back and forth.</p>
<p><span id="RedisModule_CreateDict"></span></p>
<h3 id="redismodule_createdict"><code>RedisModule_CreateDict</code></h3>
<pre><code>RedisModuleDict *RedisModule_CreateDict(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Create a new dictionary. The 'ctx' pointer can be the current module context
or NULL, depending on what you want. Please follow the following rules:</p>
<ol>
<li>Use a NULL context if you plan to retain a reference to this dictionary
that will survive the time of the module callback where you created it.</li>
<li>Use a NULL context if no context is available at the time you are creating
the dictionary (of course...).</li>
<li>However use the current callback context as 'ctx' argument if the
dictionary time to live is just limited to the callback scope. In this
case, if enabled, you can enjoy the automatic memory management that will
reclaim the dictionary memory, as well as the strings returned by the
Next / Prev dictionary iterator calls.</li>
</ol>
<p><span id="RedisModule_FreeDict"></span></p>
<h3 id="redismodule_freedict"><code>RedisModule_FreeDict</code></h3>
<pre><code>void RedisModule_FreeDict(RedisModuleCtx *ctx, RedisModuleDict *d);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Free a dictionary created with <a href="#RedisModule_CreateDict"><code>RedisModule_CreateDict()</code></a>. You need to pass the
context pointer 'ctx' only if the dictionary was created using the
context instead of passing NULL.</p>
<p><span id="RedisModule_DictSize"></span></p>
<h3 id="redismodule_dictsize"><code>RedisModule_DictSize</code></h3>
<pre><code>uint64_t RedisModule_DictSize(RedisModuleDict *d);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Return the size of the dictionary (number of keys).</p>
<p><span id="RedisModule_DictSetC"></span></p>
<h3 id="redismodule_dictsetc"><code>RedisModule_DictSetC</code></h3>
<pre><code>int RedisModule_DictSetC(RedisModuleDict *d,
                         void *key,
                         size_t keylen,
                         void *ptr);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Store the specified key into the dictionary, setting its value to the
pointer 'ptr'. If the key was added with success, since it did not
already exist, <code>REDISMODULE_OK</code> is returned. Otherwise if the key already
exists the function returns <code>REDISMODULE_ERR</code>.</p>
<p><span id="RedisModule_DictReplaceC"></span></p>
<h3 id="redismodule_dictreplacec"><code>RedisModule_DictReplaceC</code></h3>
<pre><code>int RedisModule_DictReplaceC(RedisModuleDict *d,
                             void *key,
                             size_t keylen,
                             void *ptr);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Like <a href="#RedisModule_DictSetC"><code>RedisModule_DictSetC()</code></a> but will replace the key with the new
value if the key already exists.</p>
<p><span id="RedisModule_DictSet"></span></p>
<h3 id="redismodule_dictset"><code>RedisModule_DictSet</code></h3>
<pre><code>int RedisModule_DictSet(RedisModuleDict *d, RedisModuleString *key, void *ptr);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Like <a href="#RedisModule_DictSetC"><code>RedisModule_DictSetC()</code></a> but takes the key as a <code>RedisModuleString</code>.</p>
<p><span id="RedisModule_DictReplace"></span></p>
<h3 id="redismodule_dictreplace"><code>RedisModule_DictReplace</code></h3>
<pre><code>int RedisModule_DictReplace(RedisModuleDict *d,
                            RedisModuleString *key,
                            void *ptr);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Like <a href="#RedisModule_DictReplaceC"><code>RedisModule_DictReplaceC()</code></a> but takes the key as a <code>RedisModuleString</code>.</p>
<p><span id="RedisModule_DictGetC"></span></p>
<h3 id="redismodule_dictgetc"><code>RedisModule_DictGetC</code></h3>
<pre><code>void *RedisModule_DictGetC(RedisModuleDict *d,
                           void *key,
                           size_t keylen,
                           int *nokey);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Return the value stored at the specified key. The function returns NULL
both in the case the key does not exist, or if you actually stored
NULL at key. So, optionally, if the 'nokey' pointer is not NULL, it will
be set by reference to 1 if the key does not exist, or to 0 if the key
exists.</p>
<p><span id="RedisModule_DictGet"></span></p>
<h3 id="redismodule_dictget"><code>RedisModule_DictGet</code></h3>
<pre><code>void *RedisModule_DictGet(RedisModuleDict *d,
                          RedisModuleString *key,
                          int *nokey);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Like <a href="#RedisModule_DictGetC"><code>RedisModule_DictGetC()</code></a> but takes the key as a <code>RedisModuleString</code>.</p>
<p><span id="RedisModule_DictDelC"></span></p>
<h3 id="redismodule_dictdelc"><code>RedisModule_DictDelC</code></h3>
<pre><code>int RedisModule_DictDelC(RedisModuleDict *d,
                         void *key,
                         size_t keylen,
                         void *oldval);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Remove the specified key from the dictionary, returning <code>REDISMODULE_OK</code> if
the key was found and deleted, or <code>REDISMODULE_ERR</code> if instead there was
no such key in the dictionary. When the operation is successful, if
'oldval' is not NULL, then '*oldval' is set to the value stored at the
key before it was deleted. Using this feature it is possible to get
a pointer to the value (for instance in order to release it), without
having to call <a href="#RedisModule_DictGet"><code>RedisModule_DictGet()</code></a> before deleting the key.</p>
<p><span id="RedisModule_DictDel"></span></p>
<h3 id="redismodule_dictdel"><code>RedisModule_DictDel</code></h3>
<pre><code>int RedisModule_DictDel(RedisModuleDict *d,
                        RedisModuleString *key,
                        void *oldval);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Like <a href="#RedisModule_DictDelC"><code>RedisModule_DictDelC()</code></a> but gets the key as a <code>RedisModuleString</code>.</p>
<p><span id="RedisModule_DictIteratorStartC"></span></p>
<h3 id="redismodule_dictiteratorstartc"><code>RedisModule_DictIteratorStartC</code></h3>
<pre><code>RedisModuleDictIter *RedisModule_DictIteratorStartC(RedisModuleDict *d,
                                                    const char *op,
                                                    void *key,
                                                    size_t keylen);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Return an iterator, setup in order to start iterating from the specified
key by applying the operator 'op', which is just a string specifying the
comparison operator to use in order to seek the first element. The
operators available are:</p>
<ul>
<li><code>^</code>   – Seek the first (lexicographically smaller) key.</li>
<li><code>$</code>   – Seek the last  (lexicographically bigger) key.</li>
<li><code>&gt;</code>   – Seek the first element greater than the specified key.</li>
<li><code>&gt;=</code>  – Seek the first element greater or equal than the specified key.</li>
<li><code>&lt;</code>   – Seek the first element smaller than the specified key.</li>
<li><code>&lt;=</code>  – Seek the first element smaller or equal than the specified key.</li>
<li><code>==</code>  – Seek the first element matching exactly the specified key.</li>
</ul>
<p>Note that for <code>^</code> and <code>$</code> the passed key is not used, and the user may
just pass NULL with a length of 0.</p>
<p>If the element to start the iteration cannot be seeked based on the
key and operator passed, <a href="#RedisModule_DictNext"><code>RedisModule_DictNext()</code></a> / Prev() will just return
<code>REDISMODULE_ERR</code> at the first call, otherwise they'll produce elements.</p>
<p><span id="RedisModule_DictIteratorStart"></span></p>
<h3 id="redismodule_dictiteratorstart"><code>RedisModule_DictIteratorStart</code></h3>
<pre><code>RedisModuleDictIter *RedisModule_DictIteratorStart(RedisModuleDict *d,
                                                   const char *op,
                                                   RedisModuleString *key);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Exactly like <a href="#RedisModule_DictIteratorStartC"><code>RedisModule_DictIteratorStartC</code></a>, but the key is passed as a
<code>RedisModuleString</code>.</p>
<p><span id="RedisModule_DictIteratorStop"></span></p>
<h3 id="redismodule_dictiteratorstop"><code>RedisModule_DictIteratorStop</code></h3>
<pre><code>void RedisModule_DictIteratorStop(RedisModuleDictIter *di);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Release the iterator created with <a href="#RedisModule_DictIteratorStart"><code>RedisModule_DictIteratorStart()</code></a>. This call
is mandatory otherwise a memory leak is introduced in the module.</p>
<p><span id="RedisModule_DictIteratorReseekC"></span></p>
<h3 id="redismodule_dictiteratorreseekc"><code>RedisModule_DictIteratorReseekC</code></h3>
<pre><code>int RedisModule_DictIteratorReseekC(RedisModuleDictIter *di,
                                    const char *op,
                                    void *key,
                                    size_t keylen);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>After its creation with <a href="#RedisModule_DictIteratorStart"><code>RedisModule_DictIteratorStart()</code></a>, it is possible to
change the currently selected element of the iterator by using this
API call. The result based on the operator and key is exactly like
the function <a href="#RedisModule_DictIteratorStart"><code>RedisModule_DictIteratorStart()</code></a>, however in this case the
return value is just <code>REDISMODULE_OK</code> in case the seeked element was found,
or <code>REDISMODULE_ERR</code> in case it was not possible to seek the specified
element. It is possible to reseek an iterator as many times as you want.</p>
<p><span id="RedisModule_DictIteratorReseek"></span></p>
<h3 id="redismodule_dictiteratorreseek"><code>RedisModule_DictIteratorReseek</code></h3>
<pre><code>int RedisModule_DictIteratorReseek(RedisModuleDictIter *di,
                                   const char *op,
                                   RedisModuleString *key);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Like <a href="#RedisModule_DictIteratorReseekC"><code>RedisModule_DictIteratorReseekC()</code></a> but takes the key as a
<code>RedisModuleString</code>.</p>
<p><span id="RedisModule_DictNextC"></span></p>
<h3 id="redismodule_dictnextc"><code>RedisModule_DictNextC</code></h3>
<pre><code>void *RedisModule_DictNextC(RedisModuleDictIter *di,
                            size_t *keylen,
                            void **dataptr);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Return the current item of the dictionary iterator <code>di</code> and steps to the
next element. If the iterator already yield the last element and there
are no other elements to return, NULL is returned, otherwise a pointer
to a string representing the key is provided, and the <code>*keylen</code> length
is set by reference (if keylen is not NULL). The <code>*dataptr</code>, if not NULL
is set to the value of the pointer stored at the returned key as auxiliary
data (as set by the <a href="#RedisModule_DictSet"><code>RedisModule_DictSet</code></a> API).</p>
<p>Usage example:</p>
<pre><code> ... create the iterator here ...
 char *key;
 void *data;
 while((key = RedisModule_DictNextC(iter,&amp;keylen,&amp;data)) != NULL) {
     printf("%.*s %p\n", (int)keylen, key, data);
 }
</code></pre>
<p>The returned pointer is of type void because sometimes it makes sense
to cast it to a <code>char*</code> sometimes to an unsigned <code>char*</code> depending on the
fact it contains or not binary data, so this API ends being more
comfortable to use.</p>
<p>The validity of the returned pointer is until the next call to the
next/prev iterator step. Also the pointer is no longer valid once the
iterator is released.</p>
<p><span id="RedisModule_DictPrevC"></span></p>
<h3 id="redismodule_dictprevc"><code>RedisModule_DictPrevC</code></h3>
<pre><code>void *RedisModule_DictPrevC(RedisModuleDictIter *di,
                            size_t *keylen,
                            void **dataptr);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>This function is exactly like <a href="#RedisModule_DictNext"><code>RedisModule_DictNext()</code></a> but after returning
the currently selected element in the iterator, it selects the previous
element (lexicographically smaller) instead of the next one.</p>
<p><span id="RedisModule_DictNext"></span></p>
<h3 id="redismodule_dictnext"><code>RedisModule_DictNext</code></h3>
<pre><code>RedisModuleString *RedisModule_DictNext(RedisModuleCtx *ctx,
                                        RedisModuleDictIter *di,
                                        void **dataptr);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Like <code>RedisModuleNextC()</code>, but instead of returning an internally allocated
buffer and key length, it returns directly a module string object allocated
in the specified context 'ctx' (that may be NULL exactly like for the main
API <a href="#RedisModule_CreateString"><code>RedisModule_CreateString</code></a>).</p>
<p>The returned string object should be deallocated after use, either manually
or by using a context that has automatic memory management active.</p>
<p><span id="RedisModule_DictPrev"></span></p>
<h3 id="redismodule_dictprev"><code>RedisModule_DictPrev</code></h3>
<pre><code>RedisModuleString *RedisModule_DictPrev(RedisModuleCtx *ctx,
                                        RedisModuleDictIter *di,
                                        void **dataptr);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Like <a href="#RedisModule_DictNext"><code>RedisModule_DictNext()</code></a> but after returning the currently selected
element in the iterator, it selects the previous element (lexicographically
smaller) instead of the next one.</p>
<p><span id="RedisModule_DictCompareC"></span></p>
<h3 id="redismodule_dictcomparec"><code>RedisModule_DictCompareC</code></h3>
<pre><code>int RedisModule_DictCompareC(RedisModuleDictIter *di,
                             const char *op,
                             void *key,
                             size_t keylen);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Compare the element currently pointed by the iterator to the specified
element given by key/keylen, according to the operator 'op' (the set of
valid operators are the same valid for <a href="#RedisModule_DictIteratorStart"><code>RedisModule_DictIteratorStart</code></a>).
If the comparison is successful the command returns <code>REDISMODULE_OK</code>
otherwise <code>REDISMODULE_ERR</code> is returned.</p>
<p>This is useful when we want to just emit a lexicographical range, so
in the loop, as we iterate elements, we can also check if we are still
on range.</p>
<p>The function return <code>REDISMODULE_ERR</code> if the iterator reached the
end of elements condition as well.</p>
<p><span id="RedisModule_DictCompare"></span></p>
<h3 id="redismodule_dictcompare"><code>RedisModule_DictCompare</code></h3>
<pre><code>int RedisModule_DictCompare(RedisModuleDictIter *di,
                            const char *op,
                            RedisModuleString *key);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Like <a href="#RedisModule_DictCompareC"><code>RedisModule_DictCompareC</code></a> but gets the key to compare with the current
iterator key as a <code>RedisModuleString</code>.</p>
<p><span id="section-modules-info-fields"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Modules%20Info%20fields"></a><h2 id="modules-info-fields">Modules Info fields</h2>
<p><span id="RedisModule_InfoAddSection"></span></p>
<h3 id="redismodule_infoaddsection"><code>RedisModule_InfoAddSection</code></h3>
<pre><code>int RedisModule_InfoAddSection(RedisModuleInfoCtx *ctx, const char *name);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Used to start a new section, before adding any fields. the section name will
be prefixed by <code>&lt;modulename&gt;_</code> and must only include A-Z,a-z,0-9.
NULL or empty string indicates the default section (only <code>&lt;modulename&gt;</code>) is used.
When return value is <code>REDISMODULE_ERR</code>, the section should and will be skipped.</p>
<p><span id="RedisModule_InfoBeginDictField"></span></p>
<h3 id="redismodule_infobegindictfield"><code>RedisModule_InfoBeginDictField</code></h3>
<pre><code>int RedisModule_InfoBeginDictField(RedisModuleInfoCtx *ctx, const char *name);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Starts a dict field, similar to the ones in INFO KEYSPACE. Use normal
<code>RedisModule_InfoAddField</code>* functions to add the items to this field, and
terminate with <a href="#RedisModule_InfoEndDictField"><code>RedisModule_InfoEndDictField</code></a>.</p>
<p><span id="RedisModule_InfoEndDictField"></span></p>
<h3 id="redismodule_infoenddictfield"><code>RedisModule_InfoEndDictField</code></h3>
<pre><code>int RedisModule_InfoEndDictField(RedisModuleInfoCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Ends a dict field, see <a href="#RedisModule_InfoBeginDictField"><code>RedisModule_InfoBeginDictField</code></a></p>
<p><span id="RedisModule_InfoAddFieldString"></span></p>
<h3 id="redismodule_infoaddfieldstring"><code>RedisModule_InfoAddFieldString</code></h3>
<pre><code>int RedisModule_InfoAddFieldString(RedisModuleInfoCtx *ctx,
                                   const char *field,
                                   RedisModuleString *value);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Used by <code>RedisModuleInfoFunc</code> to add info fields.
Each field will be automatically prefixed by <code>&lt;modulename&gt;_</code>.
Field names or values must not include <code>\r\n</code> or <code>:</code>.</p>
<p><span id="RedisModule_InfoAddFieldCString"></span></p>
<h3 id="redismodule_infoaddfieldcstring"><code>RedisModule_InfoAddFieldCString</code></h3>
<pre><code>int RedisModule_InfoAddFieldCString(RedisModuleInfoCtx *ctx,
                                    const char *field,
                                    const char *value);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>See <a href="#RedisModule_InfoAddFieldString"><code>RedisModule_InfoAddFieldString()</code></a>.</p>
<p><span id="RedisModule_InfoAddFieldDouble"></span></p>
<h3 id="redismodule_infoaddfielddouble"><code>RedisModule_InfoAddFieldDouble</code></h3>
<pre><code>int RedisModule_InfoAddFieldDouble(RedisModuleInfoCtx *ctx,
                                   const char *field,
                                   double value);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>See <a href="#RedisModule_InfoAddFieldString"><code>RedisModule_InfoAddFieldString()</code></a>.</p>
<p><span id="RedisModule_InfoAddFieldLongLong"></span></p>
<h3 id="redismodule_infoaddfieldlonglong"><code>RedisModule_InfoAddFieldLongLong</code></h3>
<pre><code>int RedisModule_InfoAddFieldLongLong(RedisModuleInfoCtx *ctx,
                                     const char *field,
                                     long long value);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>See <a href="#RedisModule_InfoAddFieldString"><code>RedisModule_InfoAddFieldString()</code></a>.</p>
<p><span id="RedisModule_InfoAddFieldULongLong"></span></p>
<h3 id="redismodule_infoaddfieldulonglong"><code>RedisModule_InfoAddFieldULongLong</code></h3>
<pre><code>int RedisModule_InfoAddFieldULongLong(RedisModuleInfoCtx *ctx,
                                      const char *field,
                                      unsigned long long value);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>See <a href="#RedisModule_InfoAddFieldString"><code>RedisModule_InfoAddFieldString()</code></a>.</p>
<p><span id="RedisModule_RegisterInfoFunc"></span></p>
<h3 id="redismodule_registerinfofunc"><code>RedisModule_RegisterInfoFunc</code></h3>
<pre><code>int RedisModule_RegisterInfoFunc(RedisModuleCtx *ctx, RedisModuleInfoFunc cb);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Registers callback for the INFO command. The callback should add INFO fields
by calling the <code>RedisModule_InfoAddField*()</code> functions.</p>
<p><span id="RedisModule_GetServerInfo"></span></p>
<h3 id="redismodule_getserverinfo"><code>RedisModule_GetServerInfo</code></h3>
<pre><code>RedisModuleServerInfoData *RedisModule_GetServerInfo(RedisModuleCtx *ctx,
                                                     const char *section);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Get information about the server similar to the one that returns from the
INFO command. This function takes an optional 'section' argument that may
be NULL. The return value holds the output and can be used with
<a href="#RedisModule_ServerInfoGetField"><code>RedisModule_ServerInfoGetField</code></a> and alike to get the individual fields.
When done, it needs to be freed with <a href="#RedisModule_FreeServerInfo"><code>RedisModule_FreeServerInfo</code></a> or with the
automatic memory management mechanism if enabled.</p>
<p><span id="RedisModule_FreeServerInfo"></span></p>
<h3 id="redismodule_freeserverinfo"><code>RedisModule_FreeServerInfo</code></h3>
<pre><code>void RedisModule_FreeServerInfo(RedisModuleCtx *ctx,
                                RedisModuleServerInfoData *data);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Free data created with <a href="#RedisModule_GetServerInfo"><code>RedisModule_GetServerInfo()</code></a>. You need to pass the
context pointer 'ctx' only if the dictionary was created using the
context instead of passing NULL.</p>
<p><span id="RedisModule_ServerInfoGetField"></span></p>
<h3 id="redismodule_serverinfogetfield"><code>RedisModule_ServerInfoGetField</code></h3>
<pre><code>RedisModuleString *RedisModule_ServerInfoGetField(RedisModuleCtx *ctx,
                                                  RedisModuleServerInfoData *data,
                                                  const char* field);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Get the value of a field from data collected with <a href="#RedisModule_GetServerInfo"><code>RedisModule_GetServerInfo()</code></a>. You
need to pass the context pointer 'ctx' only if you want to use auto memory
mechanism to release the returned string. Return value will be NULL if the
field was not found.</p>
<p><span id="RedisModule_ServerInfoGetFieldC"></span></p>
<h3 id="redismodule_serverinfogetfieldc"><code>RedisModule_ServerInfoGetFieldC</code></h3>
<pre><code>const char *RedisModule_ServerInfoGetFieldC(RedisModuleServerInfoData *data,
                                            const char* field);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Similar to <a href="#RedisModule_ServerInfoGetField"><code>RedisModule_ServerInfoGetField</code></a>, but returns a char* which should not be freed but the caller.</p>
<p><span id="RedisModule_ServerInfoGetFieldSigned"></span></p>
<h3 id="redismodule_serverinfogetfieldsigned"><code>RedisModule_ServerInfoGetFieldSigned</code></h3>
<pre><code>long long RedisModule_ServerInfoGetFieldSigned(RedisModuleServerInfoData *data,
                                               const char* field,
                                               int *out_err);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Get the value of a field from data collected with <a href="#RedisModule_GetServerInfo"><code>RedisModule_GetServerInfo()</code></a>. If the
field is not found, or is not numerical or out of range, return value will be
0, and the optional <code>out_err</code> argument will be set to <code>REDISMODULE_ERR</code>.</p>
<p><span id="RedisModule_ServerInfoGetFieldUnsigned"></span></p>
<h3 id="redismodule_serverinfogetfieldunsigned"><code>RedisModule_ServerInfoGetFieldUnsigned</code></h3>
<pre><code>unsigned long long RedisModule_ServerInfoGetFieldUnsigned(RedisModuleServerInfoData *data,
                                                          const char* field,
                                                          int *out_err);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Get the value of a field from data collected with <a href="#RedisModule_GetServerInfo"><code>RedisModule_GetServerInfo()</code></a>. If the
field is not found, or is not numerical or out of range, return value will be
0, and the optional <code>out_err</code> argument will be set to <code>REDISMODULE_ERR</code>.</p>
<p><span id="RedisModule_ServerInfoGetFieldDouble"></span></p>
<h3 id="redismodule_serverinfogetfielddouble"><code>RedisModule_ServerInfoGetFieldDouble</code></h3>
<pre><code>double RedisModule_ServerInfoGetFieldDouble(RedisModuleServerInfoData *data,
                                            const char* field,
                                            int *out_err);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Get the value of a field from data collected with <a href="#RedisModule_GetServerInfo"><code>RedisModule_GetServerInfo()</code></a>. If the
field is not found, or is not a double, return value will be 0, and the
optional <code>out_err</code> argument will be set to <code>REDISMODULE_ERR</code>.</p>
<p><span id="section-modules-utility-apis"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Modules%20utility%20APIs"></a><h2 id="modules-utility-apis">Modules utility APIs</h2>
<p><span id="RedisModule_GetRandomBytes"></span></p>
<h3 id="redismodule_getrandombytes"><code>RedisModule_GetRandomBytes</code></h3>
<pre><code>void RedisModule_GetRandomBytes(unsigned char *dst, size_t len);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Return random bytes using SHA1 in counter mode with a /dev/urandom
initialized seed. This function is fast so can be used to generate
many bytes without any effect on the operating system entropy pool.
Currently this function is not thread safe.</p>
<p><span id="RedisModule_GetRandomHexChars"></span></p>
<h3 id="redismodule_getrandomhexchars"><code>RedisModule_GetRandomHexChars</code></h3>
<pre><code>void RedisModule_GetRandomHexChars(char *dst, size_t len);
</code></pre>
<p><strong>Available since:</strong> 5.0.0</p>
<p>Like <a href="#RedisModule_GetRandomBytes"><code>RedisModule_GetRandomBytes()</code></a> but instead of setting the string to
random bytes the string is set to random characters in the in the
hex charset [0-9a-f].</p>
<p><span id="section-modules-api-exporting-importing"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Modules%20API%20exporting%20%2F%20importing"></a><h2 id="modules-api-exporting--importing">Modules API exporting / importing</h2>
<p><span id="RedisModule_ExportSharedAPI"></span></p>
<h3 id="redismodule_exportsharedapi"><code>RedisModule_ExportSharedAPI</code></h3>
<pre><code>int RedisModule_ExportSharedAPI(RedisModuleCtx *ctx,
                                const char *apiname,
                                void *func);
</code></pre>
<p><strong>Available since:</strong> 5.0.4</p>
<p>This function is called by a module in order to export some API with a
given name. Other modules will be able to use this API by calling the
symmetrical function <a href="#RedisModule_GetSharedAPI"><code>RedisModule_GetSharedAPI()</code></a> and casting the return value to
the right function pointer.</p>
<p>The function will return <code>REDISMODULE_OK</code> if the name is not already taken,
otherwise <code>REDISMODULE_ERR</code> will be returned and no operation will be
performed.</p>
<p>IMPORTANT: the apiname argument should be a string literal with static
lifetime. The API relies on the fact that it will always be valid in
the future.</p>
<p><span id="RedisModule_GetSharedAPI"></span></p>
<h3 id="redismodule_getsharedapi"><code>RedisModule_GetSharedAPI</code></h3>
<pre><code>void *RedisModule_GetSharedAPI(RedisModuleCtx *ctx, const char *apiname);
</code></pre>
<p><strong>Available since:</strong> 5.0.4</p>
<p>Request an exported API pointer. The return value is just a void pointer
that the caller of this function will be required to cast to the right
function pointer, so this is a private contract between modules.</p>
<p>If the requested API is not available then NULL is returned. Because
modules can be loaded at different times with different order, this
function calls should be put inside some module generic API registering
step, that is called every time a module attempts to execute a
command that requires external APIs: if some API cannot be resolved, the
command should return an error.</p>
<p>Here is an example:</p>
<pre><code>int ... myCommandImplementation() {
   if (getExternalAPIs() == 0) {
        reply with an error here if we cannot have the APIs
   }
   // Use the API:
   myFunctionPointer(foo);
}
</code></pre>
<p>And the function registerAPI() is:</p>
<pre><code>int getExternalAPIs(void) {
    static int api_loaded = 0;
    if (api_loaded != 0) return 1; // APIs already resolved.

    myFunctionPointer = RedisModule_GetSharedAPI("...");
    if (myFunctionPointer == NULL) return 0;

    return 1;
}
</code></pre>
<p><span id="section-module-command-filter-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Module%20Command%20Filter%20API"></a><h2 id="module-command-filter-api">Module Command Filter API</h2>
<p><span id="RedisModule_RegisterCommandFilter"></span></p>
<h3 id="redismodule_registercommandfilter"><code>RedisModule_RegisterCommandFilter</code></h3>
<pre><code>RedisModuleCommandFilter *RedisModule_RegisterCommandFilter(RedisModuleCtx *ctx,
                                                            RedisModuleCommandFilterFunc callback,
                                                            int flags);
</code></pre>
<p><strong>Available since:</strong> 5.0.5</p>
<p>Register a new command filter function.</p>
<p>Command filtering makes it possible for modules to extend Redis by plugging
into the execution flow of all commands.</p>
<p>A registered filter gets called before Redis executes <em>any</em> command.  This
includes both core Redis commands and commands registered by any module.  The
filter applies in all execution paths including:</p>
<ol>
<li>Invocation by a client.</li>
<li>Invocation through <a href="#RedisModule_Call"><code>RedisModule_Call()</code></a> by any module.</li>
<li>Invocation through Lua <code>redis.call()</code>.</li>
<li>Replication of a command from a master.</li>
</ol>
<p>The filter executes in a special filter context, which is different and more
limited than a <code>RedisModuleCtx</code>.  Because the filter affects any command, it
must be implemented in a very efficient way to reduce the performance impact
on Redis.  All Redis Module API calls that require a valid context (such as
<a href="#RedisModule_Call"><code>RedisModule_Call()</code></a>, <a href="#RedisModule_OpenKey"><code>RedisModule_OpenKey()</code></a>, etc.) are not supported in a
filter context.</p>
<p>The <code>RedisModuleCommandFilterCtx</code> can be used to inspect or modify the
executed command and its arguments.  As the filter executes before Redis
begins processing the command, any change will affect the way the command is
processed.  For example, a module can override Redis commands this way:</p>
<ol>
<li>Register a <code>MODULE.SET</code> command which implements an extended version of
the Redis <a href="../../../commands/set.html"><code>SET</code></a> command.</li>
<li>Register a command filter which detects invocation of <a href="../../../commands/set.html"><code>SET</code></a> on a specific
pattern of keys.  Once detected, the filter will replace the first
argument from <a href="../../../commands/set.html"><code>SET</code></a> to <code>MODULE.SET</code>.</li>
<li>When filter execution is complete, Redis considers the new command name
and therefore executes the module's own command.</li>
</ol>
<p>Note that in the above use case, if <code>MODULE.SET</code> itself uses
<a href="#RedisModule_Call"><code>RedisModule_Call()</code></a> the filter will be applied on that call as well.  If
that is not desired, the <code>REDISMODULE_CMDFILTER_NOSELF</code> flag can be set when
registering the filter.</p>
<p>The <code>REDISMODULE_CMDFILTER_NOSELF</code> flag prevents execution flows that
originate from the module's own <a href="#RedisModule_Call"><code>RedisModule_Call()</code></a> from reaching the filter.  This
flag is effective for all execution flows, including nested ones, as long as
the execution begins from the module's command context or a thread-safe
context that is associated with a blocking command.</p>
<p>Detached thread-safe contexts are <em>not</em> associated with the module and cannot
be protected by this flag.</p>
<p>If multiple filters are registered (by the same or different modules), they
are executed in the order of registration.</p>
<p><span id="RedisModule_UnregisterCommandFilter"></span></p>
<h3 id="redismodule_unregistercommandfilter"><code>RedisModule_UnregisterCommandFilter</code></h3>
<pre><code>int RedisModule_UnregisterCommandFilter(RedisModuleCtx *ctx,
                                        RedisModuleCommandFilter *filter);
</code></pre>
<p><strong>Available since:</strong> 5.0.5</p>
<p>Unregister a command filter.</p>
<p><span id="RedisModule_CommandFilterArgsCount"></span></p>
<h3 id="redismodule_commandfilterargscount"><code>RedisModule_CommandFilterArgsCount</code></h3>
<pre><code>int RedisModule_CommandFilterArgsCount(RedisModuleCommandFilterCtx *fctx);
</code></pre>
<p><strong>Available since:</strong> 5.0.5</p>
<p>Return the number of arguments a filtered command has.  The number of
arguments include the command itself.</p>
<p><span id="RedisModule_CommandFilterArgGet"></span></p>
<h3 id="redismodule_commandfilterargget"><code>RedisModule_CommandFilterArgGet</code></h3>
<pre><code>RedisModuleString *RedisModule_CommandFilterArgGet(RedisModuleCommandFilterCtx *fctx,
                                                   int pos);
</code></pre>
<p><strong>Available since:</strong> 5.0.5</p>
<p>Return the specified command argument.  The first argument (position 0) is
the command itself, and the rest are user-provided args.</p>
<p><span id="RedisModule_CommandFilterArgInsert"></span></p>
<h3 id="redismodule_commandfilterarginsert"><code>RedisModule_CommandFilterArgInsert</code></h3>
<pre><code>int RedisModule_CommandFilterArgInsert(RedisModuleCommandFilterCtx *fctx,
                                       int pos,
                                       RedisModuleString *arg);
</code></pre>
<p><strong>Available since:</strong> 5.0.5</p>
<p>Modify the filtered command by inserting a new argument at the specified
position.  The specified <code>RedisModuleString</code> argument may be used by Redis
after the filter context is destroyed, so it must not be auto-memory
allocated, freed or used elsewhere.</p>
<p><span id="RedisModule_CommandFilterArgReplace"></span></p>
<h3 id="redismodule_commandfilterargreplace"><code>RedisModule_CommandFilterArgReplace</code></h3>
<pre><code>int RedisModule_CommandFilterArgReplace(RedisModuleCommandFilterCtx *fctx,
                                        int pos,
                                        RedisModuleString *arg);
</code></pre>
<p><strong>Available since:</strong> 5.0.5</p>
<p>Modify the filtered command by replacing an existing argument with a new one.
The specified <code>RedisModuleString</code> argument may be used by Redis after the
filter context is destroyed, so it must not be auto-memory allocated, freed
or used elsewhere.</p>
<p><span id="RedisModule_CommandFilterArgDelete"></span></p>
<h3 id="redismodule_commandfilterargdelete"><code>RedisModule_CommandFilterArgDelete</code></h3>
<pre><code>int RedisModule_CommandFilterArgDelete(RedisModuleCommandFilterCtx *fctx,
                                       int pos);
</code></pre>
<p><strong>Available since:</strong> 5.0.5</p>
<p>Modify the filtered command by deleting an argument at the specified
position.</p>
<p><span id="RedisModule_MallocSize"></span></p>
<h3 id="redismodule_mallocsize"><code>RedisModule_MallocSize</code></h3>
<pre><code>size_t RedisModule_MallocSize(void* ptr);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>For a given pointer allocated via <a href="#RedisModule_Alloc"><code>RedisModule_Alloc()</code></a> or
<a href="#RedisModule_Realloc"><code>RedisModule_Realloc()</code></a>, return the amount of memory allocated for it.
Note that this may be different (larger) than the memory we allocated
with the allocation calls, since sometimes the underlying allocator
will allocate more memory.</p>
<p><span id="RedisModule_MallocUsableSize"></span></p>
<h3 id="redismodule_mallocusablesize"><code>RedisModule_MallocUsableSize</code></h3>
<pre><code>size_t RedisModule_MallocUsableSize(void *ptr);
</code></pre>
<p><strong>Available since:</strong> 7.0.1</p>
<p>Similar to <a href="#RedisModule_MallocSize"><code>RedisModule_MallocSize</code></a>, the difference is that <a href="#RedisModule_MallocUsableSize"><code>RedisModule_MallocUsableSize</code></a>
returns the usable size of memory by the module.</p>
<p><span id="RedisModule_MallocSizeString"></span></p>
<h3 id="redismodule_mallocsizestring"><code>RedisModule_MallocSizeString</code></h3>
<pre><code>size_t RedisModule_MallocSizeString(RedisModuleString* str);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Same as <a href="#RedisModule_MallocSize"><code>RedisModule_MallocSize</code></a>, except it works on <code>RedisModuleString</code> pointers.</p>
<p><span id="RedisModule_MallocSizeDict"></span></p>
<h3 id="redismodule_mallocsizedict"><code>RedisModule_MallocSizeDict</code></h3>
<pre><code>size_t RedisModule_MallocSizeDict(RedisModuleDict* dict);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Same as <a href="#RedisModule_MallocSize"><code>RedisModule_MallocSize</code></a>, except it works on <code>RedisModuleDict</code> pointers.
Note that the returned value is only the overhead of the underlying structures,
it does not include the allocation size of the keys and values.</p>
<p><span id="RedisModule_GetUsedMemoryRatio"></span></p>
<h3 id="redismodule_getusedmemoryratio"><code>RedisModule_GetUsedMemoryRatio</code></h3>
<pre><code>float RedisModule_GetUsedMemoryRatio();
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Return the a number between 0 to 1 indicating the amount of memory
currently used, relative to the Redis "maxmemory" configuration.</p>
<ul>
<li>0 - No memory limit configured.</li>
<li>Between 0 and 1 - The percentage of the memory used normalized in 0-1 range.</li>
<li>Exactly 1 - Memory limit reached.</li>
<li>Greater 1 - More memory used than the configured limit.</li>
</ul>
<p><span id="section-scanning-keyspace-and-hashes"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Scanning%20keyspace%20and%20hashes"></a><h2 id="scanning-keyspace-and-hashes">Scanning keyspace and hashes</h2>
<p><span id="RedisModule_ScanCursorCreate"></span></p>
<h3 id="redismodule_scancursorcreate"><code>RedisModule_ScanCursorCreate</code></h3>
<pre><code>RedisModuleScanCursor *RedisModule_ScanCursorCreate();
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Create a new cursor to be used with <a href="#RedisModule_Scan"><code>RedisModule_Scan</code></a></p>
<p><span id="RedisModule_ScanCursorRestart"></span></p>
<h3 id="redismodule_scancursorrestart"><code>RedisModule_ScanCursorRestart</code></h3>
<pre><code>void RedisModule_ScanCursorRestart(RedisModuleScanCursor *cursor);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Restart an existing cursor. The keys will be rescanned.</p>
<p><span id="RedisModule_ScanCursorDestroy"></span></p>
<h3 id="redismodule_scancursordestroy"><code>RedisModule_ScanCursorDestroy</code></h3>
<pre><code>void RedisModule_ScanCursorDestroy(RedisModuleScanCursor *cursor);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Destroy the cursor struct.</p>
<p><span id="RedisModule_Scan"></span></p>
<h3 id="redismodule_scan"><code>RedisModule_Scan</code></h3>
<pre><code>int RedisModule_Scan(RedisModuleCtx *ctx,
                     RedisModuleScanCursor *cursor,
                     RedisModuleScanCB fn,
                     void *privdata);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Scan API that allows a module to scan all the keys and value in
the selected db.</p>
<p>Callback for scan implementation.</p>
<pre><code>void scan_callback(RedisModuleCtx *ctx, RedisModuleString *keyname,
                   RedisModuleKey *key, void *privdata);
</code></pre>
<ul>
<li><code>ctx</code>: the redis module context provided to for the scan.</li>
<li><code>keyname</code>: owned by the caller and need to be retained if used after this
function.</li>
<li><code>key</code>: holds info on the key and value, it is provided as best effort, in
some cases it might be NULL, in which case the user should (can) use
<a href="#RedisModule_OpenKey"><code>RedisModule_OpenKey()</code></a> (and CloseKey too).
when it is provided, it is owned by the caller and will be free when the
callback returns.</li>
<li><code>privdata</code>: the user data provided to <a href="#RedisModule_Scan"><code>RedisModule_Scan()</code></a>.</li>
</ul>
<p>The way it should be used:</p>
<pre><code> RedisModuleScanCursor *c = RedisModule_ScanCursorCreate();
 while(RedisModule_Scan(ctx, c, callback, privateData));
 RedisModule_ScanCursorDestroy(c);
</code></pre>
<p>It is also possible to use this API from another thread while the lock
is acquired during the actual call to <a href="#RedisModule_Scan"><code>RedisModule_Scan</code></a>:</p>
<pre><code> RedisModuleScanCursor *c = RedisModule_ScanCursorCreate();
 RedisModule_ThreadSafeContextLock(ctx);
 while(RedisModule_Scan(ctx, c, callback, privateData)){
     RedisModule_ThreadSafeContextUnlock(ctx);
     // do some background job
     RedisModule_ThreadSafeContextLock(ctx);
 }
 RedisModule_ScanCursorDestroy(c);
</code></pre>
<p>The function will return 1 if there are more elements to scan and
0 otherwise, possibly setting errno if the call failed.</p>
<p>It is also possible to restart an existing cursor using <a href="#RedisModule_ScanCursorRestart"><code>RedisModule_ScanCursorRestart</code></a>.</p>
<p>IMPORTANT: This API is very similar to the Redis SCAN command from the
point of view of the guarantees it provides. This means that the API
may report duplicated keys, but guarantees to report at least one time
every key that was there from the start to the end of the scanning process.</p>
<p>NOTE: If you do database changes within the callback, you should be aware
that the internal state of the database may change. For instance it is safe
to delete or modify the current key, but may not be safe to delete any
other key.
Moreover playing with the Redis keyspace while iterating may have the
effect of returning more duplicates. A safe pattern is to store the keys
names you want to modify elsewhere, and perform the actions on the keys
later when the iteration is complete. However this can cost a lot of
memory, so it may make sense to just operate on the current key when
possible during the iteration, given that this is safe.</p>
<p><span id="RedisModule_ScanKey"></span></p>
<h3 id="redismodule_scankey"><code>RedisModule_ScanKey</code></h3>
<pre><code>int RedisModule_ScanKey(RedisModuleKey *key,
                        RedisModuleScanCursor *cursor,
                        RedisModuleScanKeyCB fn,
                        void *privdata);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Scan api that allows a module to scan the elements in a hash, set or sorted set key</p>
<p>Callback for scan implementation.</p>
<pre><code>void scan_callback(RedisModuleKey *key, RedisModuleString* field, RedisModuleString* value, void *privdata);
</code></pre>
<ul>
<li>key - the redis key context provided to for the scan.</li>
<li>field - field name, owned by the caller and need to be retained if used
after this function.</li>
<li>value - value string or NULL for set type, owned by the caller and need to
be retained if used after this function.</li>
<li>privdata - the user data provided to <a href="#RedisModule_ScanKey"><code>RedisModule_ScanKey</code></a>.</li>
</ul>
<p>The way it should be used:</p>
<pre><code> RedisModuleScanCursor *c = RedisModule_ScanCursorCreate();
 RedisModuleKey *key = RedisModule_OpenKey(...)
 while(RedisModule_ScanKey(key, c, callback, privateData));
 RedisModule_CloseKey(key);
 RedisModule_ScanCursorDestroy(c);
</code></pre>
<p>It is also possible to use this API from another thread while the lock is acquired during
the actual call to <a href="#RedisModule_ScanKey"><code>RedisModule_ScanKey</code></a>, and re-opening the key each time:</p>
<pre><code> RedisModuleScanCursor *c = RedisModule_ScanCursorCreate();
 RedisModule_ThreadSafeContextLock(ctx);
 RedisModuleKey *key = RedisModule_OpenKey(...)
 while(RedisModule_ScanKey(ctx, c, callback, privateData)){
     RedisModule_CloseKey(key);
     RedisModule_ThreadSafeContextUnlock(ctx);
     // do some background job
     RedisModule_ThreadSafeContextLock(ctx);
     RedisModuleKey *key = RedisModule_OpenKey(...)
 }
 RedisModule_CloseKey(key);
 RedisModule_ScanCursorDestroy(c);
</code></pre>
<p>The function will return 1 if there are more elements to scan and 0 otherwise,
possibly setting errno if the call failed.
It is also possible to restart an existing cursor using <a href="#RedisModule_ScanCursorRestart"><code>RedisModule_ScanCursorRestart</code></a>.</p>
<p>NOTE: Certain operations are unsafe while iterating the object. For instance
while the API guarantees to return at least one time all the elements that
are present in the data structure consistently from the start to the end
of the iteration (see HSCAN and similar commands documentation), the more
you play with the elements, the more duplicates you may get. In general
deleting the current element of the data structure is safe, while removing
the key you are iterating is not safe.</p>
<p><span id="section-module-fork-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Module%20fork%20API"></a><h2 id="module-fork-api">Module fork API</h2>
<p><span id="RedisModule_Fork"></span></p>
<h3 id="redismodule_fork"><code>RedisModule_Fork</code></h3>
<pre><code>int RedisModule_Fork(RedisModuleForkDoneHandler cb, void *user_data);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Create a background child process with the current frozen snapshot of the
main process where you can do some processing in the background without
affecting / freezing the traffic and no need for threads and GIL locking.
Note that Redis allows for only one concurrent fork.
When the child wants to exit, it should call <a href="#RedisModule_ExitFromChild"><code>RedisModule_ExitFromChild</code></a>.
If the parent wants to kill the child it should call <a href="#RedisModule_KillForkChild"><code>RedisModule_KillForkChild</code></a>
The done handler callback will be executed on the parent process when the
child existed (but not when killed)
Return: -1 on failure, on success the parent process will get a positive PID
of the child, and the child process will get 0.</p>
<p><span id="RedisModule_SendChildHeartbeat"></span></p>
<h3 id="redismodule_sendchildheartbeat"><code>RedisModule_SendChildHeartbeat</code></h3>
<pre><code>void RedisModule_SendChildHeartbeat(double progress);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>The module is advised to call this function from the fork child once in a while,
so that it can report progress and COW memory to the parent which will be
reported in INFO.
The <code>progress</code> argument should between 0 and 1, or -1 when not available.</p>
<p><span id="RedisModule_ExitFromChild"></span></p>
<h3 id="redismodule_exitfromchild"><code>RedisModule_ExitFromChild</code></h3>
<pre><code>int RedisModule_ExitFromChild(int retcode);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Call from the child process when you want to terminate it.
retcode will be provided to the done handler executed on the parent process.</p>
<p><span id="RedisModule_KillForkChild"></span></p>
<h3 id="redismodule_killforkchild"><code>RedisModule_KillForkChild</code></h3>
<pre><code>int RedisModule_KillForkChild(int child_pid);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Can be used to kill the forked child process from the parent process.
<code>child_pid</code> would be the return value of <a href="#RedisModule_Fork"><code>RedisModule_Fork</code></a>.</p>
<p><span id="section-server-hooks-implementation"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Server%20hooks%20implementation"></a><h2 id="server-hooks-implementation">Server hooks implementation</h2>
<p><span id="RedisModule_SubscribeToServerEvent"></span></p>
<h3 id="redismodule_subscribetoserverevent"><code>RedisModule_SubscribeToServerEvent</code></h3>
<pre><code>int RedisModule_SubscribeToServerEvent(RedisModuleCtx *ctx,
                                       RedisModuleEvent event,
                                       RedisModuleEventCallback callback);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Register to be notified, via a callback, when the specified server event
happens. The callback is called with the event as argument, and an additional
argument which is a void pointer and should be cased to a specific type
that is event-specific (but many events will just use NULL since they do not
have additional information to pass to the callback).</p>
<p>If the callback is NULL and there was a previous subscription, the module
will be unsubscribed. If there was a previous subscription and the callback
is not null, the old callback will be replaced with the new one.</p>
<p>The callback must be of this type:</p>
<pre><code>int (*RedisModuleEventCallback)(RedisModuleCtx *ctx,
                                RedisModuleEvent eid,
                                uint64_t subevent,
                                void *data);
</code></pre>
<p>The 'ctx' is a normal Redis module context that the callback can use in
order to call other modules APIs. The 'eid' is the event itself, this
is only useful in the case the module subscribed to multiple events: using
the 'id' field of this structure it is possible to check if the event
is one of the events we registered with this callback. The 'subevent' field
depends on the event that fired.</p>
<p>Finally the 'data' pointer may be populated, only for certain events, with
more relevant data.</p>
<p>Here is a list of events you can use as 'eid' and related sub events:</p>
<ul>
<li>
<p><code>RedisModuleEvent_ReplicationRoleChanged</code>:</p>
<p>This event is called when the instance switches from master
to replica or the other way around, however the event is
also called when the replica remains a replica but starts to
replicate with a different master.</p>
<p>The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_REPLROLECHANGED_NOW_MASTER</code></li>
<li><code>REDISMODULE_SUBEVENT_REPLROLECHANGED_NOW_REPLICA</code></li>
</ul>
<p>The 'data' field can be casted by the callback to a
<code>RedisModuleReplicationInfo</code> structure with the following fields:</p>
<pre><code>  int master; // true if master, false if replica
  char *masterhost; // master instance hostname for NOW_REPLICA
  int masterport; // master instance port for NOW_REPLICA
  char *replid1; // Main replication ID
  char *replid2; // Secondary replication ID
  uint64_t repl1_offset; // Main replication offset
  uint64_t repl2_offset; // Offset of replid2 validity
</code></pre>
</li>
<li>
<p><code>RedisModuleEvent_Persistence</code></p>
<p>This event is called when RDB saving or AOF rewriting starts
and ends. The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_PERSISTENCE_RDB_START</code></li>
<li><code>REDISMODULE_SUBEVENT_PERSISTENCE_AOF_START</code></li>
<li><code>REDISMODULE_SUBEVENT_PERSISTENCE_SYNC_RDB_START</code></li>
<li><code>REDISMODULE_SUBEVENT_PERSISTENCE_SYNC_AOF_START</code></li>
<li><code>REDISMODULE_SUBEVENT_PERSISTENCE_ENDED</code></li>
<li><code>REDISMODULE_SUBEVENT_PERSISTENCE_FAILED</code></li>
</ul>
<p>The above events are triggered not just when the user calls the
relevant commands like BGSAVE, but also when a saving operation
or AOF rewriting occurs because of internal server triggers.
The SYNC_RDB_START sub events are happening in the foreground due to
SAVE command, FLUSHALL, or server shutdown, and the other RDB and
AOF sub events are executed in a background fork child, so any
action the module takes can only affect the generated AOF or RDB,
but will not be reflected in the parent process and affect connected
clients and commands. Also note that the AOF_START sub event may end
up saving RDB content in case of an AOF with rdb-preamble.</p>
</li>
<li>
<p><code>RedisModuleEvent_FlushDB</code></p>
<p>The FLUSHALL, FLUSHDB or an internal flush (for instance
because of replication, after the replica synchronization)
happened. The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_FLUSHDB_START</code></li>
<li><code>REDISMODULE_SUBEVENT_FLUSHDB_END</code></li>
</ul>
<p>The data pointer can be casted to a RedisModuleFlushInfo
structure with the following fields:</p>
<pre><code>  int32_t async;  // True if the flush is done in a thread.
                  // See for instance FLUSHALL ASYNC.
                  // In this case the END callback is invoked
                  // immediately after the database is put
                  // in the free list of the thread.
  int32_t dbnum;  // Flushed database number, -1 for all the DBs
                  // in the case of the FLUSHALL operation.
</code></pre>
<p>The start event is called <em>before</em> the operation is initiated, thus
allowing the callback to call DBSIZE or other operation on the
yet-to-free keyspace.</p>
</li>
<li>
<p><code>RedisModuleEvent_Loading</code></p>
<p>Called on loading operations: at startup when the server is
started, but also after a first synchronization when the
replica is loading the RDB file from the master.
The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_LOADING_RDB_START</code></li>
<li><code>REDISMODULE_SUBEVENT_LOADING_AOF_START</code></li>
<li><code>REDISMODULE_SUBEVENT_LOADING_REPL_START</code></li>
<li><code>REDISMODULE_SUBEVENT_LOADING_ENDED</code></li>
<li><code>REDISMODULE_SUBEVENT_LOADING_FAILED</code></li>
</ul>
<p>Note that AOF loading may start with an RDB data in case of
rdb-preamble, in which case you'll only receive an AOF_START event.</p>
</li>
<li>
<p><code>RedisModuleEvent_ClientChange</code></p>
<p>Called when a client connects or disconnects.
The data pointer can be casted to a RedisModuleClientInfo
structure, documented in RedisModule_GetClientInfoById().
The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_CLIENT_CHANGE_CONNECTED</code></li>
<li><code>REDISMODULE_SUBEVENT_CLIENT_CHANGE_DISCONNECTED</code></li>
</ul>
</li>
<li>
<p><code>RedisModuleEvent_Shutdown</code></p>
<p>The server is shutting down. No subevents are available.</p>
</li>
<li>
<p><code>RedisModuleEvent_ReplicaChange</code></p>
<p>This event is called when the instance (that can be both a
master or a replica) get a new online replica, or lose a
replica since it gets disconnected.
The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_REPLICA_CHANGE_ONLINE</code></li>
<li><code>REDISMODULE_SUBEVENT_REPLICA_CHANGE_OFFLINE</code></li>
</ul>
<p>No additional information is available so far: future versions
of Redis will have an API in order to enumerate the replicas
connected and their state.</p>
</li>
<li>
<p><code>RedisModuleEvent_CronLoop</code></p>
<p>This event is called every time Redis calls the serverCron()
function in order to do certain bookkeeping. Modules that are
required to do operations from time to time may use this callback.
Normally Redis calls this function 10 times per second, but
this changes depending on the "hz" configuration.
No sub events are available.</p>
<p>The data pointer can be casted to a RedisModuleCronLoop
structure with the following fields:</p>
<pre><code>  int32_t hz;  // Approximate number of events per second.
</code></pre>
</li>
<li>
<p><code>RedisModuleEvent_MasterLinkChange</code></p>
<p>This is called for replicas in order to notify when the
replication link becomes functional (up) with our master,
or when it goes down. Note that the link is not considered
up when we just connected to the master, but only if the
replication is happening correctly.
The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_MASTER_LINK_UP</code></li>
<li><code>REDISMODULE_SUBEVENT_MASTER_LINK_DOWN</code></li>
</ul>
</li>
<li>
<p><code>RedisModuleEvent_ModuleChange</code></p>
<p>This event is called when a new module is loaded or one is unloaded.
The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_MODULE_LOADED</code></li>
<li><code>REDISMODULE_SUBEVENT_MODULE_UNLOADED</code></li>
</ul>
<p>The data pointer can be casted to a RedisModuleModuleChange
structure with the following fields:</p>
<pre><code>  const char* module_name;  // Name of module loaded or unloaded.
  int32_t module_version;  // Module version.
</code></pre>
</li>
<li>
<p><code>RedisModuleEvent_LoadingProgress</code></p>
<p>This event is called repeatedly called while an RDB or AOF file
is being loaded.
The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_LOADING_PROGRESS_RDB</code></li>
<li><code>REDISMODULE_SUBEVENT_LOADING_PROGRESS_AOF</code></li>
</ul>
<p>The data pointer can be casted to a RedisModuleLoadingProgress
structure with the following fields:</p>
<pre><code>  int32_t hz;  // Approximate number of events per second.
  int32_t progress;  // Approximate progress between 0 and 1024,
                     // or -1 if unknown.
</code></pre>
</li>
<li>
<p><code>RedisModuleEvent_SwapDB</code></p>
<p>This event is called when a SWAPDB command has been successfully
Executed.
For this event call currently there is no subevents available.</p>
<p>The data pointer can be casted to a RedisModuleSwapDbInfo
structure with the following fields:</p>
<pre><code>  int32_t dbnum_first;    // Swap Db first dbnum
  int32_t dbnum_second;   // Swap Db second dbnum
</code></pre>
</li>
<li>
<p><code>RedisModuleEvent_ReplBackup</code></p>
<p>WARNING: Replication Backup events are deprecated since Redis 7.0 and are never fired.
See RedisModuleEvent_ReplAsyncLoad for understanding how Async Replication Loading events
are now triggered when repl-diskless-load is set to swapdb.</p>
<p>Called when repl-diskless-load config is set to swapdb,
And redis needs to backup the current database for the
possibility to be restored later. A module with global data and
maybe with aux_load and aux_save callbacks may need to use this
notification to backup / restore / discard its globals.
The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_REPL_BACKUP_CREATE</code></li>
<li><code>REDISMODULE_SUBEVENT_REPL_BACKUP_RESTORE</code></li>
<li><code>REDISMODULE_SUBEVENT_REPL_BACKUP_DISCARD</code></li>
</ul>
</li>
<li>
<p><code>RedisModuleEvent_ReplAsyncLoad</code></p>
<p>Called when repl-diskless-load config is set to swapdb and a replication with a master of same
data set history (matching replication ID) occurs.
In which case redis serves current data set while loading new database in memory from socket.
Modules must have declared they support this mechanism in order to activate it, through
REDISMODULE_OPTIONS_HANDLE_REPL_ASYNC_LOAD flag.
The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_REPL_ASYNC_LOAD_STARTED</code></li>
<li><code>REDISMODULE_SUBEVENT_REPL_ASYNC_LOAD_ABORTED</code></li>
<li><code>REDISMODULE_SUBEVENT_REPL_ASYNC_LOAD_COMPLETED</code></li>
</ul>
</li>
<li>
<p><code>RedisModuleEvent_ForkChild</code></p>
<p>Called when a fork child (AOFRW, RDBSAVE, module fork...) is born/dies
The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_FORK_CHILD_BORN</code></li>
<li><code>REDISMODULE_SUBEVENT_FORK_CHILD_DIED</code></li>
</ul>
</li>
<li>
<p><code>RedisModuleEvent_EventLoop</code></p>
<p>Called on each event loop iteration, once just before the event loop goes
to sleep or just after it wakes up.
The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_EVENTLOOP_BEFORE_SLEEP</code></li>
<li><code>REDISMODULE_SUBEVENT_EVENTLOOP_AFTER_SLEEP</code></li>
</ul>
</li>
<li>
<p><code>RedisModule_Event_Config</code></p>
<p>Called when a configuration event happens
The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_CONFIG_CHANGE</code></li>
</ul>
<p>The data pointer can be casted to a RedisModuleConfigChange
structure with the following fields:</p>
<pre><code>  const char **config_names; // An array of C string pointers containing the
                             // name of each modified configuration item 
  uint32_t num_changes;      // The number of elements in the config_names array
</code></pre>
</li>
<li>
<p><code>RedisModule_Event_Key</code></p>
<p>Called when a key is removed from the keyspace. We can't modify any key in
the event.
The following sub events are available:</p>
<ul>
<li><code>REDISMODULE_SUBEVENT_KEY_DELETED</code></li>
<li><code>REDISMODULE_SUBEVENT_KEY_EXPIRED</code></li>
<li><code>REDISMODULE_SUBEVENT_KEY_EVICTED</code></li>
<li><code>REDISMODULE_SUBEVENT_KEY_OVERWRITTEN</code></li>
</ul>
<p>The data pointer can be casted to a RedisModuleKeyInfo
structure with the following fields:</p>
<pre><code>  RedisModuleKey *key;    // Key name
</code></pre>
</li>
</ul>
<p>The function returns <code>REDISMODULE_OK</code> if the module was successfully subscribed
for the specified event. If the API is called from a wrong context or unsupported event
is given then <code>REDISMODULE_ERR</code> is returned.</p>
<p><span id="RedisModule_IsSubEventSupported"></span></p>
<h3 id="redismodule_issubeventsupported"><code>RedisModule_IsSubEventSupported</code></h3>
<pre><code>int RedisModule_IsSubEventSupported(RedisModuleEvent event, int64_t subevent);
</code></pre>
<p><strong>Available since:</strong> 6.0.9</p>
<p>For a given server event and subevent, return zero if the
subevent is not supported and non-zero otherwise.</p>
<p><span id="section-module-configurations-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Module%20Configurations%20API"></a><h2 id="module-configurations-api">Module Configurations API</h2>
<p><span id="RedisModule_RegisterStringConfig"></span></p>
<h3 id="redismodule_registerstringconfig"><code>RedisModule_RegisterStringConfig</code></h3>
<pre><code>int RedisModule_RegisterStringConfig(RedisModuleCtx *ctx,
                                     const char *name,
                                     const char *default_val,
                                     unsigned int flags,
                                     RedisModuleConfigGetStringFunc getfn,
                                     RedisModuleConfigSetStringFunc setfn,
                                     RedisModuleConfigApplyFunc applyfn,
                                     void *privdata);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Create a string config that Redis users can interact with via the Redis config file,
<a href="../../../commands/config-set.html"><code>CONFIG SET</code></a>, <a href="../../../commands/config-get.html"><code>CONFIG GET</code></a>, and <a href="../../../commands/config-rewrite.html"><code>CONFIG REWRITE</code></a> commands.</p>
<p>The actual config value is owned by the module, and the <code>getfn</code>, <code>setfn</code> and optional
<code>applyfn</code> callbacks that are provided to Redis in order to access or manipulate the
value. The <code>getfn</code> callback retrieves the value from the module, while the <code>setfn</code>
callback provides a value to be stored into the module config.
The optional <code>applyfn</code> callback is called after a <a href="../../../commands/config-set.html"><code>CONFIG SET</code></a> command modified one or
more configs using the <code>setfn</code> callback and can be used to atomically apply a config
after several configs were changed together.
If there are multiple configs with <code>applyfn</code> callbacks set by a single <a href="../../../commands/config-set.html"><code>CONFIG SET</code></a>
command, they will be deduplicated if their <code>applyfn</code> function and <code>privdata</code> pointers
are identical, and the callback will only be run once.
Both the <code>setfn</code> and <code>applyfn</code> can return an error if the provided value is invalid or
cannot be used.
The config also declares a type for the value that is validated by Redis and
provided to the module. The config system provides the following types:</p>
<ul>
<li>Redis String: Binary safe string data.</li>
<li>Enum: One of a finite number of string tokens, provided during registration.</li>
<li>Numeric: 64 bit signed integer, which also supports min and max values.</li>
<li>Bool: Yes or no value.</li>
</ul>
<p>The <code>setfn</code> callback is expected to return <code>REDISMODULE_OK</code> when the value is successfully
applied. It can also return <code>REDISMODULE_ERR</code> if the value can't be applied, and the
*err pointer can be set with a <code>RedisModuleString</code> error message to provide to the client.
This <code>RedisModuleString</code> will be freed by redis after returning from the set callback.</p>
<p>All configs are registered with a name, a type, a default value, private data that is made
available in the callbacks, as well as several flags that modify the behavior of the config.
The name must only contain alphanumeric characters or dashes. The supported flags are:</p>
<ul>
<li><code>REDISMODULE_CONFIG_DEFAULT</code>: The default flags for a config. This creates a config that can be modified after startup.</li>
<li><code>REDISMODULE_CONFIG_IMMUTABLE</code>: This config can only be provided loading time.</li>
<li><code>REDISMODULE_CONFIG_SENSITIVE</code>: The value stored in this config is redacted from all logging.</li>
<li><code>REDISMODULE_CONFIG_HIDDEN</code>: The name is hidden from <a href="../../../commands/config-get.html"><code>CONFIG GET</code></a> with pattern matching.</li>
<li><code>REDISMODULE_CONFIG_PROTECTED</code>: This config will be only be modifiable based off the value of enable-protected-configs.</li>
<li><code>REDISMODULE_CONFIG_DENY_LOADING</code>: This config is not modifiable while the server is loading data.</li>
<li><code>REDISMODULE_CONFIG_MEMORY</code>: For numeric configs, this config will convert data unit notations into their byte equivalent.</li>
<li><code>REDISMODULE_CONFIG_BITFLAGS</code>: For enum configs, this config will allow multiple entries to be combined as bit flags.</li>
</ul>
<p>Default values are used on startup to set the value if it is not provided via the config file
or command line. Default values are also used to compare to on a config rewrite.</p>
<p>Notes:</p>
<ol>
<li>On string config sets that the string passed to the set callback will be freed after execution and the module must retain it.</li>
<li>On string config gets the string will not be consumed and will be valid after execution.</li>
</ol>
<p>Example implementation:</p>
<pre><code>RedisModuleString *strval;
int adjustable = 1;
RedisModuleString *getStringConfigCommand(const char *name, void *privdata) {
    return strval;
}

int setStringConfigCommand(const char *name, RedisModuleString *new, void *privdata, RedisModuleString **err) {
   if (adjustable) {
       RedisModule_Free(strval);
       RedisModule_RetainString(NULL, new);
       strval = new;
       return REDISMODULE_OK;
   }
   *err = RedisModule_CreateString(NULL, "Not adjustable.", 15);
   return REDISMODULE_ERR;
}
...
RedisModule_RegisterStringConfig(ctx, "string", NULL, REDISMODULE_CONFIG_DEFAULT, getStringConfigCommand, setStringConfigCommand, NULL, NULL);
</code></pre>
<p>If the registration fails, <code>REDISMODULE_ERR</code> is returned and one of the following
errno is set:</p>
<ul>
<li>EBUSY: Registering the Config outside of <code>RedisModule_OnLoad</code>.</li>
<li>EINVAL: The provided flags are invalid for the registration or the name of the config contains invalid characters.</li>
<li>EALREADY: The provided configuration name is already used.</li>
</ul>
<p><span id="RedisModule_RegisterBoolConfig"></span></p>
<h3 id="redismodule_registerboolconfig"><code>RedisModule_RegisterBoolConfig</code></h3>
<pre><code>int RedisModule_RegisterBoolConfig(RedisModuleCtx *ctx,
                                   const char *name,
                                   int default_val,
                                   unsigned int flags,
                                   RedisModuleConfigGetBoolFunc getfn,
                                   RedisModuleConfigSetBoolFunc setfn,
                                   RedisModuleConfigApplyFunc applyfn,
                                   void *privdata);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Create a bool config that server clients can interact with via the
<a href="../../../commands/config-set.html"><code>CONFIG SET</code></a>, <a href="../../../commands/config-get.html"><code>CONFIG GET</code></a>, and <a href="../../../commands/config-rewrite.html"><code>CONFIG REWRITE</code></a> commands. See
<a href="#RedisModule_RegisterStringConfig"><code>RedisModule_RegisterStringConfig</code></a> for detailed information about configs.</p>
<p><span id="RedisModule_RegisterEnumConfig"></span></p>
<h3 id="redismodule_registerenumconfig"><code>RedisModule_RegisterEnumConfig</code></h3>
<pre><code>int RedisModule_RegisterEnumConfig(RedisModuleCtx *ctx,
                                   const char *name,
                                   int default_val,
                                   unsigned int flags,
                                   const char **enum_values,
                                   const int *int_values,
                                   int num_enum_vals,
                                   RedisModuleConfigGetEnumFunc getfn,
                                   RedisModuleConfigSetEnumFunc setfn,
                                   RedisModuleConfigApplyFunc applyfn,
                                   void *privdata);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Create an enum config that server clients can interact with via the
<a href="../../../commands/config-set.html"><code>CONFIG SET</code></a>, <a href="../../../commands/config-get.html"><code>CONFIG GET</code></a>, and <a href="../../../commands/config-rewrite.html"><code>CONFIG REWRITE</code></a> commands.
Enum configs are a set of string tokens to corresponding integer values, where
the string value is exposed to Redis clients but the value passed Redis and the
module is the integer value. These values are defined in <code>enum_values</code>, an array
of null-terminated c strings, and <code>int_vals</code>, an array of enum values who has an
index partner in <code>enum_values</code>.
Example Implementation:
const char *enum_vals[3] = {"first", "second", "third"};
const int int_vals[3] = {0, 2, 4};
int enum_val = 0;</p>
<pre><code> int getEnumConfigCommand(const char *name, void *privdata) {
     return enum_val;
 }
  
 int setEnumConfigCommand(const char *name, int val, void *privdata, const char **err) {
     enum_val = val;
     return REDISMODULE_OK;
 }
 ...
 RedisModule_RegisterEnumConfig(ctx, "enum", 0, REDISMODULE_CONFIG_DEFAULT, enum_vals, int_vals, 3, getEnumConfigCommand, setEnumConfigCommand, NULL, NULL);
</code></pre>
<p>Note that you can use <code>REDISMODULE_CONFIG_BITFLAGS</code> so that multiple enum string
can be combined into one integer as bit flags, in which case you may want to
sort your enums so that the preferred combinations are present first.</p>
<p>See <a href="#RedisModule_RegisterStringConfig"><code>RedisModule_RegisterStringConfig</code></a> for detailed general information about configs.</p>
<p><span id="RedisModule_RegisterNumericConfig"></span></p>
<h3 id="redismodule_registernumericconfig"><code>RedisModule_RegisterNumericConfig</code></h3>
<pre><code>int RedisModule_RegisterNumericConfig(RedisModuleCtx *ctx,
                                      const char *name,
                                      long long default_val,
                                      unsigned int flags,
                                      long long min,
                                      long long max,
                                      RedisModuleConfigGetNumericFunc getfn,
                                      RedisModuleConfigSetNumericFunc setfn,
                                      RedisModuleConfigApplyFunc applyfn,
                                      void *privdata);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Create an integer config that server clients can interact with via the
<a href="../../../commands/config-set.html"><code>CONFIG SET</code></a>, <a href="../../../commands/config-get.html"><code>CONFIG GET</code></a>, and <a href="../../../commands/config-rewrite.html"><code>CONFIG REWRITE</code></a> commands. See
<a href="#RedisModule_RegisterStringConfig"><code>RedisModule_RegisterStringConfig</code></a> for detailed information about configs.</p>
<p><span id="RedisModule_LoadConfigs"></span></p>
<h3 id="redismodule_loadconfigs"><code>RedisModule_LoadConfigs</code></h3>
<pre><code>int RedisModule_LoadConfigs(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Applies all pending configurations on the module load. This should be called
after all of the configurations have been registered for the module inside of <code>RedisModule_OnLoad</code>.
This will return <code>REDISMODULE_ERR</code> if it is called outside <code>RedisModule_OnLoad</code>.
This API needs to be called when configurations are provided in either <a href="../../../commands/module-loadex.html"><code>MODULE LOADEX</code></a>
or provided as startup arguments.</p>
<p><span id="section-key-eviction-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Key%20eviction%20API"></a><h2 id="key-eviction-api">Key eviction API</h2>
<p><span id="RedisModule_SetLRU"></span></p>
<h3 id="redismodule_setlru"><code>RedisModule_SetLRU</code></h3>
<pre><code>int RedisModule_SetLRU(RedisModuleKey *key, mstime_t lru_idle);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Set the key last access time for LRU based eviction. not relevant if the
servers's maxmemory policy is LFU based. Value is idle time in milliseconds.
returns <code>REDISMODULE_OK</code> if the LRU was updated, <code>REDISMODULE_ERR</code> otherwise.</p>
<p><span id="RedisModule_GetLRU"></span></p>
<h3 id="redismodule_getlru"><code>RedisModule_GetLRU</code></h3>
<pre><code>int RedisModule_GetLRU(RedisModuleKey *key, mstime_t *lru_idle);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Gets the key last access time.
Value is idletime in milliseconds or -1 if the server's eviction policy is
LFU based.
returns <code>REDISMODULE_OK</code> if when key is valid.</p>
<p><span id="RedisModule_SetLFU"></span></p>
<h3 id="redismodule_setlfu"><code>RedisModule_SetLFU</code></h3>
<pre><code>int RedisModule_SetLFU(RedisModuleKey *key, long long lfu_freq);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Set the key access frequency. only relevant if the server's maxmemory policy
is LFU based.
The frequency is a logarithmic counter that provides an indication of
the access frequencyonly (must be &lt;= 255).
returns <code>REDISMODULE_OK</code> if the LFU was updated, <code>REDISMODULE_ERR</code> otherwise.</p>
<p><span id="RedisModule_GetLFU"></span></p>
<h3 id="redismodule_getlfu"><code>RedisModule_GetLFU</code></h3>
<pre><code>int RedisModule_GetLFU(RedisModuleKey *key, long long *lfu_freq);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Gets the key access frequency or -1 if the server's eviction policy is not
LFU based.
returns <code>REDISMODULE_OK</code> if when key is valid.</p>
<p><span id="section-miscellaneous-apis"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Miscellaneous%20APIs"></a><h2 id="miscellaneous-apis">Miscellaneous APIs</h2>
<p><span id="RedisModule_GetModuleOptionsAll"></span></p>
<h3 id="redismodule_getmoduleoptionsall"><code>RedisModule_GetModuleOptionsAll</code></h3>
<pre><code>int RedisModule_GetModuleOptionsAll();
</code></pre>
<p><strong>Available since:</strong> unreleased</p>
<p>Returns the full module options flags mask, using the return value
the module can check if a certain set of module options are supported
by the redis server version in use.
Example:</p>
<pre><code>   int supportedFlags = RedisModule_GetModuleOptionsAll();
   if (supportedFlags &amp; REDISMODULE_OPTIONS_ALLOW_NESTED_KEYSPACE_NOTIFICATIONS) {
         // REDISMODULE_OPTIONS_ALLOW_NESTED_KEYSPACE_NOTIFICATIONS is supported
   } else{
         // REDISMODULE_OPTIONS_ALLOW_NESTED_KEYSPACE_NOTIFICATIONS is not supported
   }
</code></pre>
<p><span id="RedisModule_GetContextFlagsAll"></span></p>
<h3 id="redismodule_getcontextflagsall"><code>RedisModule_GetContextFlagsAll</code></h3>
<pre><code>int RedisModule_GetContextFlagsAll();
</code></pre>
<p><strong>Available since:</strong> 6.0.9</p>
<p>Returns the full ContextFlags mask, using the return value
the module can check if a certain set of flags are supported
by the redis server version in use.
Example:</p>
<pre><code>   int supportedFlags = RedisModule_GetContextFlagsAll();
   if (supportedFlags &amp; REDISMODULE_CTX_FLAGS_MULTI) {
         // REDISMODULE_CTX_FLAGS_MULTI is supported
   } else{
         // REDISMODULE_CTX_FLAGS_MULTI is not supported
   }
</code></pre>
<p><span id="RedisModule_GetKeyspaceNotificationFlagsAll"></span></p>
<h3 id="redismodule_getkeyspacenotificationflagsall"><code>RedisModule_GetKeyspaceNotificationFlagsAll</code></h3>
<pre><code>int RedisModule_GetKeyspaceNotificationFlagsAll();
</code></pre>
<p><strong>Available since:</strong> 6.0.9</p>
<p>Returns the full KeyspaceNotification mask, using the return value
the module can check if a certain set of flags are supported
by the redis server version in use.
Example:</p>
<pre><code>   int supportedFlags = RedisModule_GetKeyspaceNotificationFlagsAll();
   if (supportedFlags &amp; REDISMODULE_NOTIFY_LOADED) {
         // REDISMODULE_NOTIFY_LOADED is supported
   } else{
         // REDISMODULE_NOTIFY_LOADED is not supported
   }
</code></pre>
<p><span id="RedisModule_GetServerVersion"></span></p>
<h3 id="redismodule_getserverversion"><code>RedisModule_GetServerVersion</code></h3>
<pre><code>int RedisModule_GetServerVersion();
</code></pre>
<p><strong>Available since:</strong> 6.0.9</p>
<p>Return the redis version in format of 0x00MMmmpp.
Example for 6.0.7 the return value will be 0x00060007.</p>
<p><span id="RedisModule_GetTypeMethodVersion"></span></p>
<h3 id="redismodule_gettypemethodversion"><code>RedisModule_GetTypeMethodVersion</code></h3>
<pre><code>int RedisModule_GetTypeMethodVersion();
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Return the current redis-server runtime value of <code>REDISMODULE_TYPE_METHOD_VERSION</code>.
You can use that when calling <a href="#RedisModule_CreateDataType"><code>RedisModule_CreateDataType</code></a> to know which fields of
<code>RedisModuleTypeMethods</code> are gonna be supported and which will be ignored.</p>
<p><span id="RedisModule_ModuleTypeReplaceValue"></span></p>
<h3 id="redismodule_moduletypereplacevalue"><code>RedisModule_ModuleTypeReplaceValue</code></h3>
<pre><code>int RedisModule_ModuleTypeReplaceValue(RedisModuleKey *key,
                                       moduleType *mt,
                                       void *new_value,
                                       void **old_value);
</code></pre>
<p><strong>Available since:</strong> 6.0.0</p>
<p>Replace the value assigned to a module type.</p>
<p>The key must be open for writing, have an existing value, and have a moduleType
that matches the one specified by the caller.</p>
<p>Unlike <a href="#RedisModule_ModuleTypeSetValue"><code>RedisModule_ModuleTypeSetValue()</code></a> which will free the old value, this function
simply swaps the old value with the new value.</p>
<p>The function returns <code>REDISMODULE_OK</code> on success, <code>REDISMODULE_ERR</code> on errors
such as:</p>
<ol>
<li>Key is not opened for writing.</li>
<li>Key is not a module data type key.</li>
<li>Key is a module datatype other than 'mt'.</li>
</ol>
<p>If <code>old_value</code> is non-NULL, the old value is returned by reference.</p>
<p><span id="RedisModule_GetCommandKeysWithFlags"></span></p>
<h3 id="redismodule_getcommandkeyswithflags"><code>RedisModule_GetCommandKeysWithFlags</code></h3>
<pre><code>int *RedisModule_GetCommandKeysWithFlags(RedisModuleCtx *ctx,
                                         RedisModuleString **argv,
                                         int argc,
                                         int *num_keys,
                                         int **out_flags);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>For a specified command, parse its arguments and return an array that
contains the indexes of all key name arguments. This function is
essentially a more efficient way to do <a href="../../../commands/command-getkeys.html"><code>COMMAND GETKEYS</code></a>.</p>
<p>The <code>out_flags</code> argument is optional, and can be set to NULL.
When provided it is filled with <code>REDISMODULE_CMD_KEY_</code> flags in matching
indexes with the key indexes of the returned array.</p>
<p>A NULL return value indicates the specified command has no keys, or
an error condition. Error conditions are indicated by setting errno
as follows:</p>
<ul>
<li>ENOENT: Specified command does not exist.</li>
<li>EINVAL: Invalid command arity specified.</li>
</ul>
<p>NOTE: The returned array is not a Redis Module object so it does not
get automatically freed even when auto-memory is used. The caller
must explicitly call <a href="#RedisModule_Free"><code>RedisModule_Free()</code></a> to free it, same as the <code>out_flags</code> pointer if
used.</p>
<p><span id="RedisModule_GetCommandKeys"></span></p>
<h3 id="redismodule_getcommandkeys"><code>RedisModule_GetCommandKeys</code></h3>
<pre><code>int *RedisModule_GetCommandKeys(RedisModuleCtx *ctx,
                                RedisModuleString **argv,
                                int argc,
                                int *num_keys);
</code></pre>
<p><strong>Available since:</strong> 6.0.9</p>
<p>Identical to <a href="#RedisModule_GetCommandKeysWithFlags"><code>RedisModule_GetCommandKeysWithFlags</code></a> when flags are not needed.</p>
<p><span id="RedisModule_GetCurrentCommandName"></span></p>
<h3 id="redismodule_getcurrentcommandname"><code>RedisModule_GetCurrentCommandName</code></h3>
<pre><code>const char *RedisModule_GetCurrentCommandName(RedisModuleCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 6.2.5</p>
<p>Return the name of the command currently running</p>
<p><span id="section-defrag-api"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Defrag%20API"></a><h2 id="defrag-api">Defrag API</h2>
<p><span id="RedisModule_RegisterDefragFunc"></span></p>
<h3 id="redismodule_registerdefragfunc"><code>RedisModule_RegisterDefragFunc</code></h3>
<pre><code>int RedisModule_RegisterDefragFunc(RedisModuleCtx *ctx,
                                   RedisModuleDefragFunc cb);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Register a defrag callback for global data, i.e. anything that the module
may allocate that is not tied to a specific data type.</p>
<p><span id="RedisModule_DefragShouldStop"></span></p>
<h3 id="redismodule_defragshouldstop"><code>RedisModule_DefragShouldStop</code></h3>
<pre><code>int RedisModule_DefragShouldStop(RedisModuleDefragCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>When the data type defrag callback iterates complex structures, this
function should be called periodically. A zero (false) return
indicates the callback may continue its work. A non-zero value (true)
indicates it should stop.</p>
<p>When stopped, the callback may use <a href="#RedisModule_DefragCursorSet"><code>RedisModule_DefragCursorSet()</code></a> to store its
position so it can later use <a href="#RedisModule_DefragCursorGet"><code>RedisModule_DefragCursorGet()</code></a> to resume defragging.</p>
<p>When stopped and more work is left to be done, the callback should
return 1. Otherwise, it should return 0.</p>
<p>NOTE: Modules should consider the frequency in which this function is called,
so it generally makes sense to do small batches of work in between calls.</p>
<p><span id="RedisModule_DefragCursorSet"></span></p>
<h3 id="redismodule_defragcursorset"><code>RedisModule_DefragCursorSet</code></h3>
<pre><code>int RedisModule_DefragCursorSet(RedisModuleDefragCtx *ctx,
                                unsigned long cursor);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Store an arbitrary cursor value for future re-use.</p>
<p>This should only be called if <a href="#RedisModule_DefragShouldStop"><code>RedisModule_DefragShouldStop()</code></a> has returned a non-zero
value and the defrag callback is about to exit without fully iterating its
data type.</p>
<p>This behavior is reserved to cases where late defrag is performed. Late
defrag is selected for keys that implement the <code>free_effort</code> callback and
return a <code>free_effort</code> value that is larger than the defrag
'active-defrag-max-scan-fields' configuration directive.</p>
<p>Smaller keys, keys that do not implement <code>free_effort</code> or the global
defrag callback are not called in late-defrag mode. In those cases, a
call to this function will return <code>REDISMODULE_ERR</code>.</p>
<p>The cursor may be used by the module to represent some progress into the
module's data type. Modules may also store additional cursor-related
information locally and use the cursor as a flag that indicates when
traversal of a new key begins. This is possible because the API makes
a guarantee that concurrent defragmentation of multiple keys will
not be performed.</p>
<p><span id="RedisModule_DefragCursorGet"></span></p>
<h3 id="redismodule_defragcursorget"><code>RedisModule_DefragCursorGet</code></h3>
<pre><code>int RedisModule_DefragCursorGet(RedisModuleDefragCtx *ctx,
                                unsigned long *cursor);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Fetch a cursor value that has been previously stored using <a href="#RedisModule_DefragCursorSet"><code>RedisModule_DefragCursorSet()</code></a>.</p>
<p>If not called for a late defrag operation, <code>REDISMODULE_ERR</code> will be returned and
the cursor should be ignored. See <a href="#RedisModule_DefragCursorSet"><code>RedisModule_DefragCursorSet()</code></a> for more details on
defrag cursors.</p>
<p><span id="RedisModule_DefragAlloc"></span></p>
<h3 id="redismodule_defragalloc"><code>RedisModule_DefragAlloc</code></h3>
<pre><code>void *RedisModule_DefragAlloc(RedisModuleDefragCtx *ctx, void *ptr);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Defrag a memory allocation previously allocated by <a href="#RedisModule_Alloc"><code>RedisModule_Alloc</code></a>, <a href="#RedisModule_Calloc"><code>RedisModule_Calloc</code></a>, etc.
The defragmentation process involves allocating a new memory block and copying
the contents to it, like <code>realloc()</code>.</p>
<p>If defragmentation was not necessary, NULL is returned and the operation has
no other effect.</p>
<p>If a non-NULL value is returned, the caller should use the new pointer instead
of the old one and update any reference to the old pointer, which must not
be used again.</p>
<p><span id="RedisModule_DefragRedisModuleString"></span></p>
<h3 id="redismodule_defragredismodulestring"><code>RedisModule_DefragRedisModuleString</code></h3>
<pre><code>RedisModuleString *RedisModule_DefragRedisModuleString(RedisModuleDefragCtx *ctx,
                                                       RedisModuleString *str);
</code></pre>
<p><strong>Available since:</strong> 6.2.0</p>
<p>Defrag a <code>RedisModuleString</code> previously allocated by <a href="#RedisModule_Alloc"><code>RedisModule_Alloc</code></a>, <a href="#RedisModule_Calloc"><code>RedisModule_Calloc</code></a>, etc.
See <a href="#RedisModule_DefragAlloc"><code>RedisModule_DefragAlloc()</code></a> for more information on how the defragmentation process
works.</p>
<p>NOTE: It is only possible to defrag strings that have a single reference.
Typically this means strings retained with <a href="#RedisModule_RetainString"><code>RedisModule_RetainString</code></a> or <a href="#RedisModule_HoldString"><code>RedisModule_HoldString</code></a>
may not be defragmentable. One exception is command argvs which, if retained
by the module, will end up with a single reference (because the reference
on the Redis side is dropped as soon as the command callback returns).</p>
<p><span id="RedisModule_GetKeyNameFromDefragCtx"></span></p>
<h3 id="redismodule_getkeynamefromdefragctx"><code>RedisModule_GetKeyNameFromDefragCtx</code></h3>
<pre><code>const RedisModuleString *RedisModule_GetKeyNameFromDefragCtx(RedisModuleDefragCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Returns the name of the key currently being processed.
There is no guarantee that the key name is always available, so this may return NULL.</p>
<p><span id="RedisModule_GetDbIdFromDefragCtx"></span></p>
<h3 id="redismodule_getdbidfromdefragctx"><code>RedisModule_GetDbIdFromDefragCtx</code></h3>
<pre><code>int RedisModule_GetDbIdFromDefragCtx(RedisModuleDefragCtx *ctx);
</code></pre>
<p><strong>Available since:</strong> 7.0.0</p>
<p>Returns the database id of the key currently being processed.
There is no guarantee that this info is always available, so this may return -1.</p>
<p><span id="section-function-index"></span></p>
<a class="dashAnchor" name="//apple_ref/Section/Function%20index"></a><h2 id="function-index">Function index</h2>
<ul>
<li><a href="#RedisModule_ACLAddLogEntry"><code>RedisModule_ACLAddLogEntry</code></a></li>
<li><a href="#RedisModule_ACLAddLogEntryByUserName"><code>RedisModule_ACLAddLogEntryByUserName</code></a></li>
<li><a href="#RedisModule_ACLCheckChannelPermissions"><code>RedisModule_ACLCheckChannelPermissions</code></a></li>
<li><a href="#RedisModule_ACLCheckCommandPermissions"><code>RedisModule_ACLCheckCommandPermissions</code></a></li>
<li><a href="#RedisModule_ACLCheckKeyPermissions"><code>RedisModule_ACLCheckKeyPermissions</code></a></li>
<li><a href="#RedisModule_AbortBlock"><code>RedisModule_AbortBlock</code></a></li>
<li><a href="#RedisModule_AddPostNotificationJob"><code>RedisModule_AddPostNotificationJob</code></a></li>
<li><a href="#RedisModule_Alloc"><code>RedisModule_Alloc</code></a></li>
<li><a href="#RedisModule_AuthenticateClientWithACLUser"><code>RedisModule_AuthenticateClientWithACLUser</code></a></li>
<li><a href="#RedisModule_AuthenticateClientWithUser"><code>RedisModule_AuthenticateClientWithUser</code></a></li>
<li><a href="#RedisModule_AutoMemory"><code>RedisModule_AutoMemory</code></a></li>
<li><a href="#RedisModule_AvoidReplicaTraffic"><code>RedisModule_AvoidReplicaTraffic</code></a></li>
<li><a href="#RedisModule_BlockClient"><code>RedisModule_BlockClient</code></a></li>
<li><a href="#RedisModule_BlockClientGetPrivateData"><code>RedisModule_BlockClientGetPrivateData</code></a></li>
<li><a href="#RedisModule_BlockClientOnAuth"><code>RedisModule_BlockClientOnAuth</code></a></li>
<li><a href="#RedisModule_BlockClientOnKeys"><code>RedisModule_BlockClientOnKeys</code></a></li>
<li><a href="#RedisModule_BlockClientOnKeysWithFlags"><code>RedisModule_BlockClientOnKeysWithFlags</code></a></li>
<li><a href="#RedisModule_BlockClientSetPrivateData"><code>RedisModule_BlockClientSetPrivateData</code></a></li>
<li><a href="#RedisModule_BlockedClientDisconnected"><code>RedisModule_BlockedClientDisconnected</code></a></li>
<li><a href="#RedisModule_BlockedClientMeasureTimeEnd"><code>RedisModule_BlockedClientMeasureTimeEnd</code></a></li>
<li><a href="#RedisModule_BlockedClientMeasureTimeStart"><code>RedisModule_BlockedClientMeasureTimeStart</code></a></li>
<li><a href="#RedisModule_CachedMicroseconds"><code>RedisModule_CachedMicroseconds</code></a></li>
<li><a href="#RedisModule_Call"><code>RedisModule_Call</code></a></li>
<li><a href="#RedisModule_CallReplyArrayElement"><code>RedisModule_CallReplyArrayElement</code></a></li>
<li><a href="#RedisModule_CallReplyAttribute"><code>RedisModule_CallReplyAttribute</code></a></li>
<li><a href="#RedisModule_CallReplyAttributeElement"><code>RedisModule_CallReplyAttributeElement</code></a></li>
<li><a href="#RedisModule_CallReplyBigNumber"><code>RedisModule_CallReplyBigNumber</code></a></li>
<li><a href="#RedisModule_CallReplyBool"><code>RedisModule_CallReplyBool</code></a></li>
<li><a href="#RedisModule_CallReplyDouble"><code>RedisModule_CallReplyDouble</code></a></li>
<li><a href="#RedisModule_CallReplyInteger"><code>RedisModule_CallReplyInteger</code></a></li>
<li><a href="#RedisModule_CallReplyLength"><code>RedisModule_CallReplyLength</code></a></li>
<li><a href="#RedisModule_CallReplyMapElement"><code>RedisModule_CallReplyMapElement</code></a></li>
<li><a href="#RedisModule_CallReplyPromiseAbort"><code>RedisModule_CallReplyPromiseAbort</code></a></li>
<li><a href="#RedisModule_CallReplyPromiseSetUnblockHandler"><code>RedisModule_CallReplyPromiseSetUnblockHandler</code></a></li>
<li><a href="#RedisModule_CallReplyProto"><code>RedisModule_CallReplyProto</code></a></li>
<li><a href="#RedisModule_CallReplySetElement"><code>RedisModule_CallReplySetElement</code></a></li>
<li><a href="#RedisModule_CallReplyStringPtr"><code>RedisModule_CallReplyStringPtr</code></a></li>
<li><a href="#RedisModule_CallReplyType"><code>RedisModule_CallReplyType</code></a></li>
<li><a href="#RedisModule_CallReplyVerbatim"><code>RedisModule_CallReplyVerbatim</code></a></li>
<li><a href="#RedisModule_Calloc"><code>RedisModule_Calloc</code></a></li>
<li><a href="#RedisModule_ChannelAtPosWithFlags"><code>RedisModule_ChannelAtPosWithFlags</code></a></li>
<li><a href="#RedisModule_CloseKey"><code>RedisModule_CloseKey</code></a></li>
<li><a href="#RedisModule_CommandFilterArgDelete"><code>RedisModule_CommandFilterArgDelete</code></a></li>
<li><a href="#RedisModule_CommandFilterArgGet"><code>RedisModule_CommandFilterArgGet</code></a></li>
<li><a href="#RedisModule_CommandFilterArgInsert"><code>RedisModule_CommandFilterArgInsert</code></a></li>
<li><a href="#RedisModule_CommandFilterArgReplace"><code>RedisModule_CommandFilterArgReplace</code></a></li>
<li><a href="#RedisModule_CommandFilterArgsCount"><code>RedisModule_CommandFilterArgsCount</code></a></li>
<li><a href="#RedisModule_CreateCommand"><code>RedisModule_CreateCommand</code></a></li>
<li><a href="#RedisModule_CreateDataType"><code>RedisModule_CreateDataType</code></a></li>
<li><a href="#RedisModule_CreateDict"><code>RedisModule_CreateDict</code></a></li>
<li><a href="#RedisModule_CreateModuleUser"><code>RedisModule_CreateModuleUser</code></a></li>
<li><a href="#RedisModule_CreateString"><code>RedisModule_CreateString</code></a></li>
<li><a href="#RedisModule_CreateStringFromCallReply"><code>RedisModule_CreateStringFromCallReply</code></a></li>
<li><a href="#RedisModule_CreateStringFromDouble"><code>RedisModule_CreateStringFromDouble</code></a></li>
<li><a href="#RedisModule_CreateStringFromLongDouble"><code>RedisModule_CreateStringFromLongDouble</code></a></li>
<li><a href="#RedisModule_CreateStringFromLongLong"><code>RedisModule_CreateStringFromLongLong</code></a></li>
<li><a href="#RedisModule_CreateStringFromStreamID"><code>RedisModule_CreateStringFromStreamID</code></a></li>
<li><a href="#RedisModule_CreateStringFromString"><code>RedisModule_CreateStringFromString</code></a></li>
<li><a href="#RedisModule_CreateStringFromULongLong"><code>RedisModule_CreateStringFromULongLong</code></a></li>
<li><a href="#RedisModule_CreateStringPrintf"><code>RedisModule_CreateStringPrintf</code></a></li>
<li><a href="#RedisModule_CreateSubcommand"><code>RedisModule_CreateSubcommand</code></a></li>
<li><a href="#RedisModule_CreateTimer"><code>RedisModule_CreateTimer</code></a></li>
<li><a href="#RedisModule_DbSize"><code>RedisModule_DbSize</code></a></li>
<li><a href="#RedisModule_DeauthenticateAndCloseClient"><code>RedisModule_DeauthenticateAndCloseClient</code></a></li>
<li><a href="#RedisModule_DefragAlloc"><code>RedisModule_DefragAlloc</code></a></li>
<li><a href="#RedisModule_DefragCursorGet"><code>RedisModule_DefragCursorGet</code></a></li>
<li><a href="#RedisModule_DefragCursorSet"><code>RedisModule_DefragCursorSet</code></a></li>
<li><a href="#RedisModule_DefragRedisModuleString"><code>RedisModule_DefragRedisModuleString</code></a></li>
<li><a href="#RedisModule_DefragShouldStop"><code>RedisModule_DefragShouldStop</code></a></li>
<li><a href="#RedisModule_DeleteKey"><code>RedisModule_DeleteKey</code></a></li>
<li><a href="#RedisModule_DictCompare"><code>RedisModule_DictCompare</code></a></li>
<li><a href="#RedisModule_DictCompareC"><code>RedisModule_DictCompareC</code></a></li>
<li><a href="#RedisModule_DictDel"><code>RedisModule_DictDel</code></a></li>
<li><a href="#RedisModule_DictDelC"><code>RedisModule_DictDelC</code></a></li>
<li><a href="#RedisModule_DictGet"><code>RedisModule_DictGet</code></a></li>
<li><a href="#RedisModule_DictGetC"><code>RedisModule_DictGetC</code></a></li>
<li><a href="#RedisModule_DictIteratorReseek"><code>RedisModule_DictIteratorReseek</code></a></li>
<li><a href="#RedisModule_DictIteratorReseekC"><code>RedisModule_DictIteratorReseekC</code></a></li>
<li><a href="#RedisModule_DictIteratorStart"><code>RedisModule_DictIteratorStart</code></a></li>
<li><a href="#RedisModule_DictIteratorStartC"><code>RedisModule_DictIteratorStartC</code></a></li>
<li><a href="#RedisModule_DictIteratorStop"><code>RedisModule_DictIteratorStop</code></a></li>
<li><a href="#RedisModule_DictNext"><code>RedisModule_DictNext</code></a></li>
<li><a href="#RedisModule_DictNextC"><code>RedisModule_DictNextC</code></a></li>
<li><a href="#RedisModule_DictPrev"><code>RedisModule_DictPrev</code></a></li>
<li><a href="#RedisModule_DictPrevC"><code>RedisModule_DictPrevC</code></a></li>
<li><a href="#RedisModule_DictReplace"><code>RedisModule_DictReplace</code></a></li>
<li><a href="#RedisModule_DictReplaceC"><code>RedisModule_DictReplaceC</code></a></li>
<li><a href="#RedisModule_DictSet"><code>RedisModule_DictSet</code></a></li>
<li><a href="#RedisModule_DictSetC"><code>RedisModule_DictSetC</code></a></li>
<li><a href="#RedisModule_DictSize"><code>RedisModule_DictSize</code></a></li>
<li><a href="#RedisModule_DigestAddLongLong"><code>RedisModule_DigestAddLongLong</code></a></li>
<li><a href="#RedisModule_DigestAddStringBuffer"><code>RedisModule_DigestAddStringBuffer</code></a></li>
<li><a href="#RedisModule_DigestEndSequence"><code>RedisModule_DigestEndSequence</code></a></li>
<li><a href="#RedisModule_EmitAOF"><code>RedisModule_EmitAOF</code></a></li>
<li><a href="#RedisModule_EventLoopAdd"><code>RedisModule_EventLoopAdd</code></a></li>
<li><a href="#RedisModule_EventLoopAddOneShot"><code>RedisModule_EventLoopAddOneShot</code></a></li>
<li><a href="#RedisModule_EventLoopDel"><code>RedisModule_EventLoopDel</code></a></li>
<li><a href="#RedisModule_ExitFromChild"><code>RedisModule_ExitFromChild</code></a></li>
<li><a href="#RedisModule_ExportSharedAPI"><code>RedisModule_ExportSharedAPI</code></a></li>
<li><a href="#RedisModule_Fork"><code>RedisModule_Fork</code></a></li>
<li><a href="#RedisModule_Free"><code>RedisModule_Free</code></a></li>
<li><a href="#RedisModule_FreeCallReply"><code>RedisModule_FreeCallReply</code></a></li>
<li><a href="#RedisModule_FreeClusterNodesList"><code>RedisModule_FreeClusterNodesList</code></a></li>
<li><a href="#RedisModule_FreeDict"><code>RedisModule_FreeDict</code></a></li>
<li><a href="#RedisModule_FreeModuleUser"><code>RedisModule_FreeModuleUser</code></a></li>
<li><a href="#RedisModule_FreeServerInfo"><code>RedisModule_FreeServerInfo</code></a></li>
<li><a href="#RedisModule_FreeString"><code>RedisModule_FreeString</code></a></li>
<li><a href="#RedisModule_FreeThreadSafeContext"><code>RedisModule_FreeThreadSafeContext</code></a></li>
<li><a href="#RedisModule_GetAbsExpire"><code>RedisModule_GetAbsExpire</code></a></li>
<li><a href="#RedisModule_GetBlockedClientHandle"><code>RedisModule_GetBlockedClientHandle</code></a></li>
<li><a href="#RedisModule_GetBlockedClientPrivateData"><code>RedisModule_GetBlockedClientPrivateData</code></a></li>
<li><a href="#RedisModule_GetBlockedClientReadyKey"><code>RedisModule_GetBlockedClientReadyKey</code></a></li>
<li><a href="#RedisModule_GetClientCertificate"><code>RedisModule_GetClientCertificate</code></a></li>
<li><a href="#RedisModule_GetClientId"><code>RedisModule_GetClientId</code></a></li>
<li><a href="#RedisModule_GetClientInfoById"><code>RedisModule_GetClientInfoById</code></a></li>
<li><a href="#RedisModule_GetClientNameById"><code>RedisModule_GetClientNameById</code></a></li>
<li><a href="#RedisModule_GetClientUserNameById"><code>RedisModule_GetClientUserNameById</code></a></li>
<li><a href="#RedisModule_GetClusterNodeInfo"><code>RedisModule_GetClusterNodeInfo</code></a></li>
<li><a href="#RedisModule_GetClusterNodesList"><code>RedisModule_GetClusterNodesList</code></a></li>
<li><a href="#RedisModule_GetClusterSize"><code>RedisModule_GetClusterSize</code></a></li>
<li><a href="#RedisModule_GetCommand"><code>RedisModule_GetCommand</code></a></li>
<li><a href="#RedisModule_GetCommandKeys"><code>RedisModule_GetCommandKeys</code></a></li>
<li><a href="#RedisModule_GetCommandKeysWithFlags"><code>RedisModule_GetCommandKeysWithFlags</code></a></li>
<li><a href="#RedisModule_GetContextFlags"><code>RedisModule_GetContextFlags</code></a></li>
<li><a href="#RedisModule_GetContextFlagsAll"><code>RedisModule_GetContextFlagsAll</code></a></li>
<li><a href="#RedisModule_GetCurrentCommandName"><code>RedisModule_GetCurrentCommandName</code></a></li>
<li><a href="#RedisModule_GetCurrentUserName"><code>RedisModule_GetCurrentUserName</code></a></li>
<li><a href="#RedisModule_GetDbIdFromDefragCtx"><code>RedisModule_GetDbIdFromDefragCtx</code></a></li>
<li><a href="#RedisModule_GetDbIdFromDigest"><code>RedisModule_GetDbIdFromDigest</code></a></li>
<li><a href="#RedisModule_GetDbIdFromIO"><code>RedisModule_GetDbIdFromIO</code></a></li>
<li><a href="#RedisModule_GetDbIdFromModuleKey"><code>RedisModule_GetDbIdFromModuleKey</code></a></li>
<li><a href="#RedisModule_GetDbIdFromOptCtx"><code>RedisModule_GetDbIdFromOptCtx</code></a></li>
<li><a href="#RedisModule_GetDetachedThreadSafeContext"><code>RedisModule_GetDetachedThreadSafeContext</code></a></li>
<li><a href="#RedisModule_GetExpire"><code>RedisModule_GetExpire</code></a></li>
<li><a href="#RedisModule_GetKeyNameFromDefragCtx"><code>RedisModule_GetKeyNameFromDefragCtx</code></a></li>
<li><a href="#RedisModule_GetKeyNameFromDigest"><code>RedisModule_GetKeyNameFromDigest</code></a></li>
<li><a href="#RedisModule_GetKeyNameFromIO"><code>RedisModule_GetKeyNameFromIO</code></a></li>
<li><a href="#RedisModule_GetKeyNameFromModuleKey"><code>RedisModule_GetKeyNameFromModuleKey</code></a></li>
<li><a href="#RedisModule_GetKeyNameFromOptCtx"><code>RedisModule_GetKeyNameFromOptCtx</code></a></li>
<li><a href="#RedisModule_GetKeyspaceNotificationFlagsAll"><code>RedisModule_GetKeyspaceNotificationFlagsAll</code></a></li>
<li><a href="#RedisModule_GetLFU"><code>RedisModule_GetLFU</code></a></li>
<li><a href="#RedisModule_GetLRU"><code>RedisModule_GetLRU</code></a></li>
<li><a href="#RedisModule_GetModuleOptionsAll"><code>RedisModule_GetModuleOptionsAll</code></a></li>
<li><a href="#RedisModule_GetModuleUserACLString"><code>RedisModule_GetModuleUserACLString</code></a></li>
<li><a href="#RedisModule_GetModuleUserFromUserName"><code>RedisModule_GetModuleUserFromUserName</code></a></li>
<li><a href="#RedisModule_GetMyClusterID"><code>RedisModule_GetMyClusterID</code></a></li>
<li><a href="#RedisModule_GetNotifyKeyspaceEvents"><code>RedisModule_GetNotifyKeyspaceEvents</code></a></li>
<li><a href="#RedisModule_GetOpenKeyModesAll"><code>RedisModule_GetOpenKeyModesAll</code></a></li>
<li><a href="#RedisModule_GetRandomBytes"><code>RedisModule_GetRandomBytes</code></a></li>
<li><a href="#RedisModule_GetRandomHexChars"><code>RedisModule_GetRandomHexChars</code></a></li>
<li><a href="#RedisModule_GetSelectedDb"><code>RedisModule_GetSelectedDb</code></a></li>
<li><a href="#RedisModule_GetServerInfo"><code>RedisModule_GetServerInfo</code></a></li>
<li><a href="#RedisModule_GetServerVersion"><code>RedisModule_GetServerVersion</code></a></li>
<li><a href="#RedisModule_GetSharedAPI"><code>RedisModule_GetSharedAPI</code></a></li>
<li><a href="#RedisModule_GetThreadSafeContext"><code>RedisModule_GetThreadSafeContext</code></a></li>
<li><a href="#RedisModule_GetTimerInfo"><code>RedisModule_GetTimerInfo</code></a></li>
<li><a href="#RedisModule_GetToDbIdFromOptCtx"><code>RedisModule_GetToDbIdFromOptCtx</code></a></li>
<li><a href="#RedisModule_GetToKeyNameFromOptCtx"><code>RedisModule_GetToKeyNameFromOptCtx</code></a></li>
<li><a href="#RedisModule_GetTypeMethodVersion"><code>RedisModule_GetTypeMethodVersion</code></a></li>
<li><a href="#RedisModule_GetUsedMemoryRatio"><code>RedisModule_GetUsedMemoryRatio</code></a></li>
<li><a href="#RedisModule_HashGet"><code>RedisModule_HashGet</code></a></li>
<li><a href="#RedisModule_HashSet"><code>RedisModule_HashSet</code></a></li>
<li><a href="#RedisModule_HoldString"><code>RedisModule_HoldString</code></a></li>
<li><a href="#RedisModule_InfoAddFieldCString"><code>RedisModule_InfoAddFieldCString</code></a></li>
<li><a href="#RedisModule_InfoAddFieldDouble"><code>RedisModule_InfoAddFieldDouble</code></a></li>
<li><a href="#RedisModule_InfoAddFieldLongLong"><code>RedisModule_InfoAddFieldLongLong</code></a></li>
<li><a href="#RedisModule_InfoAddFieldString"><code>RedisModule_InfoAddFieldString</code></a></li>
<li><a href="#RedisModule_InfoAddFieldULongLong"><code>RedisModule_InfoAddFieldULongLong</code></a></li>
<li><a href="#RedisModule_InfoAddSection"><code>RedisModule_InfoAddSection</code></a></li>
<li><a href="#RedisModule_InfoBeginDictField"><code>RedisModule_InfoBeginDictField</code></a></li>
<li><a href="#RedisModule_InfoEndDictField"><code>RedisModule_InfoEndDictField</code></a></li>
<li><a href="#RedisModule_IsBlockedReplyRequest"><code>RedisModule_IsBlockedReplyRequest</code></a></li>
<li><a href="#RedisModule_IsBlockedTimeoutRequest"><code>RedisModule_IsBlockedTimeoutRequest</code></a></li>
<li><a href="#RedisModule_IsChannelsPositionRequest"><code>RedisModule_IsChannelsPositionRequest</code></a></li>
<li><a href="#RedisModule_IsIOError"><code>RedisModule_IsIOError</code></a></li>
<li><a href="#RedisModule_IsKeysPositionRequest"><code>RedisModule_IsKeysPositionRequest</code></a></li>
<li><a href="#RedisModule_IsModuleNameBusy"><code>RedisModule_IsModuleNameBusy</code></a></li>
<li><a href="#RedisModule_IsSubEventSupported"><code>RedisModule_IsSubEventSupported</code></a></li>
<li><a href="#RedisModule_KeyAtPos"><code>RedisModule_KeyAtPos</code></a></li>
<li><a href="#RedisModule_KeyAtPosWithFlags"><code>RedisModule_KeyAtPosWithFlags</code></a></li>
<li><a href="#RedisModule_KeyExists"><code>RedisModule_KeyExists</code></a></li>
<li><a href="#RedisModule_KeyType"><code>RedisModule_KeyType</code></a></li>
<li><a href="#RedisModule_KillForkChild"><code>RedisModule_KillForkChild</code></a></li>
<li><a href="#RedisModule_LatencyAddSample"><code>RedisModule_LatencyAddSample</code></a></li>
<li><a href="#RedisModule_ListDelete"><code>RedisModule_ListDelete</code></a></li>
<li><a href="#RedisModule_ListGet"><code>RedisModule_ListGet</code></a></li>
<li><a href="#RedisModule_ListInsert"><code>RedisModule_ListInsert</code></a></li>
<li><a href="#RedisModule_ListPop"><code>RedisModule_ListPop</code></a></li>
<li><a href="#RedisModule_ListPush"><code>RedisModule_ListPush</code></a></li>
<li><a href="#RedisModule_ListSet"><code>RedisModule_ListSet</code></a></li>
<li><a href="#RedisModule_LoadConfigs"><code>RedisModule_LoadConfigs</code></a></li>
<li><a href="#RedisModule_LoadDataTypeFromString"><code>RedisModule_LoadDataTypeFromString</code></a></li>
<li><a href="#RedisModule_LoadDataTypeFromStringEncver"><code>RedisModule_LoadDataTypeFromStringEncver</code></a></li>
<li><a href="#RedisModule_LoadDouble"><code>RedisModule_LoadDouble</code></a></li>
<li><a href="#RedisModule_LoadFloat"><code>RedisModule_LoadFloat</code></a></li>
<li><a href="#RedisModule_LoadLongDouble"><code>RedisModule_LoadLongDouble</code></a></li>
<li><a href="#RedisModule_LoadSigned"><code>RedisModule_LoadSigned</code></a></li>
<li><a href="#RedisModule_LoadString"><code>RedisModule_LoadString</code></a></li>
<li><a href="#RedisModule_LoadStringBuffer"><code>RedisModule_LoadStringBuffer</code></a></li>
<li><a href="#RedisModule_LoadUnsigned"><code>RedisModule_LoadUnsigned</code></a></li>
<li><a href="#RedisModule_Log"><code>RedisModule_Log</code></a></li>
<li><a href="#RedisModule_LogIOError"><code>RedisModule_LogIOError</code></a></li>
<li><a href="#RedisModule_MallocSize"><code>RedisModule_MallocSize</code></a></li>
<li><a href="#RedisModule_MallocSizeDict"><code>RedisModule_MallocSizeDict</code></a></li>
<li><a href="#RedisModule_MallocSizeString"><code>RedisModule_MallocSizeString</code></a></li>
<li><a href="#RedisModule_MallocUsableSize"><code>RedisModule_MallocUsableSize</code></a></li>
<li><a href="#RedisModule_Microseconds"><code>RedisModule_Microseconds</code></a></li>
<li><a href="#RedisModule_Milliseconds"><code>RedisModule_Milliseconds</code></a></li>
<li><a href="#RedisModule_ModuleTypeGetType"><code>RedisModule_ModuleTypeGetType</code></a></li>
<li><a href="#RedisModule_ModuleTypeGetValue"><code>RedisModule_ModuleTypeGetValue</code></a></li>
<li><a href="#RedisModule_ModuleTypeReplaceValue"><code>RedisModule_ModuleTypeReplaceValue</code></a></li>
<li><a href="#RedisModule_ModuleTypeSetValue"><code>RedisModule_ModuleTypeSetValue</code></a></li>
<li><a href="#RedisModule_MonotonicMicroseconds"><code>RedisModule_MonotonicMicroseconds</code></a></li>
<li><a href="#RedisModule_NotifyKeyspaceEvent"><code>RedisModule_NotifyKeyspaceEvent</code></a></li>
<li><a href="#RedisModule_OpenKey"><code>RedisModule_OpenKey</code></a></li>
<li><a href="#RedisModule_PoolAlloc"><code>RedisModule_PoolAlloc</code></a></li>
<li><a href="#RedisModule_PublishMessage"><code>RedisModule_PublishMessage</code></a></li>
<li><a href="#RedisModule_PublishMessageShard"><code>RedisModule_PublishMessageShard</code></a></li>
<li><a href="#RedisModule_RandomKey"><code>RedisModule_RandomKey</code></a></li>
<li><a href="#RedisModule_Realloc"><code>RedisModule_Realloc</code></a></li>
<li><a href="#RedisModule_RedactClientCommandArgument"><code>RedisModule_RedactClientCommandArgument</code></a></li>
<li><a href="#RedisModule_RegisterAuthCallback"><code>RedisModule_RegisterAuthCallback</code></a></li>
<li><a href="#RedisModule_RegisterBoolConfig"><code>RedisModule_RegisterBoolConfig</code></a></li>
<li><a href="#RedisModule_RegisterClusterMessageReceiver"><code>RedisModule_RegisterClusterMessageReceiver</code></a></li>
<li><a href="#RedisModule_RegisterCommandFilter"><code>RedisModule_RegisterCommandFilter</code></a></li>
<li><a href="#RedisModule_RegisterDefragFunc"><code>RedisModule_RegisterDefragFunc</code></a></li>
<li><a href="#RedisModule_RegisterEnumConfig"><code>RedisModule_RegisterEnumConfig</code></a></li>
<li><a href="#RedisModule_RegisterInfoFunc"><code>RedisModule_RegisterInfoFunc</code></a></li>
<li><a href="#RedisModule_RegisterNumericConfig"><code>RedisModule_RegisterNumericConfig</code></a></li>
<li><a href="#RedisModule_RegisterStringConfig"><code>RedisModule_RegisterStringConfig</code></a></li>
<li><a href="#RedisModule_Replicate"><code>RedisModule_Replicate</code></a></li>
<li><a href="#RedisModule_ReplicateVerbatim"><code>RedisModule_ReplicateVerbatim</code></a></li>
<li><a href="#RedisModule_ReplySetArrayLength"><code>RedisModule_ReplySetArrayLength</code></a></li>
<li><a href="#RedisModule_ReplySetAttributeLength"><code>RedisModule_ReplySetAttributeLength</code></a></li>
<li><a href="#RedisModule_ReplySetMapLength"><code>RedisModule_ReplySetMapLength</code></a></li>
<li><a href="#RedisModule_ReplySetSetLength"><code>RedisModule_ReplySetSetLength</code></a></li>
<li><a href="#RedisModule_ReplyWithArray"><code>RedisModule_ReplyWithArray</code></a></li>
<li><a href="#RedisModule_ReplyWithAttribute"><code>RedisModule_ReplyWithAttribute</code></a></li>
<li><a href="#RedisModule_ReplyWithBigNumber"><code>RedisModule_ReplyWithBigNumber</code></a></li>
<li><a href="#RedisModule_ReplyWithBool"><code>RedisModule_ReplyWithBool</code></a></li>
<li><a href="#RedisModule_ReplyWithCString"><code>RedisModule_ReplyWithCString</code></a></li>
<li><a href="#RedisModule_ReplyWithCallReply"><code>RedisModule_ReplyWithCallReply</code></a></li>
<li><a href="#RedisModule_ReplyWithDouble"><code>RedisModule_ReplyWithDouble</code></a></li>
<li><a href="#RedisModule_ReplyWithEmptyArray"><code>RedisModule_ReplyWithEmptyArray</code></a></li>
<li><a href="#RedisModule_ReplyWithEmptyString"><code>RedisModule_ReplyWithEmptyString</code></a></li>
<li><a href="#RedisModule_ReplyWithError"><code>RedisModule_ReplyWithError</code></a></li>
<li><a href="#RedisModule_ReplyWithLongDouble"><code>RedisModule_ReplyWithLongDouble</code></a></li>
<li><a href="#RedisModule_ReplyWithLongLong"><code>RedisModule_ReplyWithLongLong</code></a></li>
<li><a href="#RedisModule_ReplyWithMap"><code>RedisModule_ReplyWithMap</code></a></li>
<li><a href="#RedisModule_ReplyWithNull"><code>RedisModule_ReplyWithNull</code></a></li>
<li><a href="#RedisModule_ReplyWithNullArray"><code>RedisModule_ReplyWithNullArray</code></a></li>
<li><a href="#RedisModule_ReplyWithSet"><code>RedisModule_ReplyWithSet</code></a></li>
<li><a href="#RedisModule_ReplyWithSimpleString"><code>RedisModule_ReplyWithSimpleString</code></a></li>
<li><a href="#RedisModule_ReplyWithString"><code>RedisModule_ReplyWithString</code></a></li>
<li><a href="#RedisModule_ReplyWithStringBuffer"><code>RedisModule_ReplyWithStringBuffer</code></a></li>
<li><a href="#RedisModule_ReplyWithVerbatimString"><code>RedisModule_ReplyWithVerbatimString</code></a></li>
<li><a href="#RedisModule_ReplyWithVerbatimStringType"><code>RedisModule_ReplyWithVerbatimStringType</code></a></li>
<li><a href="#RedisModule_ResetDataset"><code>RedisModule_ResetDataset</code></a></li>
<li><a href="#RedisModule_RetainString"><code>RedisModule_RetainString</code></a></li>
<li><a href="#RedisModule_SaveDataTypeToString"><code>RedisModule_SaveDataTypeToString</code></a></li>
<li><a href="#RedisModule_SaveDouble"><code>RedisModule_SaveDouble</code></a></li>
<li><a href="#RedisModule_SaveFloat"><code>RedisModule_SaveFloat</code></a></li>
<li><a href="#RedisModule_SaveLongDouble"><code>RedisModule_SaveLongDouble</code></a></li>
<li><a href="#RedisModule_SaveSigned"><code>RedisModule_SaveSigned</code></a></li>
<li><a href="#RedisModule_SaveString"><code>RedisModule_SaveString</code></a></li>
<li><a href="#RedisModule_SaveStringBuffer"><code>RedisModule_SaveStringBuffer</code></a></li>
<li><a href="#RedisModule_SaveUnsigned"><code>RedisModule_SaveUnsigned</code></a></li>
<li><a href="#RedisModule_Scan"><code>RedisModule_Scan</code></a></li>
<li><a href="#RedisModule_ScanCursorCreate"><code>RedisModule_ScanCursorCreate</code></a></li>
<li><a href="#RedisModule_ScanCursorDestroy"><code>RedisModule_ScanCursorDestroy</code></a></li>
<li><a href="#RedisModule_ScanCursorRestart"><code>RedisModule_ScanCursorRestart</code></a></li>
<li><a href="#RedisModule_ScanKey"><code>RedisModule_ScanKey</code></a></li>
<li><a href="#RedisModule_SelectDb"><code>RedisModule_SelectDb</code></a></li>
<li><a href="#RedisModule_SendChildHeartbeat"><code>RedisModule_SendChildHeartbeat</code></a></li>
<li><a href="#RedisModule_SendClusterMessage"><code>RedisModule_SendClusterMessage</code></a></li>
<li><a href="#RedisModule_ServerInfoGetField"><code>RedisModule_ServerInfoGetField</code></a></li>
<li><a href="#RedisModule_ServerInfoGetFieldC"><code>RedisModule_ServerInfoGetFieldC</code></a></li>
<li><a href="#RedisModule_ServerInfoGetFieldDouble"><code>RedisModule_ServerInfoGetFieldDouble</code></a></li>
<li><a href="#RedisModule_ServerInfoGetFieldSigned"><code>RedisModule_ServerInfoGetFieldSigned</code></a></li>
<li><a href="#RedisModule_ServerInfoGetFieldUnsigned"><code>RedisModule_ServerInfoGetFieldUnsigned</code></a></li>
<li><a href="#RedisModule_SetAbsExpire"><code>RedisModule_SetAbsExpire</code></a></li>
<li><a href="#RedisModule_SetClientNameById"><code>RedisModule_SetClientNameById</code></a></li>
<li><a href="#RedisModule_SetClusterFlags"><code>RedisModule_SetClusterFlags</code></a></li>
<li><a href="#RedisModule_SetCommandACLCategories"><code>RedisModule_SetCommandACLCategories</code></a></li>
<li><a href="#RedisModule_SetCommandInfo"><code>RedisModule_SetCommandInfo</code></a></li>
<li><a href="#RedisModule_SetContextUser"><code>RedisModule_SetContextUser</code></a></li>
<li><a href="#RedisModule_SetDisconnectCallback"><code>RedisModule_SetDisconnectCallback</code></a></li>
<li><a href="#RedisModule_SetExpire"><code>RedisModule_SetExpire</code></a></li>
<li><a href="#RedisModule_SetLFU"><code>RedisModule_SetLFU</code></a></li>
<li><a href="#RedisModule_SetLRU"><code>RedisModule_SetLRU</code></a></li>
<li><a href="#RedisModule_SetModuleOptions"><code>RedisModule_SetModuleOptions</code></a></li>
<li><a href="#RedisModule_SetModuleUserACL"><code>RedisModule_SetModuleUserACL</code></a></li>
<li><a href="#RedisModule_SetModuleUserACLString"><code>RedisModule_SetModuleUserACLString</code></a></li>
<li><a href="#RedisModule_SignalKeyAsReady"><code>RedisModule_SignalKeyAsReady</code></a></li>
<li><a href="#RedisModule_SignalModifiedKey"><code>RedisModule_SignalModifiedKey</code></a></li>
<li><a href="#RedisModule_StopTimer"><code>RedisModule_StopTimer</code></a></li>
<li><a href="#RedisModule_Strdup"><code>RedisModule_Strdup</code></a></li>
<li><a href="#RedisModule_StreamAdd"><code>RedisModule_StreamAdd</code></a></li>
<li><a href="#RedisModule_StreamDelete"><code>RedisModule_StreamDelete</code></a></li>
<li><a href="#RedisModule_StreamIteratorDelete"><code>RedisModule_StreamIteratorDelete</code></a></li>
<li><a href="#RedisModule_StreamIteratorNextField"><code>RedisModule_StreamIteratorNextField</code></a></li>
<li><a href="#RedisModule_StreamIteratorNextID"><code>RedisModule_StreamIteratorNextID</code></a></li>
<li><a href="#RedisModule_StreamIteratorStart"><code>RedisModule_StreamIteratorStart</code></a></li>
<li><a href="#RedisModule_StreamIteratorStop"><code>RedisModule_StreamIteratorStop</code></a></li>
<li><a href="#RedisModule_StreamTrimByID"><code>RedisModule_StreamTrimByID</code></a></li>
<li><a href="#RedisModule_StreamTrimByLength"><code>RedisModule_StreamTrimByLength</code></a></li>
<li><a href="#RedisModule_StringAppendBuffer"><code>RedisModule_StringAppendBuffer</code></a></li>
<li><a href="#RedisModule_StringCompare"><code>RedisModule_StringCompare</code></a></li>
<li><a href="#RedisModule_StringDMA"><code>RedisModule_StringDMA</code></a></li>
<li><a href="#RedisModule_StringPtrLen"><code>RedisModule_StringPtrLen</code></a></li>
<li><a href="#RedisModule_StringSet"><code>RedisModule_StringSet</code></a></li>
<li><a href="#RedisModule_StringToDouble"><code>RedisModule_StringToDouble</code></a></li>
<li><a href="#RedisModule_StringToLongDouble"><code>RedisModule_StringToLongDouble</code></a></li>
<li><a href="#RedisModule_StringToLongLong"><code>RedisModule_StringToLongLong</code></a></li>
<li><a href="#RedisModule_StringToStreamID"><code>RedisModule_StringToStreamID</code></a></li>
<li><a href="#RedisModule_StringToULongLong"><code>RedisModule_StringToULongLong</code></a></li>
<li><a href="#RedisModule_StringTruncate"><code>RedisModule_StringTruncate</code></a></li>
<li><a href="#RedisModule_SubscribeToKeyspaceEvents"><code>RedisModule_SubscribeToKeyspaceEvents</code></a></li>
<li><a href="#RedisModule_SubscribeToServerEvent"><code>RedisModule_SubscribeToServerEvent</code></a></li>
<li><a href="#RedisModule_ThreadSafeContextLock"><code>RedisModule_ThreadSafeContextLock</code></a></li>
<li><a href="#RedisModule_ThreadSafeContextTryLock"><code>RedisModule_ThreadSafeContextTryLock</code></a></li>
<li><a href="#RedisModule_ThreadSafeContextUnlock"><code>RedisModule_ThreadSafeContextUnlock</code></a></li>
<li><a href="#RedisModule_TrimStringAllocation"><code>RedisModule_TrimStringAllocation</code></a></li>
<li><a href="#RedisModule_TryAlloc"><code>RedisModule_TryAlloc</code></a></li>
<li><a href="#RedisModule_UnblockClient"><code>RedisModule_UnblockClient</code></a></li>
<li><a href="#RedisModule_UnlinkKey"><code>RedisModule_UnlinkKey</code></a></li>
<li><a href="#RedisModule_UnregisterCommandFilter"><code>RedisModule_UnregisterCommandFilter</code></a></li>
<li><a href="#RedisModule_ValueLength"><code>RedisModule_ValueLength</code></a></li>
<li><a href="#RedisModule_WrongArity"><code>RedisModule_WrongArity</code></a></li>
<li><a href="#RedisModule_Yield"><code>RedisModule_Yield</code></a></li>
<li><a href="#RedisModule_ZsetAdd"><code>RedisModule_ZsetAdd</code></a></li>
<li><a href="#RedisModule_ZsetFirstInLexRange"><code>RedisModule_ZsetFirstInLexRange</code></a></li>
<li><a href="#RedisModule_ZsetFirstInScoreRange"><code>RedisModule_ZsetFirstInScoreRange</code></a></li>
<li><a href="#RedisModule_ZsetIncrby"><code>RedisModule_ZsetIncrby</code></a></li>
<li><a href="#RedisModule_ZsetLastInLexRange"><code>RedisModule_ZsetLastInLexRange</code></a></li>
<li><a href="#RedisModule_ZsetLastInScoreRange"><code>RedisModule_ZsetLastInScoreRange</code></a></li>
<li><a href="#RedisModule_ZsetRangeCurrentElement"><code>RedisModule_ZsetRangeCurrentElement</code></a></li>
<li><a href="#RedisModule_ZsetRangeEndReached"><code>RedisModule_ZsetRangeEndReached</code></a></li>
<li><a href="#RedisModule_ZsetRangeNext"><code>RedisModule_ZsetRangeNext</code></a></li>
<li><a href="#RedisModule_ZsetRangePrev"><code>RedisModule_ZsetRangePrev</code></a></li>
<li><a href="#RedisModule_ZsetRangeStop"><code>RedisModule_ZsetRangeStop</code></a></li>
<li><a href="#RedisModule_ZsetRem"><code>RedisModule_ZsetRem</code></a></li>
<li><a href="#RedisModule_ZsetScore"><code>RedisModule_ZsetScore</code></a></li>
<li><a href="#RedisModule__Assert"><code>RedisModule__Assert</code></a></li>
</ul>

          
  <form class="page-feedback" method="POST" name="page-feedback"><input type="hidden" name="form-name" value="page-feedback">
    <input name="origin" value="https://redis.io/docs/reference/modules/modules-api-ref/" class="hidden">
  <div class="grid justify-center mt-10 pt-10 border-t-2">
    <span class="font-bold font-small">Rate this page</span>
    <div class="star-rating">
      
      <input type="radio" id="5-stars" name="rating" value="5" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="5-stars" class="star">★</label>
      
      <input type="radio" id="4-stars" name="rating" value="4" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="4-stars" class="star">★</label>
      
      <input type="radio" id="3-stars" name="rating" value="3" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="3-stars" class="star">★</label>
      
      <input type="radio" id="2-stars" name="rating" value="2" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="2-stars" class="star">★</label>
      
      <input type="radio" id="1-stars" name="rating" value="1" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="1-stars" class="star">★</label>
      
    </div>  
  </div>
  <div id="feedback-form" class="hidden">
    <div class="feedback-submit">
      <textarea name="comment" placeholder="Why did you choose this rating?" class="border border-neutral-500 p-2 mt-1 block w-full h-24" rows="3"></textarea>
      <button class="button button-indigo w-min justify-self-end" type="submit">
        Submit
      </button>
    </div>
  </div>
</form>
      </section>
    </div>
    

  <section class="hidden xl:block w-52 h-full shrink-0">
    <div class="w-52 z-40 hidden bg-white/75 md:block overflow-auto fixed top-28 h-full max-h-[calc(100vh-15rem)] text-[0.8125rem]">
      





<nav class="flex flex-col gap-1 mb-6 pb-2 border-b-2">
  <a href="https://github.com/redis/redis-doc/edit/master/docs/reference/modules/modules-api-ref.md" target="_blank" class="group inline-flex items-center gap-1 text-sm text-slate-700 hover:text-indigo-600 mt-auto self-start">
    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
      <path d="M11 44q-1.2 0-2.1-.9Q8 42.2 8 41V7q0-1.2.9-2.1Q9.8 4 11 4h17l12 12v7.8h-3V18H26V7H11v34h15v3Zm0-3V7v34Zm26.8-11.15 1.4 1.4-8.2 8.2V42h2.55l8.2-8.2 1.4 1.4-8.8 8.8H29v-5.35Zm5.35 5.35-5.35-5.35 3.05-3.05q.45-.45 1.05-.45.6 0 1.05.45l3.25 3.25q.45.45.45 1.05 0 .6-.45 1.05Z" fill="currentColor"></path>
    </svg>
    Edit this page
  </a>
  <a href="https://github.com/redis/redis-doc/issues/new?title=Modules%20API%20reference" target="_blank" class="group inline-flex items-center gap-1 text-sm text-slate-700 hover:text-indigo-600 mt-auto self-start">
    <svg class="w-4 h-4" viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="currentColor"></path>
    </svg>
    Create an issue
  </a>
</nav>


      
        <h1 class="font-semibold my-3">On This Page</h1>
        <nav class="text-slate-700">
          <nav id="TableOfContents">
  <ul>
    <li><a href="#sections">Sections</a></li>
    <li><a href="#heap-allocation-raw-functions">Heap allocation raw functions</a>
      <ul>
        <li><a href="#redismodule_alloc"><code>RedisModule_Alloc</code></a></li>
        <li><a href="#redismodule_tryalloc"><code>RedisModule_TryAlloc</code></a></li>
        <li><a href="#redismodule_calloc"><code>RedisModule_Calloc</code></a></li>
        <li><a href="#redismodule_realloc"><code>RedisModule_Realloc</code></a></li>
        <li><a href="#redismodule_free"><code>RedisModule_Free</code></a></li>
        <li><a href="#redismodule_strdup"><code>RedisModule_Strdup</code></a></li>
        <li><a href="#redismodule_poolalloc"><code>RedisModule_PoolAlloc</code></a></li>
      </ul>
    </li>
    <li><a href="#commands-api">Commands API</a>
      <ul>
        <li><a href="#redismodule_iskeyspositionrequest"><code>RedisModule_IsKeysPositionRequest</code></a></li>
        <li><a href="#redismodule_keyatposwithflags"><code>RedisModule_KeyAtPosWithFlags</code></a></li>
        <li><a href="#redismodule_keyatpos"><code>RedisModule_KeyAtPos</code></a></li>
        <li><a href="#redismodule_ischannelspositionrequest"><code>RedisModule_IsChannelsPositionRequest</code></a></li>
        <li><a href="#redismodule_channelatposwithflags"><code>RedisModule_ChannelAtPosWithFlags</code></a></li>
        <li><a href="#redismodule_createcommand"><code>RedisModule_CreateCommand</code></a></li>
        <li><a href="#redismodule_getcommand"><code>RedisModule_GetCommand</code></a></li>
        <li><a href="#redismodule_createsubcommand"><code>RedisModule_CreateSubcommand</code></a></li>
        <li><a href="#redismodule_setcommandaclcategories"><code>RedisModule_SetCommandACLCategories</code></a></li>
        <li><a href="#redismodule_setcommandinfo"><code>RedisModule_SetCommandInfo</code></a></li>
      </ul>
    </li>
    <li><a href="#module-information-and-time-measurement">Module information and time measurement</a>
      <ul>
        <li><a href="#redismodule_ismodulenamebusy"><code>RedisModule_IsModuleNameBusy</code></a></li>
        <li><a href="#redismodule_milliseconds"><code>RedisModule_Milliseconds</code></a></li>
        <li><a href="#redismodule_monotonicmicroseconds"><code>RedisModule_MonotonicMicroseconds</code></a></li>
        <li><a href="#redismodule_microseconds"><code>RedisModule_Microseconds</code></a></li>
        <li><a href="#redismodule_cachedmicroseconds"><code>RedisModule_CachedMicroseconds</code></a></li>
        <li><a href="#redismodule_blockedclientmeasuretimestart"><code>RedisModule_BlockedClientMeasureTimeStart</code></a></li>
        <li><a href="#redismodule_blockedclientmeasuretimeend"><code>RedisModule_BlockedClientMeasureTimeEnd</code></a></li>
        <li><a href="#redismodule_yield"><code>RedisModule_Yield</code></a></li>
        <li><a href="#redismodule_setmoduleoptions"><code>RedisModule_SetModuleOptions</code></a></li>
        <li><a href="#redismodule_signalmodifiedkey"><code>RedisModule_SignalModifiedKey</code></a></li>
      </ul>
    </li>
    <li><a href="#automatic-memory-management-for-modules">Automatic memory management for modules</a>
      <ul>
        <li><a href="#redismodule_automemory"><code>RedisModule_AutoMemory</code></a></li>
      </ul>
    </li>
    <li><a href="#string-objects-apis">String objects APIs</a>
      <ul>
        <li><a href="#redismodule_createstring"><code>RedisModule_CreateString</code></a></li>
        <li><a href="#redismodule_createstringprintf"><code>RedisModule_CreateStringPrintf</code></a></li>
        <li><a href="#redismodule_createstringfromlonglong"><code>RedisModule_CreateStringFromLongLong</code></a></li>
        <li><a href="#redismodule_createstringfromulonglong"><code>RedisModule_CreateStringFromULongLong</code></a></li>
        <li><a href="#redismodule_createstringfromdouble"><code>RedisModule_CreateStringFromDouble</code></a></li>
        <li><a href="#redismodule_createstringfromlongdouble"><code>RedisModule_CreateStringFromLongDouble</code></a></li>
        <li><a href="#redismodule_createstringfromstring"><code>RedisModule_CreateStringFromString</code></a></li>
        <li><a href="#redismodule_createstringfromstreamid"><code>RedisModule_CreateStringFromStreamID</code></a></li>
        <li><a href="#redismodule_freestring"><code>RedisModule_FreeString</code></a></li>
        <li><a href="#redismodule_retainstring"><code>RedisModule_RetainString</code></a></li>
        <li><a href="#redismodule_holdstring"><code>RedisModule_HoldString</code></a></li>
        <li><a href="#redismodule_stringptrlen"><code>RedisModule_StringPtrLen</code></a></li>
        <li><a href="#redismodule_stringtolonglong"><code>RedisModule_StringToLongLong</code></a></li>
        <li><a href="#redismodule_stringtoulonglong"><code>RedisModule_StringToULongLong</code></a></li>
        <li><a href="#redismodule_stringtodouble"><code>RedisModule_StringToDouble</code></a></li>
        <li><a href="#redismodule_stringtolongdouble"><code>RedisModule_StringToLongDouble</code></a></li>
        <li><a href="#redismodule_stringtostreamid"><code>RedisModule_StringToStreamID</code></a></li>
        <li><a href="#redismodule_stringcompare"><code>RedisModule_StringCompare</code></a></li>
        <li><a href="#redismodule_stringappendbuffer"><code>RedisModule_StringAppendBuffer</code></a></li>
        <li><a href="#redismodule_trimstringallocation"><code>RedisModule_TrimStringAllocation</code></a></li>
      </ul>
    </li>
    <li><a href="#reply-apis">Reply APIs</a>
      <ul>
        <li><a href="#reply-with-collection-functions">Reply with collection functions</a></li>
        <li><a href="#redismodule_wrongarity"><code>RedisModule_WrongArity</code></a></li>
        <li><a href="#redismodule_replywithlonglong"><code>RedisModule_ReplyWithLongLong</code></a></li>
        <li><a href="#redismodule_replywitherror"><code>RedisModule_ReplyWithError</code></a></li>
        <li><a href="#redismodule_replywithsimplestring"><code>RedisModule_ReplyWithSimpleString</code></a></li>
        <li><a href="#redismodule_replywitharray"><code>RedisModule_ReplyWithArray</code></a></li>
        <li><a href="#redismodule_replywithmap"><code>RedisModule_ReplyWithMap</code></a></li>
        <li><a href="#redismodule_replywithset"><code>RedisModule_ReplyWithSet</code></a></li>
        <li><a href="#redismodule_replywithattribute"><code>RedisModule_ReplyWithAttribute</code></a></li>
        <li><a href="#redismodule_replywithnullarray"><code>RedisModule_ReplyWithNullArray</code></a></li>
        <li><a href="#redismodule_replywithemptyarray"><code>RedisModule_ReplyWithEmptyArray</code></a></li>
        <li><a href="#redismodule_replysetarraylength"><code>RedisModule_ReplySetArrayLength</code></a></li>
        <li><a href="#redismodule_replysetmaplength"><code>RedisModule_ReplySetMapLength</code></a></li>
        <li><a href="#redismodule_replysetsetlength"><code>RedisModule_ReplySetSetLength</code></a></li>
        <li><a href="#redismodule_replysetattributelength"><code>RedisModule_ReplySetAttributeLength</code></a></li>
        <li><a href="#redismodule_replywithstringbuffer"><code>RedisModule_ReplyWithStringBuffer</code></a></li>
        <li><a href="#redismodule_replywithcstring"><code>RedisModule_ReplyWithCString</code></a></li>
        <li><a href="#redismodule_replywithstring"><code>RedisModule_ReplyWithString</code></a></li>
        <li><a href="#redismodule_replywithemptystring"><code>RedisModule_ReplyWithEmptyString</code></a></li>
        <li><a href="#redismodule_replywithverbatimstringtype"><code>RedisModule_ReplyWithVerbatimStringType</code></a></li>
        <li><a href="#redismodule_replywithverbatimstring"><code>RedisModule_ReplyWithVerbatimString</code></a></li>
        <li><a href="#redismodule_replywithnull"><code>RedisModule_ReplyWithNull</code></a></li>
        <li><a href="#redismodule_replywithbool"><code>RedisModule_ReplyWithBool</code></a></li>
        <li><a href="#redismodule_replywithcallreply"><code>RedisModule_ReplyWithCallReply</code></a></li>
        <li><a href="#redismodule_replywithdouble"><code>RedisModule_ReplyWithDouble</code></a></li>
        <li><a href="#redismodule_replywithbignumber"><code>RedisModule_ReplyWithBigNumber</code></a></li>
        <li><a href="#redismodule_replywithlongdouble"><code>RedisModule_ReplyWithLongDouble</code></a></li>
      </ul>
    </li>
    <li><a href="#commands-replication-api">Commands replication API</a>
      <ul>
        <li><a href="#redismodule_replicate"><code>RedisModule_Replicate</code></a></li>
        <li><a href="#redismodule_replicateverbatim"><code>RedisModule_ReplicateVerbatim</code></a></li>
      </ul>
    </li>
    <li><a href="#db-and-key-apis--generic-api">DB and Key APIs – Generic API</a>
      <ul>
        <li><a href="#redismodule_getclientid"><code>RedisModule_GetClientId</code></a></li>
        <li><a href="#redismodule_getclientusernamebyid"><code>RedisModule_GetClientUserNameById</code></a></li>
        <li><a href="#redismodule_getclientinfobyid"><code>RedisModule_GetClientInfoById</code></a></li>
        <li><a href="#redismodule_getclientnamebyid"><code>RedisModule_GetClientNameById</code></a></li>
        <li><a href="#redismodule_setclientnamebyid"><code>RedisModule_SetClientNameById</code></a></li>
        <li><a href="#redismodule_publishmessage"><code>RedisModule_PublishMessage</code></a></li>
        <li><a href="#redismodule_publishmessageshard"><code>RedisModule_PublishMessageShard</code></a></li>
        <li><a href="#redismodule_getselecteddb"><code>RedisModule_GetSelectedDb</code></a></li>
        <li><a href="#redismodule_getcontextflags"><code>RedisModule_GetContextFlags</code></a></li>
        <li><a href="#redismodule_avoidreplicatraffic"><code>RedisModule_AvoidReplicaTraffic</code></a></li>
        <li><a href="#redismodule_selectdb"><code>RedisModule_SelectDb</code></a></li>
        <li><a href="#redismodule_keyexists"><code>RedisModule_KeyExists</code></a></li>
        <li><a href="#redismodule_openkey"><code>RedisModule_OpenKey</code></a></li>
        <li><a href="#redismodule_getopenkeymodesall"><code>RedisModule_GetOpenKeyModesAll</code></a></li>
        <li><a href="#redismodule_closekey"><code>RedisModule_CloseKey</code></a></li>
        <li><a href="#redismodule_keytype"><code>RedisModule_KeyType</code></a></li>
        <li><a href="#redismodule_valuelength"><code>RedisModule_ValueLength</code></a></li>
        <li><a href="#redismodule_deletekey"><code>RedisModule_DeleteKey</code></a></li>
        <li><a href="#redismodule_unlinkkey"><code>RedisModule_UnlinkKey</code></a></li>
        <li><a href="#redismodule_getexpire"><code>RedisModule_GetExpire</code></a></li>
        <li><a href="#redismodule_setexpire"><code>RedisModule_SetExpire</code></a></li>
        <li><a href="#redismodule_getabsexpire"><code>RedisModule_GetAbsExpire</code></a></li>
        <li><a href="#redismodule_setabsexpire"><code>RedisModule_SetAbsExpire</code></a></li>
        <li><a href="#redismodule_resetdataset"><code>RedisModule_ResetDataset</code></a></li>
        <li><a href="#redismodule_dbsize"><code>RedisModule_DbSize</code></a></li>
        <li><a href="#redismodule_randomkey"><code>RedisModule_RandomKey</code></a></li>
        <li><a href="#redismodule_getkeynamefromoptctx"><code>RedisModule_GetKeyNameFromOptCtx</code></a></li>
        <li><a href="#redismodule_gettokeynamefromoptctx"><code>RedisModule_GetToKeyNameFromOptCtx</code></a></li>
        <li><a href="#redismodule_getdbidfromoptctx"><code>RedisModule_GetDbIdFromOptCtx</code></a></li>
        <li><a href="#redismodule_gettodbidfromoptctx"><code>RedisModule_GetToDbIdFromOptCtx</code></a></li>
      </ul>
    </li>
    <li><a href="#key-api-for-string-type">Key API for String type</a>
      <ul>
        <li><a href="#redismodule_stringset"><code>RedisModule_StringSet</code></a></li>
        <li><a href="#redismodule_stringdma"><code>RedisModule_StringDMA</code></a></li>
        <li><a href="#redismodule_stringtruncate"><code>RedisModule_StringTruncate</code></a></li>
      </ul>
    </li>
    <li><a href="#key-api-for-list-type">Key API for List type</a>
      <ul>
        <li><a href="#redismodule_listpush"><code>RedisModule_ListPush</code></a></li>
        <li><a href="#redismodule_listpop"><code>RedisModule_ListPop</code></a></li>
        <li><a href="#redismodule_listget"><code>RedisModule_ListGet</code></a></li>
        <li><a href="#redismodule_listset"><code>RedisModule_ListSet</code></a></li>
        <li><a href="#redismodule_listinsert"><code>RedisModule_ListInsert</code></a></li>
        <li><a href="#redismodule_listdelete"><code>RedisModule_ListDelete</code></a></li>
      </ul>
    </li>
    <li><a href="#key-api-for-sorted-set-type">Key API for Sorted Set type</a>
      <ul>
        <li><a href="#redismodule_zsetadd"><code>RedisModule_ZsetAdd</code></a></li>
        <li><a href="#redismodule_zsetincrby"><code>RedisModule_ZsetIncrby</code></a></li>
        <li><a href="#redismodule_zsetrem"><code>RedisModule_ZsetRem</code></a></li>
        <li><a href="#redismodule_zsetscore"><code>RedisModule_ZsetScore</code></a></li>
      </ul>
    </li>
    <li><a href="#key-api-for-sorted-set-iterator">Key API for Sorted Set iterator</a>
      <ul>
        <li><a href="#redismodule_zsetrangestop"><code>RedisModule_ZsetRangeStop</code></a></li>
        <li><a href="#redismodule_zsetrangeendreached"><code>RedisModule_ZsetRangeEndReached</code></a></li>
        <li><a href="#redismodule_zsetfirstinscorerange"><code>RedisModule_ZsetFirstInScoreRange</code></a></li>
        <li><a href="#redismodule_zsetlastinscorerange"><code>RedisModule_ZsetLastInScoreRange</code></a></li>
        <li><a href="#redismodule_zsetfirstinlexrange"><code>RedisModule_ZsetFirstInLexRange</code></a></li>
        <li><a href="#redismodule_zsetlastinlexrange"><code>RedisModule_ZsetLastInLexRange</code></a></li>
        <li><a href="#redismodule_zsetrangecurrentelement"><code>RedisModule_ZsetRangeCurrentElement</code></a></li>
        <li><a href="#redismodule_zsetrangenext"><code>RedisModule_ZsetRangeNext</code></a></li>
        <li><a href="#redismodule_zsetrangeprev"><code>RedisModule_ZsetRangePrev</code></a></li>
      </ul>
    </li>
    <li><a href="#key-api-for-hash-type">Key API for Hash type</a>
      <ul>
        <li><a href="#redismodule_hashset"><code>RedisModule_HashSet</code></a></li>
        <li><a href="#redismodule_hashget"><code>RedisModule_HashGet</code></a></li>
      </ul>
    </li>
    <li><a href="#key-api-for-stream-type">Key API for Stream type</a>
      <ul>
        <li><a href="#redismodule_streamadd"><code>RedisModule_StreamAdd</code></a></li>
        <li><a href="#redismodule_streamdelete"><code>RedisModule_StreamDelete</code></a></li>
        <li><a href="#redismodule_streamiteratorstart"><code>RedisModule_StreamIteratorStart</code></a></li>
        <li><a href="#redismodule_streamiteratorstop"><code>RedisModule_StreamIteratorStop</code></a></li>
        <li><a href="#redismodule_streamiteratornextid"><code>RedisModule_StreamIteratorNextID</code></a></li>
        <li><a href="#redismodule_streamiteratornextfield"><code>RedisModule_StreamIteratorNextField</code></a></li>
        <li><a href="#redismodule_streamiteratordelete"><code>RedisModule_StreamIteratorDelete</code></a></li>
        <li><a href="#redismodule_streamtrimbylength"><code>RedisModule_StreamTrimByLength</code></a></li>
        <li><a href="#redismodule_streamtrimbyid"><code>RedisModule_StreamTrimByID</code></a></li>
      </ul>
    </li>
    <li><a href="#calling-redis-commands-from-modules">Calling Redis commands from modules</a>
      <ul>
        <li><a href="#redismodule_freecallreply"><code>RedisModule_FreeCallReply</code></a></li>
        <li><a href="#redismodule_callreplytype"><code>RedisModule_CallReplyType</code></a></li>
        <li><a href="#redismodule_callreplylength"><code>RedisModule_CallReplyLength</code></a></li>
        <li><a href="#redismodule_callreplyarrayelement"><code>RedisModule_CallReplyArrayElement</code></a></li>
        <li><a href="#redismodule_callreplyinteger"><code>RedisModule_CallReplyInteger</code></a></li>
        <li><a href="#redismodule_callreplydouble"><code>RedisModule_CallReplyDouble</code></a></li>
        <li><a href="#redismodule_callreplybignumber"><code>RedisModule_CallReplyBigNumber</code></a></li>
        <li><a href="#redismodule_callreplyverbatim"><code>RedisModule_CallReplyVerbatim</code></a></li>
        <li><a href="#redismodule_callreplybool"><code>RedisModule_CallReplyBool</code></a></li>
        <li><a href="#redismodule_callreplysetelement"><code>RedisModule_CallReplySetElement</code></a></li>
        <li><a href="#redismodule_callreplymapelement"><code>RedisModule_CallReplyMapElement</code></a></li>
        <li><a href="#redismodule_callreplyattribute"><code>RedisModule_CallReplyAttribute</code></a></li>
        <li><a href="#redismodule_callreplyattributeelement"><code>RedisModule_CallReplyAttributeElement</code></a></li>
        <li><a href="#redismodule_callreplypromisesetunblockhandler"><code>RedisModule_CallReplyPromiseSetUnblockHandler</code></a></li>
        <li><a href="#redismodule_callreplypromiseabort"><code>RedisModule_CallReplyPromiseAbort</code></a></li>
        <li><a href="#redismodule_callreplystringptr"><code>RedisModule_CallReplyStringPtr</code></a></li>
        <li><a href="#redismodule_createstringfromcallreply"><code>RedisModule_CreateStringFromCallReply</code></a></li>
        <li><a href="#redismodule_setcontextuser"><code>RedisModule_SetContextUser</code></a></li>
        <li><a href="#redismodule_call"><code>RedisModule_Call</code></a></li>
        <li><a href="#redismodule_callreplyproto"><code>RedisModule_CallReplyProto</code></a></li>
      </ul>
    </li>
    <li><a href="#modules-data-types">Modules data types</a>
      <ul>
        <li><a href="#redismodule_createdatatype"><code>RedisModule_CreateDataType</code></a></li>
        <li><a href="#redismodule_moduletypesetvalue"><code>RedisModule_ModuleTypeSetValue</code></a></li>
        <li><a href="#redismodule_moduletypegettype"><code>RedisModule_ModuleTypeGetType</code></a></li>
        <li><a href="#redismodule_moduletypegetvalue"><code>RedisModule_ModuleTypeGetValue</code></a></li>
      </ul>
    </li>
    <li><a href="#rdb-loading-and-saving-functions">RDB loading and saving functions</a>
      <ul>
        <li><a href="#redismodule_isioerror"><code>RedisModule_IsIOError</code></a></li>
        <li><a href="#redismodule_saveunsigned"><code>RedisModule_SaveUnsigned</code></a></li>
        <li><a href="#redismodule_loadunsigned"><code>RedisModule_LoadUnsigned</code></a></li>
        <li><a href="#redismodule_savesigned"><code>RedisModule_SaveSigned</code></a></li>
        <li><a href="#redismodule_loadsigned"><code>RedisModule_LoadSigned</code></a></li>
        <li><a href="#redismodule_savestring"><code>RedisModule_SaveString</code></a></li>
        <li><a href="#redismodule_savestringbuffer"><code>RedisModule_SaveStringBuffer</code></a></li>
        <li><a href="#redismodule_loadstring"><code>RedisModule_LoadString</code></a></li>
        <li><a href="#redismodule_loadstringbuffer"><code>RedisModule_LoadStringBuffer</code></a></li>
        <li><a href="#redismodule_savedouble"><code>RedisModule_SaveDouble</code></a></li>
        <li><a href="#redismodule_loaddouble"><code>RedisModule_LoadDouble</code></a></li>
        <li><a href="#redismodule_savefloat"><code>RedisModule_SaveFloat</code></a></li>
        <li><a href="#redismodule_loadfloat"><code>RedisModule_LoadFloat</code></a></li>
        <li><a href="#redismodule_savelongdouble"><code>RedisModule_SaveLongDouble</code></a></li>
        <li><a href="#redismodule_loadlongdouble"><code>RedisModule_LoadLongDouble</code></a></li>
      </ul>
    </li>
    <li><a href="#key-digest-api-debug-digest-interface-for-modules-types">Key digest API (DEBUG DIGEST interface for modules types)</a>
      <ul>
        <li><a href="#redismodule_digestaddstringbuffer"><code>RedisModule_DigestAddStringBuffer</code></a></li>
        <li><a href="#redismodule_digestaddlonglong"><code>RedisModule_DigestAddLongLong</code></a></li>
        <li><a href="#redismodule_digestendsequence"><code>RedisModule_DigestEndSequence</code></a></li>
        <li><a href="#redismodule_loaddatatypefromstringencver"><code>RedisModule_LoadDataTypeFromStringEncver</code></a></li>
        <li><a href="#redismodule_loaddatatypefromstring"><code>RedisModule_LoadDataTypeFromString</code></a></li>
        <li><a href="#redismodule_savedatatypetostring"><code>RedisModule_SaveDataTypeToString</code></a></li>
        <li><a href="#redismodule_getkeynamefromdigest"><code>RedisModule_GetKeyNameFromDigest</code></a></li>
        <li><a href="#redismodule_getdbidfromdigest"><code>RedisModule_GetDbIdFromDigest</code></a></li>
      </ul>
    </li>
    <li><a href="#aof-api-for-modules-data-types">AOF API for modules data types</a>
      <ul>
        <li><a href="#redismodule_emitaof"><code>RedisModule_EmitAOF</code></a></li>
      </ul>
    </li>
    <li><a href="#io-context-handling">IO context handling</a>
      <ul>
        <li><a href="#redismodule_getkeynamefromio"><code>RedisModule_GetKeyNameFromIO</code></a></li>
        <li><a href="#redismodule_getkeynamefrommodulekey"><code>RedisModule_GetKeyNameFromModuleKey</code></a></li>
        <li><a href="#redismodule_getdbidfrommodulekey"><code>RedisModule_GetDbIdFromModuleKey</code></a></li>
        <li><a href="#redismodule_getdbidfromio"><code>RedisModule_GetDbIdFromIO</code></a></li>
      </ul>
    </li>
    <li><a href="#logging">Logging</a>
      <ul>
        <li><a href="#redismodule_log"><code>RedisModule_Log</code></a></li>
        <li><a href="#redismodule_logioerror"><code>RedisModule_LogIOError</code></a></li>
        <li><a href="#redismodule__assert"><code>RedisModule__Assert</code></a></li>
        <li><a href="#redismodule_latencyaddsample"><code>RedisModule_LatencyAddSample</code></a></li>
      </ul>
    </li>
    <li><a href="#blocking-clients-from-modules">Blocking clients from modules</a>
      <ul>
        <li><a href="#redismodule_registerauthcallback"><code>RedisModule_RegisterAuthCallback</code></a></li>
        <li><a href="#redismodule_blockclient"><code>RedisModule_BlockClient</code></a></li>
        <li><a href="#redismodule_blockclientonauth"><code>RedisModule_BlockClientOnAuth</code></a></li>
        <li><a href="#redismodule_blockclientgetprivatedata"><code>RedisModule_BlockClientGetPrivateData</code></a></li>
        <li><a href="#redismodule_blockclientsetprivatedata"><code>RedisModule_BlockClientSetPrivateData</code></a></li>
        <li><a href="#redismodule_blockclientonkeys"><code>RedisModule_BlockClientOnKeys</code></a></li>
        <li><a href="#redismodule_blockclientonkeyswithflags"><code>RedisModule_BlockClientOnKeysWithFlags</code></a></li>
        <li><a href="#redismodule_signalkeyasready"><code>RedisModule_SignalKeyAsReady</code></a></li>
        <li><a href="#redismodule_unblockclient"><code>RedisModule_UnblockClient</code></a></li>
        <li><a href="#redismodule_abortblock"><code>RedisModule_AbortBlock</code></a></li>
        <li><a href="#redismodule_setdisconnectcallback"><code>RedisModule_SetDisconnectCallback</code></a></li>
        <li><a href="#redismodule_isblockedreplyrequest"><code>RedisModule_IsBlockedReplyRequest</code></a></li>
        <li><a href="#redismodule_isblockedtimeoutrequest"><code>RedisModule_IsBlockedTimeoutRequest</code></a></li>
        <li><a href="#redismodule_getblockedclientprivatedata"><code>RedisModule_GetBlockedClientPrivateData</code></a></li>
        <li><a href="#redismodule_getblockedclientreadykey"><code>RedisModule_GetBlockedClientReadyKey</code></a></li>
        <li><a href="#redismodule_getblockedclienthandle"><code>RedisModule_GetBlockedClientHandle</code></a></li>
        <li><a href="#redismodule_blockedclientdisconnected"><code>RedisModule_BlockedClientDisconnected</code></a></li>
      </ul>
    </li>
    <li><a href="#thread-safe-contexts">Thread Safe Contexts</a>
      <ul>
        <li><a href="#redismodule_getthreadsafecontext"><code>RedisModule_GetThreadSafeContext</code></a></li>
        <li><a href="#redismodule_getdetachedthreadsafecontext"><code>RedisModule_GetDetachedThreadSafeContext</code></a></li>
        <li><a href="#redismodule_freethreadsafecontext"><code>RedisModule_FreeThreadSafeContext</code></a></li>
        <li><a href="#redismodule_threadsafecontextlock"><code>RedisModule_ThreadSafeContextLock</code></a></li>
        <li><a href="#redismodule_threadsafecontexttrylock"><code>RedisModule_ThreadSafeContextTryLock</code></a></li>
        <li><a href="#redismodule_threadsafecontextunlock"><code>RedisModule_ThreadSafeContextUnlock</code></a></li>
      </ul>
    </li>
    <li><a href="#module-keyspace-notifications-api">Module Keyspace Notifications API</a>
      <ul>
        <li><a href="#redismodule_subscribetokeyspaceevents"><code>RedisModule_SubscribeToKeyspaceEvents</code></a></li>
        <li><a href="#redismodule_addpostnotificationjob"><code>RedisModule_AddPostNotificationJob</code></a></li>
        <li><a href="#redismodule_getnotifykeyspaceevents"><code>RedisModule_GetNotifyKeyspaceEvents</code></a></li>
        <li><a href="#redismodule_notifykeyspaceevent"><code>RedisModule_NotifyKeyspaceEvent</code></a></li>
      </ul>
    </li>
    <li><a href="#modules-cluster-api">Modules Cluster API</a>
      <ul>
        <li><a href="#redismodule_registerclustermessagereceiver"><code>RedisModule_RegisterClusterMessageReceiver</code></a></li>
        <li><a href="#redismodule_sendclustermessage"><code>RedisModule_SendClusterMessage</code></a></li>
        <li><a href="#redismodule_getclusternodeslist"><code>RedisModule_GetClusterNodesList</code></a></li>
        <li><a href="#redismodule_freeclusternodeslist"><code>RedisModule_FreeClusterNodesList</code></a></li>
        <li><a href="#redismodule_getmyclusterid"><code>RedisModule_GetMyClusterID</code></a></li>
        <li><a href="#redismodule_getclustersize"><code>RedisModule_GetClusterSize</code></a></li>
        <li><a href="#redismodule_getclusternodeinfo"><code>RedisModule_GetClusterNodeInfo</code></a></li>
        <li><a href="#redismodule_setclusterflags"><code>RedisModule_SetClusterFlags</code></a></li>
      </ul>
    </li>
    <li><a href="#modules-timers-api">Modules Timers API</a>
      <ul>
        <li><a href="#redismodule_createtimer"><code>RedisModule_CreateTimer</code></a></li>
        <li><a href="#redismodule_stoptimer"><code>RedisModule_StopTimer</code></a></li>
        <li><a href="#redismodule_gettimerinfo"><code>RedisModule_GetTimerInfo</code></a></li>
      </ul>
    </li>
    <li><a href="#modules-eventloop-api">Modules EventLoop API</a>
      <ul>
        <li><a href="#redismodule_eventloopadd"><code>RedisModule_EventLoopAdd</code></a></li>
        <li><a href="#redismodule_eventloopdel"><code>RedisModule_EventLoopDel</code></a></li>
        <li><a href="#redismodule_eventloopaddoneshot"><code>RedisModule_EventLoopAddOneShot</code></a></li>
      </ul>
    </li>
    <li><a href="#modules-acl-api">Modules ACL API</a>
      <ul>
        <li><a href="#redismodule_createmoduleuser"><code>RedisModule_CreateModuleUser</code></a></li>
        <li><a href="#redismodule_freemoduleuser"><code>RedisModule_FreeModuleUser</code></a></li>
        <li><a href="#redismodule_setmoduleuseracl"><code>RedisModule_SetModuleUserACL</code></a></li>
        <li><a href="#redismodule_setmoduleuseraclstring"><code>RedisModule_SetModuleUserACLString</code></a></li>
        <li><a href="#redismodule_getmoduleuseraclstring"><code>RedisModule_GetModuleUserACLString</code></a></li>
        <li><a href="#redismodule_getcurrentusername"><code>RedisModule_GetCurrentUserName</code></a></li>
        <li><a href="#redismodule_getmoduleuserfromusername"><code>RedisModule_GetModuleUserFromUserName</code></a></li>
        <li><a href="#redismodule_aclcheckcommandpermissions"><code>RedisModule_ACLCheckCommandPermissions</code></a></li>
        <li><a href="#redismodule_aclcheckkeypermissions"><code>RedisModule_ACLCheckKeyPermissions</code></a></li>
        <li><a href="#redismodule_aclcheckchannelpermissions"><code>RedisModule_ACLCheckChannelPermissions</code></a></li>
        <li><a href="#redismodule_acladdlogentry"><code>RedisModule_ACLAddLogEntry</code></a></li>
        <li><a href="#redismodule_acladdlogentrybyusername"><code>RedisModule_ACLAddLogEntryByUserName</code></a></li>
        <li><a href="#redismodule_authenticateclientwithuser"><code>RedisModule_AuthenticateClientWithUser</code></a></li>
        <li><a href="#redismodule_authenticateclientwithacluser"><code>RedisModule_AuthenticateClientWithACLUser</code></a></li>
        <li><a href="#redismodule_deauthenticateandcloseclient"><code>RedisModule_DeauthenticateAndCloseClient</code></a></li>
        <li><a href="#redismodule_redactclientcommandargument"><code>RedisModule_RedactClientCommandArgument</code></a></li>
        <li><a href="#redismodule_getclientcertificate"><code>RedisModule_GetClientCertificate</code></a></li>
      </ul>
    </li>
    <li><a href="#modules-dictionary-api">Modules Dictionary API</a>
      <ul>
        <li><a href="#redismodule_createdict"><code>RedisModule_CreateDict</code></a></li>
        <li><a href="#redismodule_freedict"><code>RedisModule_FreeDict</code></a></li>
        <li><a href="#redismodule_dictsize"><code>RedisModule_DictSize</code></a></li>
        <li><a href="#redismodule_dictsetc"><code>RedisModule_DictSetC</code></a></li>
        <li><a href="#redismodule_dictreplacec"><code>RedisModule_DictReplaceC</code></a></li>
        <li><a href="#redismodule_dictset"><code>RedisModule_DictSet</code></a></li>
        <li><a href="#redismodule_dictreplace"><code>RedisModule_DictReplace</code></a></li>
        <li><a href="#redismodule_dictgetc"><code>RedisModule_DictGetC</code></a></li>
        <li><a href="#redismodule_dictget"><code>RedisModule_DictGet</code></a></li>
        <li><a href="#redismodule_dictdelc"><code>RedisModule_DictDelC</code></a></li>
        <li><a href="#redismodule_dictdel"><code>RedisModule_DictDel</code></a></li>
        <li><a href="#redismodule_dictiteratorstartc"><code>RedisModule_DictIteratorStartC</code></a></li>
        <li><a href="#redismodule_dictiteratorstart"><code>RedisModule_DictIteratorStart</code></a></li>
        <li><a href="#redismodule_dictiteratorstop"><code>RedisModule_DictIteratorStop</code></a></li>
        <li><a href="#redismodule_dictiteratorreseekc"><code>RedisModule_DictIteratorReseekC</code></a></li>
        <li><a href="#redismodule_dictiteratorreseek"><code>RedisModule_DictIteratorReseek</code></a></li>
        <li><a href="#redismodule_dictnextc"><code>RedisModule_DictNextC</code></a></li>
        <li><a href="#redismodule_dictprevc"><code>RedisModule_DictPrevC</code></a></li>
        <li><a href="#redismodule_dictnext"><code>RedisModule_DictNext</code></a></li>
        <li><a href="#redismodule_dictprev"><code>RedisModule_DictPrev</code></a></li>
        <li><a href="#redismodule_dictcomparec"><code>RedisModule_DictCompareC</code></a></li>
        <li><a href="#redismodule_dictcompare"><code>RedisModule_DictCompare</code></a></li>
      </ul>
    </li>
    <li><a href="#modules-info-fields">Modules Info fields</a>
      <ul>
        <li><a href="#redismodule_infoaddsection"><code>RedisModule_InfoAddSection</code></a></li>
        <li><a href="#redismodule_infobegindictfield"><code>RedisModule_InfoBeginDictField</code></a></li>
        <li><a href="#redismodule_infoenddictfield"><code>RedisModule_InfoEndDictField</code></a></li>
        <li><a href="#redismodule_infoaddfieldstring"><code>RedisModule_InfoAddFieldString</code></a></li>
        <li><a href="#redismodule_infoaddfieldcstring"><code>RedisModule_InfoAddFieldCString</code></a></li>
        <li><a href="#redismodule_infoaddfielddouble"><code>RedisModule_InfoAddFieldDouble</code></a></li>
        <li><a href="#redismodule_infoaddfieldlonglong"><code>RedisModule_InfoAddFieldLongLong</code></a></li>
        <li><a href="#redismodule_infoaddfieldulonglong"><code>RedisModule_InfoAddFieldULongLong</code></a></li>
        <li><a href="#redismodule_registerinfofunc"><code>RedisModule_RegisterInfoFunc</code></a></li>
        <li><a href="#redismodule_getserverinfo"><code>RedisModule_GetServerInfo</code></a></li>
        <li><a href="#redismodule_freeserverinfo"><code>RedisModule_FreeServerInfo</code></a></li>
        <li><a href="#redismodule_serverinfogetfield"><code>RedisModule_ServerInfoGetField</code></a></li>
        <li><a href="#redismodule_serverinfogetfieldc"><code>RedisModule_ServerInfoGetFieldC</code></a></li>
        <li><a href="#redismodule_serverinfogetfieldsigned"><code>RedisModule_ServerInfoGetFieldSigned</code></a></li>
        <li><a href="#redismodule_serverinfogetfieldunsigned"><code>RedisModule_ServerInfoGetFieldUnsigned</code></a></li>
        <li><a href="#redismodule_serverinfogetfielddouble"><code>RedisModule_ServerInfoGetFieldDouble</code></a></li>
      </ul>
    </li>
    <li><a href="#modules-utility-apis">Modules utility APIs</a>
      <ul>
        <li><a href="#redismodule_getrandombytes"><code>RedisModule_GetRandomBytes</code></a></li>
        <li><a href="#redismodule_getrandomhexchars"><code>RedisModule_GetRandomHexChars</code></a></li>
      </ul>
    </li>
    <li><a href="#modules-api-exporting--importing">Modules API exporting / importing</a>
      <ul>
        <li><a href="#redismodule_exportsharedapi"><code>RedisModule_ExportSharedAPI</code></a></li>
        <li><a href="#redismodule_getsharedapi"><code>RedisModule_GetSharedAPI</code></a></li>
      </ul>
    </li>
    <li><a href="#module-command-filter-api">Module Command Filter API</a>
      <ul>
        <li><a href="#redismodule_registercommandfilter"><code>RedisModule_RegisterCommandFilter</code></a></li>
        <li><a href="#redismodule_unregistercommandfilter"><code>RedisModule_UnregisterCommandFilter</code></a></li>
        <li><a href="#redismodule_commandfilterargscount"><code>RedisModule_CommandFilterArgsCount</code></a></li>
        <li><a href="#redismodule_commandfilterargget"><code>RedisModule_CommandFilterArgGet</code></a></li>
        <li><a href="#redismodule_commandfilterarginsert"><code>RedisModule_CommandFilterArgInsert</code></a></li>
        <li><a href="#redismodule_commandfilterargreplace"><code>RedisModule_CommandFilterArgReplace</code></a></li>
        <li><a href="#redismodule_commandfilterargdelete"><code>RedisModule_CommandFilterArgDelete</code></a></li>
        <li><a href="#redismodule_mallocsize"><code>RedisModule_MallocSize</code></a></li>
        <li><a href="#redismodule_mallocusablesize"><code>RedisModule_MallocUsableSize</code></a></li>
        <li><a href="#redismodule_mallocsizestring"><code>RedisModule_MallocSizeString</code></a></li>
        <li><a href="#redismodule_mallocsizedict"><code>RedisModule_MallocSizeDict</code></a></li>
        <li><a href="#redismodule_getusedmemoryratio"><code>RedisModule_GetUsedMemoryRatio</code></a></li>
      </ul>
    </li>
    <li><a href="#scanning-keyspace-and-hashes">Scanning keyspace and hashes</a>
      <ul>
        <li><a href="#redismodule_scancursorcreate"><code>RedisModule_ScanCursorCreate</code></a></li>
        <li><a href="#redismodule_scancursorrestart"><code>RedisModule_ScanCursorRestart</code></a></li>
        <li><a href="#redismodule_scancursordestroy"><code>RedisModule_ScanCursorDestroy</code></a></li>
        <li><a href="#redismodule_scan"><code>RedisModule_Scan</code></a></li>
        <li><a href="#redismodule_scankey"><code>RedisModule_ScanKey</code></a></li>
      </ul>
    </li>
    <li><a href="#module-fork-api">Module fork API</a>
      <ul>
        <li><a href="#redismodule_fork"><code>RedisModule_Fork</code></a></li>
        <li><a href="#redismodule_sendchildheartbeat"><code>RedisModule_SendChildHeartbeat</code></a></li>
        <li><a href="#redismodule_exitfromchild"><code>RedisModule_ExitFromChild</code></a></li>
        <li><a href="#redismodule_killforkchild"><code>RedisModule_KillForkChild</code></a></li>
      </ul>
    </li>
    <li><a href="#server-hooks-implementation">Server hooks implementation</a>
      <ul>
        <li><a href="#redismodule_subscribetoserverevent"><code>RedisModule_SubscribeToServerEvent</code></a></li>
        <li><a href="#redismodule_issubeventsupported"><code>RedisModule_IsSubEventSupported</code></a></li>
      </ul>
    </li>
    <li><a href="#module-configurations-api">Module Configurations API</a>
      <ul>
        <li><a href="#redismodule_registerstringconfig"><code>RedisModule_RegisterStringConfig</code></a></li>
        <li><a href="#redismodule_registerboolconfig"><code>RedisModule_RegisterBoolConfig</code></a></li>
        <li><a href="#redismodule_registerenumconfig"><code>RedisModule_RegisterEnumConfig</code></a></li>
        <li><a href="#redismodule_registernumericconfig"><code>RedisModule_RegisterNumericConfig</code></a></li>
        <li><a href="#redismodule_loadconfigs"><code>RedisModule_LoadConfigs</code></a></li>
      </ul>
    </li>
    <li><a href="#key-eviction-api">Key eviction API</a>
      <ul>
        <li><a href="#redismodule_setlru"><code>RedisModule_SetLRU</code></a></li>
        <li><a href="#redismodule_getlru"><code>RedisModule_GetLRU</code></a></li>
        <li><a href="#redismodule_setlfu"><code>RedisModule_SetLFU</code></a></li>
        <li><a href="#redismodule_getlfu"><code>RedisModule_GetLFU</code></a></li>
      </ul>
    </li>
    <li><a href="#miscellaneous-apis">Miscellaneous APIs</a>
      <ul>
        <li><a href="#redismodule_getmoduleoptionsall"><code>RedisModule_GetModuleOptionsAll</code></a></li>
        <li><a href="#redismodule_getcontextflagsall"><code>RedisModule_GetContextFlagsAll</code></a></li>
        <li><a href="#redismodule_getkeyspacenotificationflagsall"><code>RedisModule_GetKeyspaceNotificationFlagsAll</code></a></li>
        <li><a href="#redismodule_getserverversion"><code>RedisModule_GetServerVersion</code></a></li>
        <li><a href="#redismodule_gettypemethodversion"><code>RedisModule_GetTypeMethodVersion</code></a></li>
        <li><a href="#redismodule_moduletypereplacevalue"><code>RedisModule_ModuleTypeReplaceValue</code></a></li>
        <li><a href="#redismodule_getcommandkeyswithflags"><code>RedisModule_GetCommandKeysWithFlags</code></a></li>
        <li><a href="#redismodule_getcommandkeys"><code>RedisModule_GetCommandKeys</code></a></li>
        <li><a href="#redismodule_getcurrentcommandname"><code>RedisModule_GetCurrentCommandName</code></a></li>
      </ul>
    </li>
    <li><a href="#defrag-api">Defrag API</a>
      <ul>
        <li><a href="#redismodule_registerdefragfunc"><code>RedisModule_RegisterDefragFunc</code></a></li>
        <li><a href="#redismodule_defragshouldstop"><code>RedisModule_DefragShouldStop</code></a></li>
        <li><a href="#redismodule_defragcursorset"><code>RedisModule_DefragCursorSet</code></a></li>
        <li><a href="#redismodule_defragcursorget"><code>RedisModule_DefragCursorGet</code></a></li>
        <li><a href="#redismodule_defragalloc"><code>RedisModule_DefragAlloc</code></a></li>
        <li><a href="#redismodule_defragredismodulestring"><code>RedisModule_DefragRedisModuleString</code></a></li>
        <li><a href="#redismodule_getkeynamefromdefragctx"><code>RedisModule_GetKeyNameFromDefragCtx</code></a></li>
        <li><a href="#redismodule_getdbidfromdefragctx"><code>RedisModule_GetDbIdFromDefragCtx</code></a></li>
      </ul>
    </li>
    <li><a href="#function-index">Function index</a></li>
  </ul>
</nav>
        </nav>
        
    </div>
  </section>


  </main>


    <footer class="bg-midnight-700 relative z-50">
      <p class="container max-w-[85rem] mx-auto px-4 sm:px-8 py-8 text-slate-400 text-sm text-center">
  This is a community website sponsored by <a href="https://redis.com/" class="text-white underline underline-offset-1 decoration-transparent hover:decoration-slate-500 transition-colors">Redis Ltd.</a> © 2023. Redis and the cube logo are registered trademarks of Redis Ltd. <a href="../../../terms.html" class="text-white underline underline-offset-1 decoration-transparent hover:decoration-slate-500 transition-colors">Terms of use &amp; privacy policy</a>.
</p>

      <script>
  
  document.addEventListener('DOMContentLoaded', () => {

    const TableOfContents = {
      container: document.querySelector('#TableOfContents'),
      links: null,
      headings: null,
      intersectionOptions: {
        rootMargin: '0px',
        threshold: 1
      },
      previousSection: null,
      observer: null,

      init() {
        if (!this.container) return false

        this.handleObserver = this.handleObserver.bind(this)
        this.setUpObserver()
        this.findLinksAndHeadings()
        this.observeSections()
      },

      handleObserver(entries, observer) {
        entries.forEach(entry => {
          let href = `#${entry.target.getAttribute('id')}`
          let link = this.links.find(l => l.getAttribute('href') === href)

          if (entry.isIntersecting && entry.intersectionRatio >= 1) {
            link.classList.add('visible')
            this.previousSection = entry.target.getAttribute('id')
          } else {
            link.classList.remove('visible')
          }

          this.highlightFirstActive()
        })
      },

      highlightFirstActive() {
        let firstVisibleLink = this.container.querySelector('.visible')

        this.links.forEach(link => {
          link.classList.remove('active')
        })

        if (firstVisibleLink) {
          firstVisibleLink.classList.add('active')
        }

        if (!firstVisibleLink && this.previousSection) {
          this.container.querySelector(
            `a[href="#${this.previousSection}"]`
          ).classList.add('active')
        }
      },

      observeSections() {
        this.headings.forEach(heading => {
          this.observer.observe(heading)
        })
      },

      setUpObserver() {
        this.observer = new IntersectionObserver(
          this.handleObserver,
          this.intersectionOptions
        )
      },

      findLinksAndHeadings() {
        this.links = [...this.container.querySelectorAll('a')]
        this.headings = this.links.map(link => {
          let id = link.getAttribute('href')
          return document.querySelector(id)
        })
      }
    }

    TableOfContents.init()

})
</script>
    </footer>

    
<div class="sr-only w-screen h-screen fixed z-[200] top-0 left-0 cursor-auto flex flex-col bg-slate-900/75 p-4 sm:p-6 md:p-[10vh] lg:p-[12vh]" id="search-container" role="button" aria-expanded="true" aria-haspopup="listbox" aria-labelledby="search-label" tabindex="0">
  <div class="search-modal">
    <header class="search-bar">
      <form id="search-form" class="search-form">
        <label class="search-magnifier-label" for="search-input" id="search-label">
          <svg width="20" height="20" class="search-icon" viewBox="0 0 20 20">
            <path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </label>
        <div class="search-loading-indicator">
          <svg viewBox="0 0 38 38" stroke="currentColor" stroke-opacity=".5">
            <g fill="none" fill-rule="evenodd">
              <g transform="translate(1 1)" stroke-width="2">
                <circle stroke-opacity=".3" cx="18" cy="18" r="18"></circle>
                <path d="M36 18c0-9.94-8.06-18-18-18">
                  <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"></animateTransform>
                </path>
              </g>
            </g>
          </svg>
        </div>
        <input class="search-input" aria-autocomplete="both" aria-labelledby="search-label" id="search-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search…" maxlength="64" type="search" value="">
        <button type="reset" title="Clear the query" class="search-reset" aria-label="Clear the query" hidden="">
          <svg width="20" height="20" viewBox="0 0 20 20">
            <path d="M10 10l5.09-5.09L10 10l5.09 5.09L10 10zm0 0L4.91 4.91 10 10l-5.09 5.09L10 10z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </button>
      </form>
      <button id="search-cancel" type="reset" aria-label="Cancel">
        Cancel
      </button>
    </header>
    <dl id="search-results" class="search-results" role="listbox"></dl>
    <footer class="search-footer">
      <a href="../../stack/search.html" target="_blank" rel="noopener noreferrer">
        <span class="logo-label">Powered by Redis Stack</span>
        
        <svg viewBox="0 0 39 31" fill="none"><path d="M21.7371 15.2903C21.5759 15.2895 21.4198 15.2337 21.2947 15.1321 21.1695 15.0305 21.0828 14.8892 21.049 14.7316S21.0362 14.4096 21.1086 14.2655C21.1811 14.1215 21.3005 14.0066 21.4472 13.9397L35.7199 7.47338 21.4578 1.34289C21.2943 1.26329 21.1678 1.12377 21.1045.953307 21.0412.78285 21.046.594558 21.1179.427547 21.1898.260535 21.3233.127641 21.4906.0564719 21.6579-.0146977 21.8462-.0186728 22.0164.045373L37.7492 6.80518C37.8747 6.8605 37.9814 6.95112 38.0563 7.06599S38.171 7.31503 38.171 7.45216 38.1312 7.72347 38.0563 7.83834C37.9814 7.95321 37.8747 8.04383 37.7492 8.09915L22.0306 15.2266C21.9388 15.2698 21.8385 15.2916 21.7371 15.2903z" fill="#db2e2e"></path><path d="M16.4339 15.2903C16.3379 15.2906 16.2429 15.2714 16.1546 15.2337L.421813 8.47393C.296339 8.41861.18966 8.32799.114767 8.21312.0398745 8.09825.0 7.96407.0 7.82694.0 7.68981.0398745 7.55564.114767 7.44077.18966 7.3259.296339 7.23528.421813 7.17995L16.1546.052465C16.3235-.0111265 16.5104-.00772359 16.6768.0619772 16.8433.131678 16.9768.2624 17.0501.427363 17.1233.592325 17.1306.779042 17.0706.949259 17.0106 1.11948 16.8878 1.26031 16.7274 1.34291L2.44763 7.80573 16.7132 13.9362C16.8612 14.0015 16.9823 14.1154 17.0565 14.2592 17.1306 14.4029 17.1532 14.5677 17.1205 14.7261 17.0878 14.8845 17.0019 15.0269 16.8769 15.1295 16.752 15.2322 16.5956 15.2889 16.4339 15.2903z" fill="#db2e2e"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 17.4328c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 13.9539C37.3908 13.8108 37.6564 13.6514 37.9118 13.4766 37.972 13.8833 37.972 14.2967 37.9118 14.7034 37.8022 15.1312 37.4875 15.4847 36.289 16.061 35.4617 16.4605 33.1531 17.408 30.5792 18.4687c-3.6167 1.4884-7.778 3.1819-9.0826 3.889C19.2587 23.4183 18.0284 23.4183 16.3137 22.644 15.4864 22.2021 12.4918 20.9117 9.39476 19.5611c-3.3198-1.446-6.75627-2.945-7.77802-3.4753C.22377 15.3575.153061 15.1948.160132 14.8271V13.8655L.513678 14.0564c1.311652.6647 7.219412 3.1819 11.486722 5.0204 2.1142.898 3.8112 1.6298 4.3769 1.8844C18.092 21.7319 19.3082 21.8733 21.5603 20.6748 22.7022 20.0808 25.9619 18.7409 29.1651 17.4328z" fill="#494c4d"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 24.5037c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 21.0248C37.3908 20.8817 37.6564 20.7223 37.9118 20.5475 37.972 20.9542 37.972 21.3676 37.9118 21.7743 37.8022 22.2021 37.4875 22.5557 36.289 23.1319 35.4617 23.5314 33.1531 24.4789 30.5792 25.5396c-3.6167 1.4884-7.778 3.1819-9.0826 3.889-2.2379 1.0606-3.4682 1.0606-5.1829.2864C15.4864 29.2801 12.4918 27.9755 9.39476 26.625c-3.3198-1.446-6.75627-2.9451-7.77802-3.4754C.22377 22.4213.153061 22.2587.160132 21.891V20.9364L.513678 21.1273C1.82533 21.792 7.73309 24.3092 12.0004 26.1477c2.1001.898 3.8006 1.6298 4.3663 1.8844C18.0814 28.8028 19.2976 28.9442 21.5497 27.7457 22.7022 27.1518 25.9619 25.8118 29.1651 24.5037z" fill="#494c4d"></path></svg>
      </a>
    </footer>
  </div>
</div>

<script>
  const searchModal = (() => {
    const searchButton = document.querySelector('#search-button')
    const searchContainer = document.querySelector('#search-container')
    const searchInput = searchContainer.querySelector('#search-input')
    const resultsContainer = searchContainer.querySelector('#search-results')
    const style = document.createElement('style')
    
    let keys = {}
    let focusable
    let firstFocusable
    let lastFocusable
  
    function next (elem, selector) {
      let nextElem = elem.nextElementSibling
      if (!selector) return nextElem
      if (nextElem && nextElem.matches(selector)) return nextElem
      return null
    }
  
    function debounce(callback, delay) {
      let timeout
      
      return function() {
        clearTimeout(timeout)
        timeout = setTimeout(callback, delay)
      }
    }
  
    function searchSubmit(form) {
      if (form.id !== 'search-form') return false
  
      const searchTerm = searchInput.value
  
      if (searchTerm.length < 1) {
        resultsContainer.innerHTML = ''
        return
      }
  
      function search(url) {
        let promise = new Promise((resolve, reject) => {
          const req = new XMLHttpRequest()
          req.open('GET', url)
          req.onload = function() {
            if (req.status === 200) {
              resolve(JSON.parse(req.response))
            } else {
              reject(Error(req.status))
            }
          }
          req.send()
        })
  
        return promise
      }
  
      function sortData(data) {
        
        const getCategories = (data) =>
          data.reduce((a, c) => {
            if (!a.includes(c.hierarchy[0])) {
              a.push(c.hierarchy[0])
            }
  
            return a
          }, [])

        
        const constructSectionTitle = (record) => {
          if (record.hierarchy && record.hierarchy.length > 2) {
            return record.hierarchy[1]
          } else {
            return record.title
          }
        }

        
        const mergeData = (data, categories) =>
          categories.map((category) => {
            const obj = {}
            obj.category = category
  
            data.forEach((record) => {
              if (record.hierarchy[0] === category) {
                obj[record.title] = {
                  path: constructSectionTitle(record),
                  url: record.url,
                }
              }
            })
  
            return obj
          })
  
        return mergeData(data.results, getCategories(data.results))
      }
  
      function escape_evil_chars(str_in) {
        return str_in.replaceAll('>','&gt;').replaceAll('<', '&lt;').replaceAll('&', '&amp;').replaceAll('"','&quot;').replaceAll("'",'&#x27;')
      }   
      
      function displayData(data) {
        resultsContainer.innerHTML = ''
        
        if (data.results.length < 1) {
          escapedSearchTerm = escape_evil_chars(searchTerm)
          resultsContainer.insertAdjacentHTML(
            'beforeend',
            `<dt class="sr-only">${escapedSearchTerm}:</dt>
            <dd class="search-no-results">
              No results for \"<span class="search-title">${escapedSearchTerm}</span>\"
            </dd>`
          )
        } else {
          sortData(data).forEach((result) => {
            resultsContainer.insertAdjacentHTML(
              'beforeend', 
              `<dt class="search-item-source">
                ${result.category}
              </dt>`
            )
    
            delete result.category
    
            Object.keys(result).forEach((key, index) => {
              resultsContainer.insertAdjacentHTML(
                'beforeend',
                `<dd class="search-item" role="option">
                  <a href="${result[key].url}">
                    <span class="search-item-icon"></span>
                    <span class="search-item-content">
                      ${result[key].path ? `<span class="search-item-path">${result[key].path}</span>` : ''}
                      <span class="search-item-title">${key.replace(new RegExp(`(^|)(${searchTerm})(|$)`, 'ig'), '$1<b class="search-term-match">$2</b>$3')}</span>
                    </span>
                    <span class="search-item-action"></span>
                  </a>
                </dd>`
              )
            })
            
            if (!resultsContainer.querySelector('[aria-selected]')) resultsContainer.querySelector('.search-item').setAttribute('aria-selected', '')
          })
        }
        return
      }
  
      function displayError(error) {
        console.log(error)
      }
  
      search(`https://search-service.redislabs.com/search?q=${searchTerm}*&site=https://redis.io`)
        .then(displayData)
        .catch(displayError)
    }
  
    function loadHandler(event) {
      style.innerHTML = `
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      `
  
      document.head.appendChild(style)
      document.documentElement.dataset.searchState = 'off'
    }
  
    function getNextSibling(elem, selector, direction) {
      let sibling = direction === 'down' ? elem.nextElementSibling : elem.previousElementSibling
    
      while (sibling) {
        if (sibling.matches(selector)) return sibling
        sibling = direction === 'down' ? sibling.nextElementSibling : sibling.previousElementSibling
      }
    }
  
    function tabSelection(direction) {
      const currentSelection = resultsContainer.querySelector('[aria-selected]')
      if (!currentSelection || direction === 'down' && !currentSelection.nextElementSibling || direction === 'up' && !currentSelection.previousElementSibling) return false
        
      const nextSelection = getNextSibling(currentSelection, '.search-item', direction)
      if (!nextSelection) return false
      
      nextSelection.setAttribute('aria-selected', '')
      currentSelection.removeAttribute('aria-selected')
      resultsContainer.scrollTop = nextSelection.offsetTop - resultsContainer.offsetTop
    }
    
    function keyDownHandler(event) {
      switch (event.key) {
  
        // Arrow keys
        case 'ArrowDown':
          if (document.documentElement.dataset.searchState === 'off' || !document.querySelector('.search-item')) return false
          event.preventDefault()
          tabSelection('down')
          break
  
        case 'ArrowUp':
          if (document.documentElement.dataset.searchState === 'off' || !document.querySelector('.search-item')) return false
          event.preventDefault()
          tabSelection('up')
          break
  
        // Tab
        case 'Tab':
          if (document.documentElement.dataset.searchState === 'off') return false
  
          if (focusable.length === 1) {
            event.preventDefault()
            break
          }
  
          // If shift is fired, tab backward
          if (event.shiftKey) {
            if (document.activeElement === firstFocusable) {
              event.preventDefault()
              lastFocusable.focus()
            }
  
            // Otherwise tab forward
          } else {
            if (document.activeElement === lastFocusable) {
              event.preventDefault()
              firstFocusable.focus()
            }
          }
          break
  
        // Esc
        case 'Escape':
          if (document.documentElement.dataset.searchState === 'off') return false
          stopSearch()
          break
        
        // Enter
        case 'Enter':
          if (!document.querySelector('.search-item:focus-within') && document.querySelector('.search-item[aria-selected]')) {
            event.preventDefault()
            document.querySelector('.search-item[aria-selected] a').click()
          }
          break
  
        // Forward slash
        case '/':
          if (document.documentElement.dataset.searchState === 'on') return false
          event.preventDefault()
          startSearch()
          break
      
        // Default
        default:
          return false
          break
      }
    }
  
    function keyUpHandler(event) {
      if (document.documentElement.dataset.searchState === 'off' || !document.activeElement.matches('.search-input')) return false
      
      switch (event.key) {
        case 'ArrowDown':
          return false
          break
        case 'ArrowUp':
          return false
          break
        case 'ArrowLeft':
          return false
          break
        case 'ArrowRight':
          return false
          break
        case 'Tab':
          return false
          break
        case 'Escape':
          return false
          break
        case 'Enter':
          return false
          break
        case '/':
          return false
          break
        default:
          searchSubmit(document.activeElement.closest('form'))
          break
      }
    }
  
    function multiKeyHandler(event) {
      if (document.documentElement.dataset.searchState === 'on') return false
  
      let { key, type } = event
      let isKeyDown = (type == 'keydown')
      keys[key] = isKeyDown
  
      // Both (cmd || cntrl) & k pressed
      if (isKeyDown && (keys.Control || keys.Meta) && keys.k) {
        event.preventDefault()
        startSearch()
      }
    }
  
    // Click handler function
    function clickHandler(event) {
      if (event.target.closest('#search-button')) {
        startSearch()
      } else if (event.target.closest('#search-cancel') || event.target.matches('#search-container')) {
        stopSearch()
      }
    }
  
    function startSearch() {
      sessionStorage.setItem('scroll-position', document.documentElement.scrollTop)
      document.documentElement.dataset.scrollDisabled = 'on'
      document.documentElement.dataset.searchState = 'on'
      allowFocus(searchContainer, true)
      trapFocus(searchContainer)
      searchInput.focus()
    }
  
    function stopSearch() {
      document.documentElement.dataset.searchState = 'off'
      document.documentElement.dataset.scrollDisabled = 'off'
      document.documentElement.scrollTop = sessionStorage.getItem('scroll-position')
      allowFocus(searchContainer, false)
      document.activeElement.blur()
      resultsContainer.innerHTML = ''
      searchInput.value = ''
      keys = {}
    }
  
    function submitHandler(event) {
      if (event.target.id === 'search-form') {
        event.preventDefault()
        return false
      }
    }
  
    function allowFocus(selector, state) {
      const focusable = selector.querySelectorAll('button, [href], input, select, textarea')
      focusable.forEach(el => el.setAttribute('tabindex', state ? '' : '-1'))
      selector.classList.toggle('sr-only')
    }
  
    function trapFocus(selector) {
      focusable = selector.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"]')
      firstFocusable = focusable[0]
      lastFocusable = focusable[focusable.length - 1]
    }
  
    // Attach event listeners
    document.addEventListener('DOMContentLoaded', loadHandler)
    document.addEventListener('click', clickHandler)
    document.addEventListener('keydown', event => debounce(keyDownHandler(event), 100))
    document.addEventListener('keyup', event => debounce(keyUpHandler(event), 100))
    document.addEventListener('keydown', multiKeyHandler)
    document.addEventListener('keyup', multiKeyHandler)
    document.addEventListener('submit', submitHandler)
  })()
</script>
  

</body></html>