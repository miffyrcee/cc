<html><!-- Online page at https://redis.io/docs/stack/get-started/tutorials/stack-node/ --><head><meta charset="utf-8"><title>Redis OM for Node.js</title><link rel="stylesheet" href="../../../../css_1.css" type="text/css"><link rel="stylesheet" href="../../../../css_2.css" type="text/css"><link rel="stylesheet" href="../../../../css_3.css" type="text/css"><link rel="stylesheet" href="../../../../css_4.css" type="text/css"><link rel="stylesheet" href="../../../../css_5.css" type="text/css"><script type="text/javascript" src="../../../../js_1.js"></script><script type="text/javascript" src="../../../../js_10.js"></script><script type="text/javascript" src="../../../../js_3.js"></script><script type="text/javascript" src="../../../../js_4.js"></script><script type="text/javascript" src="../../../../js_5.js"></script><script type="text/javascript" src="../../../../js_6.js"></script><script type="text/javascript" src="../../../../js_7.js"></script><script type="text/javascript" src="../../../../js_8.js"></script><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style></head><body class="antialiased tracking-[-0.01em]">
    <noscript>&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;lt;iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T4MTBKP"
        height="0" width="0" style="display:none;visibility:hidden"&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;lt;/iframe&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;gt;</noscript>
    <header class="sticky top-0 z-50 flex items-center w-full text-xs lg:text-sm font-semibold lg:font-medium text-white shadow bg-midnight-700">
      <div class="flex items-center w-full h-16 container max-w-[85rem] mx-auto px-4 sm:px-8">
  <a class="relative z-50 mr-auto" href="../../../../../redis.io.html">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 368.69 125.59" class="w-auto h-8">
  <defs>
    <style>
      .cls-1 {
        fill: none;
      }

      .cls-2 {
        clip-path: url(#clip-path);
      }

      .cls-3 {
        fill: #a32422;
      }

      .cls-4 {
        fill: #dc382c;
      }

      .cls-5 {
        fill: #fff;
      }

      .cls-6 {
        fill: #741113;
      }

      .cls-7 {
        fill: #ac2724;
      }
    </style>
    <clipPath id="clip-path" transform="translate(0.01 0.01)">
      <rect class="cls-1" width="146.42" height="125.48"></rect>
    </clipPath>
  </defs>
  <g id="Layer_2" data-name="Layer 2">
    <g id="Layer_1-2" data-name="Layer 1">
      <g class="cls-2">
        <path class="cls-3" d="M140.66,96.74c-7.8,4.08-48.28,20.73-57,25.3s-13.39,4.44-20.21,1.18S13.7,102.5,5.92,98.78C2,96.94,0,95.37,0,93.9V79.09S56.08,66.92,65.13,63.64,77.31,60.28,85,63.1,138.79,74.24,146.4,77V91.6c0,1.52-1.75,3-5.74,5.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,82c-7.8,4.06-48.28,20.71-57,25.2s-13.39,4.45-20.21,1.2S13.7,87.69,5.92,84s-7.93-6.27-.3-9.25S56.08,55,65.13,51.7,77.31,48.33,85,51.16,133,70,140.57,72.79s7.92,5.08.09,9.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-3" d="M140.66,72.62c-7.8,4.07-48.28,20.71-57,25.2S70.31,102.27,63.49,99,13.7,78.37,5.92,74.66C2,72.8,0,71.24,0,69.76V55S56.08,42.79,65.13,39.51,77.31,36.14,85,39,138.79,50.1,146.4,52.88v14.6C146.4,69,144.65,70.52,140.66,72.62Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,57.81c-7.8,4.08-48.28,20.72-57,25.21s-13.39,4.46-20.21,1.2S13.7,63.57,5.92,59.85-2,53.6,5.62,50.62s50.46-19.79,59.51-23S77.31,24.21,85,27,133,45.94,140.57,48.65s7.92,5.09.09,9.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-3" d="M140.66,47.59c-7.8,4.08-48.28,20.73-57,25.21S70.31,77.25,63.49,74,13.7,53.34,5.92,49.63C2,47.79,0,46.22,0,44.74V29.93S56.08,17.76,65.13,14.49,77.31,11.12,85,13.94s53.77,11.14,61.38,13.92v14.6C146.4,44,144.65,45.5,140.66,47.59Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,32.8c-7.8,4-48.28,20.75-57,25.2s-13.39,4.44-20.21,1.2S13.7,38.53,5.92,34.83s-7.93-6.27-.3-9.25S56.08,5.8,65.13,2.54,77.31-.82,85,2,133,20.85,140.57,23.63s7.92,5.09.09,9.14Z" transform="translate(0.01 0.01)"></path>
      </g>
      <polygon class="cls-5" points="75.51 11.78 85.17 8.61 82.55 14.87 92.38 18.55 79.71 19.87 76.86 26.71 72.28 19.08 57.63 17.76 68.57 13.82 65.28 7.76 75.51 11.78 75.51 11.78 75.51 11.78"></polygon>
      <polygon class="cls-5" points="76.12 51.71 52.44 41.88 86.36 36.67 76.12 51.71 76.12 51.71 76.12 51.71"></polygon>
      <path class="cls-5" d="M43.28,22.34c10,0,18.13,3.15,18.13,7s-8.15,7-18.13,7-18.14-3.15-18.14-7S33.27,22.34,43.28,22.34Z" transform="translate(0.01 0.01)"></path>
      <polygon class="cls-6" points="107.39 20.42 127.46 28.35 107.41 36.28 107.39 20.42 107.39 20.42 107.39 20.42"></polygon>
      <polygon class="cls-7" points="107.39 20.42 107.41 36.28 105.23 37.13 85.17 29.2 107.39 20.42 107.39 20.42 107.39 20.42"></polygon>
      <path class="cls-5" d="M193,41.4a17.36,17.36,0,0,1,6.23-4.34,20,20,0,0,1,7.3-1.61,6.71,6.71,0,0,1,5,1.61,5,5,0,0,1,1.52,3.79,5.39,5.39,0,0,1-1.52,3.79,4.9,4.9,0,0,1-3.79,1.63c-6.24.55-14.9,6.77-14.9,15.22V80.67a5.57,5.57,0,0,1-5.42,5.41,4.92,4.92,0,0,1-3.87-1.67,5.36,5.36,0,0,1-1.62-3.79v-40a5.35,5.35,0,0,1,1.62-3.79,7.2,7.2,0,0,1,4.07-1.36,5.52,5.52,0,0,1,5.41,5.4Z" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M258.71,59a5.25,5.25,0,0,1-1.35,3.54,6.11,6.11,0,0,1-3.79,1.62h-32a10.31,10.31,0,0,0,3.47,6.56,14.46,14.46,0,0,0,9.48,4.57,14.07,14.07,0,0,0,10.56-2.44,5.52,5.52,0,0,1,4.07-1.63,4.65,4.65,0,0,1,3.51,1.36,4.41,4.41,0,0,1,.26,6.24c-.08.09-.17.17-.26.26a24.49,24.49,0,0,1-17.59,6.5A23,23,0,0,1,217.5,78a26.67,26.67,0,0,1-7.3-17.9,24.31,24.31,0,0,1,7.3-17.88,22.59,22.59,0,0,1,17.06-7.31,22,22,0,0,1,16.74,6.78,24.78,24.78,0,0,1,7.61,16.74v.53Zm-24.1-14.35a14.2,14.2,0,0,0-9.13,3.53,13.17,13.17,0,0,0-4.33,7h28.43a12.39,12.39,0,0,0-4.88-6.76,17.3,17.3,0,0,0-10-3.81" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M309.66,80.12a5.57,5.57,0,0,1-5.41,5.42,5.85,5.85,0,0,1-5.42-4.34A23.23,23.23,0,0,1,285,85.54a23.57,23.57,0,0,1-17.33-7.31,24.14,24.14,0,0,1-7.05-17.88,25.75,25.75,0,0,1,7.05-17.87A23.85,23.85,0,0,1,285,34.87a22.34,22.34,0,0,1,13.53,4.34V20.28a4.92,4.92,0,0,1,1.63-3.79A5.37,5.37,0,0,1,304,14.86a4.92,4.92,0,0,1,3.79,1.63,5.36,5.36,0,0,1,1.63,3.79V80.12ZM285.31,74.7a12,12,0,0,0,9.47-4.32,14.4,14.4,0,0,0,0-20A13,13,0,0,0,285.31,46a11.65,11.65,0,0,0-9.48,4.34,14.4,14.4,0,0,0,0,20,12.49,12.49,0,0,0,9.48,4.32" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M325.67,20.28v2.18A5.5,5.5,0,0,1,324,26.58a4.64,4.64,0,0,1-3.79,1.35,4.86,4.86,0,0,1-3.78-1.61,5.44,5.44,0,0,1-1.63-4.06v-2a5.28,5.28,0,0,1,1.63-3.79,5.33,5.33,0,0,1,3.78-1.63A5,5,0,0,1,324,16.49a4.9,4.9,0,0,1,1.66,3.79m-9.13,16.53a5.28,5.28,0,0,1,3.79-1.63,4.85,4.85,0,0,1,3.79,1.63,5.48,5.48,0,0,1,1.55,4V80.42A4.55,4.55,0,0,1,324,84.21a5.33,5.33,0,0,1-3.78,1.63,4.9,4.9,0,0,1-3.79-1.63,5.28,5.28,0,0,1-1.63-3.79V40.85a5.39,5.39,0,0,1,1.63-4" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M364.08,40.6a5.29,5.29,0,0,1,2.17,3.24,7.17,7.17,0,0,1-.54,4.06,5.4,5.4,0,0,1-3.25,2.16,5.61,5.61,0,0,1-4.07-.81c-3.79-2.43-6.75-3.78-9.2-3.78a8.74,8.74,0,0,0-6,1.88c-1.08.82-1.62,1.36-1.62,1.9a2,2,0,0,0,.27,1.36,3.74,3.74,0,0,0,1.08.81,16.19,16.19,0,0,0,7.32,2.43h0a37.75,37.75,0,0,1,9.74,3,13.57,13.57,0,0,1,6.5,5.7,13.46,13.46,0,0,1-4.06,18.67,21.79,21.79,0,0,1-13,4.06c-6.23,0-12.18-2.43-17.87-7a5.77,5.77,0,0,1-1.9-3.53,5.2,5.2,0,0,1,8.4-4.56,15.73,15.73,0,0,0,11.1,4.33,11.61,11.61,0,0,0,6.77-1.9c1.08-1.08,1.9-1.89,1.9-2.71s0-1.08-.27-1.35c0-.28-.55-.81-1.36-1.08a20.15,20.15,0,0,0-8.13-2.86h0a28.26,28.26,0,0,1-9.2-3,16.56,16.56,0,0,1-6.5-5.67,12.61,12.61,0,0,1-1.61-6.23,13.3,13.3,0,0,1,5.95-11.11,21.82,21.82,0,0,1,12.45-3.79c4.56.28,9.48,2.16,14.89,5.69" transform="translate(0.01 0.01)"></path>
    </g>
  </g>
</svg>
  </a>

	<nav data-menu="" class="hidden lg:flex items-center justify-center content-start lg:content-center lg:gap-y-4 flex-1 z-40 fixed inset-0 lg:static bg-slate-900 lg:bg-transparent text-sm max-h-screen lg:max-w-none pt-20 pb-8 lg:py-0 overflow-y-auto lg:overflow-y-visible">
    
    
      

        
        <a href="../../../getting-started.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Get started
        </a>

        
        <a href="../../../getting-started.html" class="flex lg:hidden items-center mt-1.5">
          Get started
        </a>
      
    
      
        
        
        <dl class="hidden lg:flex group relative first:ml-auto ml-1 mt-3 mb-0 px-3 pt-2 pb-5 cursor-pointer">
          <dt class="sr-only uppercase lg:not-sr-only flex items-center justify-items-center group-hover:text-white/50 group-focus-within:text-white/50 whitespace-nowrap transition-colors" href="#">
            
            Docs
          </dt>
          <dd class="hidden lg:grid text-[0.8rem] lg:text-sm text-redis-neutral-800 absolute top-full -mt-1 right-[1000rem] p-2 group-hover:right-[unset] group-hover:-left-3 group-focus-within:right-[unset] group-focus-within:-left-3 bg-white rounded-lg border border-slate-500/10 bg-clip-padding shadow-md">
            
              
                <div class="-my-2 pr-3 py-4 col-start-1  pl-3 ">
                  <a href="../../../about.html" class=" font-semibold text-[0.9375rem] text-slate-900 flex items-center whitespace-nowrap min-w-[10rem] hover:text-slate-600 focus:text-slate-600 transition-colors">
                    
                      <span class="grid place-items-center w-5 h-5 mr-2.5">
                        
                        <svg viewBox="0 0 147 126" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M140.708 96.7107c-7.81 4.0703-48.2904 20.7203-57.0004 25.2903C74.9976 126.571 70.3176 126.441 63.4976 123.191s-49.8-20.73-57.57002-24.4403C2.04758 96.9007.00756836 95.3407.00756836 93.8607V79.0508S56.0876 66.8807 65.1376 63.6107 77.3176 60.2406 85.0276 63.0606C92.7376 65.8806 138.798 74.2007 146.408 76.9807V91.5606C146.408 93.0806 144.658 94.5606 140.668 96.6907L140.708 96.7107z" fill="#a32422"></path><path d="M140.708 81.9108C132.898 85.9808 92.4176 102.631 83.7076 107.121 74.9976 111.611 70.3176 111.561 63.4976 108.321c-6.82-3.24-49.8-20.6703-57.57001-24.3703-7.77-3.7-7.92999-6.27-.30999-9.25s50.47-19.78 59.52-23S77.3176 48.3408 85.0276 51.1708C92.7376 54.0008 132.968 70.0108 140.578 72.7908 148.188 75.5708 148.488 77.8808 140.668 81.9208L140.708 81.9108z" fill="#dc382c"></path><path d="M140.708 72.5807C132.898 76.6507 92.4176 93.3008 83.7076 97.7908 74.9976 102.281 70.3176 102.231 63.4976 98.9907 56.6776 95.7507 13.6976 78.3407 5.92758 74.6207 2.04758 72.7707.00756836 71.2007.00756836 69.7207V54.9306S56.0876 42.7607 65.1376 39.4707 77.3176 36.1107 85.0276 38.9407C92.7376 41.7707 138.798 50.0607 146.408 52.8507v14.64C146.488 68.9607 144.698 70.4907 140.708 72.5807z" fill="#a32422"></path><path d="M140.708 57.7808c-7.81 4.08-48.2904 20.7099-57.0004 25.1999S70.3176 87.4407 63.4976 84.1807s-49.8-20.65-57.57001-24.36C-1.84241 56.1107-2.0024 53.5607 5.6176 50.5807s50.47-19.78 59.52-23S77.3176 24.2208 85.0276 27.0308C92.7376 29.8408 132.968 45.9508 140.578 48.6608 148.188 51.3708 148.488 53.7408 140.668 57.7908L140.708 57.7808z" fill="#dc382c"></path><path d="M140.708 47.5508c-7.81 4.08-48.2904 20.73-57.0004 25.22C74.9976 77.2608 70.3176 77.2107 63.4976 73.9507 56.6776 70.6907 13.6976 53.3007 5.92758 49.5907c-3.88-1.84-5.92001164-3.41-5.92001164-4.89V29.9008S56.0876 17.7207 65.1376 14.4507c9.05-3.27 12.18-3.3599 19.89-.549899999999999C92.7376 16.7108 138.798 25.0407 146.408 27.8307V42.4208C146.488 43.9408 144.698 45.4908 140.708 47.5508z" fill="#a32422"></path><path d="M140.708 32.7607c-7.81 4-48.2904 20.7599-57.0004 25.1999s-13.39 4.4401-20.21 1.2001-49.8-20.66-57.57001-24.36c-7.77-3.7-7.92999-6.27-.30999-9.26 7.62-2.99 50.47-19.77998 59.52-22.99998 9.05-3.219996 12.18-3.360025 19.89-.53003C92.7376 4.84069 132.968 20.8507 140.578 23.6407 148.188 26.4307 148.488 28.7207 140.668 32.7707L140.708 32.7607z" fill="#dc382c"></path><path d="M140.708 96.7107c-7.81 4.0703-48.2904 20.7203-57.0004 25.2903C74.9976 126.571 70.3176 126.441 63.4976 123.191s-49.8-20.73-57.57002-24.4403C2.04758 96.9007.00756836 95.3407.00756836 93.8607V79.0508S56.0876 66.8807 65.1376 63.6107 77.3176 60.2406 85.0276 63.0606C92.7376 65.8806 138.798 74.2007 146.408 76.9807V91.5606C146.408 93.0806 144.658 94.5606 140.668 96.6907L140.708 96.7107z" fill="#a32422"></path><path d="M140.708 81.9108C132.898 85.9808 92.4176 102.631 83.7076 107.121 74.9976 111.611 70.3176 111.561 63.4976 108.321c-6.82-3.24-49.8-20.6703-57.57001-24.3703-7.77-3.7-7.92999-6.27-.30999-9.25s50.47-19.78 59.52-23S77.3176 48.3408 85.0276 51.1708C92.7376 54.0008 132.968 70.0108 140.578 72.7908 148.188 75.5708 148.488 77.8808 140.668 81.9208L140.708 81.9108z" fill="#dc382c"></path><path d="M140.708 72.5807C132.898 76.6507 92.4176 93.3008 83.7076 97.7908 74.9976 102.281 70.3176 102.231 63.4976 98.9907 56.6776 95.7507 13.6976 78.3407 5.92758 74.6207 2.04758 72.7707.00756836 71.2007.00756836 69.7207V54.9306S56.0876 42.7607 65.1376 39.4707 77.3176 36.1107 85.0276 38.9407C92.7376 41.7707 138.798 50.0607 146.408 52.8507v14.64C146.488 68.9607 144.698 70.4907 140.708 72.5807z" fill="#a32422"></path><path d="M140.708 57.7808c-7.81 4.08-48.2904 20.7099-57.0004 25.1999S70.3176 87.4407 63.4976 84.1807s-49.8-20.65-57.57001-24.36C-1.84241 56.1107-2.0024 53.5607 5.6176 50.5807s50.47-19.78 59.52-23S77.3176 24.2208 85.0276 27.0308C92.7376 29.8408 132.968 45.9508 140.578 48.6608 148.188 51.3708 148.488 53.7408 140.668 57.7908L140.708 57.7808z" fill="#dc382c"></path><path d="M140.708 47.5508c-7.81 4.08-48.2904 20.73-57.0004 25.22C74.9976 77.2608 70.3176 77.2107 63.4976 73.9507 56.6776 70.6907 13.6976 53.3007 5.92758 49.5907c-3.88-1.84-5.92001164-3.41-5.92001164-4.89V29.9008S56.0876 17.7207 65.1376 14.4507c9.05-3.27 12.18-3.3599 19.89-.549899999999999C92.7376 16.7108 138.798 25.0407 146.408 27.8307V42.4208C146.488 43.9408 144.698 45.4908 140.708 47.5508z" fill="#a32422"></path><path d="M140.708 32.7607c-7.81 4-48.2904 20.7599-57.0004 25.1999s-13.39 4.4401-20.21 1.2001-49.8-20.66-57.57001-24.36c-7.77-3.7-7.92999-6.27-.30999-9.26 7.62-2.99 50.47-19.77998 59.52-22.99998 9.05-3.219996 12.18-3.360025 19.89-.53003C92.7376 4.84069 132.968 20.8507 140.578 23.6407 148.188 26.4307 148.488 28.7207 140.668 32.7707L140.708 32.7607z" fill="#dc382c"></path><path d="M75.5476 11.7307l9.66-3.17-2.62 6.26 9.83 3.68-12.67 1.32L76.8976 26.6607l-4.58-7.63-14.65-1.32 10.94-3.94L65.3176 7.71069l10.23 4.02001z" fill="#fff"></path><path d="M76.1575 51.6607l-23.68-9.83 33.92-5.2-10.24 15.03z" fill="#fff"></path><path d="M43.3276 22.3008c10 0 18.12 3.15 18.12 7s-8.14 7-18.12 7c-9.98.0-18.14-3.15000000000001-18.14-7s8.13-7 18.14-7z" fill="#fff"></path><path d="M107.428 20.3707l20.07 7.93-20.05 7.93L107.428 20.3707z" fill="#741113"></path><path d="M107.428 20.3707 107.448 36.2307 105.268 37.0807l-20.0605-7.93 22.2205-8.78z" fill="#ac2724"></path></svg>
                      </span>
                    
                    Redis
                  </a>
                  
                    <a href="../../../getting-started.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Get started
                    </a>
                  
                    <a href="../../../data-types.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Data types
                    </a>
                  
                    <a href="../../../ui/cli.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Redis CLI
                    </a>
                  
                    <a href="../../../clients.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Redis clients
                    </a>
                  
                    <a href="../../../management/persistence.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Persistence
                    </a>
                  
                    <a href="../../../management/scaling.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Scaling
                    </a>
                  
                </div>
              
            
              
                <div class="-my-2 pr-3 py-4 col-start-2  border-l pl-5 ">
                  <a href="../../../stack.html" class=" font-semibold text-[0.9375rem] text-slate-900 flex items-center whitespace-nowrap min-w-[10rem] hover:text-slate-600 focus:text-slate-600 transition-colors">
                    
                      <span class="grid place-items-center w-5 h-5 mr-2.5">
                        
                        <svg viewBox="0 0 39 31" fill="none"><path d="M21.7371 15.2903C21.5759 15.2895 21.4198 15.2337 21.2947 15.1321 21.1695 15.0305 21.0828 14.8892 21.049 14.7316S21.0362 14.4096 21.1086 14.2655C21.1811 14.1215 21.3005 14.0066 21.4472 13.9397L35.7199 7.47338 21.4578 1.34289C21.2943 1.26329 21.1678 1.12377 21.1045.953307 21.0412.78285 21.046.594558 21.1179.427547 21.1898.260535 21.3233.127641 21.4906.0564719 21.6579-.0146977 21.8462-.0186728 22.0164.045373L37.7492 6.80518C37.8747 6.8605 37.9814 6.95112 38.0563 7.06599S38.171 7.31503 38.171 7.45216 38.1312 7.72347 38.0563 7.83834C37.9814 7.95321 37.8747 8.04383 37.7492 8.09915L22.0306 15.2266C21.9388 15.2698 21.8385 15.2916 21.7371 15.2903z" fill="#db2e2e"></path><path d="M16.4339 15.2903C16.3379 15.2906 16.2429 15.2714 16.1546 15.2337L.421813 8.47393C.296339 8.41861.18966 8.32799.114767 8.21312.0398745 8.09825.0 7.96407.0 7.82694.0 7.68981.0398745 7.55564.114767 7.44077.18966 7.3259.296339 7.23528.421813 7.17995L16.1546.052465C16.3235-.0111265 16.5104-.00772359 16.6768.0619772 16.8433.131678 16.9768.2624 17.0501.427363 17.1233.592325 17.1306.779042 17.0706.949259 17.0106 1.11948 16.8878 1.26031 16.7274 1.34291L2.44763 7.80573 16.7132 13.9362C16.8612 14.0015 16.9823 14.1154 17.0565 14.2592 17.1306 14.4029 17.1532 14.5677 17.1205 14.7261 17.0878 14.8845 17.0019 15.0269 16.8769 15.1295 16.752 15.2322 16.5956 15.2889 16.4339 15.2903z" fill="#db2e2e"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 17.4328c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 13.9539C37.3908 13.8108 37.6564 13.6514 37.9118 13.4766 37.972 13.8833 37.972 14.2967 37.9118 14.7034 37.8022 15.1312 37.4875 15.4847 36.289 16.061 35.4617 16.4605 33.1531 17.408 30.5792 18.4687c-3.6167 1.4884-7.778 3.1819-9.0826 3.889C19.2587 23.4183 18.0284 23.4183 16.3137 22.644 15.4864 22.2021 12.4918 20.9117 9.39476 19.5611c-3.3198-1.446-6.75627-2.945-7.77802-3.4753C.22377 15.3575.153061 15.1948.160132 14.8271V13.8655L.513678 14.0564c1.311652.6647 7.219412 3.1819 11.486722 5.0204 2.1142.898 3.8112 1.6298 4.3769 1.8844C18.092 21.7319 19.3082 21.8733 21.5603 20.6748 22.7022 20.0808 25.9619 18.7409 29.1651 17.4328z" fill="#494c4d"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 24.5037c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 21.0248C37.3908 20.8817 37.6564 20.7223 37.9118 20.5475 37.972 20.9542 37.972 21.3676 37.9118 21.7743 37.8022 22.2021 37.4875 22.5557 36.289 23.1319 35.4617 23.5314 33.1531 24.4789 30.5792 25.5396c-3.6167 1.4884-7.778 3.1819-9.0826 3.889-2.2379 1.0606-3.4682 1.0606-5.1829.2864C15.4864 29.2801 12.4918 27.9755 9.39476 26.625c-3.3198-1.446-6.75627-2.9451-7.77802-3.4754C.22377 22.4213.153061 22.2587.160132 21.891V20.9364L.513678 21.1273C1.82533 21.792 7.73309 24.3092 12.0004 26.1477c2.1001.898 3.8006 1.6298 4.3663 1.8844C18.0814 28.8028 19.2976 28.9442 21.5497 27.7457 22.7022 27.1518 25.9619 25.8118 29.1651 24.5037z" fill="#494c4d"></path></svg>
                      </span>
                    
                    Redis Stack
                  </a>
                  
                    <a href="../../get-started.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Get started
                    </a>
                  
                    <a href="../clients.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Stack clients
                    </a>
                  
                    <a href="../../../ui/insight.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      RedisInsight
                    </a>
                  
                    <a href="../../json.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      JSON
                    </a>
                  
                    <a href="../../search.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Search
                    </a>
                  
                    <a href="../../bloom.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Probabilistic
                    </a>
                  
                </div>
              
            
          </dd>
        </dl>
        
        
        <dl class="lg:hidden">
          <dt class="sr-only">
            Docs
          </dt>
          <dd class="lg:hidden flex flex-col">
            
              
                <a href="../../../about.html" class="flex items-center mt-2">
                  Redis
                </a>
                
                  <a href="../../../getting-started.html" class="mt-2">
                    Get started
                  </a>
                
                  <a href="../../../data-types.html" class="mt-2">
                    Data types
                  </a>
                
                  <a href="../../../ui/cli.html" class="mt-2">
                    Redis CLI
                  </a>
                
                  <a href="../../../clients.html" class="mt-2">
                    Redis clients
                  </a>
                
                  <a href="../../../management/persistence.html" class="mt-2">
                    Persistence
                  </a>
                
                  <a href="../../../management/scaling.html" class="mt-2">
                    Scaling
                  </a>
                
                <hr class="opacity-10 mt-4 mb-2">
              
            
              
                <a href="../../../stack.html" class="flex items-center mt-2">
                  Redis Stack
                </a>
                
                  <a href="../../get-started.html" class="mt-2">
                    Get started
                  </a>
                
                  <a href="../clients.html" class="mt-2">
                    Stack clients
                  </a>
                
                  <a href="../../../ui/insight.html" class="mt-2">
                    RedisInsight
                  </a>
                
                  <a href="../../json.html" class="mt-2">
                    JSON
                  </a>
                
                  <a href="../../search.html" class="mt-2">
                    Search
                  </a>
                
                  <a href="../../bloom.html" class="mt-2">
                    Probabilistic
                  </a>
                
                <hr class="opacity-10 mt-4 mb-2">
              
            
          </dd>
        </dl>
      
    
      

        
        <a href="../../../../commands.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Commands
        </a>

        
        <a href="../../../../commands.html" class="flex lg:hidden items-center mt-1.5">
          Commands
        </a>
      
    
      
        
        
        <dl class="hidden lg:flex group relative first:ml-auto ml-1 mt-3 mb-0 px-3 pt-2 pb-5 cursor-pointer">
          <dt class="sr-only uppercase lg:not-sr-only flex items-center justify-items-center group-hover:text-white/50 group-focus-within:text-white/50 whitespace-nowrap transition-colors" href="#">
            
            Resources
          </dt>
          <dd class="hidden lg:grid text-[0.8rem] lg:text-sm text-redis-neutral-800 absolute top-full -mt-1 right-[1000rem] p-2 group-hover:right-[unset] group-hover:-left-3 group-focus-within:right-[unset] group-focus-within:-left-3 bg-white rounded-lg border border-slate-500/10 bg-clip-padding shadow-md">
            
              
              <a href="../../../../resources/clients.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Clients
              </a>
              
            
              
              <a href="../../../../resources/libraries.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Libraries
              </a>
              
            
              
              <a href="../../../../resources/tools.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Tools
              </a>
              
            
              
              <a href="../../../../resources/modules.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Modules
              </a>
              
            
          </dd>
        </dl>
        
        
        <dl class="lg:hidden">
          <dt class="sr-only">
            Resources
          </dt>
          <dd class="lg:hidden flex flex-col">
            
              
              <a href="../../../../resources/clients.html" class="mt-2">
                Clients
              </a>
              
            
              
              <a href="../../../../resources/libraries.html" class="mt-2">
                Libraries
              </a>
              
            
              
              <a href="../../../../resources/tools.html" class="mt-2">
                Tools
              </a>
              
            
              
              <a href="../../../../resources/modules.html" class="mt-2">
                Modules
              </a>
              
            
          </dd>
        </dl>
      
    
      

        
        <a href="../../../../community.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Community
        </a>

        
        <a href="../../../../community.html" class="flex lg:hidden items-center mt-1.5">
          Community
        </a>
      
    
      

        
        <a href="../../../../support.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Support
        </a>

        
        <a href="../../../../support.html" class="flex lg:hidden items-center mt-1.5">
          Support
        </a>
      
    
    
    <div class="flex flex-col lg:flex-row lg:ml-auto lg:space-x-2">
      <button id="search-button" type="button" class="rounded-sm w-full lg:w-auto transition-colors shrink-0 flex-1 lg:flex-none lg:ml-2 lg:mr-0 mt-4 lg:mt-0 inline-flex items-center px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 border-white/50 hover:text-indigo-600 focus:text-indigo-600 hover:bg-white focus:bg-white focus:ring-white">
        <svg class="w-[0.875rem] h-[0.875rem] mr-0.5" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <circle cx="10" cy="10" r="7"></circle>
          <line x1="21" y1="21" x2="15" y2="15"></line>
        </svg>
        <span class="sr-only">Quick search&amp;hellip…</span>
        <span class="lg:hidden xl:block flex-auto ml-1 mr-4" aria-hidden="">Search…</span>
        <script>
          if (navigator.appVersion.indexOf("Win") != -1 || navigator.appVersion.indexOf("Linux") != -1) {
            document.querySelector('[title="Command"]').textContent = "&#8963;";
          } 
        </script>
        <kbd class="font-sans font-semibold">
          <abbr title="Command" class="no-underline">⌘</abbr>&nbsp;K
        </kbd>
      </button>
      
        <a class="rounded-sm transition-colors shrink-0 inline-flex items-center justify-center mt-2 lg:mt-0 px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900
         border-transparent bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 focus:ring-indigo-600
        " href="../../../../download.html">
          Download
        </a>
      
        <a class="rounded-sm transition-colors shrink-0 inline-flex items-center justify-center mt-2 lg:mt-0 px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900
        
         border-white/50 hover:text-indigo-600 focus:text-indigo-600 hover:bg-white focus:bg-white focus:ring-white" href="http://redis.com/try-free/">
          Try Redis Cloud
        </a>
      
    </div>
	</nav>

  <button data-menu-toggle="" aria-expanded="false" class="menu-toggle block ml-auto lg:hidden relative z-50"> 
    <span class="sr-only">Open main menu</span> 
    <svg aria-hidden="true" role="img" viewBox="0 0 24 24" style="pointer-events: none; width: 24px; height: 24px;" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <line x1="4" y1="6" x2="20" y2="6"></line>
      <line x1="4" y1="12" x2="20" y2="12"></line>
      <line x1="4" y1="18" x2="20" y2="18"></line>
    </svg>
  </button>
</div>
    </header>

    
  <main class="docs w-full max-w-[85rem] mx-auto px-4 sm:px-6 lg:px-8 md:flex gap-16">
    

<div class="hidden md:block w-52 h-full shrink-0">
  <nav class="w-52 z-40 bg-white hidden md:block fixed top-28 pb-16 h-full max-h-[calc(100vh-7rem)] text-[0.8125rem] leading-7 font">
    <div class="absolute right-0 -top-28 z-[-1] h-screen border-r border-slate-200/50 bg-gradient-to-bl from-slate-50 via-slate-50 to-indigo-100 w-[17rem] xl:w-[calc(50vw-23rem)]"></div>
    <ul class="h-full max-h-[calc(100vh-7rem)] overflow-y-auto pr-6">
      
    <li>
      <a class="flex justify-between items-center truncate font-semibold text-slate-900" href="../../../../docs.html">
          <span>Documentation</span>
          
      </a>
        <ul class="">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../../about.html">
          <span>About</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../../getting-started.html">
          <span>Getting started</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../../ui.html">
          <span>User interfaces</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../../data-types.html">
          <span>Data types</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../../clients.html">
          <span>Client quickstarts</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../../manual.html">
          <span>Using Redis</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../../management.html">
          <span>Managing Redis</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../../reference.html">
          <span>Reference</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../../stack.html">
          <span>Redis Stack</span>
          
            
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400 rotate-90" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../about.html">
          <span>About</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../get-started.html">
          <span>Get started</span>
          
            
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400 rotate-90" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../clients.html">
          <span>Clients</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../install.html">
          <span>Install</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../tutorials.html">
          <span>Tutorials</span>
          
            
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400 rotate-90" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./stack-dotnet.html">
          <span>.NET</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate active text-indigo-600" href="./stack-node.html">
          <span>Node.js</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./stack-python.html">
          <span>Python</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./stack-spring.html">
          <span>Spring / Java</span>
          
      </a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../use-cases.html">
          <span>Use cases</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../search.html">
          <span>Search</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../json.html">
          <span>JSON</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../graph.html">
          <span>Graph</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../timeseries.html">
          <span>Time Series</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../bloom.html">
          <span>Probabilistic</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../license.html">
          <span>License</span>
          
      </a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
  </nav>
</div>
    <div class="w-full max-w-[47rem] py-12">
      <nav class="flex" aria-label="Breadcrumb">
  <ol role="list" class="flex items-center space-x-2">
    
  
    
  
    
  
    
  
    
  
    
  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <a class="text-gray-400 hover:text-gray-500" href="../../../../../redis.io.html">
        <svg class="flex-shrink-0 h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
        </svg>
        <span class="sr-only">Home</span>
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../../../../docs.html">
        Documentation
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../../../stack.html">
        Redis Stack
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../../get-started.html">
        Get started with Redis Stack
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../tutorials.html">
        Redis Stack tutorials
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 pointer-events-none">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="./stack-node.html">
        Redis OM for Node.js
      </a>
    
  </li>

  </ol>
</nav>


      <section class="prose prose-slate w-full max-w-[47rem] py-12">
        <h1>Redis OM for Node.js</h1>
        <p class="text-lg -mt-5 mb-10">Learn how to build with Redis Stack and Node.js</p>
        <p>This tutorial will show you how to build an API using Node.js and Redis Stack.</p>
<p>We'll be using <a href="https://expressjs.com/">Express</a> and <a href="https://github.com/redis/redis-om-node">Redis OM</a> to do this, and we assume that you have a basic understanding of Express.</p>
<p>The API we'll be building is a simple and relatively RESTful API that reads, writes, and finds data on persons: first name, last name, age, etc. We'll also add a simple location tracking feature just for a bit of extra interest.</p>
<p>But before we start with the coding, let's start with a description of what Redis OM <em>is</em>.</p>
<a class="dashAnchor" name="//apple_ref/Section/Redis%20OM%20for%20Node%2Ejs"></a><h2 id="redis-om-for-nodejs">Redis OM for Node.js</h2>
<p>Redis OM (pronounced <em>REDiss OHM</em>) is a library that provides object mapping for Redis—that's what the OM stands for... <em>object mapping</em>. It maps Redis data types — specifically Hashes and JSON documents — to JavaScript objects. And it allows you to search over these Hashes and JSON documents. It uses RedisJSON and RediSearch to do this.</p>
<p>RedisJSON and RediSearch are two of the modules included in Redis Stack. Modules are extensions to Redis that add new data types and new commands. RedisJSON adds a JSON document data type and the commands to manipulate it. RediSearch adds various search commands to index the contents of JSON documents and Hashes.</p>
<p>Redis OM comes in <em>four</em> different versions. We'll be working with Redis OM for Node.js in this tutorial, but there are also flavors and tutorials for <a href="./stack-python.html">Python</a>, <a href="./stack-dotnet.html">.NET</a>, and <a href="./stack-node/docs/stack/get-started/tutorials/stack-spring.html">Spring</a>.</p>
<p>This tutorial will get you started with Redis OM for Node.js, covering the basics. But if you want to dive deep into <em>all</em> of Redis OM's capabilities, check out <a href="https://github.com/redis/redis-om-node">the README</a> over on GitHub.</p>
<a class="dashAnchor" name="//apple_ref/Section/Prerequisites"></a><h2 id="prerequisites">Prerequisites</h2>
<p>Like anything software-related, you need to have some dependencies installed before you can get started:</p>
<ul>
<li><a href="https://nodejs.org/en/">Node.js 14.8+</a>: In this tutorial, we're using JavaScript's top-level <code>await</code> feature which was introduced in Node 14.8. So, make sure you are using that version or later.</li>
<li><a href="../../../../download.html">Redis Stack</a>: You need a version of Redis Stack, either running locally on your machine or <a href="https://redis.com/try-free/">in the cloud</a>.</li>
<li><a href="https://redis.com/redis-enterprise/redis-insight/">RedisInsight</a>: We'll use this to look inside Redis and make sure our code is doing what we think it's doing.</li>
</ul>
<a class="dashAnchor" name="//apple_ref/Section/Starter%20code"></a><h2 id="starter-code">Starter code</h2>
<p>We're not going to code this completely from scratch. Instead, we've provided some starter code for you. Go ahead and clone it to a folder of your convenience:</p>
<pre><code>git clone git@github.com:redis-developer/express-redis-om-workshop.git
</code></pre>
<p>Now that you have the starter code, let's explore it a bit. Opening up <code>server.js</code> in the root we see that we have a simple Express app that uses <a href="https://www.npmjs.com/package/dotenv"><em>Dotenv</em></a> for configuration and <a href="https://www.npmjs.com/package/swagger-ui-express">Swagger UI Express</a> for testing our API:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="s1">'dotenv/config'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">express</span> <span class="nx">from</span> <span class="s1">'express'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">swaggerUi</span> <span class="nx">from</span> <span class="s1">'swagger-ui-express'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">YAML</span> <span class="nx">from</span> <span class="s1">'yamljs'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* create an express app and use JSON */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">express</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* set up swagger in the root */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">swaggerDocument</span> <span class="o">=</span> <span class="nx">YAML</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">'api.yaml'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nx">swaggerUi</span><span class="p">.</span><span class="nx">serve</span><span class="p">,</span> <span class="nx">swaggerUi</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="nx">swaggerDocument</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* start the server */</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span></span></span></code></pre></div>
<p>Alongside this is <code>api.yaml</code>, which defines the API we're going to build and provides the information Swagger UI Express needs to render its UI. You don't need to mess with it unless you want to add some additional routes.</p>
<p>The <code>persons</code> folder has some JSON files and a shell script. The JSON files are sample persons—all musicians because fun—that you can load into the API to test it. The shell script—<code>load-data.sh</code>—will load all the JSON files into the API using <code>curl</code>.</p>
<p>There are two empty folders, <code>om</code> and <code>routers</code>. The <code>om</code> folder is where all the Redis OM code will go. The <code>routers</code> folder will hold code for all of our Express routes.</p>
<a class="dashAnchor" name="//apple_ref/Section/Configure%20and%20run"></a><h2 id="configure-and-run">Configure and run</h2>
<p>The starter code is perfectly runnable if a bit thin. Let's configure and run it to make sure it works before we move on to writing actual code. First, get all the dependencies:</p>
<pre><code>npm install
</code></pre>
<p>Then, set up a <code>.env</code> file in the root that Dotenv can make use of. There's a <code>sample.env</code> file in the root that you can copy and modify:</p>
<pre><code>cp sample.env .env
</code></pre>
<p>The contents of <code>.env</code> looks like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Put your local Redis Stack URL here. Want to run in the</span>
</span></span><span class="line"><span class="cl"><span class="c1"># cloud instead? Sign up at https://redis.com/try-free/.</span>
</span></span><span class="line"><span class="cl"><span class="nv">REDIS_URL</span><span class="o">=</span>redis://localhost:6379</span></span></code></pre></div>
<p>There's a good chance this is already correct. However, if you need to change the <code>REDIS_URL</code> for your particular environment (e.g., you're running Redis Stack in the cloud), this is the time to do it. Once done, you should be able to run the app:</p>
<pre><code>npm start
</code></pre>
<p>Navigate to <code>http://localhost:8080</code> and check out the client that Swagger UI Express has created. None of it <em>works</em> yet because we haven't implemented any of the routes. But, you can try them out and watch them fail!</p>
<p>The starter code runs. Let's add some Redis OM to it so it actually <em>does</em> something!</p>
<a class="dashAnchor" name="//apple_ref/Section/Setting%20up%20a%20Client"></a><h2 id="setting-up-a-client">Setting up a Client</h2>
<p>First things first, let's set up a <strong>client</strong>. The <code>Client</code> class is the thing that knows how to talk to Redis on behalf of Redis OM. One option is to put our client in its own file and export it. This ensures that the application has one and only one instance of <code>Client</code> and thus only one connection to Redis Stack. Since Redis and JavaScript are both (more or less) single-threaded, this works neatly.</p>
<p>Let's create our first file. In the <code>om</code> folder add a file called <code>client.js</code> and add the following code:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Client</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'redis-om'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* pulls the Redis URL from .env */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDIS_URL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* create and open the Redis OM Client */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="kr">await</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">().</span><span class="nx">open</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">client</span></span></span></code></pre></div>
<blockquote>
<p>Remember that <em>top-level await</em> stuff we mentioned earlier? There it is!</p>
</blockquote>
<p>Note that we are getting our Redis URL from an environment variable. It was put there by Dotenv and read from our <code>.env</code> file. If we didn't have the <code>.env</code> file or have a <code>REDIS_URL</code> property in our <code>.env</code> file, this code would gladly read this value from the <em>actual</em> environment variables.</p>
<p>Also note that the <code>.open()</code> method conveniently returns <code>this</code>. This <code>this</code> (can I say <em>this</em> again? I just did!) lets us chain the instantiation of the client with the opening of the client. If this isn't to your liking, you could always write it like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/* create and open the Redis OM Client */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span></span></span></code></pre></div>
<a class="dashAnchor" name="//apple_ref/Section/Entity%2C%20Schema%2C%20and%20Repository"></a><h2 id="entity-schema-and-repository">Entity, Schema, and Repository</h2>
<p>Now that we have a client that's connected to Redis, we need to start mapping some persons. To do that, we need to define an <code>Entity</code> and a <code>Schema</code>. Let's start by creating a file named <code>person.js</code> in the <code>om</code> folder and importing <code>client</code> from <code>client.js</code> and the <code>Entity</code> and <code>Schema</code> classes from Redis OM:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Entity</span><span class="p">,</span> <span class="nx">Schema</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'redis-om'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">client</span> <span class="nx">from</span> <span class="s1">'./client.js'</span></span></span></code></pre></div>
<h3 id="entity">Entity</h3>
<p>Next, we need to define an <strong>entity</strong>. An <code>Entity</code> is the class that holds you data when you work with it—the thing being mapped to. It is what you create, read, update, and delete. Any class that extends <code>Entity</code> is an entity. We'll define our <code>Person</code> entity with a single line:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/* our entity */</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Entity</span> <span class="p">{}</span></span></span></code></pre></div>
<h3 id="schema">Schema</h3>
<p>A <strong>schema</strong> defines the fields on your entity, their types, and how they are mapped internally to Redis. By default, entities map to JSON documents. Let's create our <code>Schema</code> in <code>person.js</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/* create a Schema for Person */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">personSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">(</span><span class="nx">Person</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">firstName</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'string'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">lastName</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'string'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">age</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'number'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">verified</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'boolean'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">location</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'point'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">locationUpdated</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'date'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">skills</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'string[]'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">personalStatement</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'text'</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<p>When you create a <code>Schema</code>, it modifies the <code>Entity</code> class you handed it (<code>Person</code> in our case) adding getters and setters for the properties you define. The type those getters and setters accept and return are defined with the type parameter as shown above. Valid values are: <code>string</code>, <code>number</code>, <code>boolean</code>, <code>string[]</code>, <code>date</code>, <code>point</code>, and <code>text</code>.</p>
<p>The first three do exactly what you think—they define a property that is a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String"><code>String</code></a>, a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number"><code>Number</code></a>, or a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean"><code>Boolean</code></a>. <code>string[]</code> does what you'd think as well, specifically defining an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array"><code>Array</code></a> of strings.</p>
<p><code>date</code> is a little different, but still more or less what you'd expect. It defines a property that returns a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date"><code>Date</code></a> and can be set using not only a <code>Date</code> but also a <code>String</code> containing an <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> date or a <code>Number</code> with the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date#the_ecmascript_epoch_and_timestamps">UNIX epoch time</a> in <em>milliseconds</em>.</p>
<p>A <code>point</code> defines a point somewhere on the globe as a longitude and a latitude. It creates a property that returns and accepts a simple object with the properties of <code>longitude</code> and <code>latitude</code>. Like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">point</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">longitude</span><span class="o">:</span> <span class="mf">12.34</span><span class="p">,</span> <span class="nx">latitude</span><span class="o">:</span> <span class="mf">56.78</span> <span class="p">}</span></span></span></code></pre></div>
<p>A <code>text</code> field is a lot like a <code>string</code>. If you're just reading and writing objects, they are identical. But if you want to <em>search</em> on them, they are very, very different. We'll talk about search more later, but the tl;dr is that <code>string</code> fields can only be matched on their whole value—no partial matches—and are best for keys while <code>text</code> fields have full-text search enabled on them and are optimized for human-readable text.</p>
<h3 id="repository">Repository</h3>
<p>Now we have all the pieces that we need to create a <strong>repository</strong>. A <code>Repository</code> is the main interface into Redis OM. It gives us the methods to read, write, and remove a specific <code>Entity</code>. Create a <code>Repository</code> in <code>person.js</code> and make sure it's exported as you'll need it when we start implementing out API:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/* use the client to create a Repository just for Persons */</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">personRepository</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">fetchRepository</span><span class="p">(</span><span class="nx">personSchema</span><span class="p">)</span></span></span></code></pre></div>
<p>We're almost done with setting up our repository. But we still need to create an index or we won't be able to search. We do that by calling <code>.createIndex()</code>. If an index already exists and it's identical, this function won't do anything. If it's different, it'll drop it and create a new one. Add a call to <code>.createIndex()</code> to <code>person.js</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/* create the index for Person */</span>
</span></span><span class="line"><span class="cl"><span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">()</span></span></span></code></pre></div>
<p>That's all we need for <code>person.js</code> and all we need to start talking to Redis using Redis OM. Here's the code in its entirety:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Entity</span><span class="p">,</span> <span class="nx">Schema</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'redis-om'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">client</span> <span class="nx">from</span> <span class="s1">'./client.js'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* our entity */</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Entity</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* create a Schema for Person */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">personSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Schema</span><span class="p">(</span><span class="nx">Person</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">firstName</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'string'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">lastName</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'string'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">age</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'number'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">verified</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'boolean'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">location</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'point'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">locationUpdated</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'date'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">skills</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'string[]'</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">personalStatement</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">'text'</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* use the client to create a Repository just for Persons */</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">personRepository</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">fetchRepository</span><span class="p">(</span><span class="nx">personSchema</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* create the index for Person */</span>
</span></span><span class="line"><span class="cl"><span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">()</span></span></span></code></pre></div>
<p>Now, let's add some routes in Express.</p>
<a class="dashAnchor" name="//apple_ref/Section/Set%20up%20the%20Person%20Router"></a><h2 id="set-up-the-person-router">Set up the Person Router</h2>
<p>Let's create a truly RESTful API with the CRUD operations mapping to PUT, GET, POST, and DELETE respectively. We're going to do this using <a href="https://expressjs.com/en/4x/api.html#router">Express Routers</a> as this makes our code nice and tidy. Create a file called <code>person-router.js</code> in the <code>routers</code> folder and in it import <code>Router</code> from Express and <code>personRepository</code> from <code>person.js</code>. Then create and export a <code>Router</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Router</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'express'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">personRepository</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'../om/person.js'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">Router</span><span class="p">()</span></span></span></code></pre></div>
<p>Imports and exports done, let's bind the router to our Express app. Open up <code>server.js</code> and import the <code>Router</code> we just created:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/* import routers */</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">router</span> <span class="nx">as</span> <span class="nx">personRouter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'./routers/person-router.js'</span></span></span></code></pre></div>
<p>Then add the <code>personRouter</code> to the Express app:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/* bring in some routers */</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/person'</span><span class="p">,</span> <span class="nx">personRouter</span><span class="p">)</span></span></span></code></pre></div>
<p>Your <code>server.js</code> should now look like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="s1">'dotenv/config'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">express</span> <span class="nx">from</span> <span class="s1">'express'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">swaggerUi</span> <span class="nx">from</span> <span class="s1">'swagger-ui-express'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">YAML</span> <span class="nx">from</span> <span class="s1">'yamljs'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* import routers */</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">router</span> <span class="nx">as</span> <span class="nx">personRouter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'./routers/person-router.js'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* create an express app and use JSON */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">express</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* bring in some routers */</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/person'</span><span class="p">,</span> <span class="nx">personRouter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* set up swagger in the root */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">swaggerDocument</span> <span class="o">=</span> <span class="nx">YAML</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">'api.yaml'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nx">swaggerUi</span><span class="p">.</span><span class="nx">serve</span><span class="p">,</span> <span class="nx">swaggerUi</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="nx">swaggerDocument</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* start the server */</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span></span></span></code></pre></div>
<p>Now we can add our routes to create, read, update, and delete persons. Head back to the <code>person-router.js</code> file so we can do just that.</p>
<h3 id="creating-a-person">Creating a Person</h3>
<p>We'll create a person first as you need to have persons in Redis before you can do any of the reading, writing, or removing of them. Add the PUT route below. This route will call <code>.createAndSave()</code> to create a <code>Person</code> from the request body and immediately save it to the Redis:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">createAndSave</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<p>Note that we are also returning the newly created <code>Person</code>. Let's see what that looks like by actually calling our API using the Swagger UI. Go to http://localhost:8080 in your browser and try it out. The default request body in Swagger will be fine for testing. You should see a response that looks like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"entityId"</span><span class="p">:</span> <span class="s2">"01FY9MWDTWW4XQNTPJ9XY9FPMN"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"firstName"</span><span class="p">:</span> <span class="s2">"Rupert"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"lastName"</span><span class="p">:</span> <span class="s2">"Holmes"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"age"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"verified"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"location"</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"longitude"</span><span class="p">:</span> <span class="mf">45.678</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"latitude"</span><span class="p">:</span> <span class="mf">45.678</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"locationUpdated"</span><span class="p">:</span> <span class="s2">"2022-03-01T12:34:56.123Z"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"skills"</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"singing"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"songwriting"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"playwriting"</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"personalStatement"</span><span class="p">:</span> <span class="s2">"I like piña coladas and walks in the rain"</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
<p>This is exactly what we handed it with one exception: the <code>entityId</code>. Every entity in Redis OM has an entity ID which is—as you've probably guessed—the unique ID of that entity. It was randomly generated when we called <code>.createAndSave()</code>. Yours will be different, so make note of it.</p>
<p>You can see this newly created JSON document in Redis with RedisInsight. Go ahead and launch RedisInsight and you should see a key with a name like <code>Person:01FY9MWDTWW4XQNTPJ9XY9FPMN</code>. The <code>Person</code> bit of the key was derived from the class name of our entity and the sequence of letters and numbers is our generated entity ID. Click on it to take a look at the JSON document you've created.</p>
<p>You'll also see a key named <code>Person:index:hash</code>. That's a unique value that Redis OM uses to see if it needs to recreate the index or not when <code>.createIndex()</code> is called. You can safely ignore it.</p>
<h3 id="reading-a-person">Reading a Person</h3>
<p>Create down, let's add a GET route to read this newly created <code>Person</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/:id'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<p>This code extracts a parameter from the URL used in the route—the <code>entityId</code> that we received previously. It uses the <code>.fetch()</code> method on the <code>personRepository</code> to retrieve a <code>Person</code> using that <code>entityId</code>. Then, it returns that <code>Person</code>.</p>
<p>Let's go ahead and test that in Swagger as well. You should get back exactly the same response. In fact, since this is a simple GET, we should be able to just load the URL into our browser. Test that out too by navigating to http://localhost:8080/person/01FY9MWDTWW4XQNTPJ9XY9FPMN, replacing the entity ID with your own.</p>
<p>Now that we can read and write, let's implement the <em>REST</em> of the HTTP verbs. REST... get it?</p>
<h3 id="updating-a-person">Updating a Person</h3>
<p>Let's add the code to update a person using a POST route:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/:id'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">age</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">verified</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">verified</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">location</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">locationUpdated</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">locationUpdated</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">skills</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">skills</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">personalStatement</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">personalStatement</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<p>This code fetches the <code>Person</code> from the <code>personRepository</code> using the <code>entityId</code> just like our previous route did. However, now we change all the properties based on the properties in the request body. If any of them are missing, we set them to <code>null</code>. Then, we call <code>.save()</code> and return the changed <code>Person</code>.</p>
<p>Let's test this in Swagger too, why not? Make some changes. Try removing some of the fields. What do you get back when you read it after you've changed it?</p>
<h3 id="deleting-a-person">Deleting a Person</h3>
<p>Deletion—my favorite! Remember kids, deletion is 100% compression. The route that deletes is just as straightforward as the one that reads, but much more destructive:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">'/:id'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">entityId</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<p>I guess we should probably test this one out too. Load up Swagger and exercise the route. You should get back JSON with the entity ID you just removed:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">"entityId"</span><span class="p">:</span> <span class="s2">"01FY9MWDTWW4XQNTPJ9XY9FPMN"</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
<p>And just like that, it's gone!</p>
<h3 id="all-the-crud">All the CRUD</h3>
<p>Do a quick check with what you've written so far. Here's what should be the totality of your <code>person-router.js</code> file:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Router</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'express'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">personRepository</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'../om/person.js'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">Router</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">createAndSave</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/:id'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/:id'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">age</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">verified</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">verified</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">location</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">locationUpdated</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">locationUpdated</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">skills</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">skills</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">personalStatement</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">personalStatement</span> <span class="o">??</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">'/:id'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">entityId</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<a class="dashAnchor" name="//apple_ref/Section/Preparing%20to%20search"></a><h2 id="preparing-to-search">Preparing to search</h2>
<p>CRUD completed, let's do some searching. In order to search, we need data to search over. Remember that <code>persons</code> folder with all the JSON documents and the <code>load-data.sh</code> shell script? Its time has arrived. Go into that folder and run the script:</p>
<pre><code>cd persons
./load-data.sh
</code></pre>
<p>You should get a rather verbose response containing the JSON response from the API and the names of the files you loaded. Like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span><span class="nt">"entityId"</span><span class="p">:</span><span class="s2">"01FY9Z4RRPKF4K9H78JQ3K3CP3"</span><span class="p">,</span><span class="nt">"firstName"</span><span class="p">:</span><span class="s2">"Chris"</span><span class="p">,</span><span class="nt">"lastName"</span><span class="p">:</span><span class="s2">"Stapleton"</span><span class="p">,</span><span class="nt">"age"</span><span class="p">:</span><span class="mi">43</span><span class="p">,</span><span class="nt">"verified"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nt">"location"</span><span class="p">:{</span><span class="nt">"longitude"</span><span class="p">:</span><span class="mf">-84.495</span><span class="p">,</span><span class="nt">"latitude"</span><span class="p">:</span><span class="mf">38.03</span><span class="p">},</span><span class="nt">"locationUpdated"</span><span class="p">:</span><span class="s2">"2022-01-01T12:00:00.000Z"</span><span class="p">,</span><span class="nt">"skills"</span><span class="p">:[</span><span class="s2">"singing"</span><span class="p">,</span><span class="s2">"football"</span><span class="p">,</span><span class="s2">"coal mining"</span><span class="p">],</span><span class="nt">"personalStatement"</span><span class="p">:</span><span class="s2">"There are days that I can walk around like I'm alright. And I pretend to wear a smile on my face. And I could keep the pain from comin' out of my eyes. But sometimes, sometimes, sometimes I cry."</span><span class="p">}</span> <span class="err">&lt;-</span> <span class="err">chris-stapleton.json</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">"entityId"</span><span class="p">:</span><span class="s2">"01FY9Z4RS2QQVN4XFYSNPKH6B2"</span><span class="p">,</span><span class="nt">"firstName"</span><span class="p">:</span><span class="s2">"David"</span><span class="p">,</span><span class="nt">"lastName"</span><span class="p">:</span><span class="s2">"Paich"</span><span class="p">,</span><span class="nt">"age"</span><span class="p">:</span><span class="mi">67</span><span class="p">,</span><span class="nt">"verified"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nt">"location"</span><span class="p">:{</span><span class="nt">"longitude"</span><span class="p">:</span><span class="mf">-118.25</span><span class="p">,</span><span class="nt">"latitude"</span><span class="p">:</span><span class="mf">34.05</span><span class="p">},</span><span class="nt">"locationUpdated"</span><span class="p">:</span><span class="s2">"2022-01-01T12:00:00.000Z"</span><span class="p">,</span><span class="nt">"skills"</span><span class="p">:[</span><span class="s2">"singing"</span><span class="p">,</span><span class="s2">"keyboard"</span><span class="p">,</span><span class="s2">"blessing"</span><span class="p">],</span><span class="nt">"personalStatement"</span><span class="p">:</span><span class="s2">"I seek to cure what's deep inside frightened of this thing that I've become"</span><span class="p">}</span> <span class="err">&lt;-</span> <span class="err">david-paich.json</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">"entityId"</span><span class="p">:</span><span class="s2">"01FY9Z4RSD7SQMSWDFZ6S4M5MJ"</span><span class="p">,</span><span class="nt">"firstName"</span><span class="p">:</span><span class="s2">"Ivan"</span><span class="p">,</span><span class="nt">"lastName"</span><span class="p">:</span><span class="s2">"Doroschuk"</span><span class="p">,</span><span class="nt">"age"</span><span class="p">:</span><span class="mi">64</span><span class="p">,</span><span class="nt">"verified"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nt">"location"</span><span class="p">:{</span><span class="nt">"longitude"</span><span class="p">:</span><span class="mf">-88.273</span><span class="p">,</span><span class="nt">"latitude"</span><span class="p">:</span><span class="mf">40.115</span><span class="p">},</span><span class="nt">"locationUpdated"</span><span class="p">:</span><span class="s2">"2022-01-01T12:00:00.000Z"</span><span class="p">,</span><span class="nt">"skills"</span><span class="p">:[</span><span class="s2">"singing"</span><span class="p">,</span><span class="s2">"dancing"</span><span class="p">,</span><span class="s2">"friendship"</span><span class="p">],</span><span class="nt">"personalStatement"</span><span class="p">:</span><span class="s2">"We can dance if we want to. We can leave your friends behind. 'Cause your friends don't dance and if they don't dance well they're no friends of mine."</span><span class="p">}</span> <span class="err">&lt;-</span> <span class="err">ivan-doroschuk.json</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">"entityId"</span><span class="p">:</span><span class="s2">"01FY9Z4RSRZFGQ21BMEKYHEVK6"</span><span class="p">,</span><span class="nt">"firstName"</span><span class="p">:</span><span class="s2">"Joan"</span><span class="p">,</span><span class="nt">"lastName"</span><span class="p">:</span><span class="s2">"Jett"</span><span class="p">,</span><span class="nt">"age"</span><span class="p">:</span><span class="mi">63</span><span class="p">,</span><span class="nt">"verified"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nt">"location"</span><span class="p">:{</span><span class="nt">"longitude"</span><span class="p">:</span><span class="mf">-75.273</span><span class="p">,</span><span class="nt">"latitude"</span><span class="p">:</span><span class="mf">40.003</span><span class="p">},</span><span class="nt">"locationUpdated"</span><span class="p">:</span><span class="s2">"2022-01-01T12:00:00.000Z"</span><span class="p">,</span><span class="nt">"skills"</span><span class="p">:[</span><span class="s2">"singing"</span><span class="p">,</span><span class="s2">"guitar"</span><span class="p">,</span><span class="s2">"black eyeliner"</span><span class="p">],</span><span class="nt">"personalStatement"</span><span class="p">:</span><span class="s2">"I love rock n' roll so put another dime in the jukebox, baby."</span><span class="p">}</span> <span class="err">&lt;-</span> <span class="err">joan-jett.json</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">"entityId"</span><span class="p">:</span><span class="s2">"01FY9Z4RT25ABWYTW6ZG7R79V4"</span><span class="p">,</span><span class="nt">"firstName"</span><span class="p">:</span><span class="s2">"Justin"</span><span class="p">,</span><span class="nt">"lastName"</span><span class="p">:</span><span class="s2">"Timberlake"</span><span class="p">,</span><span class="nt">"age"</span><span class="p">:</span><span class="mi">41</span><span class="p">,</span><span class="nt">"verified"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nt">"location"</span><span class="p">:{</span><span class="nt">"longitude"</span><span class="p">:</span><span class="mf">-89.971</span><span class="p">,</span><span class="nt">"latitude"</span><span class="p">:</span><span class="mf">35.118</span><span class="p">},</span><span class="nt">"locationUpdated"</span><span class="p">:</span><span class="s2">"2022-01-01T12:00:00.000Z"</span><span class="p">,</span><span class="nt">"skills"</span><span class="p">:[</span><span class="s2">"singing"</span><span class="p">,</span><span class="s2">"dancing"</span><span class="p">,</span><span class="s2">"half-time shows"</span><span class="p">],</span><span class="nt">"personalStatement"</span><span class="p">:</span><span class="s2">"What goes around comes all the way back around."</span><span class="p">}</span> <span class="err">&lt;-</span> <span class="err">justin-timberlake.json</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">"entityId"</span><span class="p">:</span><span class="s2">"01FY9Z4RTD9EKBDS2YN9CRMG1D"</span><span class="p">,</span><span class="nt">"firstName"</span><span class="p">:</span><span class="s2">"Kerry"</span><span class="p">,</span><span class="nt">"lastName"</span><span class="p">:</span><span class="s2">"Livgren"</span><span class="p">,</span><span class="nt">"age"</span><span class="p">:</span><span class="mi">72</span><span class="p">,</span><span class="nt">"verified"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nt">"location"</span><span class="p">:{</span><span class="nt">"longitude"</span><span class="p">:</span><span class="mf">-95.689</span><span class="p">,</span><span class="nt">"latitude"</span><span class="p">:</span><span class="mf">39.056</span><span class="p">},</span><span class="nt">"locationUpdated"</span><span class="p">:</span><span class="s2">"2022-01-01T12:00:00.000Z"</span><span class="p">,</span><span class="nt">"skills"</span><span class="p">:[</span><span class="s2">"poetry"</span><span class="p">,</span><span class="s2">"philosophy"</span><span class="p">,</span><span class="s2">"songwriting"</span><span class="p">,</span><span class="s2">"guitar"</span><span class="p">],</span><span class="nt">"personalStatement"</span><span class="p">:</span><span class="s2">"All we are is dust in the wind."</span><span class="p">}</span> <span class="err">&lt;-</span> <span class="err">kerry-livgren.json</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">"entityId"</span><span class="p">:</span><span class="s2">"01FY9Z4RTR73HZQXK83JP94NWR"</span><span class="p">,</span><span class="nt">"firstName"</span><span class="p">:</span><span class="s2">"Marshal"</span><span class="p">,</span><span class="nt">"lastName"</span><span class="p">:</span><span class="s2">"Mathers"</span><span class="p">,</span><span class="nt">"age"</span><span class="p">:</span><span class="mi">49</span><span class="p">,</span><span class="nt">"verified"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nt">"location"</span><span class="p">:{</span><span class="nt">"longitude"</span><span class="p">:</span><span class="mf">-83.046</span><span class="p">,</span><span class="nt">"latitude"</span><span class="p">:</span><span class="mf">42.331</span><span class="p">},</span><span class="nt">"locationUpdated"</span><span class="p">:</span><span class="s2">"2022-01-01T12:00:00.000Z"</span><span class="p">,</span><span class="nt">"skills"</span><span class="p">:[</span><span class="s2">"rapping"</span><span class="p">,</span><span class="s2">"songwriting"</span><span class="p">,</span><span class="s2">"comics"</span><span class="p">],</span><span class="nt">"personalStatement"</span><span class="p">:</span><span class="s2">"Look, if you had, one shot, or one opportunity to seize everything you ever wanted, in one moment, would you capture it, or just let it slip?"</span><span class="p">}</span> <span class="err">&lt;-</span> <span class="err">marshal-mathers.json</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">"entityId"</span><span class="p">:</span><span class="s2">"01FY9Z4RV2QHH0Z1GJM5ND15JE"</span><span class="p">,</span><span class="nt">"firstName"</span><span class="p">:</span><span class="s2">"Rupert"</span><span class="p">,</span><span class="nt">"lastName"</span><span class="p">:</span><span class="s2">"Holmes"</span><span class="p">,</span><span class="nt">"age"</span><span class="p">:</span><span class="mi">75</span><span class="p">,</span><span class="nt">"verified"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nt">"location"</span><span class="p">:{</span><span class="nt">"longitude"</span><span class="p">:</span><span class="mf">-2.518</span><span class="p">,</span><span class="nt">"latitude"</span><span class="p">:</span><span class="mf">53.259</span><span class="p">},</span><span class="nt">"locationUpdated"</span><span class="p">:</span><span class="s2">"2022-01-01T12:00:00.000Z"</span><span class="p">,</span><span class="nt">"skills"</span><span class="p">:[</span><span class="s2">"singing"</span><span class="p">,</span><span class="s2">"songwriting"</span><span class="p">,</span><span class="s2">"playwriting"</span><span class="p">],</span><span class="nt">"personalStatement"</span><span class="p">:</span><span class="s2">"I like piña coladas and taking walks in the rain."</span><span class="p">}</span> <span class="err">&lt;-</span> <span class="err">rupert-holmes.json</span></span></span></code></pre></div>
<p>A little messy, but if you don't see this, then it didn't work!</p>
<p>Now that we have some data, let's add another router to hold the search routes we want to add. Create a file named <code>search-router.js</code> in the routers folder and set it up with imports and exports just like we did in <code>person-router.js</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Router</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'express'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">personRepository</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'../om/person.js'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">Router</span><span class="p">()</span></span></span></code></pre></div>
<p>Import the <code>Router</code> into <code>server.js</code> the same way we did for the <code>personRouter</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/* import routers */</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">router</span> <span class="nx">as</span> <span class="nx">personRouter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'./routers/person-router.js'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">router</span> <span class="nx">as</span> <span class="nx">searchRouter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'./routers/search-router.js'</span></span></span></code></pre></div>
<p>Then add the <code>searchRouter</code> to the Express app:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/* bring in some routers */</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/person'</span><span class="p">,</span> <span class="nx">personRouter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/persons'</span><span class="p">,</span> <span class="nx">searchRouter</span><span class="p">)</span></span></span></code></pre></div>
<p>Router bound, we can now add some routes.</p>
<h3 id="search-all-the-things">Search all the things</h3>
<p>We're going to add a plethora of searches to our new <code>Router</code>. But the first will be the easiest as it's just going to return everything. Go ahead and add the following code to <code>search-router.js</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/all'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">persons</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<p>Here we see how to start and finish a search. Searches start just like CRUD operations start—on a <code>Repository</code>. But instead of calling <code>.createAndSave()</code>, <code>.fetch()</code>, <code>.save()</code>, or <code>.remove()</code>, we call <code>.search()</code>. And unlike all those other methods, <code>.search()</code> doesn't end there. Instead, it allows you to build up a query (which you'll see in the next example) and then resolve it with a call to <code>.return.all()</code>.</p>
<p>With this new route in place, go into the Swagger UI and exercise the <code>/persons/all</code> route. You should see all of the folks you added with the shell script as a JSON array.</p>
<p>In the example above, the query is not specified—we didn't build anything up. If you do this, you'll just get everything. Which is what you want sometimes. But not most of the time. It's not really searching if you just return everything. So let's add a route that lets us find persons by their last name. Add the following code:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/by-last-name/:lastName'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">lastName</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">lastName</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'lastName'</span><span class="p">).</span><span class="nx">equals</span><span class="p">(</span><span class="nx">lastName</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">persons</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<p>In this route, we're specifying a field we want to filter on and a value that it needs to equal. The field name in the call to <code>.where()</code> is the name of the field specified in our schema. This field was defined as a <code>string</code>, which matters because the type of the field determines the methods that are available query it.</p>
<p>In the case of a <code>string</code>, there's just <code>.equals()</code>, which will query against the value of the entire string. This is aliased as <code>.eq()</code>, <code>.equal()</code>, and <code>.equalTo()</code> for your convenience. You can even add a little more syntactic sugar with calls to <code>.is</code> and <code>.does</code> that really don't do anything but make your code pretty. Like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'lastName'</span><span class="p">).</span><span class="nx">is</span><span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="nx">lastName</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'lastName'</span><span class="p">).</span><span class="nx">does</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">lastName</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span></span></span></code></pre></div>
<p>You can also invert the query with a call to <code>.not</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'lastName'</span><span class="p">).</span><span class="nx">is</span><span class="p">.</span><span class="nx">not</span><span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="nx">lastName</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'lastName'</span><span class="p">).</span><span class="nx">does</span><span class="p">.</span><span class="nx">not</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">lastName</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span></span></span></code></pre></div>
<p>In all these cases, the call to <code>.return.all()</code> executes the query we build between it and the call to <code>.search()</code>. We can search on other field types as well. Let's add some routes to search on a <code>number</code> and a <code>boolean</code> field:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/old-enough-to-drink-in-america'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">).</span><span class="nx">gte</span><span class="p">(</span><span class="mi">21</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">persons</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/non-verified'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'verified'</span><span class="p">).</span><span class="nx">is</span><span class="p">.</span><span class="nx">not</span><span class="p">.</span><span class="kc">true</span><span class="p">().</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">persons</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<p>The <code>number</code> field is filtering persons by age where the age is great than or equal to 21. Again, there are aliases and syntactic sugar:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">).</span><span class="nx">is</span><span class="p">.</span><span class="nx">greaterThanOrEqualTo</span><span class="p">(</span><span class="mi">21</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span></span></span></code></pre></div>
<p>But there are also more ways to query:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="mi">21</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">).</span><span class="nx">gt</span><span class="p">(</span><span class="mi">21</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">).</span><span class="nx">gte</span><span class="p">(</span><span class="mi">21</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">).</span><span class="nx">lt</span><span class="p">(</span><span class="mi">21</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">).</span><span class="nx">lte</span><span class="p">(</span><span class="mi">21</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'age'</span><span class="p">).</span><span class="nx">between</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">65</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span></span></span></code></pre></div>
<p>The <code>boolean</code> field is searching for persons by their verification status. It already has some of our syntactic sugar in it. Note that this query will match a missing value or a false value. That's why I specified <code>.not.true()</code>. You can also call <code>.false()</code> on boolean fields as well as all the variations of <code>.equals</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'verified'</span><span class="p">).</span><span class="kc">true</span><span class="p">().</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'verified'</span><span class="p">).</span><span class="kc">false</span><span class="p">().</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">().</span><span class="nx">where</span><span class="p">(</span><span class="s1">'verified'</span><span class="p">).</span><span class="nx">equals</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span></span></span></code></pre></div>
<blockquote>
<p>So, we've created a few routes and I haven't told you to test them. Maybe you have anyhow. If so, good for you, you rebel. For the rest of you, why don't you go ahead and test them now with Swagger? And, going forward, just test them when you want. Heck, create some routes of your own using the provided syntax and try those out too. Don't let me tell you how to live your life.</p>
</blockquote>
<p>Of course, querying on just one field is never enough. Not a problem, Redis OM can handle <code>.and()</code> and <code>.or()</code> like in this route:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/verified-drinkers-with-last-name/:lastName'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">lastName</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">lastName</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'verified'</span><span class="p">).</span><span class="nx">is</span><span class="p">.</span><span class="kc">true</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">and</span><span class="p">(</span><span class="s1">'age'</span><span class="p">).</span><span class="nx">gte</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">and</span><span class="p">(</span><span class="s1">'lastName'</span><span class="p">).</span><span class="nx">equals</span><span class="p">(</span><span class="nx">lastName</span><span class="p">).</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">persons</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<p>Here, I'm just showing the syntax for <code>.and()</code> but, of course, you can also use <code>.or()</code>.</p>
<h3 id="full-text-search">Full-text search</h3>
<p>If you've defined a field with a type of <code>text</code> in your schema, you can perform full-text searches against it. The way a <code>text</code> field is searched is different from how a <code>string</code> is searched. A <code>string</code> can only be compared with <code>.equals()</code> and must match the entire string. With a <code>text</code> field, you can look for words within the string.</p>
<p>A <code>text</code> field is optimized for human-readable text, like an essay or song lyrics. It's pretty clever. It understands that certain words (like <em>a</em>, <em>an</em>, or <em>the</em>) are common and ignores them. It understands how words are grammatically similar and so if you search for <em>give</em>, it matches <em>gives</em>, <em>given</em>, <em>giving</em>, and <em>gave</em> too. And it ignores punctuation.</p>
<p>Let's add a route that does full-text search against our <code>personalStatement</code> field:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/with-statement-containing/:text'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">text</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'personalStatement'</span><span class="p">).</span><span class="nx">matches</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">persons</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<p>Note the use of the <code>.matches()</code> function. This is the only one that works with <code>text</code> fields. It takes a string that can be one or more words—space-delimited—that you want to query for. Let's try it out. In Swagger, use this route to search for the word "walk". You should get the following results:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"entityId"</span><span class="p">:</span> <span class="s2">"01FYC7CTR027F219455PS76247"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"firstName"</span><span class="p">:</span> <span class="s2">"Rupert"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"lastName"</span><span class="p">:</span> <span class="s2">"Holmes"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"age"</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"verified"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"location"</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">"longitude"</span><span class="p">:</span> <span class="mf">-2.518</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">"latitude"</span><span class="p">:</span> <span class="mf">53.259</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"locationUpdated"</span><span class="p">:</span> <span class="s2">"2022-01-01T12:00:00.000Z"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"skills"</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">"singing"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">"songwriting"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">"playwriting"</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"personalStatement"</span><span class="p">:</span> <span class="s2">"I like piña coladas and taking walks in the rain."</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"entityId"</span><span class="p">:</span> <span class="s2">"01FYC7CTNBJD9CZKKWPQEZEW14"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"firstName"</span><span class="p">:</span> <span class="s2">"Chris"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"lastName"</span><span class="p">:</span> <span class="s2">"Stapleton"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"age"</span><span class="p">:</span> <span class="mi">43</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"verified"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"location"</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">"longitude"</span><span class="p">:</span> <span class="mf">-84.495</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">"latitude"</span><span class="p">:</span> <span class="mf">38.03</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"locationUpdated"</span><span class="p">:</span> <span class="s2">"2022-01-01T12:00:00.000Z"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"skills"</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">"singing"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">"football"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">"coal mining"</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"personalStatement"</span><span class="p">:</span> <span class="s2">"There are days that I can walk around like I'm alright. And I pretend to wear a smile on my face. And I could keep the pain from comin' out of my eyes. But sometimes, sometimes, sometimes I cry."</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span></span></span></code></pre></div>
<p>Notice how the word "walk" is matched for Rupert Holmes' personal statement that contains "walks" <em>and</em> matched for Chris Stapleton's that contains "walk". Now search "walk raining". You'll see that this returns Rupert's entry only even though the exact text of neither of these words is found in his personal statement. But they are <em>grammatically</em> related so it matched them. This is called stemming and it's a pretty cool feature of RediSearch that Redis OM exploits.</p>
<p>And if you search for "a rain walk" you'll <em>still</em> match Rupert's entry even though the word "a" is not in the text. Why? Because it's a common word that's not very helpful with searching. These common words are called stop words and this is another cool feature of RediSearch that Redis OM just gets for free.</p>
<h3 id="searching-the-globe">Searching the globe</h3>
<p>RediSearch, and therefore Redis OM, both support searching by geographic location. You specify a point in the globe, a radius, and the units for that radius and it'll gleefully return all the entities therein. Let's add a route to do just that:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/near/:lng,:lat/radius/:radius'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">longitude</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">lng</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">latitude</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">lat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">radius</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">radius</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">persons</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">search</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="s1">'location'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">inRadius</span><span class="p">(</span><span class="nx">circle</span> <span class="p">=&gt;</span> <span class="nx">circle</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">longitude</span><span class="p">(</span><span class="nx">longitude</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">latitude</span><span class="p">(</span><span class="nx">latitude</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">radius</span><span class="p">(</span><span class="nx">radius</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">miles</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="k">return</span><span class="p">.</span><span class="nx">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">persons</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<p>This code looks a little different than the others because the way we define the circle we want to search is done with a function that is passed into the <code>.inRadius</code> method:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">circle</span> <span class="p">=&gt;</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">longitude</span><span class="p">(</span><span class="nx">longitude</span><span class="p">).</span><span class="nx">latitude</span><span class="p">(</span><span class="nx">latitude</span><span class="p">).</span><span class="nx">radius</span><span class="p">(</span><span class="nx">radius</span><span class="p">).</span><span class="nx">miles</span></span></span></code></pre></div>
<p>All this function does is accept an instance of a <a href="https://github.com/redis/redis-om-node/blob/main/docs/classes/Circle.md"><code>Circle</code></a> that has been initialized with default values. We override those values by calling various builder methods to define the origin of our search (i.e. the longitude and latitude), the radius, and the units that radius is measured in. Valid units are <code>miles</code>, <code>meters</code>, <code>feet</code>, and <code>kilometers</code>.</p>
<p>Let's try the route out. I know we can find Joan Jett at around longitude -75.0 and latitude 40.0, which is in eastern Pennsylvania. So use those coordinates with a radius of 20 miles. You should receive in response:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"entityId"</span><span class="p">:</span> <span class="s2">"01FYC7CTPKYNXQ98JSTBC37AS1"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"firstName"</span><span class="p">:</span> <span class="s2">"Joan"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"lastName"</span><span class="p">:</span> <span class="s2">"Jett"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"age"</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"verified"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"location"</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">"longitude"</span><span class="p">:</span> <span class="mf">-75.273</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">"latitude"</span><span class="p">:</span> <span class="mf">40.003</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"locationUpdated"</span><span class="p">:</span> <span class="s2">"2022-01-01T12:00:00.000Z"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"skills"</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">"singing"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">"guitar"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">"black eyeliner"</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">"personalStatement"</span><span class="p">:</span> <span class="s2">"I love rock n' roll so put another dime in the jukebox, baby."</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span></span></span></code></pre></div>
<p>Try widening the radius and see who else you can find.</p>
<a class="dashAnchor" name="//apple_ref/Section/Adding%20location%20tracking"></a><h2 id="adding-location-tracking">Adding location tracking</h2>
<p>We're getting toward the end of the tutorial here, but before we go, I'd like to add that location tracking piece that I mentioned way back in the beginning. This next bit of code should be easily understood if you've gotten this far as it's not really doing anything I haven't talked about already.</p>
<p>Add a new file called <code>location-router.js</code> in the <code>routers</code> folder:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Router</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'express'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">personRepository</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'../om/person.js'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">Router</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="s1">'/:id/location/:lng,:lat'</span><span class="p">,</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">longitude</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">lng</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">latitude</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">lat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">locationUpdated</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">longitude</span><span class="p">,</span> <span class="nx">latitude</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">locationUpdated</span> <span class="o">=</span> <span class="nx">locationUpdated</span>
</span></span><span class="line"><span class="cl">  <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">locationUpdated</span><span class="p">,</span> <span class="nx">location</span><span class="o">:</span> <span class="p">{</span> <span class="nx">longitude</span><span class="p">,</span> <span class="nx">latitude</span> <span class="p">}</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span></span></span></code></pre></div>
<p>Here we're calling <code>.fetch()</code> to fetch a person, we're updating some values for that person—the <code>.location</code> property with our longitude and latitude and the <code>.locationUpdated</code> property with the current date and time. Easy stuff.</p>
<p>To use this <code>Router</code>, import it in <code>server.js</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/* import routers */</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">router</span> <span class="nx">as</span> <span class="nx">personRouter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'./routers/person-router.js'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">router</span> <span class="nx">as</span> <span class="nx">searchRouter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'./routers/search-router.js'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">router</span> <span class="nx">as</span> <span class="nx">locationRouter</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'./routers/location-router.js'</span></span></span></code></pre></div>
<p>And bind the router to a path:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="cm">/* bring in some routers */</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/person'</span><span class="p">,</span> <span class="nx">personRouter</span><span class="p">,</span> <span class="nx">locationRouter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/persons'</span><span class="p">,</span> <span class="nx">searchRouter</span><span class="p">)</span></span></span></code></pre></div>
<p>And that's that. But this just isn't enough to satisfy. It doesn't show you anything new, except maybe the usage of a <code>date</code> field. And, it's not really location <em>tracking</em>. It just shows where these people last were, no history. So let's add some!.</p>
<p>To add some history, we're going to use a <a href="../../../data-types/streams-tutorial.html">Redis Stream</a>. Streams are a big topic but don't worry if you’re not familiar with them, you can think of them as being sort of like a log file stored in a Redis key where each entry represents an event. In our case, the event would be the person moving about or checking in or whatever.</p>
<p>But there's a problem. Redis OM doesn’t support Streams even though Redis Stack does. So how do we take advantage of them in our application? By using <a href="https://github.com/redis/node-redis">Node Redis</a>. Node Redis is a low-level Redis client for Node.js that gives you access to all the Redis commands and data types. Internally, Redis OM is creating and using a Node Redis connection. You can use that connection too. Or rather, Redis OM can be <em>told</em> to use the connection you are using. Let me show you how.</p>
<a class="dashAnchor" name="//apple_ref/Section/Using%20Node%20Redis"></a><h2 id="using-node-redis">Using Node Redis</h2>
<p>Open up <code>client.js</code> in the <code>om</code> folder. Remember how we created a Redis OM <code>Client</code> and then called <code>.open()</code> on it?</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="kr">await</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">().</span><span class="nx">open</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span></span></span></code></pre></div>
<p>Well, the <code>Client</code> class also has a <code>.use()</code> method that takes a Node Redis connection. Modify <code>client.js</code> to open a connection to Redis using Node Redis and then <code>.use()</code> it:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Client</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'redis-om'</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">createClient</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'redis'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* pulls the Redis URL from .env */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDIS_URL</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* create a connection to Redis with Node Redis */</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">createClient</span><span class="p">({</span> <span class="nx">url</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="kr">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* create a Client and bind it to the Node Redis connection */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="kr">await</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">().</span><span class="nx">use</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">client</span></span></span></code></pre></div>
<p>And that's it. Redis OM is now using the <code>connection</code> you created. Note that we are exporting both the <code>client</code> <em>and</em> the <code>connection</code>. Got to export the <code>connection</code> if we want to use it in our newest route.</p>
<a class="dashAnchor" name="//apple_ref/Section/Storing%20location%20history%20with%20Streams"></a><h2 id="storing-location-history-with-streams">Storing location history with Streams</h2>
<p>To add an event to a Stream we need to use the <a href="../../../../commands/xadd.html">XADD</a> command. Node Redis exposes that as <code>.xAdd()</code>. So, we need to add a call to <code>.xAdd()</code> in our route. Modify <code>location-router.js</code> to import our <code>connection</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">connection</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'../om/client.js'</span></span></span></code></pre></div>
<p>And then in the route itself add a call to <code>.xAdd()</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl">  <span class="p">...</span><span class="nx">snip</span><span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">longitude</span><span class="p">,</span> <span class="nx">latitude</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">person</span><span class="p">.</span><span class="nx">locationUpdated</span> <span class="o">=</span> <span class="nx">locationUpdated</span>
</span></span><span class="line"><span class="cl">  <span class="kr">await</span> <span class="nx">personRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">keyName</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">person</span><span class="p">.</span><span class="nx">keyName</span><span class="si">}</span><span class="sb">:locationHistory`</span>
</span></span><span class="line"><span class="cl">  <span class="kr">await</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">xAdd</span><span class="p">(</span><span class="nx">keyName</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">,</span> <span class="nx">person</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span><span class="nx">snip</span><span class="p">...</span></span></span></code></pre></div>
<p><code>.xAdd()</code> takes a key name, an event ID, and a JavaScript object containing the keys and values that make up the event, i.e. the event data. For the key name, we're building a string using the <code>.keyName</code> property that <code>Person</code> inherited from <code>Entity</code> (which will return something like <code>Person:01FYC7CTPKYNXQ98JSTBC37AS1</code>) combined with a hard-coded value. We're passing in <code>*</code> for our event ID, which tells Redis to just generate it based on the current time and previous event ID. And we're passing in the location—with properties of longitude and latitude—as our event data.</p>
<p>Now, whenever this route is exercised, the longitude and latitude will be logged and the event ID will encode the time. Go ahead and use Swagger to move Joan Jett around a few times.</p>
<p>Now, go into RedisInsight and take a look at the Stream. You'll see it there in the list of keys but if you click on it, you'll get a message saying that "This data type is coming soon!". If you don't get this message, congratualtions, you live in the future! For us here in the past, we'll just issue the raw command instead:</p>
<pre><code>XRANGE Person:01FYC7CTPKYNXQ98JSTBC37AS1:locationHistory - +
</code></pre>
<p>This tells Redis to get a range of values from a Stream stored in the given the key name—<code>Person:01FYC7CTPKYNXQ98JSTBC37AS1:locationHistory</code> in our example. The next values are the starting event ID and the ending event ID. <code>-</code> is the beginning of the Stream. <code>+</code> is the end. So this returns everything in the Stream:</p>
<pre><code>1) 1) "1647536562911-0"
  2) 1) "longitude"
      2) "45.678"
      3) "latitude"
      4) "45.678"
2) 1) "1647536564189-0"
  2) 1) "longitude"
      2) "45.679"
      3) "latitude"
      4) "45.679"
3) 1) "1647536565278-0"
  2) 1) "longitude"
      2) "45.680"
      3) "latitude"
      4) "45.680"
</code></pre>
<p>And just like that, we're tracking Joan Jett.</p>
<a class="dashAnchor" name="//apple_ref/Section/Wrap%2Dup"></a><h2 id="wrap-up">Wrap-up</h2>
<p>So, now you know how to use Express + Redis OM to build an API backed by Redis Stack. And, you've got yourself some pretty decent started code in the process. Good deal! If you want to learn more, you can check out the <a href="https://github.com/redis/redis-om-node">documentation</a> for Redis OM. It covers the full breadth of Redis OM's capabilities.</p>
<p>And thanks for taking the time to work through this. I sincerely hope you found it useful. If you have any questions, the <a href="https://discord.gg/redis">Redis Discord server</a> is by far the best place to get them answered. Join the server and ask away!</p>

          
  <form class="page-feedback" method="POST" name="page-feedback"><input type="hidden" name="form-name" value="page-feedback">
    <input name="origin" value="https://redis.io/docs/stack/get-started/tutorials/stack-node/" class="hidden">
  <div class="grid justify-center mt-10 pt-10 border-t-2">
    <span class="font-bold font-small">Rate this page</span>
    <div class="star-rating">
      
      <input type="radio" id="5-stars" name="rating" value="5" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="5-stars" class="star">★</label>
      
      <input type="radio" id="4-stars" name="rating" value="4" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="4-stars" class="star">★</label>
      
      <input type="radio" id="3-stars" name="rating" value="3" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="3-stars" class="star">★</label>
      
      <input type="radio" id="2-stars" name="rating" value="2" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="2-stars" class="star">★</label>
      
      <input type="radio" id="1-stars" name="rating" value="1" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="1-stars" class="star">★</label>
      
    </div>  
  </div>
  <div id="feedback-form" class="hidden">
    <div class="feedback-submit">
      <textarea name="comment" placeholder="Why did you choose this rating?" class="border border-neutral-500 p-2 mt-1 block w-full h-24" rows="3"></textarea>
      <button class="button button-indigo w-min justify-self-end" type="submit">
        Submit
      </button>
    </div>
  </div>
</form>
      </section>
    </div>
    

  <section class="hidden xl:block w-52 h-full shrink-0">
    <div class="w-52 z-40 hidden bg-white/75 md:block overflow-auto fixed top-28 h-full max-h-[calc(100vh-15rem)] text-[0.8125rem]">
      





<nav class="flex flex-col gap-1 mb-6 pb-2 border-b-2">
  <a href="https://github.com/redis-stack/redis-stack-docs/edit/main/docs/stack/get-started/tutorials/stack-node.md" target="_blank" class="group inline-flex items-center gap-1 text-sm text-slate-700 hover:text-indigo-600 mt-auto self-start">
    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
      <path d="M11 44q-1.2 0-2.1-.9Q8 42.2 8 41V7q0-1.2.9-2.1Q9.8 4 11 4h17l12 12v7.8h-3V18H26V7H11v34h15v3Zm0-3V7v34Zm26.8-11.15 1.4 1.4-8.2 8.2V42h2.55l8.2-8.2 1.4 1.4-8.8 8.8H29v-5.35Zm5.35 5.35-5.35-5.35 3.05-3.05q.45-.45 1.05-.45.6 0 1.05.45l3.25 3.25q.45.45.45 1.05 0 .6-.45 1.05Z" fill="currentColor"></path>
    </svg>
    Edit this page
  </a>
  <a href="https://github.com/redis-stack/redis-stack-docs/issues/new?title=Redis%20OM%20for%20Node.js" target="_blank" class="group inline-flex items-center gap-1 text-sm text-slate-700 hover:text-indigo-600 mt-auto self-start">
    <svg class="w-4 h-4" viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="currentColor"></path>
    </svg>
    Create an issue
  </a>
</nav>


      
        <h1 class="font-semibold my-3">On This Page</h1>
        <nav class="text-slate-700">
          <nav id="TableOfContents">
  <ul>
    <li><a href="#redis-om-for-nodejs">Redis OM for Node.js</a></li>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#starter-code">Starter code</a></li>
    <li><a href="#configure-and-run">Configure and run</a></li>
    <li><a href="#setting-up-a-client">Setting up a Client</a></li>
    <li><a href="#entity-schema-and-repository">Entity, Schema, and Repository</a>
      <ul>
        <li><a href="#entity">Entity</a></li>
        <li><a href="#schema">Schema</a></li>
        <li><a href="#repository">Repository</a></li>
      </ul>
    </li>
    <li><a href="#set-up-the-person-router">Set up the Person Router</a>
      <ul>
        <li><a href="#creating-a-person">Creating a Person</a></li>
        <li><a href="#reading-a-person">Reading a Person</a></li>
        <li><a href="#updating-a-person">Updating a Person</a></li>
        <li><a href="#deleting-a-person">Deleting a Person</a></li>
        <li><a href="#all-the-crud">All the CRUD</a></li>
      </ul>
    </li>
    <li><a href="#preparing-to-search">Preparing to search</a>
      <ul>
        <li><a href="#search-all-the-things">Search all the things</a></li>
        <li><a href="#full-text-search">Full-text search</a></li>
        <li><a href="#searching-the-globe">Searching the globe</a></li>
      </ul>
    </li>
    <li><a href="#adding-location-tracking">Adding location tracking</a></li>
    <li><a href="#using-node-redis">Using Node Redis</a></li>
    <li><a href="#storing-location-history-with-streams">Storing location history with Streams</a></li>
    <li><a href="#wrap-up">Wrap-up</a></li>
  </ul>
</nav>
        </nav>
        
    </div>
  </section>


  </main>


    <footer class="bg-midnight-700 relative z-50">
      <p class="container max-w-[85rem] mx-auto px-4 sm:px-8 py-8 text-slate-400 text-sm text-center">
  This is a community website sponsored by <a href="https://redis.com/" class="text-white underline underline-offset-1 decoration-transparent hover:decoration-slate-500 transition-colors">Redis Ltd.</a> © 2023. Redis and the cube logo are registered trademarks of Redis Ltd. <a href="../../../../terms.html" class="text-white underline underline-offset-1 decoration-transparent hover:decoration-slate-500 transition-colors">Terms of use &amp; privacy policy</a>.
</p>

      <script>
  
  document.addEventListener('DOMContentLoaded', () => {

    const TableOfContents = {
      container: document.querySelector('#TableOfContents'),
      links: null,
      headings: null,
      intersectionOptions: {
        rootMargin: '0px',
        threshold: 1
      },
      previousSection: null,
      observer: null,

      init() {
        if (!this.container) return false

        this.handleObserver = this.handleObserver.bind(this)
        this.setUpObserver()
        this.findLinksAndHeadings()
        this.observeSections()
      },

      handleObserver(entries, observer) {
        entries.forEach(entry => {
          let href = `#${entry.target.getAttribute('id')}`
          let link = this.links.find(l => l.getAttribute('href') === href)

          if (entry.isIntersecting && entry.intersectionRatio >= 1) {
            link.classList.add('visible')
            this.previousSection = entry.target.getAttribute('id')
          } else {
            link.classList.remove('visible')
          }

          this.highlightFirstActive()
        })
      },

      highlightFirstActive() {
        let firstVisibleLink = this.container.querySelector('.visible')

        this.links.forEach(link => {
          link.classList.remove('active')
        })

        if (firstVisibleLink) {
          firstVisibleLink.classList.add('active')
        }

        if (!firstVisibleLink && this.previousSection) {
          this.container.querySelector(
            `a[href="#${this.previousSection}"]`
          ).classList.add('active')
        }
      },

      observeSections() {
        this.headings.forEach(heading => {
          this.observer.observe(heading)
        })
      },

      setUpObserver() {
        this.observer = new IntersectionObserver(
          this.handleObserver,
          this.intersectionOptions
        )
      },

      findLinksAndHeadings() {
        this.links = [...this.container.querySelectorAll('a')]
        this.headings = this.links.map(link => {
          let id = link.getAttribute('href')
          return document.querySelector(id)
        })
      }
    }

    TableOfContents.init()

})
</script>
    </footer>

    
<div class="sr-only w-screen h-screen fixed z-[200] top-0 left-0 cursor-auto flex flex-col bg-slate-900/75 p-4 sm:p-6 md:p-[10vh] lg:p-[12vh]" id="search-container" role="button" aria-expanded="true" aria-haspopup="listbox" aria-labelledby="search-label" tabindex="0">
  <div class="search-modal">
    <header class="search-bar">
      <form id="search-form" class="search-form">
        <label class="search-magnifier-label" for="search-input" id="search-label">
          <svg width="20" height="20" class="search-icon" viewBox="0 0 20 20">
            <path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </label>
        <div class="search-loading-indicator">
          <svg viewBox="0 0 38 38" stroke="currentColor" stroke-opacity=".5">
            <g fill="none" fill-rule="evenodd">
              <g transform="translate(1 1)" stroke-width="2">
                <circle stroke-opacity=".3" cx="18" cy="18" r="18"></circle>
                <path d="M36 18c0-9.94-8.06-18-18-18">
                  <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"></animateTransform>
                </path>
              </g>
            </g>
          </svg>
        </div>
        <input class="search-input" aria-autocomplete="both" aria-labelledby="search-label" id="search-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search…" maxlength="64" type="search" value="">
        <button type="reset" title="Clear the query" class="search-reset" aria-label="Clear the query" hidden="">
          <svg width="20" height="20" viewBox="0 0 20 20">
            <path d="M10 10l5.09-5.09L10 10l5.09 5.09L10 10zm0 0L4.91 4.91 10 10l-5.09 5.09L10 10z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </button>
      </form>
      <button id="search-cancel" type="reset" aria-label="Cancel">
        Cancel
      </button>
    </header>
    <dl id="search-results" class="search-results" role="listbox"></dl>
    <footer class="search-footer">
      <a href="../../search.html" target="_blank" rel="noopener noreferrer">
        <span class="logo-label">Powered by Redis Stack</span>
        
        <svg viewBox="0 0 39 31" fill="none"><path d="M21.7371 15.2903C21.5759 15.2895 21.4198 15.2337 21.2947 15.1321 21.1695 15.0305 21.0828 14.8892 21.049 14.7316S21.0362 14.4096 21.1086 14.2655C21.1811 14.1215 21.3005 14.0066 21.4472 13.9397L35.7199 7.47338 21.4578 1.34289C21.2943 1.26329 21.1678 1.12377 21.1045.953307 21.0412.78285 21.046.594558 21.1179.427547 21.1898.260535 21.3233.127641 21.4906.0564719 21.6579-.0146977 21.8462-.0186728 22.0164.045373L37.7492 6.80518C37.8747 6.8605 37.9814 6.95112 38.0563 7.06599S38.171 7.31503 38.171 7.45216 38.1312 7.72347 38.0563 7.83834C37.9814 7.95321 37.8747 8.04383 37.7492 8.09915L22.0306 15.2266C21.9388 15.2698 21.8385 15.2916 21.7371 15.2903z" fill="#db2e2e"></path><path d="M16.4339 15.2903C16.3379 15.2906 16.2429 15.2714 16.1546 15.2337L.421813 8.47393C.296339 8.41861.18966 8.32799.114767 8.21312.0398745 8.09825.0 7.96407.0 7.82694.0 7.68981.0398745 7.55564.114767 7.44077.18966 7.3259.296339 7.23528.421813 7.17995L16.1546.052465C16.3235-.0111265 16.5104-.00772359 16.6768.0619772 16.8433.131678 16.9768.2624 17.0501.427363 17.1233.592325 17.1306.779042 17.0706.949259 17.0106 1.11948 16.8878 1.26031 16.7274 1.34291L2.44763 7.80573 16.7132 13.9362C16.8612 14.0015 16.9823 14.1154 17.0565 14.2592 17.1306 14.4029 17.1532 14.5677 17.1205 14.7261 17.0878 14.8845 17.0019 15.0269 16.8769 15.1295 16.752 15.2322 16.5956 15.2889 16.4339 15.2903z" fill="#db2e2e"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 17.4328c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 13.9539C37.3908 13.8108 37.6564 13.6514 37.9118 13.4766 37.972 13.8833 37.972 14.2967 37.9118 14.7034 37.8022 15.1312 37.4875 15.4847 36.289 16.061 35.4617 16.4605 33.1531 17.408 30.5792 18.4687c-3.6167 1.4884-7.778 3.1819-9.0826 3.889C19.2587 23.4183 18.0284 23.4183 16.3137 22.644 15.4864 22.2021 12.4918 20.9117 9.39476 19.5611c-3.3198-1.446-6.75627-2.945-7.77802-3.4753C.22377 15.3575.153061 15.1948.160132 14.8271V13.8655L.513678 14.0564c1.311652.6647 7.219412 3.1819 11.486722 5.0204 2.1142.898 3.8112 1.6298 4.3769 1.8844C18.092 21.7319 19.3082 21.8733 21.5603 20.6748 22.7022 20.0808 25.9619 18.7409 29.1651 17.4328z" fill="#494c4d"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 24.5037c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 21.0248C37.3908 20.8817 37.6564 20.7223 37.9118 20.5475 37.972 20.9542 37.972 21.3676 37.9118 21.7743 37.8022 22.2021 37.4875 22.5557 36.289 23.1319 35.4617 23.5314 33.1531 24.4789 30.5792 25.5396c-3.6167 1.4884-7.778 3.1819-9.0826 3.889-2.2379 1.0606-3.4682 1.0606-5.1829.2864C15.4864 29.2801 12.4918 27.9755 9.39476 26.625c-3.3198-1.446-6.75627-2.9451-7.77802-3.4754C.22377 22.4213.153061 22.2587.160132 21.891V20.9364L.513678 21.1273C1.82533 21.792 7.73309 24.3092 12.0004 26.1477c2.1001.898 3.8006 1.6298 4.3663 1.8844C18.0814 28.8028 19.2976 28.9442 21.5497 27.7457 22.7022 27.1518 25.9619 25.8118 29.1651 24.5037z" fill="#494c4d"></path></svg>
      </a>
    </footer>
  </div>
</div>

<script>
  const searchModal = (() => {
    const searchButton = document.querySelector('#search-button')
    const searchContainer = document.querySelector('#search-container')
    const searchInput = searchContainer.querySelector('#search-input')
    const resultsContainer = searchContainer.querySelector('#search-results')
    const style = document.createElement('style')
    
    let keys = {}
    let focusable
    let firstFocusable
    let lastFocusable
  
    function next (elem, selector) {
      let nextElem = elem.nextElementSibling
      if (!selector) return nextElem
      if (nextElem && nextElem.matches(selector)) return nextElem
      return null
    }
  
    function debounce(callback, delay) {
      let timeout
      
      return function() {
        clearTimeout(timeout)
        timeout = setTimeout(callback, delay)
      }
    }
  
    function searchSubmit(form) {
      if (form.id !== 'search-form') return false
  
      const searchTerm = searchInput.value
  
      if (searchTerm.length < 1) {
        resultsContainer.innerHTML = ''
        return
      }
  
      function search(url) {
        let promise = new Promise((resolve, reject) => {
          const req = new XMLHttpRequest()
          req.open('GET', url)
          req.onload = function() {
            if (req.status === 200) {
              resolve(JSON.parse(req.response))
            } else {
              reject(Error(req.status))
            }
          }
          req.send()
        })
  
        return promise
      }
  
      function sortData(data) {
        
        const getCategories = (data) =>
          data.reduce((a, c) => {
            if (!a.includes(c.hierarchy[0])) {
              a.push(c.hierarchy[0])
            }
  
            return a
          }, [])

        
        const constructSectionTitle = (record) => {
          if (record.hierarchy && record.hierarchy.length > 2) {
            return record.hierarchy[1]
          } else {
            return record.title
          }
        }

        
        const mergeData = (data, categories) =>
          categories.map((category) => {
            const obj = {}
            obj.category = category
  
            data.forEach((record) => {
              if (record.hierarchy[0] === category) {
                obj[record.title] = {
                  path: constructSectionTitle(record),
                  url: record.url,
                }
              }
            })
  
            return obj
          })
  
        return mergeData(data.results, getCategories(data.results))
      }
  
      function escape_evil_chars(str_in) {
        return str_in.replaceAll('>','&gt;').replaceAll('<', '&lt;').replaceAll('&', '&amp;').replaceAll('"','&quot;').replaceAll("'",'&#x27;')
      }   
      
      function displayData(data) {
        resultsContainer.innerHTML = ''
        
        if (data.results.length < 1) {
          escapedSearchTerm = escape_evil_chars(searchTerm)
          resultsContainer.insertAdjacentHTML(
            'beforeend',
            `<dt class="sr-only">${escapedSearchTerm}:</dt>
            <dd class="search-no-results">
              No results for \"<span class="search-title">${escapedSearchTerm}</span>\"
            </dd>`
          )
        } else {
          sortData(data).forEach((result) => {
            resultsContainer.insertAdjacentHTML(
              'beforeend', 
              `<dt class="search-item-source">
                ${result.category}
              </dt>`
            )
    
            delete result.category
    
            Object.keys(result).forEach((key, index) => {
              resultsContainer.insertAdjacentHTML(
                'beforeend',
                `<dd class="search-item" role="option">
                  <a href="${result[key].url}">
                    <span class="search-item-icon"></span>
                    <span class="search-item-content">
                      ${result[key].path ? `<span class="search-item-path">${result[key].path}</span>` : ''}
                      <span class="search-item-title">${key.replace(new RegExp(`(^|)(${searchTerm})(|$)`, 'ig'), '$1<b class="search-term-match">$2</b>$3')}</span>
                    </span>
                    <span class="search-item-action"></span>
                  </a>
                </dd>`
              )
            })
            
            if (!resultsContainer.querySelector('[aria-selected]')) resultsContainer.querySelector('.search-item').setAttribute('aria-selected', '')
          })
        }
        return
      }
  
      function displayError(error) {
        console.log(error)
      }
  
      search(`https://search-service.redislabs.com/search?q=${searchTerm}*&site=https://redis.io`)
        .then(displayData)
        .catch(displayError)
    }
  
    function loadHandler(event) {
      style.innerHTML = `
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      `
  
      document.head.appendChild(style)
      document.documentElement.dataset.searchState = 'off'
    }
  
    function getNextSibling(elem, selector, direction) {
      let sibling = direction === 'down' ? elem.nextElementSibling : elem.previousElementSibling
    
      while (sibling) {
        if (sibling.matches(selector)) return sibling
        sibling = direction === 'down' ? sibling.nextElementSibling : sibling.previousElementSibling
      }
    }
  
    function tabSelection(direction) {
      const currentSelection = resultsContainer.querySelector('[aria-selected]')
      if (!currentSelection || direction === 'down' && !currentSelection.nextElementSibling || direction === 'up' && !currentSelection.previousElementSibling) return false
        
      const nextSelection = getNextSibling(currentSelection, '.search-item', direction)
      if (!nextSelection) return false
      
      nextSelection.setAttribute('aria-selected', '')
      currentSelection.removeAttribute('aria-selected')
      resultsContainer.scrollTop = nextSelection.offsetTop - resultsContainer.offsetTop
    }
    
    function keyDownHandler(event) {
      switch (event.key) {
  
        // Arrow keys
        case 'ArrowDown':
          if (document.documentElement.dataset.searchState === 'off' || !document.querySelector('.search-item')) return false
          event.preventDefault()
          tabSelection('down')
          break
  
        case 'ArrowUp':
          if (document.documentElement.dataset.searchState === 'off' || !document.querySelector('.search-item')) return false
          event.preventDefault()
          tabSelection('up')
          break
  
        // Tab
        case 'Tab':
          if (document.documentElement.dataset.searchState === 'off') return false
  
          if (focusable.length === 1) {
            event.preventDefault()
            break
          }
  
          // If shift is fired, tab backward
          if (event.shiftKey) {
            if (document.activeElement === firstFocusable) {
              event.preventDefault()
              lastFocusable.focus()
            }
  
            // Otherwise tab forward
          } else {
            if (document.activeElement === lastFocusable) {
              event.preventDefault()
              firstFocusable.focus()
            }
          }
          break
  
        // Esc
        case 'Escape':
          if (document.documentElement.dataset.searchState === 'off') return false
          stopSearch()
          break
        
        // Enter
        case 'Enter':
          if (!document.querySelector('.search-item:focus-within') && document.querySelector('.search-item[aria-selected]')) {
            event.preventDefault()
            document.querySelector('.search-item[aria-selected] a').click()
          }
          break
  
        // Forward slash
        case '/':
          if (document.documentElement.dataset.searchState === 'on') return false
          event.preventDefault()
          startSearch()
          break
      
        // Default
        default:
          return false
          break
      }
    }
  
    function keyUpHandler(event) {
      if (document.documentElement.dataset.searchState === 'off' || !document.activeElement.matches('.search-input')) return false
      
      switch (event.key) {
        case 'ArrowDown':
          return false
          break
        case 'ArrowUp':
          return false
          break
        case 'ArrowLeft':
          return false
          break
        case 'ArrowRight':
          return false
          break
        case 'Tab':
          return false
          break
        case 'Escape':
          return false
          break
        case 'Enter':
          return false
          break
        case '/':
          return false
          break
        default:
          searchSubmit(document.activeElement.closest('form'))
          break
      }
    }
  
    function multiKeyHandler(event) {
      if (document.documentElement.dataset.searchState === 'on') return false
  
      let { key, type } = event
      let isKeyDown = (type == 'keydown')
      keys[key] = isKeyDown
  
      // Both (cmd || cntrl) & k pressed
      if (isKeyDown && (keys.Control || keys.Meta) && keys.k) {
        event.preventDefault()
        startSearch()
      }
    }
  
    // Click handler function
    function clickHandler(event) {
      if (event.target.closest('#search-button')) {
        startSearch()
      } else if (event.target.closest('#search-cancel') || event.target.matches('#search-container')) {
        stopSearch()
      }
    }
  
    function startSearch() {
      sessionStorage.setItem('scroll-position', document.documentElement.scrollTop)
      document.documentElement.dataset.scrollDisabled = 'on'
      document.documentElement.dataset.searchState = 'on'
      allowFocus(searchContainer, true)
      trapFocus(searchContainer)
      searchInput.focus()
    }
  
    function stopSearch() {
      document.documentElement.dataset.searchState = 'off'
      document.documentElement.dataset.scrollDisabled = 'off'
      document.documentElement.scrollTop = sessionStorage.getItem('scroll-position')
      allowFocus(searchContainer, false)
      document.activeElement.blur()
      resultsContainer.innerHTML = ''
      searchInput.value = ''
      keys = {}
    }
  
    function submitHandler(event) {
      if (event.target.id === 'search-form') {
        event.preventDefault()
        return false
      }
    }
  
    function allowFocus(selector, state) {
      const focusable = selector.querySelectorAll('button, [href], input, select, textarea')
      focusable.forEach(el => el.setAttribute('tabindex', state ? '' : '-1'))
      selector.classList.toggle('sr-only')
    }
  
    function trapFocus(selector) {
      focusable = selector.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"]')
      firstFocusable = focusable[0]
      lastFocusable = focusable[focusable.length - 1]
    }
  
    // Attach event listeners
    document.addEventListener('DOMContentLoaded', loadHandler)
    document.addEventListener('click', clickHandler)
    document.addEventListener('keydown', event => debounce(keyDownHandler(event), 100))
    document.addEventListener('keyup', event => debounce(keyUpHandler(event), 100))
    document.addEventListener('keydown', multiKeyHandler)
    document.addEventListener('keyup', multiKeyHandler)
    document.addEventListener('submit', submitHandler)
  })()
</script>
  

</body></html>