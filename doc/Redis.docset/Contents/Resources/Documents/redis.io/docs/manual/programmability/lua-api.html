<html><!-- Online page at https://redis.io/docs/manual/programmability/lua-api/ --><head><meta charset="utf-8"><title>Redis Lua API reference</title><link rel="stylesheet" href="../../../css_1.css" type="text/css"><link rel="stylesheet" href="../../../css_2.css" type="text/css"><link rel="stylesheet" href="../../../css_3.css" type="text/css"><link rel="stylesheet" href="../../../css_4.css" type="text/css"><link rel="stylesheet" href="../../../css_5.css" type="text/css"><script type="text/javascript" src="../../../js_1.js"></script><script type="text/javascript" src="../../../js_10.js"></script><script type="text/javascript" src="../../../js_3.js"></script><script type="text/javascript" src="../../../js_4.js"></script><script type="text/javascript" src="../../../js_5.js"></script><script type="text/javascript" src="../../../js_6.js"></script><script type="text/javascript" src="../../../js_7.js"></script><script type="text/javascript" src="../../../js_8.js"></script><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style></head><body class="antialiased tracking-[-0.01em]">
    <noscript>&amp;amp;amp;amp;amp;amp;amp;lt;iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T4MTBKP"
        height="0" width="0" style="display:none;visibility:hidden"&amp;amp;amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;amp;amp;lt;/iframe&amp;amp;amp;amp;amp;amp;amp;gt;</noscript>
    <header class="sticky top-0 z-50 flex items-center w-full text-xs lg:text-sm font-semibold lg:font-medium text-white shadow bg-midnight-700">
      <div class="flex items-center w-full h-16 container max-w-[85rem] mx-auto px-4 sm:px-8">
  <a class="relative z-50 mr-auto" href="../../../../redis.io.html">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 368.69 125.59" class="w-auto h-8">
  <defs>
    <style>
      .cls-1 {
        fill: none;
      }

      .cls-2 {
        clip-path: url(#clip-path);
      }

      .cls-3 {
        fill: #a32422;
      }

      .cls-4 {
        fill: #dc382c;
      }

      .cls-5 {
        fill: #fff;
      }

      .cls-6 {
        fill: #741113;
      }

      .cls-7 {
        fill: #ac2724;
      }
    </style>
    <clipPath id="clip-path" transform="translate(0.01 0.01)">
      <rect class="cls-1" width="146.42" height="125.48"></rect>
    </clipPath>
  </defs>
  <g id="Layer_2" data-name="Layer 2">
    <g id="Layer_1-2" data-name="Layer 1">
      <g class="cls-2">
        <path class="cls-3" d="M140.66,96.74c-7.8,4.08-48.28,20.73-57,25.3s-13.39,4.44-20.21,1.18S13.7,102.5,5.92,98.78C2,96.94,0,95.37,0,93.9V79.09S56.08,66.92,65.13,63.64,77.31,60.28,85,63.1,138.79,74.24,146.4,77V91.6c0,1.52-1.75,3-5.74,5.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,82c-7.8,4.06-48.28,20.71-57,25.2s-13.39,4.45-20.21,1.2S13.7,87.69,5.92,84s-7.93-6.27-.3-9.25S56.08,55,65.13,51.7,77.31,48.33,85,51.16,133,70,140.57,72.79s7.92,5.08.09,9.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-3" d="M140.66,72.62c-7.8,4.07-48.28,20.71-57,25.2S70.31,102.27,63.49,99,13.7,78.37,5.92,74.66C2,72.8,0,71.24,0,69.76V55S56.08,42.79,65.13,39.51,77.31,36.14,85,39,138.79,50.1,146.4,52.88v14.6C146.4,69,144.65,70.52,140.66,72.62Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,57.81c-7.8,4.08-48.28,20.72-57,25.21s-13.39,4.46-20.21,1.2S13.7,63.57,5.92,59.85-2,53.6,5.62,50.62s50.46-19.79,59.51-23S77.31,24.21,85,27,133,45.94,140.57,48.65s7.92,5.09.09,9.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-3" d="M140.66,47.59c-7.8,4.08-48.28,20.73-57,25.21S70.31,77.25,63.49,74,13.7,53.34,5.92,49.63C2,47.79,0,46.22,0,44.74V29.93S56.08,17.76,65.13,14.49,77.31,11.12,85,13.94s53.77,11.14,61.38,13.92v14.6C146.4,44,144.65,45.5,140.66,47.59Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,32.8c-7.8,4-48.28,20.75-57,25.2s-13.39,4.44-20.21,1.2S13.7,38.53,5.92,34.83s-7.93-6.27-.3-9.25S56.08,5.8,65.13,2.54,77.31-.82,85,2,133,20.85,140.57,23.63s7.92,5.09.09,9.14Z" transform="translate(0.01 0.01)"></path>
      </g>
      <polygon class="cls-5" points="75.51 11.78 85.17 8.61 82.55 14.87 92.38 18.55 79.71 19.87 76.86 26.71 72.28 19.08 57.63 17.76 68.57 13.82 65.28 7.76 75.51 11.78 75.51 11.78 75.51 11.78"></polygon>
      <polygon class="cls-5" points="76.12 51.71 52.44 41.88 86.36 36.67 76.12 51.71 76.12 51.71 76.12 51.71"></polygon>
      <path class="cls-5" d="M43.28,22.34c10,0,18.13,3.15,18.13,7s-8.15,7-18.13,7-18.14-3.15-18.14-7S33.27,22.34,43.28,22.34Z" transform="translate(0.01 0.01)"></path>
      <polygon class="cls-6" points="107.39 20.42 127.46 28.35 107.41 36.28 107.39 20.42 107.39 20.42 107.39 20.42"></polygon>
      <polygon class="cls-7" points="107.39 20.42 107.41 36.28 105.23 37.13 85.17 29.2 107.39 20.42 107.39 20.42 107.39 20.42"></polygon>
      <path class="cls-5" d="M193,41.4a17.36,17.36,0,0,1,6.23-4.34,20,20,0,0,1,7.3-1.61,6.71,6.71,0,0,1,5,1.61,5,5,0,0,1,1.52,3.79,5.39,5.39,0,0,1-1.52,3.79,4.9,4.9,0,0,1-3.79,1.63c-6.24.55-14.9,6.77-14.9,15.22V80.67a5.57,5.57,0,0,1-5.42,5.41,4.92,4.92,0,0,1-3.87-1.67,5.36,5.36,0,0,1-1.62-3.79v-40a5.35,5.35,0,0,1,1.62-3.79,7.2,7.2,0,0,1,4.07-1.36,5.52,5.52,0,0,1,5.41,5.4Z" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M258.71,59a5.25,5.25,0,0,1-1.35,3.54,6.11,6.11,0,0,1-3.79,1.62h-32a10.31,10.31,0,0,0,3.47,6.56,14.46,14.46,0,0,0,9.48,4.57,14.07,14.07,0,0,0,10.56-2.44,5.52,5.52,0,0,1,4.07-1.63,4.65,4.65,0,0,1,3.51,1.36,4.41,4.41,0,0,1,.26,6.24c-.08.09-.17.17-.26.26a24.49,24.49,0,0,1-17.59,6.5A23,23,0,0,1,217.5,78a26.67,26.67,0,0,1-7.3-17.9,24.31,24.31,0,0,1,7.3-17.88,22.59,22.59,0,0,1,17.06-7.31,22,22,0,0,1,16.74,6.78,24.78,24.78,0,0,1,7.61,16.74v.53Zm-24.1-14.35a14.2,14.2,0,0,0-9.13,3.53,13.17,13.17,0,0,0-4.33,7h28.43a12.39,12.39,0,0,0-4.88-6.76,17.3,17.3,0,0,0-10-3.81" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M309.66,80.12a5.57,5.57,0,0,1-5.41,5.42,5.85,5.85,0,0,1-5.42-4.34A23.23,23.23,0,0,1,285,85.54a23.57,23.57,0,0,1-17.33-7.31,24.14,24.14,0,0,1-7.05-17.88,25.75,25.75,0,0,1,7.05-17.87A23.85,23.85,0,0,1,285,34.87a22.34,22.34,0,0,1,13.53,4.34V20.28a4.92,4.92,0,0,1,1.63-3.79A5.37,5.37,0,0,1,304,14.86a4.92,4.92,0,0,1,3.79,1.63,5.36,5.36,0,0,1,1.63,3.79V80.12ZM285.31,74.7a12,12,0,0,0,9.47-4.32,14.4,14.4,0,0,0,0-20A13,13,0,0,0,285.31,46a11.65,11.65,0,0,0-9.48,4.34,14.4,14.4,0,0,0,0,20,12.49,12.49,0,0,0,9.48,4.32" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M325.67,20.28v2.18A5.5,5.5,0,0,1,324,26.58a4.64,4.64,0,0,1-3.79,1.35,4.86,4.86,0,0,1-3.78-1.61,5.44,5.44,0,0,1-1.63-4.06v-2a5.28,5.28,0,0,1,1.63-3.79,5.33,5.33,0,0,1,3.78-1.63A5,5,0,0,1,324,16.49a4.9,4.9,0,0,1,1.66,3.79m-9.13,16.53a5.28,5.28,0,0,1,3.79-1.63,4.85,4.85,0,0,1,3.79,1.63,5.48,5.48,0,0,1,1.55,4V80.42A4.55,4.55,0,0,1,324,84.21a5.33,5.33,0,0,1-3.78,1.63,4.9,4.9,0,0,1-3.79-1.63,5.28,5.28,0,0,1-1.63-3.79V40.85a5.39,5.39,0,0,1,1.63-4" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M364.08,40.6a5.29,5.29,0,0,1,2.17,3.24,7.17,7.17,0,0,1-.54,4.06,5.4,5.4,0,0,1-3.25,2.16,5.61,5.61,0,0,1-4.07-.81c-3.79-2.43-6.75-3.78-9.2-3.78a8.74,8.74,0,0,0-6,1.88c-1.08.82-1.62,1.36-1.62,1.9a2,2,0,0,0,.27,1.36,3.74,3.74,0,0,0,1.08.81,16.19,16.19,0,0,0,7.32,2.43h0a37.75,37.75,0,0,1,9.74,3,13.57,13.57,0,0,1,6.5,5.7,13.46,13.46,0,0,1-4.06,18.67,21.79,21.79,0,0,1-13,4.06c-6.23,0-12.18-2.43-17.87-7a5.77,5.77,0,0,1-1.9-3.53,5.2,5.2,0,0,1,8.4-4.56,15.73,15.73,0,0,0,11.1,4.33,11.61,11.61,0,0,0,6.77-1.9c1.08-1.08,1.9-1.89,1.9-2.71s0-1.08-.27-1.35c0-.28-.55-.81-1.36-1.08a20.15,20.15,0,0,0-8.13-2.86h0a28.26,28.26,0,0,1-9.2-3,16.56,16.56,0,0,1-6.5-5.67,12.61,12.61,0,0,1-1.61-6.23,13.3,13.3,0,0,1,5.95-11.11,21.82,21.82,0,0,1,12.45-3.79c4.56.28,9.48,2.16,14.89,5.69" transform="translate(0.01 0.01)"></path>
    </g>
  </g>
</svg>
  </a>

	<nav data-menu="" class="hidden lg:flex items-center justify-center content-start lg:content-center lg:gap-y-4 flex-1 z-40 fixed inset-0 lg:static bg-slate-900 lg:bg-transparent text-sm max-h-screen lg:max-w-none pt-20 pb-8 lg:py-0 overflow-y-auto lg:overflow-y-visible">
    
    
      

        
        <a href="../../getting-started.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Get started
        </a>

        
        <a href="../../getting-started.html" class="flex lg:hidden items-center mt-1.5">
          Get started
        </a>
      
    
      
        
        
        <dl class="hidden lg:flex group relative first:ml-auto ml-1 mt-3 mb-0 px-3 pt-2 pb-5 cursor-pointer">
          <dt class="sr-only uppercase lg:not-sr-only flex items-center justify-items-center group-hover:text-white/50 group-focus-within:text-white/50 whitespace-nowrap transition-colors" href="#">
            
            Docs
          </dt>
          <dd class="hidden lg:grid text-[0.8rem] lg:text-sm text-redis-neutral-800 absolute top-full -mt-1 right-[1000rem] p-2 group-hover:right-[unset] group-hover:-left-3 group-focus-within:right-[unset] group-focus-within:-left-3 bg-white rounded-lg border border-slate-500/10 bg-clip-padding shadow-md">
            
              
                <div class="-my-2 pr-3 py-4 col-start-1  pl-3 ">
                  <a href="../../about.html" class=" font-semibold text-[0.9375rem] text-slate-900 flex items-center whitespace-nowrap min-w-[10rem] hover:text-slate-600 focus:text-slate-600 transition-colors">
                    
                      <span class="grid place-items-center w-5 h-5 mr-2.5">
                        
                        <svg viewBox="0 0 147 126" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M140.708 96.7107c-7.81 4.0703-48.2904 20.7203-57.0004 25.2903C74.9976 126.571 70.3176 126.441 63.4976 123.191s-49.8-20.73-57.57002-24.4403C2.04758 96.9007.00756836 95.3407.00756836 93.8607V79.0508S56.0876 66.8807 65.1376 63.6107 77.3176 60.2406 85.0276 63.0606C92.7376 65.8806 138.798 74.2007 146.408 76.9807V91.5606C146.408 93.0806 144.658 94.5606 140.668 96.6907L140.708 96.7107z" fill="#a32422"></path><path d="M140.708 81.9108C132.898 85.9808 92.4176 102.631 83.7076 107.121 74.9976 111.611 70.3176 111.561 63.4976 108.321c-6.82-3.24-49.8-20.6703-57.57001-24.3703-7.77-3.7-7.92999-6.27-.30999-9.25s50.47-19.78 59.52-23S77.3176 48.3408 85.0276 51.1708C92.7376 54.0008 132.968 70.0108 140.578 72.7908 148.188 75.5708 148.488 77.8808 140.668 81.9208L140.708 81.9108z" fill="#dc382c"></path><path d="M140.708 72.5807C132.898 76.6507 92.4176 93.3008 83.7076 97.7908 74.9976 102.281 70.3176 102.231 63.4976 98.9907 56.6776 95.7507 13.6976 78.3407 5.92758 74.6207 2.04758 72.7707.00756836 71.2007.00756836 69.7207V54.9306S56.0876 42.7607 65.1376 39.4707 77.3176 36.1107 85.0276 38.9407C92.7376 41.7707 138.798 50.0607 146.408 52.8507v14.64C146.488 68.9607 144.698 70.4907 140.708 72.5807z" fill="#a32422"></path><path d="M140.708 57.7808c-7.81 4.08-48.2904 20.7099-57.0004 25.1999S70.3176 87.4407 63.4976 84.1807s-49.8-20.65-57.57001-24.36C-1.84241 56.1107-2.0024 53.5607 5.6176 50.5807s50.47-19.78 59.52-23S77.3176 24.2208 85.0276 27.0308C92.7376 29.8408 132.968 45.9508 140.578 48.6608 148.188 51.3708 148.488 53.7408 140.668 57.7908L140.708 57.7808z" fill="#dc382c"></path><path d="M140.708 47.5508c-7.81 4.08-48.2904 20.73-57.0004 25.22C74.9976 77.2608 70.3176 77.2107 63.4976 73.9507 56.6776 70.6907 13.6976 53.3007 5.92758 49.5907c-3.88-1.84-5.92001164-3.41-5.92001164-4.89V29.9008S56.0876 17.7207 65.1376 14.4507c9.05-3.27 12.18-3.3599 19.89-.549899999999999C92.7376 16.7108 138.798 25.0407 146.408 27.8307V42.4208C146.488 43.9408 144.698 45.4908 140.708 47.5508z" fill="#a32422"></path><path d="M140.708 32.7607c-7.81 4-48.2904 20.7599-57.0004 25.1999s-13.39 4.4401-20.21 1.2001-49.8-20.66-57.57001-24.36c-7.77-3.7-7.92999-6.27-.30999-9.26 7.62-2.99 50.47-19.77998 59.52-22.99998 9.05-3.219996 12.18-3.360025 19.89-.53003C92.7376 4.84069 132.968 20.8507 140.578 23.6407 148.188 26.4307 148.488 28.7207 140.668 32.7707L140.708 32.7607z" fill="#dc382c"></path><path d="M140.708 96.7107c-7.81 4.0703-48.2904 20.7203-57.0004 25.2903C74.9976 126.571 70.3176 126.441 63.4976 123.191s-49.8-20.73-57.57002-24.4403C2.04758 96.9007.00756836 95.3407.00756836 93.8607V79.0508S56.0876 66.8807 65.1376 63.6107 77.3176 60.2406 85.0276 63.0606C92.7376 65.8806 138.798 74.2007 146.408 76.9807V91.5606C146.408 93.0806 144.658 94.5606 140.668 96.6907L140.708 96.7107z" fill="#a32422"></path><path d="M140.708 81.9108C132.898 85.9808 92.4176 102.631 83.7076 107.121 74.9976 111.611 70.3176 111.561 63.4976 108.321c-6.82-3.24-49.8-20.6703-57.57001-24.3703-7.77-3.7-7.92999-6.27-.30999-9.25s50.47-19.78 59.52-23S77.3176 48.3408 85.0276 51.1708C92.7376 54.0008 132.968 70.0108 140.578 72.7908 148.188 75.5708 148.488 77.8808 140.668 81.9208L140.708 81.9108z" fill="#dc382c"></path><path d="M140.708 72.5807C132.898 76.6507 92.4176 93.3008 83.7076 97.7908 74.9976 102.281 70.3176 102.231 63.4976 98.9907 56.6776 95.7507 13.6976 78.3407 5.92758 74.6207 2.04758 72.7707.00756836 71.2007.00756836 69.7207V54.9306S56.0876 42.7607 65.1376 39.4707 77.3176 36.1107 85.0276 38.9407C92.7376 41.7707 138.798 50.0607 146.408 52.8507v14.64C146.488 68.9607 144.698 70.4907 140.708 72.5807z" fill="#a32422"></path><path d="M140.708 57.7808c-7.81 4.08-48.2904 20.7099-57.0004 25.1999S70.3176 87.4407 63.4976 84.1807s-49.8-20.65-57.57001-24.36C-1.84241 56.1107-2.0024 53.5607 5.6176 50.5807s50.47-19.78 59.52-23S77.3176 24.2208 85.0276 27.0308C92.7376 29.8408 132.968 45.9508 140.578 48.6608 148.188 51.3708 148.488 53.7408 140.668 57.7908L140.708 57.7808z" fill="#dc382c"></path><path d="M140.708 47.5508c-7.81 4.08-48.2904 20.73-57.0004 25.22C74.9976 77.2608 70.3176 77.2107 63.4976 73.9507 56.6776 70.6907 13.6976 53.3007 5.92758 49.5907c-3.88-1.84-5.92001164-3.41-5.92001164-4.89V29.9008S56.0876 17.7207 65.1376 14.4507c9.05-3.27 12.18-3.3599 19.89-.549899999999999C92.7376 16.7108 138.798 25.0407 146.408 27.8307V42.4208C146.488 43.9408 144.698 45.4908 140.708 47.5508z" fill="#a32422"></path><path d="M140.708 32.7607c-7.81 4-48.2904 20.7599-57.0004 25.1999s-13.39 4.4401-20.21 1.2001-49.8-20.66-57.57001-24.36c-7.77-3.7-7.92999-6.27-.30999-9.26 7.62-2.99 50.47-19.77998 59.52-22.99998 9.05-3.219996 12.18-3.360025 19.89-.53003C92.7376 4.84069 132.968 20.8507 140.578 23.6407 148.188 26.4307 148.488 28.7207 140.668 32.7707L140.708 32.7607z" fill="#dc382c"></path><path d="M75.5476 11.7307l9.66-3.17-2.62 6.26 9.83 3.68-12.67 1.32L76.8976 26.6607l-4.58-7.63-14.65-1.32 10.94-3.94L65.3176 7.71069l10.23 4.02001z" fill="#fff"></path><path d="M76.1575 51.6607l-23.68-9.83 33.92-5.2-10.24 15.03z" fill="#fff"></path><path d="M43.3276 22.3008c10 0 18.12 3.15 18.12 7s-8.14 7-18.12 7c-9.98.0-18.14-3.15000000000001-18.14-7s8.13-7 18.14-7z" fill="#fff"></path><path d="M107.428 20.3707l20.07 7.93-20.05 7.93L107.428 20.3707z" fill="#741113"></path><path d="M107.428 20.3707 107.448 36.2307 105.268 37.0807l-20.0605-7.93 22.2205-8.78z" fill="#ac2724"></path></svg>
                      </span>
                    
                    Redis
                  </a>
                  
                    <a href="../../getting-started.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Get started
                    </a>
                  
                    <a href="../../data-types.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Data types
                    </a>
                  
                    <a href="../../ui/cli.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Redis CLI
                    </a>
                  
                    <a href="../../clients.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Redis clients
                    </a>
                  
                    <a href="../../management/persistence.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Persistence
                    </a>
                  
                    <a href="../../management/scaling.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Scaling
                    </a>
                  
                </div>
              
            
              
                <div class="-my-2 pr-3 py-4 col-start-2  border-l pl-5 ">
                  <a href="../../stack.html" class=" font-semibold text-[0.9375rem] text-slate-900 flex items-center whitespace-nowrap min-w-[10rem] hover:text-slate-600 focus:text-slate-600 transition-colors">
                    
                      <span class="grid place-items-center w-5 h-5 mr-2.5">
                        
                        <svg viewBox="0 0 39 31" fill="none"><path d="M21.7371 15.2903C21.5759 15.2895 21.4198 15.2337 21.2947 15.1321 21.1695 15.0305 21.0828 14.8892 21.049 14.7316S21.0362 14.4096 21.1086 14.2655C21.1811 14.1215 21.3005 14.0066 21.4472 13.9397L35.7199 7.47338 21.4578 1.34289C21.2943 1.26329 21.1678 1.12377 21.1045.953307 21.0412.78285 21.046.594558 21.1179.427547 21.1898.260535 21.3233.127641 21.4906.0564719 21.6579-.0146977 21.8462-.0186728 22.0164.045373L37.7492 6.80518C37.8747 6.8605 37.9814 6.95112 38.0563 7.06599S38.171 7.31503 38.171 7.45216 38.1312 7.72347 38.0563 7.83834C37.9814 7.95321 37.8747 8.04383 37.7492 8.09915L22.0306 15.2266C21.9388 15.2698 21.8385 15.2916 21.7371 15.2903z" fill="#db2e2e"></path><path d="M16.4339 15.2903C16.3379 15.2906 16.2429 15.2714 16.1546 15.2337L.421813 8.47393C.296339 8.41861.18966 8.32799.114767 8.21312.0398745 8.09825.0 7.96407.0 7.82694.0 7.68981.0398745 7.55564.114767 7.44077.18966 7.3259.296339 7.23528.421813 7.17995L16.1546.052465C16.3235-.0111265 16.5104-.00772359 16.6768.0619772 16.8433.131678 16.9768.2624 17.0501.427363 17.1233.592325 17.1306.779042 17.0706.949259 17.0106 1.11948 16.8878 1.26031 16.7274 1.34291L2.44763 7.80573 16.7132 13.9362C16.8612 14.0015 16.9823 14.1154 17.0565 14.2592 17.1306 14.4029 17.1532 14.5677 17.1205 14.7261 17.0878 14.8845 17.0019 15.0269 16.8769 15.1295 16.752 15.2322 16.5956 15.2889 16.4339 15.2903z" fill="#db2e2e"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 17.4328c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 13.9539C37.3908 13.8108 37.6564 13.6514 37.9118 13.4766 37.972 13.8833 37.972 14.2967 37.9118 14.7034 37.8022 15.1312 37.4875 15.4847 36.289 16.061 35.4617 16.4605 33.1531 17.408 30.5792 18.4687c-3.6167 1.4884-7.778 3.1819-9.0826 3.889C19.2587 23.4183 18.0284 23.4183 16.3137 22.644 15.4864 22.2021 12.4918 20.9117 9.39476 19.5611c-3.3198-1.446-6.75627-2.945-7.77802-3.4753C.22377 15.3575.153061 15.1948.160132 14.8271V13.8655L.513678 14.0564c1.311652.6647 7.219412 3.1819 11.486722 5.0204 2.1142.898 3.8112 1.6298 4.3769 1.8844C18.092 21.7319 19.3082 21.8733 21.5603 20.6748 22.7022 20.0808 25.9619 18.7409 29.1651 17.4328z" fill="#494c4d"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 24.5037c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 21.0248C37.3908 20.8817 37.6564 20.7223 37.9118 20.5475 37.972 20.9542 37.972 21.3676 37.9118 21.7743 37.8022 22.2021 37.4875 22.5557 36.289 23.1319 35.4617 23.5314 33.1531 24.4789 30.5792 25.5396c-3.6167 1.4884-7.778 3.1819-9.0826 3.889-2.2379 1.0606-3.4682 1.0606-5.1829.2864C15.4864 29.2801 12.4918 27.9755 9.39476 26.625c-3.3198-1.446-6.75627-2.9451-7.77802-3.4754C.22377 22.4213.153061 22.2587.160132 21.891V20.9364L.513678 21.1273C1.82533 21.792 7.73309 24.3092 12.0004 26.1477c2.1001.898 3.8006 1.6298 4.3663 1.8844C18.0814 28.8028 19.2976 28.9442 21.5497 27.7457 22.7022 27.1518 25.9619 25.8118 29.1651 24.5037z" fill="#494c4d"></path></svg>
                      </span>
                    
                    Redis Stack
                  </a>
                  
                    <a href="../../stack/get-started.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Get started
                    </a>
                  
                    <a href="../../stack/get-started/clients.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Stack clients
                    </a>
                  
                    <a href="../../ui/insight.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      RedisInsight
                    </a>
                  
                    <a href="../../stack/json.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      JSON
                    </a>
                  
                    <a href="../../stack/search.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Search
                    </a>
                  
                    <a href="../../stack/bloom.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Probabilistic
                    </a>
                  
                </div>
              
            
          </dd>
        </dl>
        
        
        <dl class="lg:hidden">
          <dt class="sr-only">
            Docs
          </dt>
          <dd class="lg:hidden flex flex-col">
            
              
                <a href="../../about.html" class="flex items-center mt-2">
                  Redis
                </a>
                
                  <a href="../../getting-started.html" class="mt-2">
                    Get started
                  </a>
                
                  <a href="../../data-types.html" class="mt-2">
                    Data types
                  </a>
                
                  <a href="../../ui/cli.html" class="mt-2">
                    Redis CLI
                  </a>
                
                  <a href="../../clients.html" class="mt-2">
                    Redis clients
                  </a>
                
                  <a href="../../management/persistence.html" class="mt-2">
                    Persistence
                  </a>
                
                  <a href="../../management/scaling.html" class="mt-2">
                    Scaling
                  </a>
                
                <hr class="opacity-10 mt-4 mb-2">
              
            
              
                <a href="../../stack.html" class="flex items-center mt-2">
                  Redis Stack
                </a>
                
                  <a href="../../stack/get-started.html" class="mt-2">
                    Get started
                  </a>
                
                  <a href="../../stack/get-started/clients.html" class="mt-2">
                    Stack clients
                  </a>
                
                  <a href="../../ui/insight.html" class="mt-2">
                    RedisInsight
                  </a>
                
                  <a href="../../stack/json.html" class="mt-2">
                    JSON
                  </a>
                
                  <a href="../../stack/search.html" class="mt-2">
                    Search
                  </a>
                
                  <a href="../../stack/bloom.html" class="mt-2">
                    Probabilistic
                  </a>
                
                <hr class="opacity-10 mt-4 mb-2">
              
            
          </dd>
        </dl>
      
    
      

        
        <a href="../../../commands.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Commands
        </a>

        
        <a href="../../../commands.html" class="flex lg:hidden items-center mt-1.5">
          Commands
        </a>
      
    
      
        
        
        <dl class="hidden lg:flex group relative first:ml-auto ml-1 mt-3 mb-0 px-3 pt-2 pb-5 cursor-pointer">
          <dt class="sr-only uppercase lg:not-sr-only flex items-center justify-items-center group-hover:text-white/50 group-focus-within:text-white/50 whitespace-nowrap transition-colors" href="#">
            
            Resources
          </dt>
          <dd class="hidden lg:grid text-[0.8rem] lg:text-sm text-redis-neutral-800 absolute top-full -mt-1 right-[1000rem] p-2 group-hover:right-[unset] group-hover:-left-3 group-focus-within:right-[unset] group-focus-within:-left-3 bg-white rounded-lg border border-slate-500/10 bg-clip-padding shadow-md">
            
              
              <a href="../../../resources/clients.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Clients
              </a>
              
            
              
              <a href="../../../resources/libraries.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Libraries
              </a>
              
            
              
              <a href="../../../resources/tools.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Tools
              </a>
              
            
              
              <a href="../../../resources/modules.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Modules
              </a>
              
            
          </dd>
        </dl>
        
        
        <dl class="lg:hidden">
          <dt class="sr-only">
            Resources
          </dt>
          <dd class="lg:hidden flex flex-col">
            
              
              <a href="../../../resources/clients.html" class="mt-2">
                Clients
              </a>
              
            
              
              <a href="../../../resources/libraries.html" class="mt-2">
                Libraries
              </a>
              
            
              
              <a href="../../../resources/tools.html" class="mt-2">
                Tools
              </a>
              
            
              
              <a href="../../../resources/modules.html" class="mt-2">
                Modules
              </a>
              
            
          </dd>
        </dl>
      
    
      

        
        <a href="../../../community.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Community
        </a>

        
        <a href="../../../community.html" class="flex lg:hidden items-center mt-1.5">
          Community
        </a>
      
    
      

        
        <a href="../../../support.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Support
        </a>

        
        <a href="../../../support.html" class="flex lg:hidden items-center mt-1.5">
          Support
        </a>
      
    
    
    <div class="flex flex-col lg:flex-row lg:ml-auto lg:space-x-2">
      <button id="search-button" type="button" class="rounded-sm w-full lg:w-auto transition-colors shrink-0 flex-1 lg:flex-none lg:ml-2 lg:mr-0 mt-4 lg:mt-0 inline-flex items-center px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 border-white/50 hover:text-indigo-600 focus:text-indigo-600 hover:bg-white focus:bg-white focus:ring-white">
        <svg class="w-[0.875rem] h-[0.875rem] mr-0.5" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <circle cx="10" cy="10" r="7"></circle>
          <line x1="21" y1="21" x2="15" y2="15"></line>
        </svg>
        <span class="sr-only">Quick search&amp;hellip…</span>
        <span class="lg:hidden xl:block flex-auto ml-1 mr-4" aria-hidden="">Search…</span>
        <script>
          if (navigator.appVersion.indexOf("Win") != -1 || navigator.appVersion.indexOf("Linux") != -1) {
            document.querySelector('[title="Command"]').textContent = "&#8963;";
          } 
        </script>
        <kbd class="font-sans font-semibold">
          <abbr title="Command" class="no-underline">⌘</abbr>&nbsp;K
        </kbd>
      </button>
      
        <a class="rounded-sm transition-colors shrink-0 inline-flex items-center justify-center mt-2 lg:mt-0 px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900
         border-transparent bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 focus:ring-indigo-600
        " href="../../../download.html">
          Download
        </a>
      
        <a class="rounded-sm transition-colors shrink-0 inline-flex items-center justify-center mt-2 lg:mt-0 px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900
        
         border-white/50 hover:text-indigo-600 focus:text-indigo-600 hover:bg-white focus:bg-white focus:ring-white" href="http://redis.com/try-free/">
          Try Redis Cloud
        </a>
      
    </div>
	</nav>

  <button data-menu-toggle="" aria-expanded="false" class="menu-toggle block ml-auto lg:hidden relative z-50"> 
    <span class="sr-only">Open main menu</span> 
    <svg aria-hidden="true" role="img" viewBox="0 0 24 24" style="pointer-events: none; width: 24px; height: 24px;" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <line x1="4" y1="6" x2="20" y2="6"></line>
      <line x1="4" y1="12" x2="20" y2="12"></line>
      <line x1="4" y1="18" x2="20" y2="18"></line>
    </svg>
  </button>
</div>
    </header>

    
  <main class="docs w-full max-w-[85rem] mx-auto px-4 sm:px-6 lg:px-8 md:flex gap-16">
    

<div class="hidden md:block w-52 h-full shrink-0">
  <nav class="w-52 z-40 bg-white hidden md:block fixed top-28 pb-16 h-full max-h-[calc(100vh-7rem)] text-[0.8125rem] leading-7 font">
    <div class="absolute right-0 -top-28 z-[-1] h-screen border-r border-slate-200/50 bg-gradient-to-bl from-slate-50 via-slate-50 to-indigo-100 w-[17rem] xl:w-[calc(50vw-23rem)]"></div>
    <ul class="h-full max-h-[calc(100vh-7rem)] overflow-y-auto pr-6">
      
    <li>
      <a class="flex justify-between items-center truncate font-semibold text-slate-900" href="../../../docs.html">
          <span>Documentation</span>
          
      </a>
        <ul class="">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../about.html">
          <span>About</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../getting-started.html">
          <span>Getting started</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../ui.html">
          <span>User interfaces</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../data-types.html">
          <span>Data types</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../clients.html">
          <span>Client quickstarts</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../manual.html">
          <span>Using Redis</span>
          
            
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400 rotate-90" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../client-side-caching.html">
          <span>Client-side caching</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../pipelining.html">
          <span>Pipelining</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../keyspace-notifications.html">
          <span>Keyspace notifications</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../pubsub.html">
          <span>Pub/sub</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../transactions.html">
          <span>Transactions</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../patterns.html">
          <span>Patterns</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../programmability.html">
          <span>Programmability</span>
          
            
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400 rotate-90" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./functions-intro.html">
          <span>Functions</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./eval-intro.html">
          <span>Lua scripting</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate active text-indigo-600" href="./lua-api.html">
          <span>Lua API</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./lua-debugging.html">
          <span>Debugging Lua</span>
          
      </a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../management.html">
          <span>Managing Redis</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../reference.html">
          <span>Reference</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../../stack.html">
          <span>Redis Stack</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
        </ul>
    </li>
    </ul>
  </nav>
</div>
    <div class="w-full max-w-[47rem] py-12">
      <nav class="flex" aria-label="Breadcrumb">
  <ol role="list" class="flex items-center space-x-2">
    
  
    
  
    
  
    
  
    
  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <a class="text-gray-400 hover:text-gray-500" href="../../../../redis.io.html">
        <svg class="flex-shrink-0 h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
        </svg>
        <span class="sr-only">Home</span>
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../../../docs.html">
        Documentation
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../../manual.html">
        Using Redis
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../programmability.html">
        Redis programmability
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 pointer-events-none">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="./lua-api.html">
        Redis Lua API reference
      </a>
    
  </li>

  </ol>
</nav>


      <section class="prose prose-slate w-full max-w-[47rem] py-12">
        <h1>Redis Lua API reference</h1>
        <p class="text-lg -mt-5 mb-10">Executing Lua in Redis</p>
        <p>Redis includes an embedded <a href="https://www.lua.org/">Lua 5.1</a> interpreter.
The interpreter runs user-defined <a href="./eval-intro.html">ephemeral scripts</a> and <a href="./functions-intro.html">functions</a>. Scripts run in a sandboxed context and can only access specific Lua packages. This page describes the packages and APIs available inside the execution's context.</p>
<a class="dashAnchor" name="//apple_ref/Section/Sandbox%20context"></a><h2 id="sandbox-context">Sandbox context</h2>
<p>The sandboxed Lua context attempts to prevent accidental misuse and reduce potential threats from the server's environment.</p>
<p>Scripts should never try to access the Redis server's underlying host systems.
That includes the file system, network, and any other attempt to perform a system call other than those supported by the API.</p>
<p>Scripts should operate solely on data stored in Redis and data provided as arguments to their execution.</p>
<h3 id="global-variables-and-functions">Global variables and functions</h3>
<p>The sandboxed Lua execution context blocks the declaration of global variables and functions.
The blocking of global variables is in place to ensure that scripts and functions don't attempt to maintain any runtime context other than the data stored in Redis.
In the (somewhat uncommon) use case that a context needs to be maintain between executions,
you should store the context in Redis' keyspace.</p>
<p>Redis will return a "Script attempted to create global variable 'my_global_variable" error when trying to execute the following snippet:</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="n">my_global_variable</span> <span class="o">=</span> <span class="s1">'some value'</span>
</span></span></code></pre></div><p>And similarly for the following global function declaration:</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="kr">function</span> <span class="nf">my_global_function</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="c1">-- Do something amazing</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span></code></pre></div><p>You'll also get a similar error when your script attempts to access any global variables that are undefined in the runtime's context:</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="c1">-- The following will surely raise an error</span>
</span></span><span class="line"><span class="cl"><span class="kr">return</span> <span class="n">an_undefined_global_variable</span>
</span></span></code></pre></div><p>Instead, all variable and function definitions are required to be declared as local.
To do so, you'll need to prepend the <a href="https://www.lua.org/manual/5.1/manual.html#2.4.7"><em>local</em></a> keyword to your declarations.
For example, the following snippet will be considered perfectly valid by Redis:</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">my_local_variable</span> <span class="o">=</span> <span class="s1">'some value'</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="kr">function</span> <span class="nf">my_local_function</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="c1">-- Do something else, but equally amazing</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span></code></pre></div><p><strong>Note:</strong>
the sandbox attempts to prevent the use of globals.
Using Lua's debugging functionality or other approaches such as altering the meta table used for implementing the globals' protection to circumvent the sandbox isn't hard.
However, it is difficult to circumvent the protection by accident.
If the user messes with the Lua global state, the consistency of AOF and replication can't be guaranteed.
In other words, just don't do it.</p>
<h3 id="imported-lua-modules">Imported Lua modules</h3>
<p>Using imported Lua modules is not supported inside the sandboxed execution context.
The sandboxed execution context prevents the loading modules by disabling Lua's <a href="https://www.lua.org/pil/8.1.html"><code>require</code> function</a>.</p>
<p>The only libraries that Redis ships with and that you can use in scripts are listed under the <a href="#runtime-libraries">Runtime libraries</a> section.</p>
<a class="dashAnchor" name="//apple_ref/Section/Runtime%20globals"></a><h2 id="runtime-globals">Runtime globals</h2>
<p>While the sandbox prevents users from declaring globals, the execution context is pre-populated with several of these.</p>
<h3 id="the-_redis_-singleton">The <em>redis</em> singleton</h3>
<p>The <em>redis</em> singleton is an object instance that's accessible from all scripts.
It provides the API to interact with Redis from scripts.
Its description follows <a href="#redis_object">below</a>.</p>
<h3 id="a-namethe-keys-global-variableathe-_keys_-global-variable"><a name="the-keys-global-variable"></a>The <em>KEYS</em> global variable</h3>
<ul>
<li>Since version: 2.6.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: no</li>
</ul>
<p><strong>Important:</strong>
to ensure the correct execution of scripts, both in standalone and clustered deployments, all names of keys that a function accesses must be explicitly provided as input key arguments.
The script <strong>should only</strong> access keys whose names are given as input arguments.
Scripts <strong>should never</strong> access keys with programmatically-generated names or based on the contents of data structures stored in the database.</p>
<p>The <em>KEYS</em> global variable is available only for <a href="./eval-intro.html">ephemeral scripts</a>.
It is pre-populated with all key name input arguments.</p>
<h3 id="a-namethe-argv-global-variableathe-_argv_-global-variable"><a name="the-argv-global-variable"></a>The <em>ARGV</em> global variable</h3>
<ul>
<li>Since version: 2.6.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: no</li>
</ul>
<p>The <em>ARGV</em> global variable is available only in <a href="./eval-intro.html">ephemeral scripts</a>.
It is pre-populated with all regular input arguments.</p>
<a class="dashAnchor" name="//apple_ref/Section/redis%20object"></a><h2 id="a-nameredis_objecta_redis_-object"><a name="redis_object"></a><em>redis</em> object</h2>
<ul>
<li>Since version: 2.6.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>The Redis Lua execution context always provides a singleton instance of an object named <em>redis</em>.
The <em>redis</em> instance enables the script to interact with the Redis server that's running it.
Following is the API provided by the <em>redis</em> object instance.</p>
<h3 id="a-namerediscalla-rediscallcommand-arg"><a name="redis.call"></a> <code>redis.call(command [,arg...])</code></h3>
<ul>
<li>Since version: 2.6.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>The <code>redis.call()</code> function calls a given Redis command and returns its reply.
Its inputs are the command and arguments, and once called, it executes the command in Redis and returns the reply.</p>
<p>For example, we can call the <a href="../../../commands/echo.html"><code>ECHO</code></a> command from a script and return its reply like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="kr">return</span> <span class="n">redis.call</span><span class="p">(</span><span class="s1">'ECHO'</span><span class="p">,</span> <span class="s1">'Echo, echo... eco... o...'</span><span class="p">)</span>
</span></span></code></pre></div><p>If and when <code>redis.call()</code> triggers a runtime exception, the raw exception is raised back to the user as an error, automatically.
Therefore, attempting to execute the following ephemeral script will fail and generate a runtime exception because <a href="../../../commands/echo.html"><code>ECHO</code></a> accepts exactly zero or one argument:</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="n">redis</span><span class="o">&gt;</span> <span class="n">EVAL</span> <span class="s2">"return redis.call('ECHO', 'Echo,', 'echo... ', 'eco... ', 'o...')"</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="n">ERR</span> <span class="n">Error</span> <span class="n">running</span> <span class="n">script</span> <span class="p">(</span><span class="n">call</span> <span class="n">to</span> <span class="n">b0345693f4b77517a711221050e76d24ae60b7f7</span><span class="p">):</span> <span class="err">@</span><span class="n">user_script</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span> <span class="err">@</span><span class="n">user_script</span><span class="p">:</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Wrong</span> <span class="n">number</span> <span class="n">of</span> <span class="n">args</span> <span class="n">calling</span> <span class="n">Redis</span> <span class="n">command</span> <span class="n">from</span> <span class="n">script</span>
</span></span></code></pre></div><p>Note that the call can fail due to various reasons, see <a href="./eval-intro.html#execution-under-low-memory-conditions">Execution under low memory conditions</a> and <a href="#script_flags">Script flags</a></p>
<p>To handle Redis runtime errors use `redis.pcall() instead.</p>
<h3 id="a-nameredispcalla-redispcallcommand-arg"><a name="redis.pcall"></a> <code>redis.pcall(command [,arg...])</code></h3>
<ul>
<li>Since version: 2.6.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>This function enables handling runtime errors raised by the Redis server.
The <code>redis.pcall()</code> function  behaves exactly like <a href="#redis.call"><code>redis.call()</code></a>, except that it:</p>
<ul>
<li>Always returns a reply.</li>
<li>Never throws a runtime exception, and returns in its stead a <a href="#redis.error_reply"><code>redis.error_reply</code></a> in case that a runtime exception is thrown by the server.</li>
</ul>
<p>The following demonstrates how to use <code>redis.pcall()</code> to intercept and handle runtime exceptions from within the context of an ephemeral script.</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">reply</span> <span class="o">=</span> <span class="n">redis.pcall</span><span class="p">(</span><span class="s1">'ECHO'</span><span class="p">,</span> <span class="n">unpack</span><span class="p">(</span><span class="n">ARGV</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="n">reply</span><span class="p">[</span><span class="s1">'err'</span><span class="p">]</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">  <span class="c1">-- Handle the error sometime, but for now just log it</span>
</span></span><span class="line"><span class="cl">  <span class="n">redis.log</span><span class="p">(</span><span class="n">redis.LOG_WARNING</span><span class="p">,</span> <span class="n">reply</span><span class="p">[</span><span class="s1">'err'</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="n">reply</span><span class="p">[</span><span class="s1">'err'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'ERR Something is wrong, but no worries, everything is under control'</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl"><span class="kr">return</span> <span class="n">reply</span>
</span></span></code></pre></div><p>Evaluating this script with more than one argument will return:</p>
<pre tabindex="0"><code>redis&gt; EVAL "..." 0 hello world
(error) ERR Something is wrong, but no worries, everything is under control
</code></pre><h3 id="a-namerediserror_replya-rediserror_replyx"><a name="redis.error_reply"></a> <code>redis.error_reply(x)</code></h3>
<ul>
<li>Since version: 2.6.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>This is a helper function that returns an <a href="../../reference/protocol-spec.html#resp-errors">error reply</a>.
The helper accepts a single string argument and returns a Lua table with the <em>err</em> field set to that string.</p>
<p>The outcome of the following code is that <em>error1</em> and <em>error2</em> are identical for all intents and purposes:</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'ERR My very special error'</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">reply1</span> <span class="o">=</span> <span class="p">{</span> <span class="n">err</span> <span class="o">=</span> <span class="n">text</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">reply2</span> <span class="o">=</span> <span class="n">redis.error_reply</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></div><p>Therefore, both forms are valid as means for returning an error reply from scripts:</p>
<pre tabindex="0"><code>redis&gt; EVAL "return { err = 'ERR My very special table error' }" 0
(error) ERR My very special table error
redis&gt; EVAL "return redis.error_reply('ERR My very special reply error')" 0
(error) ERR My very special reply error
</code></pre><p>For returning Redis status replies refer to <a href="#redis.status_reply"><code>redis.status_reply()</code></a>.
Refer to the <a href="#data-type-conversion">Data type conversion</a> for returning other response types.</p>
<p><strong>Note:</strong>
By convention, Redis uses the first word of an error string as a unique error code for specific errors or <code>ERR</code> for general-purpose errors.
Scripts are advised to follow this convention, as shown in the example above, but this is not mandatory.</p>
<h3 id="a-nameredisstatus_replya-redisstatus_replyx"><a name="redis.status_reply"></a> <code>redis.status_reply(x)</code></h3>
<ul>
<li>Since version: 2.6.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>This is a helper function that returns a <a href="../../reference/protocol-spec.html#resp-simple-strings">simple string reply</a>.
"OK" is an example of a standard Redis status reply.
The Lua API represents status replies as tables with a single field, <em>ok</em>, set with a simple status string.</p>
<p>The outcome of the following code is that <em>status1</em> and <em>status2</em> are identical for all intents and purposes:</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Frosty'</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">status1</span> <span class="o">=</span> <span class="p">{</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">text</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">status2</span> <span class="o">=</span> <span class="n">redis.status_reply</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></div><p>Therefore, both forms are valid as means for returning status replies from scripts:</p>
<pre tabindex="0"><code>redis&gt; EVAL "return { ok = 'TICK' }" 0
TICK
redis&gt; EVAL "return redis.status_reply('TOCK')" 0
TOCK
</code></pre><p>For returning Redis error replies refer to <a href="#redis.error_reply"><code>redis.error_reply()</code></a>.
Refer to the <a href="#data-type-conversion">Data type conversion</a> for returning other response types.</p>
<h3 id="a-nameredissha1hexa-redissha1hexx"><a name="redis.sha1hex"></a> <code>redis.sha1hex(x)</code></h3>
<ul>
<li>Since version: 2.6.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>This function returns the SHA1 hexadecimal digest of its single string argument.</p>
<p>You can, for example, obtain the empty string's SHA1 digest:</p>
<pre tabindex="0"><code>redis&gt; EVAL "return redis.sha1hex('')" 0
"da39a3ee5e6b4b0d3255bfef95601890afd80709"
</code></pre><h3 id="a-nameredisloga-redisloglevel-message"><a name="redis.log"></a> <code>redis.log(level, message)</code></h3>
<ul>
<li>Since version: 2.6.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>This function writes to the Redis server log.</p>
<p>It expects two input arguments: the log level and a message.
The message is a string to write to the log file.
Log level can be on of these:</p>
<ul>
<li><code>redis.LOG_DEBUG</code></li>
<li><code>redis.LOG_VERBOSE</code></li>
<li><code>redis.LOG_NOTICE</code></li>
<li><code>redis.LOG_WARNING</code></li>
</ul>
<p>These levels map to the server's log levels.
The log only records messages equal or greater in level than the server's <code>loglevel</code> configuration directive.</p>
<p>The following snippet:</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="n">redis.log</span><span class="p">(</span><span class="n">redis.LOG_WARNING</span><span class="p">,</span> <span class="s1">'Something is terribly wrong'</span><span class="p">)</span>
</span></span></code></pre></div><p>will produce a line similar to the following in your server's log:</p>
<pre tabindex="0"><code>[32343] 22 Mar 15:21:39 # Something is terribly wrong
</code></pre><h3 id="a-nameredissetrespa-redissetrespx"><a name="redis.setresp"></a> <code>redis.setresp(x)</code></h3>
<ul>
<li>Since version: 6.0.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>This function allows the executing script to switch between <a href="../../reference/protocol-spec.html">Redis Serialization Protocol (RESP)</a> versions for the replies returned by <a href="#redis.call"><code>redis.call()</code></a> and <a href="#redis.pcall"><code>redis.pcall()</code></a>.
It expects a single numerical argument as the protocol's version.
The default protocol version is <em>2</em>, but it can be switched to version <em>3</em>.</p>
<p>Here's an example of switching to RESP3 replies:</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="n">redis.setresp</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></div><p>Please refer to the <a href="#data-type-conversion">Data type conversion</a> for more information about type conversions.</p>
<h3 id="a-nameredisset_repla-redisset_replx"><a name="redis.set_repl"></a> <code>redis.set_repl(x)</code></h3>
<ul>
<li>Since version: 3.2.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: no</li>
</ul>
<p><strong>Note:</strong>
this feature is only available when script effects replication is employed.
Calling it when using verbatim script replication will result in an error.
As of Redis version 2.6.0, scripts were replicated verbatim, meaning that the scripts' source code was sent for execution by replicas and stored in the AOF.
An alternative replication mode added in version 3.2.0 allows replicating only the scripts' effects.
As of Redis version 7.0, script replication is no longer supported, and the only replication mode available is script effects replication.</p>
<p><strong>Warning:</strong>
this is an advanced feature. Misuse can cause damage by violating the contract that binds the Redis master, its replicas, and AOF contents to hold the same logical content.</p>
<p>This function allows a script to assert control over how its effects are propagated to replicas and the AOF afterward.
A script's effects are the Redis write commands that it calls.</p>
<p>By default, all write commands that a script executes are replicated.
Sometimes, however, better control over this behavior can be helpful.
This can be the case, for example, when storing intermediate values in the master alone.</p>
<p>Consider a script that intersects two sets and stores the result in a temporary key with <a href="../../../commands/sunionstore.html"><code>SUNIONSTORE</code></a>.
It then picks five random elements (<a href="../../../commands/srandmember.html"><code>SRANDMEMBER</code></a>) from the intersection and stores (<a href="../../../commands/sadd.html"><code>SADD</code></a>) them in another set.
Finally, before returning, it deletes the temporary key that stores the intersection of the two source sets.</p>
<p>In this case, only the new set with its five randomly-chosen elements needs to be replicated.
Replicating the <a href="../../../commands/sunionstore.html"><code>SUNIONSTORE</code></a> command and the `DEL'ition of the temporary key is unnecessary and wasteful.</p>
<p>The <code>redis.set_repl()</code> function instructs the server how to treat subsequent write commands in terms of replication.
It accepts a single input argument that only be one of the following:</p>
<ul>
<li><code>redis.REPL_ALL</code>: replicates the effects to the AOF and replicas.</li>
<li><code>redis.REPL_AOF</code>: replicates the effects to the AOF alone.</li>
<li><code>redis.REPL_REPLICA</code>: replicates the effects to the replicas alone.</li>
<li><code>redis.REPL_SLAVE</code>: same as <code>REPL_REPLICA</code>, maintained for backward compatibility.</li>
<li><code>redis.REPL_NONE</code>: disables effect replication entirely.</li>
</ul>
<p>By default, the scripting engine is initialized to the <code>redis.REPL_ALL</code> setting when a script begins its execution.
You can call the <code>redis.set_repl()</code> function at any time during the script's execution to switch between the different replication modes.</p>
<p>A simple example follows:</p>
<div class="highlight"><pre class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="n">redis.replicate_commands</span><span class="p">()</span> <span class="c1">-- Enable effects replication in versions lower than Redis v7.0</span>
</span></span><span class="line"><span class="cl"><span class="n">redis.call</span><span class="p">(</span><span class="s1">'SET'</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">redis.set_repl</span><span class="p">(</span><span class="n">redis.REPL_NONE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">redis.call</span><span class="p">(</span><span class="s1">'SET'</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">redis.set_repl</span><span class="p">(</span><span class="n">redis.REPL_ALL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">redis.call</span><span class="p">(</span><span class="s1">'SET'</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ARGV</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span></span></code></pre></div><p>If you run this script by calling <code>EVAL "..." 3 A B C 1 2 3</code>, the result will be that only the keys <em>A</em> and <em>C</em> are created on the replicas and AOF.</p>
<h3 id="a-nameredisreplicate_commandsa-redisreplicate_commands"><a name="redis.replicate_commands"></a> <code>redis.replicate_commands()</code></h3>
<ul>
<li>Since version: 3.2.0</li>
<li>Until version: 7.0.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: no</li>
</ul>
<p>This function switches the script's replication mode from verbatim replication to effects replication.
You can use it to override the default verbatim script replication mode used by Redis until version 7.0.</p>
<p><strong>Note:</strong>
as of Redis v7.0, verbatim script replication is no longer supported.
The default, and only script replication mode supported, is script effects' replication.
For more information, please refer to <a href="./eval-intro.html#replicating-commands-instead-of-scripts"><code>Replicating commands instead of scripts</code></a></p>
<h3 id="a-nameredisbreakpointa--redisbreakpoint"><a name="redis.breakpoint"></a>  <code>redis.breakpoint()</code></h3>
<ul>
<li>Since version: 3.2.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: no</li>
</ul>
<p>This function triggers a breakpoint when using the Redis Lua debugger](/topics/ldb).</p>
<h3 id="a-nameredisdebuga-redisdebugx"><a name="redis.debug"></a> <code>redis.debug(x)</code></h3>
<ul>
<li>Since version: 3.2.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: no</li>
</ul>
<p>This function prints its argument in the <a href="./lua-debugging.html">Redis Lua debugger</a> console.</p>
<h3 id="a-nameredisacl_check_cmda-redisacl_check_cmdcommand-arg"><a name="redis.acl_check_cmd"></a> <code>redis.acl_check_cmd(command [,arg...])</code></h3>
<ul>
<li>Since version: 7.0.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>This function is used for checking if the current user running the script has <a href="../../management/security/acl.html">ACL</a> permissions to execute the given command with the given arguments.</p>
<p>The return value is a boolean <code>true</code> in case the current user has permissions to execute the command (via a call to <a href="#redis.call">redis.call</a> or <a href="#redis.pcall">redis.pcall</a>) or <code>false</code> in case they don't.</p>
<p>The function will raise an error if the passed command or its arguments are invalid.</p>
<h3 id="a-nameredisregister_functiona-redisregister_function"><a name="redis.register_function"></a> <code>redis.register_function</code></h3>
<ul>
<li>Since version: 7.0.0</li>
<li>Available in scripts: no</li>
<li>Available in functions: yes</li>
</ul>
<p>This function is only available from the context of the <a href="../../../commands/function-load.html"><code>FUNCTION LOAD</code></a> command.
When called, it registers a function to the loaded library.
The function can be called either with positional or named arguments.</p>
<h4 id="a-nameredisregister_function_pos_argsa-positional-arguments-redisregister_functionname-callback"><a name="redis.register_function_pos_args"></a> positional arguments: <code>redis.register_function(name, callback)</code></h4>
<p>The first argument to <code>redis.register_function</code> is a Lua string representing the function name.
The second argument to <code>redis.register_function</code> is a Lua function.</p>
<p>Usage example:</p>
<pre tabindex="0"><code>redis&gt; FUNCTION LOAD "#!lua name=mylib\n redis.register_function('noop', function() end)"
</code></pre><h4 id="a-nameredisregister_function_named_argsa-named-arguments--redisregister_functionfunction_namename-callbackcallback-flagsflag1-flag2--descriptiondescription"><a name="redis.register_function_named_args"></a> Named arguments:  <code>redis.register_function{function_name=name, callback=callback, flags={flag1, flag2, ..}, description=description}</code></h4>
<p>The named arguments variant accepts the following arguments:</p>
<ul>
<li><em>function_name</em>: the function's name.</li>
<li><em>callback</em>: the function's callback.</li>
<li><em>flags</em>: an array of strings, each a function flag (optional).</li>
<li><em>description</em>: function's description (optional).</li>
</ul>
<p>Both <em>function_name</em> and <em>callback</em> are mandatory.</p>
<p>Usage example:</p>
<pre tabindex="0"><code>redis&gt; FUNCTION LOAD "#!lua name=mylib\n redis.register_function{function_name='noop', callback=function() end, flags={ 'no-writes' }, description='Does nothing'}"
</code></pre><h4 id="a-namescript_flagsa-script-flags"><a name="script_flags"></a> Script flags</h4>
<p><strong>Important:</strong>
Use script flags with care, which may negatively impact if misused.
Note that the default for Eval scripts are different than the default for functions that are mentioned below, see <a href="./eval-intro.html#eval-flags">Eval Flags</a></p>
<p>When you register a function or load an Eval script, the server does not know how it accesses the database.
By default, Redis assumes that all scripts read and write data.
This results in the following behavior:</p>
<ol>
<li>They can read and write data.</li>
<li>They can run in cluster mode, and are not able to run commands accessing keys of different hash slots.</li>
<li>Execution against a stale replica is denied to avoid inconsistent reads.</li>
<li>Execution under low memory is denied to avoid exceeding the configured threshold.</li>
</ol>
<p>You can use the following flags and instruct the server to treat the scripts' execution differently:</p>
<ul>
<li>
<p><code>no-writes</code>: this flag indicates that the script only reads data but never writes.</p>
<p>By default, Redis will deny the execution of flagged scripts (Functions and Eval scripts with <a href="./eval-intro.html#eval-flags">shebang</a>) against read-only replicas, as they may attempt to perform writes.
Similarly, the server will not allow calling scripts with <a href="../../../commands/fcall_ro.html"><code>FCALL_RO</code></a> / <a href="../../../commands/eval_ro.html"><code>EVAL_RO</code></a>.
Lastly, when data persistence is at risk due to a disk error, execution is blocked as well.</p>
<p>Using this flag allows executing the script:</p>
<ol>
<li>With <a href="../../../commands/fcall_ro.html"><code>FCALL_RO</code></a> / <a href="../../../commands/eval_ro.html"><code>EVAL_RO</code></a></li>
<li>On read-only replicas.</li>
<li>Even if there's a disk error (Redis is unable to persist so it rejects writes).</li>
<li>When over the memory limit since it implies the script doesn't increase memory consumption (see <code>allow-oom</code> below)</li>
</ol>
<p>However, note that the server will return an error if the script attempts to call a write command.
Also note that currently <a href="../../../commands/publish.html"><code>PUBLISH</code></a>, <a href="../../../commands/spublish.html"><code>SPUBLISH</code></a> and <a href="../../../commands/pfcount.html"><code>PFCOUNT</code></a> are also considered write commands in scripts, because they could attempt to propagate commands to replicas and AOF file.</p>
<p>For more information please refer to <a href="../programmability.html#read-only_scripts">Read-only scripts</a></p>
</li>
<li>
<p><code>allow-oom</code>: use this flag to allow a script to execute when the server is out of memory (OOM).</p>
<p>Unless used, Redis will deny the execution of flagged scripts (Functions and Eval scripts with <a href="./eval-intro.html#eval-flags">shebang</a>) when in an OOM state.
Furthermore, when you use this flag, the script can call any Redis command, including commands that aren't usually allowed in this state.
Specifying <code>no-writes</code> or using <a href="../../../commands/fcall_ro.html"><code>FCALL_RO</code></a> / <a href="../../../commands/eval_ro.html"><code>EVAL_RO</code></a> also implies the script can run in OOM state (without specifying <code>allow-oom</code>)</p>
</li>
<li>
<p><code>allow-stale</code>: a flag that enables running the flagged scripts (Functions and Eval scripts with <a href="./eval-intro.html#eval-flags">shebang</a>) against a stale replica when the <code>replica-serve-stale-data</code> config is set to <code>no</code> .</p>
<p>Redis can be set to prevent data consistency problems from using old data by having stale replicas return a runtime error.
For scripts that do not access the data, this flag can be set to allow stale Redis replicas to run the script.
Note however that the script will still be unable to execute any command that accesses stale data.</p>
</li>
<li>
<p><code>no-cluster</code>: the flag causes the script to return an error in Redis cluster mode.</p>
<p>Redis allows scripts to be executed both in standalone and cluster modes.
Setting this flag prevents executing the script against nodes in the cluster.</p>
</li>
<li>
<p><code>allow-cross-slot-keys</code>: The flag that allows a script to access keys from multiple slots.</p>
<p>Redis typically prevents any single command from accessing keys that hash to multiple slots.
This flag allows scripts to break this rule and access keys within the script that access multiple slots.
Declared keys to the script are still always required to hash to a single slot.
Accessing keys from multiple slots is discouraged as applications should be designed to only access keys from a single slot at a time, allowing slots to move between Redis servers.</p>
<p>This flag has no effect when cluster mode is disabled.</p>
</li>
</ul>
<p>Please refer to <a href="./functions-intro.html#function-flags">Function Flags</a> and <a href="./eval-intro.html#eval-flags">Eval Flags</a> for a detailed example.</p>
<h3 id="a-nameredisredis_versiona-redisredis_version"><a name="redis.redis_version"></a> <code>redis.REDIS_VERSION</code></h3>
<ul>
<li>Since version: 7.0.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>Returns the current Redis server version as a Lua string.
The reply's format is <code>MM.mm.PP</code>, where:</p>
<ul>
<li><strong>MM:</strong> is the major version.</li>
<li><strong>mm:</strong> is the minor version.</li>
<li><strong>PP:</strong> is the patch level.</li>
</ul>
<h3 id="a-nameredisredis_version_numa-redisredis_version_num"><a name="redis.redis_version_num"></a> <code>redis.REDIS_VERSION_NUM</code></h3>
<ul>
<li>Since version: 7.0.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>Returns the current Redis server version as a number.
The reply is a hexadecimal value structured as <code>0x00MMmmPP</code>, where:</p>
<ul>
<li><strong>MM:</strong> is the major version.</li>
<li><strong>mm:</strong> is the minor version.</li>
<li><strong>PP:</strong> is the patch level.</li>
</ul>
<a class="dashAnchor" name="//apple_ref/Section/Data%20type%20conversion"></a><h2 id="data-type-conversion">Data type conversion</h2>
<p>Unless a runtime exception is raised, <code>redis.call()</code> and <code>redis.pcall()</code> return the reply from the executed command to the Lua script.
Redis' replies from these functions are converted automatically into Lua's native data types.</p>
<p>Similarly, when a Lua script returns a reply with the <code>return</code> keyword,
that reply is automatically converted to Redis' protocol.</p>
<p>Put differently; there's a one-to-one mapping between Redis' replies and Lua's data types and a one-to-one mapping between Lua's data types and the <a href="../../reference/protocol-spec.html">Redis Protocol</a> data types.
The underlying design is such that if a Redis type is converted into a Lua type and converted back into a Redis type, the result is the same as the initial value.</p>
<p>Type conversion from Redis protocol replies (i.e., the replies from <code>redis.call()</code> and <code>redis.pcall()</code> to Lua data types depends on the Redis Serialization Protocol version used by the script.
The default protocol version during script executions is RESP2.
The script may switch the replies' protocol versions by calling the <code>redis.setresp()</code> function.</p>
<p>Type conversion from a script's returned Lua data type depends on the user's choice of protocol (see the <a href="../../../commands/hello.html"><code>HELLO</code></a> command).</p>
<p>The following sections describe the type conversion rules between Lua and Redis per the protocol's version.</p>
<h3 id="resp2-to-lua-type-conversion">RESP2 to Lua type conversion</h3>
<p>The following type conversion rules apply to the execution's context by default as well as after calling <code>redis.setresp(2)</code>:</p>
<ul>
<li><a href="../../reference/protocol-spec.html#resp-integers">RESP2 integer reply</a> -&gt; Lua number</li>
<li><a href="../../reference/protocol-spec.html#resp-bulk-strings">RESP2 bulk string reply</a> -&gt; Lua string</li>
<li><a href="../../reference/protocol-spec.html#resp-arrays">RESP2 array reply</a> -&gt; Lua table (may have other Redis data types nested)</li>
<li><a href="../../reference/protocol-spec.html#resp-simple-strings">RESP2 status reply</a> -&gt; Lua table with a single <em>ok</em> field containing the status string</li>
<li><a href="../../reference/protocol-spec.html#resp-errors">RESP2 error reply</a> -&gt; Lua table with a single <em>err</em> field containing the error string</li>
<li><a href="../../reference/protocol-spec.html#null-elements-in-arrays">RESP2 null bulk reply</a> and <a href="../../reference/protocol-spec.html#resp-arrays">null multi bulk reply</a> -&gt; Lua false boolean type</li>
</ul>
<a class="dashAnchor" name="//apple_ref/Section/Lua%20to%20RESP2%20type%20conversion"></a><h2 id="lua-to-resp2-type-conversion">Lua to RESP2 type conversion</h2>
<p>The following type conversion rules apply by default as well as after the user had called <code>HELLO 2</code>:</p>
<ul>
<li>Lua number -&gt; <a href="../../reference/protocol-spec.html#resp-integers">RESP2 integer reply</a> (the number is converted into an integer)</li>
<li>Lua string -&gt; <a href="../../reference/protocol-spec.html#resp-bulk-strings">RESP bulk string reply</a></li>
<li>Lua table (indexed, non-associative array) -&gt; <a href="../../reference/protocol-spec.html#resp-arrays">RESP2 array reply</a> (truncated at the first Lua <code>nil</code> value encountered in the table, if any)</li>
<li>Lua table with a single <em>ok</em> field -&gt; <a href="../../reference/protocol-spec.html#resp-simple-strings">RESP2 status reply</a></li>
<li>Lua table with a single <em>err</em> field -&gt; <a href="../../reference/protocol-spec.html#resp-errors">RESP2 error reply</a></li>
<li>Lua boolean false -&gt; <a href="../../reference/protocol-spec.html#null-elements-in-arrays">RESP2 null bulk reply</a></li>
</ul>
<p>There is an additional Lua-to-Redis conversion rule that has no corresponding Redis-to-Lua conversion rule:</p>
<ul>
<li>Lua Boolean <code>true</code> -&gt; <a href="../../reference/protocol-spec.html#resp-integers">RESP2 integer reply</a> with value of 1.</li>
</ul>
<p>There are three additional rules to note about converting Lua to Redis data types:</p>
<ul>
<li>Lua has a single numerical type, Lua numbers.
There is no distinction between integers and floats.
So we always convert Lua numbers into integer replies, removing the decimal part of the number, if any.
<strong>If you want to return a Lua float, it should be returned as a string</strong>,
exactly like Redis itself does (see, for instance, the <a href="../../../commands/zscore.html"><code>ZSCORE</code></a> command).</li>
<li>There's <a href="http://www.lua.org/pil/19.1.html">no simple way to have nils inside Lua arrays</a> due
to Lua's table semantics.
Therefore, when Redis converts a Lua array to RESP, the conversion stops when it encounters a Lua <code>nil</code> value.</li>
<li>When a Lua table is an associative array that contains keys and their respective values, the converted Redis reply will <strong>not</strong> include them.</li>
</ul>
<p>Lua to RESP2 type conversion examples:</p>
<pre tabindex="0"><code>redis&gt; EVAL "return 10" 0
(integer) 10

redis&gt; EVAL "return { 1, 2, { 3, 'Hello World!' } }" 0
1) (integer) 1
2) (integer) 2
3) 1) (integer) 3
   1) "Hello World!"

redis&gt; EVAL "return redis.call('get','foo')" 0
"bar"
</code></pre><p>The last example demonstrates receiving and returning the exact return value of <code>redis.call()</code> (or <code>redis.pcall()</code>) in Lua as it would be returned if the command had been called directly.</p>
<p>The following example shows how floats and arrays that cont nils and keys are handled:</p>
<pre tabindex="0"><code>redis&gt; EVAL "return { 1, 2, 3.3333, somekey = 'somevalue', 'foo', nil , 'bar' }" 0
1) (integer) 1
2) (integer) 2
3) (integer) 3
4) "foo"
</code></pre><p>As you can see, the float value of <em>3.333</em> gets converted to an integer <em>3</em>, the <em>somekey</em> key and its value are omitted, and the string "bar" isn't returned as there is a <code>nil</code> value that precedes it.</p>
<h3 id="resp3-to-lua-type-conversion">RESP3 to Lua type conversion</h3>
<p><a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md">RESP3</a> is a newer version of the <a href="../../reference/protocol-spec.html">Redis Serialization Protocol</a>.
It is available as an opt-in choice as of Redis v6.0.</p>
<p>An executing script may call the <a href="#redis.setresp"><code>redis.setresp</code></a> function during its execution and switch the protocol version that's used for returning replies from Redis' commands (that can be invoked via <a href="#redis.call"><code>redis.call()</code></a> or <a href="#redis.pcall"><code>redis.pcall()</code></a>).</p>
<p>Once Redis' replies are in RESP3 protocol, all of the <a href="#resp2-to-lua-type-conversion">RESP2 to Lua conversion</a> rules apply, with the following additions:</p>
<ul>
<li><a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#map-type">RESP3 map reply</a> -&gt; Lua table with a single <em>map</em> field containing a Lua table representing the fields and values of the map.</li>
<li><a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#set-reply">RESP set reply</a> -&gt; Lua table with a single <em>set</em> field containing a Lua table representing the elements of the set as fields, each with the Lua Boolean value of <code>true</code>.</li>
<li><a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#null-reply">RESP3 null</a> -&gt; Lua <code>nil</code>.</li>
<li><a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#boolean-reply">RESP3 true reply</a> -&gt; Lua true boolean value.</li>
<li><a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#boolean-reply">RESP3 false reply</a> -&gt; Lua false boolean value.</li>
<li><a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#double-type">RESP3 double reply</a> -&gt; Lua table with a single <em>double</em> field containing a Lua number representing the double value.</li>
<li><a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#big-number-type">RESP3 big number reply</a> -&gt; Lua table with a single <em>big_number</em> field containing a Lua string representing the big number value.</li>
<li><a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#verbatim-string-type">Redis verbatim string reply</a> -&gt; Lua table with a single <em>verbatim_string</em> field containing a Lua table with two fields, <em>string</em> and <em>format</em>, representing the verbatim string and its format, respectively.</li>
</ul>
<p><strong>Note:</strong>
the RESP3 <a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#big-number-type">big number</a> and <a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#verbatim-string-type">verbatim strings</a> replies are only supported as of Redis v7.0 and greater.
Also, presently, RESP3's <a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#attribute-type">attributes</a>, <a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#streamed-strings">streamed strings</a> and <a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#streamed-aggregate-data-types">streamed aggregate data types</a> are not supported by the Redis Lua API.</p>
<h3 id="lua-to-resp3-type-conversion">Lua to RESP3 type conversion</h3>
<p>Regardless of the script's choice of protocol version set for replies with the [<code>redis.setresp()</code> function] when it calls <code>redis.call()</code> or <code>redis.pcall()</code>, the user may opt-in to using RESP3 (with the <code>HELLO 3</code> command) for the connection.
Although the default protocol for incoming client connections is RESP2, the script should honor the user's preference and return adequately-typed RESP3 replies, so the following rules apply on top of those specified in the <a href="#lua-to-resp2-type-conversion">Lua to RESP2 type conversion</a> section when that is the case.</p>
<ul>
<li>Lua Boolean -&gt; <a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#boolean-reply">RESP3 Boolean reply</a> (note that this is a change compared to the RESP2, in which returning a Boolean Lua <code>true</code> returned the number 1 to the Redis client, and returning a <code>false</code> used to return a <code>null</code>.</li>
<li>Lua table with a single <em>map</em> field set to an associative Lua table -&gt; <a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#map-type">RESP3 map reply</a>.</li>
<li>Lua table with a single <em>set</em> field set to an associative Lua table -&gt; <a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#set-type">RESP3 set reply</a>. Values can be set to anything and are discarded anyway.</li>
<li>Lua table with a single <em>double</em> field to an associative Lua table -&gt; <a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#double-type">RESP3 double reply</a>.</li>
<li>Lua nil -&gt; <a href="https://github.com/redis/redis-specifications/blob/master/protocol/RESP3.md#null-reply">RESP3 null</a>.</li>
</ul>
<p>However, if the connection is set use the RESP2 protocol, and even if the script replies with RESP3-typed responses, Redis will automatically perform a RESP3 to RESP2 conversion of the reply as is the case for regular commands.
That means, for example, that returning the RESP3 map type to a RESP2 connection will result in the repy being converted to a flat RESP2 array that consists of alternating field names and their values, rather than a RESP3 map.</p>
<a class="dashAnchor" name="//apple_ref/Section/Additional%20notes%20about%20scripting"></a><h2 id="additional-notes-about-scripting">Additional notes about scripting</h2>
<h3 id="using-selectcommandsselect-inside-scripts">Using <a href="../../../commands/select.html"><code>SELECT</code></a> inside scripts</h3>
<p>You can call the <a href="../../../commands/select.html"><code>SELECT</code></a> command from your Lua scripts, like you can with any normal client connection.
However, one subtle aspect of the behavior changed between Redis versions 2.8.11 and 2.8.12.
Prior to Redis version 2.8.12, the database selected by the Lua script was <em>set as the current database</em> for the client connection that had called it.
As of Redis version 2.8.12, the database selected by the Lua script only affects the execution context of the script, and does not modify the database that's selected by the client calling the script.
This semantic change between patch level releases was required since the old behavior was inherently incompatible with Redis' replication and introduced bugs.</p>
<a class="dashAnchor" name="//apple_ref/Section/Runtime%20libraries"></a><h2 id="runtime-libraries">Runtime libraries</h2>
<p>The Redis Lua runtime context always comes with several pre-imported libraries.</p>
<p>The following <a href="https://www.lua.org/manual/5.1/manual.html#5">standard Lua libraries</a> are available to use:</p>
<ul>
<li>The <a href="https://www.lua.org/manual/5.1/manual.html#5.4"><em>String Manipulation (string)</em> library</a></li>
<li>The <a href="https://www.lua.org/manual/5.1/manual.html#5.5"><em>Table Manipulation (table)</em> library</a></li>
<li>The <a href="https://www.lua.org/manual/5.1/manual.html#5.6"><em>Mathematical Functions (math)</em> library</a></li>
</ul>
<p>In addition, the following external libraries are loaded and accessible to scripts:</p>
<ul>
<li>The <a href="#struct-library"><em>struct</em> library</a></li>
<li>The <a href="#cjson-library"><em>cjson</em> library</a></li>
<li>The <a href="#cmsgpack-library"><em>cmsgpack</em> library</a></li>
<li>The <a href="#bitop-library"><em>bitop</em> library</a></li>
</ul>
<h3 id="a-namestruct-librarya-_struct_-library"><a name="struct-library"></a> <em>struct</em> library</h3>
<ul>
<li>Since version: 2.6.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p><em>struct</em> is a library for packing and unpacking C-like structures in Lua.
It provides the following functions:</p>
<ul>
<li><a href="#struct.pack"><code>struct.pack()</code></a></li>
<li><a href="#struct.unpack"><code>struct.unpack()</code></a></li>
<li><a href="#struct.size"><code>struct.size()</code></a></li>
</ul>
<p>All of <em>struct</em>'s functions expect their first argument to be a <a href="#struct-formats">format string</a>.</p>
<h4 id="a-namestruct-formatsa-_struct_-formats"><a name="struct-formats"></a> <em>struct</em> formats</h4>
<p>The following are valid format strings for <em>struct</em>'s functions:</p>
<ul>
<li><code>&gt;</code>: big endian</li>
<li><code>&lt;</code>: little endian</li>
<li><code>![num]</code>: alignment</li>
<li><code>x</code>: padding</li>
<li><code>b/B</code>: signed/unsigned byte</li>
<li><code>h/H</code>: signed/unsigned short</li>
<li><code>l/L</code>: signed/unsigned long</li>
<li><code>T</code>: size_t</li>
<li><code>i/In</code>: signed/unsigned integer with size <em>n</em> (defaults to the size of int)</li>
<li><code>cn</code>: sequence of <em>n</em> chars (from/to a string); when packing, n == 0 means the
whole string; when unpacking, n == 0 means use the previously read number as
the string's length.</li>
<li><code>s</code>: zero-terminated string</li>
<li><code>f</code>: float</li>
<li><code>d</code>: double</li>
<li><code> </code> (space): ignored</li>
</ul>
<h4 id="a-namestructpacka-structpackx"><a name="struct.pack"></a> <code>struct.pack(x)</code></h4>
<p>This function returns a struct-encoded string from values.
It accepts a <a href="#struct-formats"><em>struct</em> format string</a> as its first argument, followed by the values that are to be encoded.</p>
<p>Usage example:</p>
<pre tabindex="0"><code>redis&gt; EVAL "return struct.pack('HH', 1, 2)" 0
"\x01\x00\x02\x00"
</code></pre><h4 id="a-namestructunpacka-structunpackx"><a name="struct.unpack"></a> <code>struct.unpack(x)</code></h4>
<p>This function returns the decoded values from a struct.
It accepts a <a href="#struct-formats"><em>struct</em> format string</a> as its first argument, followed by encoded struct's string.</p>
<p>Usage example:</p>
<pre tabindex="0"><code>redis&gt; EVAL "return { struct.unpack('HH', ARGV[1]) }" 0 "\x01\x00\x02\x00"
1) (integer) 1
2) (integer) 2
3) (integer) 5
</code></pre><h4 id="a-namestructsizea-structsizex"><a name="struct.size"></a> <code>struct.size(x)</code></h4>
<p>This function returns the size, in bytes, of a struct.
It accepts a <a href="#struct-formats"><em>struct</em> format string</a> as its only argument.</p>
<p>Usage example:</p>
<pre tabindex="0"><code>redis&gt; EVAL "return struct.size('HH')" 0
(integer) 4
</code></pre><h3 id="a-namecjson-librarya-_cjson_-library"><a name="cjson-library"></a> <em>cjson</em> library</h3>
<ul>
<li>Since version: 2.6.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>The <em>cjson</em> library provides fast <a href="https://json.org/">JSON</a> encoding and decoding from Lua.
It provides these functions.</p>
<h4 id="a-namecjsonencodea-cjsonencodex"><a name="cjson.encode()"></a> <code>cjson.encode(x)</code></h4>
<p>This function returns a JSON-encoded string for the Lua data type provided as its argument.</p>
<p>Usage example:</p>
<pre tabindex="0"><code>redis&gt; EVAL "return cjson.encode({ ['foo'] = 'bar' })" 0
"{\"foo\":\"bar\"}"
</code></pre><h4 id="a-namecjsondecodea-cjsondecodex"><a name="cjson.decode()"></a> <code>cjson.decode(x)</code></h4>
<p>This function returns a Lua data type from the JSON-encoded string provided as its argument.</p>
<p>Usage example:</p>
<pre tabindex="0"><code>redis&gt; EVAL "return cjson.decode(ARGV[1])['foo']" 0 '{"foo":"bar"}'
"bar"
</code></pre><h3 id="a-namecmsgpack-librarya-_cmsgpack_-library"><a name="cmsgpack-library"></a> <em>cmsgpack</em> library</h3>
<ul>
<li>Since version: 2.6.0</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>The <em>cmsgpack</em> library provides fast <a href="https://msgpack.org/index.html">MessagePack</a> encoding and decoding from Lua.
It provides these functions.</p>
<h4 id="a-namecmsgpackpacka-cmsgpackpackx"><a name="cmsgpack.pack()"></a> <code>cmsgpack.pack(x)</code></h4>
<p>This function returns the packed string encoding of the Lua data type it is given as an argument.</p>
<p>Usage example:</p>
<pre tabindex="0"><code>redis&gt; EVAL "return cmsgpack.pack({'foo', 'bar', 'baz'})" 0
"\x93\xa3foo\xa3bar\xa3baz"
</code></pre><h4 id="a-namecmsgpackunpacka-cmsgpackunpackx"><a name="cmsgpack.unpack()"></a> <code>cmsgpack.unpack(x)</code></h4>
<p>This function returns the unpacked values from decoding its input string argument.</p>
<p>Usage example:</p>
<pre tabindex="0"><code>redis&gt; EVAL "return cmsgpack.unpack(ARGV[1])" 0 "\x93\xa3foo\xa3bar\xa3baz"
1) "foo"
2) "bar"
3) "baz"
</code></pre><h3 id="a-namebitop-librarya-_bit_-library"><a name="bitop-library"></a> <em>bit</em> library</h3>
<ul>
<li>Since version: 2.8.18</li>
<li>Available in scripts: yes</li>
<li>Available in functions: yes</li>
</ul>
<p>The <em>bit</em> library provides bitwise operations on numbers.
Its documentation resides at <a href="http://bitop.luajit.org/api.html">Lua BitOp documentation</a>
It provides the following functions.</p>
<h4 id="a-namebittobita-bittobitx"><a name="bit.tobit()"></a> <code>bit.tobit(x)</code></h4>
<p>Normalizes a number to the numeric range for bit operations and returns it.</p>
<p>Usage example:</p>
<pre tabindex="0"><code>redis&gt; EVAL 'return bit.tobit(1)' 0
(integer) 1
</code></pre><h4 id="a-namebittohexa-bittohexx-n"><a name="bit.tohex()"></a> <code>bit.tohex(x [,n])</code></h4>
<p>Converts its first argument to a hex string. The number of hex digits is given by the absolute value of the optional second argument.</p>
<p>Usage example:</p>
<pre tabindex="0"><code>redis&gt; EVAL 'return bit.tohex(422342)' 0
"000671c6"
</code></pre><h4 id="a-namebitbnota-bitbnotx"><a name="bit.bnot()"></a> <code>bit.bnot(x)</code></h4>
<p>Returns the bitwise <strong>not</strong> of its argument.</p>
<h4 id="a-namebitopsa-bitbnotx-bitborx1-x2-bitbandx1-x2-and-bitbxorx1-x2"><a name="bit.ops"></a> <code>bit.bnot(x)</code> <code>bit.bor(x1 [,x2...])</code>, <code>bit.band(x1 [,x2...])</code> and <code>bit.bxor(x1 [,x2...])</code></h4>
<p>Returns either the bitwise <strong>or</strong>, bitwise <strong>and</strong>, or bitwise <strong>xor</strong> of all of its arguments.
Note that more than two arguments are allowed.</p>
<p>Usage example:</p>
<pre tabindex="0"><code>redis&gt; EVAL 'return bit.bor(1,2,4,8,16,32,64,128)' 0
(integer) 255
</code></pre><h4 id="a-namebitshiftsa-bitlshiftx-n-bitrshiftx-n-and-bitarshiftx-n"><a name="bit.shifts"></a> <code>bit.lshift(x, n)</code>, <code>bit.rshift(x, n)</code> and <code>bit.arshift(x, n)</code></h4>
<p>Returns either the bitwise logical <strong>left-shift</strong>, bitwise logical <strong>right-shift</strong>, or bitwise <strong>arithmetic right-shift</strong> of its first argument by the number of bits given by the second argument.</p>
<h4 id="a-namebitroa-bitrolx-n-and-bitrorx-n"><a name="bit.ro"></a> <code>bit.rol(x, n)</code> and <code>bit.ror(x, n)</code></h4>
<p>Returns either the bitwise <strong>left rotation</strong>, or bitwise <strong>right rotation</strong> of its first argument by the number of bits given by the second argument.
Bits shifted out on one side are shifted back in on the other side.</p>
<h4 id="a-namebitbswapa-bitbswapx"><a name="bit.bswap()"></a> <code>bit.bswap(x)</code></h4>
<p>Swaps the bytes of its argument and returns it.
This can be used to convert little-endian 32-bit numbers to big-endian 32-bit numbers and vice versa.</p>

          
  <form class="page-feedback" method="POST" name="page-feedback"><input type="hidden" name="form-name" value="page-feedback">
    <input name="origin" value="https://redis.io/docs/manual/programmability/lua-api/" class="hidden">
  <div class="grid justify-center mt-10 pt-10 border-t-2">
    <span class="font-bold font-small">Rate this page</span>
    <div class="star-rating">
      
      <input type="radio" id="5-stars" name="rating" value="5" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="5-stars" class="star">★</label>
      
      <input type="radio" id="4-stars" name="rating" value="4" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="4-stars" class="star">★</label>
      
      <input type="radio" id="3-stars" name="rating" value="3" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="3-stars" class="star">★</label>
      
      <input type="radio" id="2-stars" name="rating" value="2" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="2-stars" class="star">★</label>
      
      <input type="radio" id="1-stars" name="rating" value="1" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="1-stars" class="star">★</label>
      
    </div>  
  </div>
  <div id="feedback-form" class="hidden">
    <div class="feedback-submit">
      <textarea name="comment" placeholder="Why did you choose this rating?" class="border border-neutral-500 p-2 mt-1 block w-full h-24" rows="3"></textarea>
      <button class="button button-indigo w-min justify-self-end" type="submit">
        Submit
      </button>
    </div>
  </div>
</form>
      </section>
    </div>
    

  <section class="hidden xl:block w-52 h-full shrink-0">
    <div class="w-52 z-40 hidden bg-white/75 md:block overflow-auto fixed top-28 h-full max-h-[calc(100vh-15rem)] text-[0.8125rem]">
      





<nav class="flex flex-col gap-1 mb-6 pb-2 border-b-2">
  <a href="https://github.com/redis/redis-doc/edit/master/docs/manual/programmability/lua-api.md" target="_blank" class="group inline-flex items-center gap-1 text-sm text-slate-700 hover:text-indigo-600 mt-auto self-start">
    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
      <path d="M11 44q-1.2 0-2.1-.9Q8 42.2 8 41V7q0-1.2.9-2.1Q9.8 4 11 4h17l12 12v7.8h-3V18H26V7H11v34h15v3Zm0-3V7v34Zm26.8-11.15 1.4 1.4-8.2 8.2V42h2.55l8.2-8.2 1.4 1.4-8.8 8.8H29v-5.35Zm5.35 5.35-5.35-5.35 3.05-3.05q.45-.45 1.05-.45.6 0 1.05.45l3.25 3.25q.45.45.45 1.05 0 .6-.45 1.05Z" fill="currentColor"></path>
    </svg>
    Edit this page
  </a>
  <a href="https://github.com/redis/redis-doc/issues/new?title=Redis%20Lua%20API%20reference" target="_blank" class="group inline-flex items-center gap-1 text-sm text-slate-700 hover:text-indigo-600 mt-auto self-start">
    <svg class="w-4 h-4" viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="currentColor"></path>
    </svg>
    Create an issue
  </a>
</nav>


      
        <h1 class="font-semibold my-3">On This Page</h1>
        <nav class="text-slate-700">
          <nav id="TableOfContents">
  <ul>
    <li><a href="#sandbox-context">Sandbox context</a>
      <ul>
        <li><a href="#global-variables-and-functions">Global variables and functions</a></li>
        <li><a href="#imported-lua-modules">Imported Lua modules</a></li>
      </ul>
    </li>
    <li><a href="#runtime-globals">Runtime globals</a>
      <ul>
        <li><a href="#the-_redis_-singleton">The <em>redis</em> singleton</a></li>
        <li><a href="#a-namethe-keys-global-variableathe-_keys_-global-variable"></a><a name="the-keys-global-variable"></a>The <em>KEYS</em> global variable</li>
        <li><a href="#a-namethe-argv-global-variableathe-_argv_-global-variable"></a><a name="the-argv-global-variable"></a>The <em>ARGV</em> global variable</li>
      </ul>
    </li>
    <li><a href="#a-nameredis_objecta_redis_-object"></a><a name="redis_object"></a><em>redis</em> object
      <ul>
        <li><a href="#a-namerediscalla-rediscallcommand-arg"></a><a name="redis.call"></a> <code>redis.call(command [,arg...])</code></li>
        <li><a href="#a-nameredispcalla-redispcallcommand-arg"></a><a name="redis.pcall"></a> <code>redis.pcall(command [,arg...])</code></li>
        <li><a href="#a-namerediserror_replya-rediserror_replyx"></a><a name="redis.error_reply"></a> <code>redis.error_reply(x)</code></li>
        <li><a href="#a-nameredisstatus_replya-redisstatus_replyx"></a><a name="redis.status_reply"></a> <code>redis.status_reply(x)</code></li>
        <li><a href="#a-nameredissha1hexa-redissha1hexx"></a><a name="redis.sha1hex"></a> <code>redis.sha1hex(x)</code></li>
        <li><a href="#a-nameredisloga-redisloglevel-message"></a><a name="redis.log"></a> <code>redis.log(level, message)</code></li>
        <li><a href="#a-nameredissetrespa-redissetrespx"></a><a name="redis.setresp"></a> <code>redis.setresp(x)</code></li>
        <li><a href="#a-nameredisset_repla-redisset_replx"></a><a name="redis.set_repl"></a> <code>redis.set_repl(x)</code></li>
        <li><a href="#a-nameredisreplicate_commandsa-redisreplicate_commands"></a><a name="redis.replicate_commands"></a> <code>redis.replicate_commands()</code></li>
        <li><a href="#a-nameredisbreakpointa--redisbreakpoint"></a><a name="redis.breakpoint"></a>  <code>redis.breakpoint()</code></li>
        <li><a href="#a-nameredisdebuga-redisdebugx"></a><a name="redis.debug"></a> <code>redis.debug(x)</code></li>
        <li><a href="#a-nameredisacl_check_cmda-redisacl_check_cmdcommand-arg"></a><a name="redis.acl_check_cmd"></a> <code>redis.acl_check_cmd(command [,arg...])</code></li>
        <li><a href="#a-nameredisregister_functiona-redisregister_function"></a><a name="redis.register_function"></a> <code>redis.register_function</code></li>
        <li><a href="#a-nameredisredis_versiona-redisredis_version"></a><a name="redis.redis_version"></a> <code>redis.REDIS_VERSION</code></li>
        <li><a href="#a-nameredisredis_version_numa-redisredis_version_num"></a><a name="redis.redis_version_num"></a> <code>redis.REDIS_VERSION_NUM</code></li>
      </ul>
    </li>
    <li><a href="#data-type-conversion">Data type conversion</a>
      <ul>
        <li><a href="#resp2-to-lua-type-conversion">RESP2 to Lua type conversion</a></li>
      </ul>
    </li>
    <li><a href="#lua-to-resp2-type-conversion">Lua to RESP2 type conversion</a>
      <ul>
        <li><a href="#resp3-to-lua-type-conversion">RESP3 to Lua type conversion</a></li>
        <li><a href="#lua-to-resp3-type-conversion">Lua to RESP3 type conversion</a></li>
      </ul>
    </li>
    <li><a href="#additional-notes-about-scripting">Additional notes about scripting</a>
      <ul>
        <li><a href="#using-selectcommandsselect-inside-scripts">Using </a><a href="../../../commands/select.html"><code>SELECT</code></a> inside scripts</li>
      </ul>
    </li>
    <li><a href="#runtime-libraries">Runtime libraries</a>
      <ul>
        <li><a href="#a-namestruct-librarya-_struct_-library"></a><a name="struct-library"></a> <em>struct</em> library</li>
        <li><a href="#a-namecjson-librarya-_cjson_-library"></a><a name="cjson-library"></a> <em>cjson</em> library</li>
        <li><a href="#a-namecmsgpack-librarya-_cmsgpack_-library"></a><a name="cmsgpack-library"></a> <em>cmsgpack</em> library</li>
        <li><a href="#a-namebitop-librarya-_bit_-library"></a><a name="bitop-library"></a> <em>bit</em> library</li>
      </ul>
    </li>
  </ul>
</nav>
        </nav>
        
    </div>
  </section>


  </main>


    <footer class="bg-midnight-700 relative z-50">
      <p class="container max-w-[85rem] mx-auto px-4 sm:px-8 py-8 text-slate-400 text-sm text-center">
  This is a community website sponsored by <a href="https://redis.com/" class="text-white underline underline-offset-1 decoration-transparent hover:decoration-slate-500 transition-colors">Redis Ltd.</a> © 2023. Redis and the cube logo are registered trademarks of Redis Ltd. <a href="../../../terms.html" class="text-white underline underline-offset-1 decoration-transparent hover:decoration-slate-500 transition-colors">Terms of use &amp; privacy policy</a>.
</p>

      <script>
  
  document.addEventListener('DOMContentLoaded', () => {

    const TableOfContents = {
      container: document.querySelector('#TableOfContents'),
      links: null,
      headings: null,
      intersectionOptions: {
        rootMargin: '0px',
        threshold: 1
      },
      previousSection: null,
      observer: null,

      init() {
        if (!this.container) return false

        this.handleObserver = this.handleObserver.bind(this)
        this.setUpObserver()
        this.findLinksAndHeadings()
        this.observeSections()
      },

      handleObserver(entries, observer) {
        entries.forEach(entry => {
          let href = `#${entry.target.getAttribute('id')}`
          let link = this.links.find(l => l.getAttribute('href') === href)

          if (entry.isIntersecting && entry.intersectionRatio >= 1) {
            link.classList.add('visible')
            this.previousSection = entry.target.getAttribute('id')
          } else {
            link.classList.remove('visible')
          }

          this.highlightFirstActive()
        })
      },

      highlightFirstActive() {
        let firstVisibleLink = this.container.querySelector('.visible')

        this.links.forEach(link => {
          link.classList.remove('active')
        })

        if (firstVisibleLink) {
          firstVisibleLink.classList.add('active')
        }

        if (!firstVisibleLink && this.previousSection) {
          this.container.querySelector(
            `a[href="#${this.previousSection}"]`
          ).classList.add('active')
        }
      },

      observeSections() {
        this.headings.forEach(heading => {
          this.observer.observe(heading)
        })
      },

      setUpObserver() {
        this.observer = new IntersectionObserver(
          this.handleObserver,
          this.intersectionOptions
        )
      },

      findLinksAndHeadings() {
        this.links = [...this.container.querySelectorAll('a')]
        this.headings = this.links.map(link => {
          let id = link.getAttribute('href')
          return document.querySelector(id)
        })
      }
    }

    TableOfContents.init()

})
</script>
    </footer>

    
<div class="sr-only w-screen h-screen fixed z-[200] top-0 left-0 cursor-auto flex flex-col bg-slate-900/75 p-4 sm:p-6 md:p-[10vh] lg:p-[12vh]" id="search-container" role="button" aria-expanded="true" aria-haspopup="listbox" aria-labelledby="search-label" tabindex="0">
  <div class="search-modal">
    <header class="search-bar">
      <form id="search-form" class="search-form">
        <label class="search-magnifier-label" for="search-input" id="search-label">
          <svg width="20" height="20" class="search-icon" viewBox="0 0 20 20">
            <path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </label>
        <div class="search-loading-indicator">
          <svg viewBox="0 0 38 38" stroke="currentColor" stroke-opacity=".5">
            <g fill="none" fill-rule="evenodd">
              <g transform="translate(1 1)" stroke-width="2">
                <circle stroke-opacity=".3" cx="18" cy="18" r="18"></circle>
                <path d="M36 18c0-9.94-8.06-18-18-18">
                  <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"></animateTransform>
                </path>
              </g>
            </g>
          </svg>
        </div>
        <input class="search-input" aria-autocomplete="both" aria-labelledby="search-label" id="search-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search…" maxlength="64" type="search" value="">
        <button type="reset" title="Clear the query" class="search-reset" aria-label="Clear the query" hidden="">
          <svg width="20" height="20" viewBox="0 0 20 20">
            <path d="M10 10l5.09-5.09L10 10l5.09 5.09L10 10zm0 0L4.91 4.91 10 10l-5.09 5.09L10 10z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </button>
      </form>
      <button id="search-cancel" type="reset" aria-label="Cancel">
        Cancel
      </button>
    </header>
    <dl id="search-results" class="search-results" role="listbox"></dl>
    <footer class="search-footer">
      <a href="../../stack/search.html" target="_blank" rel="noopener noreferrer">
        <span class="logo-label">Powered by Redis Stack</span>
        
        <svg viewBox="0 0 39 31" fill="none"><path d="M21.7371 15.2903C21.5759 15.2895 21.4198 15.2337 21.2947 15.1321 21.1695 15.0305 21.0828 14.8892 21.049 14.7316S21.0362 14.4096 21.1086 14.2655C21.1811 14.1215 21.3005 14.0066 21.4472 13.9397L35.7199 7.47338 21.4578 1.34289C21.2943 1.26329 21.1678 1.12377 21.1045.953307 21.0412.78285 21.046.594558 21.1179.427547 21.1898.260535 21.3233.127641 21.4906.0564719 21.6579-.0146977 21.8462-.0186728 22.0164.045373L37.7492 6.80518C37.8747 6.8605 37.9814 6.95112 38.0563 7.06599S38.171 7.31503 38.171 7.45216 38.1312 7.72347 38.0563 7.83834C37.9814 7.95321 37.8747 8.04383 37.7492 8.09915L22.0306 15.2266C21.9388 15.2698 21.8385 15.2916 21.7371 15.2903z" fill="#db2e2e"></path><path d="M16.4339 15.2903C16.3379 15.2906 16.2429 15.2714 16.1546 15.2337L.421813 8.47393C.296339 8.41861.18966 8.32799.114767 8.21312.0398745 8.09825.0 7.96407.0 7.82694.0 7.68981.0398745 7.55564.114767 7.44077.18966 7.3259.296339 7.23528.421813 7.17995L16.1546.052465C16.3235-.0111265 16.5104-.00772359 16.6768.0619772 16.8433.131678 16.9768.2624 17.0501.427363 17.1233.592325 17.1306.779042 17.0706.949259 17.0106 1.11948 16.8878 1.26031 16.7274 1.34291L2.44763 7.80573 16.7132 13.9362C16.8612 14.0015 16.9823 14.1154 17.0565 14.2592 17.1306 14.4029 17.1532 14.5677 17.1205 14.7261 17.0878 14.8845 17.0019 15.0269 16.8769 15.1295 16.752 15.2322 16.5956 15.2889 16.4339 15.2903z" fill="#db2e2e"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 17.4328c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 13.9539C37.3908 13.8108 37.6564 13.6514 37.9118 13.4766 37.972 13.8833 37.972 14.2967 37.9118 14.7034 37.8022 15.1312 37.4875 15.4847 36.289 16.061 35.4617 16.4605 33.1531 17.408 30.5792 18.4687c-3.6167 1.4884-7.778 3.1819-9.0826 3.889C19.2587 23.4183 18.0284 23.4183 16.3137 22.644 15.4864 22.2021 12.4918 20.9117 9.39476 19.5611c-3.3198-1.446-6.75627-2.945-7.77802-3.4753C.22377 15.3575.153061 15.1948.160132 14.8271V13.8655L.513678 14.0564c1.311652.6647 7.219412 3.1819 11.486722 5.0204 2.1142.898 3.8112 1.6298 4.3769 1.8844C18.092 21.7319 19.3082 21.8733 21.5603 20.6748 22.7022 20.0808 25.9619 18.7409 29.1651 17.4328z" fill="#494c4d"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 24.5037c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 21.0248C37.3908 20.8817 37.6564 20.7223 37.9118 20.5475 37.972 20.9542 37.972 21.3676 37.9118 21.7743 37.8022 22.2021 37.4875 22.5557 36.289 23.1319 35.4617 23.5314 33.1531 24.4789 30.5792 25.5396c-3.6167 1.4884-7.778 3.1819-9.0826 3.889-2.2379 1.0606-3.4682 1.0606-5.1829.2864C15.4864 29.2801 12.4918 27.9755 9.39476 26.625c-3.3198-1.446-6.75627-2.9451-7.77802-3.4754C.22377 22.4213.153061 22.2587.160132 21.891V20.9364L.513678 21.1273C1.82533 21.792 7.73309 24.3092 12.0004 26.1477c2.1001.898 3.8006 1.6298 4.3663 1.8844C18.0814 28.8028 19.2976 28.9442 21.5497 27.7457 22.7022 27.1518 25.9619 25.8118 29.1651 24.5037z" fill="#494c4d"></path></svg>
      </a>
    </footer>
  </div>
</div>

<script>
  const searchModal = (() => {
    const searchButton = document.querySelector('#search-button')
    const searchContainer = document.querySelector('#search-container')
    const searchInput = searchContainer.querySelector('#search-input')
    const resultsContainer = searchContainer.querySelector('#search-results')
    const style = document.createElement('style')
    
    let keys = {}
    let focusable
    let firstFocusable
    let lastFocusable
  
    function next (elem, selector) {
      let nextElem = elem.nextElementSibling
      if (!selector) return nextElem
      if (nextElem && nextElem.matches(selector)) return nextElem
      return null
    }
  
    function debounce(callback, delay) {
      let timeout
      
      return function() {
        clearTimeout(timeout)
        timeout = setTimeout(callback, delay)
      }
    }
  
    function searchSubmit(form) {
      if (form.id !== 'search-form') return false
  
      const searchTerm = searchInput.value
  
      if (searchTerm.length < 1) {
        resultsContainer.innerHTML = ''
        return
      }
  
      function search(url) {
        let promise = new Promise((resolve, reject) => {
          const req = new XMLHttpRequest()
          req.open('GET', url)
          req.onload = function() {
            if (req.status === 200) {
              resolve(JSON.parse(req.response))
            } else {
              reject(Error(req.status))
            }
          }
          req.send()
        })
  
        return promise
      }
  
      function sortData(data) {
        
        const getCategories = (data) =>
          data.reduce((a, c) => {
            if (!a.includes(c.hierarchy[0])) {
              a.push(c.hierarchy[0])
            }
  
            return a
          }, [])

        
        const constructSectionTitle = (record) => {
          if (record.hierarchy && record.hierarchy.length > 2) {
            return record.hierarchy[1]
          } else {
            return record.title
          }
        }

        
        const mergeData = (data, categories) =>
          categories.map((category) => {
            const obj = {}
            obj.category = category
  
            data.forEach((record) => {
              if (record.hierarchy[0] === category) {
                obj[record.title] = {
                  path: constructSectionTitle(record),
                  url: record.url,
                }
              }
            })
  
            return obj
          })
  
        return mergeData(data.results, getCategories(data.results))
      }
  
      function escape_evil_chars(str_in) {
        return str_in.replaceAll('>','&gt;').replaceAll('<', '&lt;').replaceAll('&', '&amp;').replaceAll('"','&quot;').replaceAll("'",'&#x27;')
      }   
      
      function displayData(data) {
        resultsContainer.innerHTML = ''
        
        if (data.results.length < 1) {
          escapedSearchTerm = escape_evil_chars(searchTerm)
          resultsContainer.insertAdjacentHTML(
            'beforeend',
            `<dt class="sr-only">${escapedSearchTerm}:</dt>
            <dd class="search-no-results">
              No results for \"<span class="search-title">${escapedSearchTerm}</span>\"
            </dd>`
          )
        } else {
          sortData(data).forEach((result) => {
            resultsContainer.insertAdjacentHTML(
              'beforeend', 
              `<dt class="search-item-source">
                ${result.category}
              </dt>`
            )
    
            delete result.category
    
            Object.keys(result).forEach((key, index) => {
              resultsContainer.insertAdjacentHTML(
                'beforeend',
                `<dd class="search-item" role="option">
                  <a href="${result[key].url}">
                    <span class="search-item-icon"></span>
                    <span class="search-item-content">
                      ${result[key].path ? `<span class="search-item-path">${result[key].path}</span>` : ''}
                      <span class="search-item-title">${key.replace(new RegExp(`(^|)(${searchTerm})(|$)`, 'ig'), '$1<b class="search-term-match">$2</b>$3')}</span>
                    </span>
                    <span class="search-item-action"></span>
                  </a>
                </dd>`
              )
            })
            
            if (!resultsContainer.querySelector('[aria-selected]')) resultsContainer.querySelector('.search-item').setAttribute('aria-selected', '')
          })
        }
        return
      }
  
      function displayError(error) {
        console.log(error)
      }
  
      search(`https://search-service.redislabs.com/search?q=${searchTerm}*&site=https://redis.io`)
        .then(displayData)
        .catch(displayError)
    }
  
    function loadHandler(event) {
      style.innerHTML = `
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      `
  
      document.head.appendChild(style)
      document.documentElement.dataset.searchState = 'off'
    }
  
    function getNextSibling(elem, selector, direction) {
      let sibling = direction === 'down' ? elem.nextElementSibling : elem.previousElementSibling
    
      while (sibling) {
        if (sibling.matches(selector)) return sibling
        sibling = direction === 'down' ? sibling.nextElementSibling : sibling.previousElementSibling
      }
    }
  
    function tabSelection(direction) {
      const currentSelection = resultsContainer.querySelector('[aria-selected]')
      if (!currentSelection || direction === 'down' && !currentSelection.nextElementSibling || direction === 'up' && !currentSelection.previousElementSibling) return false
        
      const nextSelection = getNextSibling(currentSelection, '.search-item', direction)
      if (!nextSelection) return false
      
      nextSelection.setAttribute('aria-selected', '')
      currentSelection.removeAttribute('aria-selected')
      resultsContainer.scrollTop = nextSelection.offsetTop - resultsContainer.offsetTop
    }
    
    function keyDownHandler(event) {
      switch (event.key) {
  
        // Arrow keys
        case 'ArrowDown':
          if (document.documentElement.dataset.searchState === 'off' || !document.querySelector('.search-item')) return false
          event.preventDefault()
          tabSelection('down')
          break
  
        case 'ArrowUp':
          if (document.documentElement.dataset.searchState === 'off' || !document.querySelector('.search-item')) return false
          event.preventDefault()
          tabSelection('up')
          break
  
        // Tab
        case 'Tab':
          if (document.documentElement.dataset.searchState === 'off') return false
  
          if (focusable.length === 1) {
            event.preventDefault()
            break
          }
  
          // If shift is fired, tab backward
          if (event.shiftKey) {
            if (document.activeElement === firstFocusable) {
              event.preventDefault()
              lastFocusable.focus()
            }
  
            // Otherwise tab forward
          } else {
            if (document.activeElement === lastFocusable) {
              event.preventDefault()
              firstFocusable.focus()
            }
          }
          break
  
        // Esc
        case 'Escape':
          if (document.documentElement.dataset.searchState === 'off') return false
          stopSearch()
          break
        
        // Enter
        case 'Enter':
          if (!document.querySelector('.search-item:focus-within') && document.querySelector('.search-item[aria-selected]')) {
            event.preventDefault()
            document.querySelector('.search-item[aria-selected] a').click()
          }
          break
  
        // Forward slash
        case '/':
          if (document.documentElement.dataset.searchState === 'on') return false
          event.preventDefault()
          startSearch()
          break
      
        // Default
        default:
          return false
          break
      }
    }
  
    function keyUpHandler(event) {
      if (document.documentElement.dataset.searchState === 'off' || !document.activeElement.matches('.search-input')) return false
      
      switch (event.key) {
        case 'ArrowDown':
          return false
          break
        case 'ArrowUp':
          return false
          break
        case 'ArrowLeft':
          return false
          break
        case 'ArrowRight':
          return false
          break
        case 'Tab':
          return false
          break
        case 'Escape':
          return false
          break
        case 'Enter':
          return false
          break
        case '/':
          return false
          break
        default:
          searchSubmit(document.activeElement.closest('form'))
          break
      }
    }
  
    function multiKeyHandler(event) {
      if (document.documentElement.dataset.searchState === 'on') return false
  
      let { key, type } = event
      let isKeyDown = (type == 'keydown')
      keys[key] = isKeyDown
  
      // Both (cmd || cntrl) & k pressed
      if (isKeyDown && (keys.Control || keys.Meta) && keys.k) {
        event.preventDefault()
        startSearch()
      }
    }
  
    // Click handler function
    function clickHandler(event) {
      if (event.target.closest('#search-button')) {
        startSearch()
      } else if (event.target.closest('#search-cancel') || event.target.matches('#search-container')) {
        stopSearch()
      }
    }
  
    function startSearch() {
      sessionStorage.setItem('scroll-position', document.documentElement.scrollTop)
      document.documentElement.dataset.scrollDisabled = 'on'
      document.documentElement.dataset.searchState = 'on'
      allowFocus(searchContainer, true)
      trapFocus(searchContainer)
      searchInput.focus()
    }
  
    function stopSearch() {
      document.documentElement.dataset.searchState = 'off'
      document.documentElement.dataset.scrollDisabled = 'off'
      document.documentElement.scrollTop = sessionStorage.getItem('scroll-position')
      allowFocus(searchContainer, false)
      document.activeElement.blur()
      resultsContainer.innerHTML = ''
      searchInput.value = ''
      keys = {}
    }
  
    function submitHandler(event) {
      if (event.target.id === 'search-form') {
        event.preventDefault()
        return false
      }
    }
  
    function allowFocus(selector, state) {
      const focusable = selector.querySelectorAll('button, [href], input, select, textarea')
      focusable.forEach(el => el.setAttribute('tabindex', state ? '' : '-1'))
      selector.classList.toggle('sr-only')
    }
  
    function trapFocus(selector) {
      focusable = selector.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"]')
      firstFocusable = focusable[0]
      lastFocusable = focusable[focusable.length - 1]
    }
  
    // Attach event listeners
    document.addEventListener('DOMContentLoaded', loadHandler)
    document.addEventListener('click', clickHandler)
    document.addEventListener('keydown', event => debounce(keyDownHandler(event), 100))
    document.addEventListener('keyup', event => debounce(keyUpHandler(event), 100))
    document.addEventListener('keydown', multiKeyHandler)
    document.addEventListener('keyup', multiKeyHandler)
    document.addEventListener('submit', submitHandler)
  })()
</script>
  

</body></html>