<html><!-- Online page at https://redis.io/docs/reference/modules/ --><head><meta charset="utf-8"><title>Redis modules API</title><link rel="stylesheet" href="../../css_1.css" type="text/css"><link rel="stylesheet" href="../../css_2.css" type="text/css"><link rel="stylesheet" href="../../css_3.css" type="text/css"><link rel="stylesheet" href="../../css_4.css" type="text/css"><link rel="stylesheet" href="../../css_5.css" type="text/css"><script type="text/javascript" src="../../js_1.js"></script><script type="text/javascript" src="../../js_10.js"></script><script type="text/javascript" src="../../js_3.js"></script><script type="text/javascript" src="../../js_4.js"></script><script type="text/javascript" src="../../js_5.js"></script><script type="text/javascript" src="../../js_6.js"></script><script type="text/javascript" src="../../js_7.js"></script><script type="text/javascript" src="../../js_8.js"></script><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style><style>
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      </style></head><body class="antialiased tracking-[-0.01em]">
    <noscript>&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;lt;iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T4MTBKP"
        height="0" width="0" style="display:none;visibility:hidden"&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;gt;&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;lt;/iframe&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;gt;</noscript>
    <header class="sticky top-0 z-50 flex items-center w-full text-xs lg:text-sm font-semibold lg:font-medium text-white shadow bg-midnight-700">
      <div class="flex items-center w-full h-16 container max-w-[85rem] mx-auto px-4 sm:px-8">
  <a class="relative z-50 mr-auto" href="../../../redis.io.html">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 368.69 125.59" class="w-auto h-8">
  <defs>
    <style>
      .cls-1 {
        fill: none;
      }

      .cls-2 {
        clip-path: url(#clip-path);
      }

      .cls-3 {
        fill: #a32422;
      }

      .cls-4 {
        fill: #dc382c;
      }

      .cls-5 {
        fill: #fff;
      }

      .cls-6 {
        fill: #741113;
      }

      .cls-7 {
        fill: #ac2724;
      }
    </style>
    <clipPath id="clip-path" transform="translate(0.01 0.01)">
      <rect class="cls-1" width="146.42" height="125.48"></rect>
    </clipPath>
  </defs>
  <g id="Layer_2" data-name="Layer 2">
    <g id="Layer_1-2" data-name="Layer 1">
      <g class="cls-2">
        <path class="cls-3" d="M140.66,96.74c-7.8,4.08-48.28,20.73-57,25.3s-13.39,4.44-20.21,1.18S13.7,102.5,5.92,98.78C2,96.94,0,95.37,0,93.9V79.09S56.08,66.92,65.13,63.64,77.31,60.28,85,63.1,138.79,74.24,146.4,77V91.6c0,1.52-1.75,3-5.74,5.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,82c-7.8,4.06-48.28,20.71-57,25.2s-13.39,4.45-20.21,1.2S13.7,87.69,5.92,84s-7.93-6.27-.3-9.25S56.08,55,65.13,51.7,77.31,48.33,85,51.16,133,70,140.57,72.79s7.92,5.08.09,9.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-3" d="M140.66,72.62c-7.8,4.07-48.28,20.71-57,25.2S70.31,102.27,63.49,99,13.7,78.37,5.92,74.66C2,72.8,0,71.24,0,69.76V55S56.08,42.79,65.13,39.51,77.31,36.14,85,39,138.79,50.1,146.4,52.88v14.6C146.4,69,144.65,70.52,140.66,72.62Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,57.81c-7.8,4.08-48.28,20.72-57,25.21s-13.39,4.46-20.21,1.2S13.7,63.57,5.92,59.85-2,53.6,5.62,50.62s50.46-19.79,59.51-23S77.31,24.21,85,27,133,45.94,140.57,48.65s7.92,5.09.09,9.13Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-3" d="M140.66,47.59c-7.8,4.08-48.28,20.73-57,25.21S70.31,77.25,63.49,74,13.7,53.34,5.92,49.63C2,47.79,0,46.22,0,44.74V29.93S56.08,17.76,65.13,14.49,77.31,11.12,85,13.94s53.77,11.14,61.38,13.92v14.6C146.4,44,144.65,45.5,140.66,47.59Z" transform="translate(0.01 0.01)"></path>
        <path class="cls-4" d="M140.66,32.8c-7.8,4-48.28,20.75-57,25.2s-13.39,4.44-20.21,1.2S13.7,38.53,5.92,34.83s-7.93-6.27-.3-9.25S56.08,5.8,65.13,2.54,77.31-.82,85,2,133,20.85,140.57,23.63s7.92,5.09.09,9.14Z" transform="translate(0.01 0.01)"></path>
      </g>
      <polygon class="cls-5" points="75.51 11.78 85.17 8.61 82.55 14.87 92.38 18.55 79.71 19.87 76.86 26.71 72.28 19.08 57.63 17.76 68.57 13.82 65.28 7.76 75.51 11.78 75.51 11.78 75.51 11.78"></polygon>
      <polygon class="cls-5" points="76.12 51.71 52.44 41.88 86.36 36.67 76.12 51.71 76.12 51.71 76.12 51.71"></polygon>
      <path class="cls-5" d="M43.28,22.34c10,0,18.13,3.15,18.13,7s-8.15,7-18.13,7-18.14-3.15-18.14-7S33.27,22.34,43.28,22.34Z" transform="translate(0.01 0.01)"></path>
      <polygon class="cls-6" points="107.39 20.42 127.46 28.35 107.41 36.28 107.39 20.42 107.39 20.42 107.39 20.42"></polygon>
      <polygon class="cls-7" points="107.39 20.42 107.41 36.28 105.23 37.13 85.17 29.2 107.39 20.42 107.39 20.42 107.39 20.42"></polygon>
      <path class="cls-5" d="M193,41.4a17.36,17.36,0,0,1,6.23-4.34,20,20,0,0,1,7.3-1.61,6.71,6.71,0,0,1,5,1.61,5,5,0,0,1,1.52,3.79,5.39,5.39,0,0,1-1.52,3.79,4.9,4.9,0,0,1-3.79,1.63c-6.24.55-14.9,6.77-14.9,15.22V80.67a5.57,5.57,0,0,1-5.42,5.41,4.92,4.92,0,0,1-3.87-1.67,5.36,5.36,0,0,1-1.62-3.79v-40a5.35,5.35,0,0,1,1.62-3.79,7.2,7.2,0,0,1,4.07-1.36,5.52,5.52,0,0,1,5.41,5.4Z" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M258.71,59a5.25,5.25,0,0,1-1.35,3.54,6.11,6.11,0,0,1-3.79,1.62h-32a10.31,10.31,0,0,0,3.47,6.56,14.46,14.46,0,0,0,9.48,4.57,14.07,14.07,0,0,0,10.56-2.44,5.52,5.52,0,0,1,4.07-1.63,4.65,4.65,0,0,1,3.51,1.36,4.41,4.41,0,0,1,.26,6.24c-.08.09-.17.17-.26.26a24.49,24.49,0,0,1-17.59,6.5A23,23,0,0,1,217.5,78a26.67,26.67,0,0,1-7.3-17.9,24.31,24.31,0,0,1,7.3-17.88,22.59,22.59,0,0,1,17.06-7.31,22,22,0,0,1,16.74,6.78,24.78,24.78,0,0,1,7.61,16.74v.53Zm-24.1-14.35a14.2,14.2,0,0,0-9.13,3.53,13.17,13.17,0,0,0-4.33,7h28.43a12.39,12.39,0,0,0-4.88-6.76,17.3,17.3,0,0,0-10-3.81" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M309.66,80.12a5.57,5.57,0,0,1-5.41,5.42,5.85,5.85,0,0,1-5.42-4.34A23.23,23.23,0,0,1,285,85.54a23.57,23.57,0,0,1-17.33-7.31,24.14,24.14,0,0,1-7.05-17.88,25.75,25.75,0,0,1,7.05-17.87A23.85,23.85,0,0,1,285,34.87a22.34,22.34,0,0,1,13.53,4.34V20.28a4.92,4.92,0,0,1,1.63-3.79A5.37,5.37,0,0,1,304,14.86a4.92,4.92,0,0,1,3.79,1.63,5.36,5.36,0,0,1,1.63,3.79V80.12ZM285.31,74.7a12,12,0,0,0,9.47-4.32,14.4,14.4,0,0,0,0-20A13,13,0,0,0,285.31,46a11.65,11.65,0,0,0-9.48,4.34,14.4,14.4,0,0,0,0,20,12.49,12.49,0,0,0,9.48,4.32" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M325.67,20.28v2.18A5.5,5.5,0,0,1,324,26.58a4.64,4.64,0,0,1-3.79,1.35,4.86,4.86,0,0,1-3.78-1.61,5.44,5.44,0,0,1-1.63-4.06v-2a5.28,5.28,0,0,1,1.63-3.79,5.33,5.33,0,0,1,3.78-1.63A5,5,0,0,1,324,16.49a4.9,4.9,0,0,1,1.66,3.79m-9.13,16.53a5.28,5.28,0,0,1,3.79-1.63,4.85,4.85,0,0,1,3.79,1.63,5.48,5.48,0,0,1,1.55,4V80.42A4.55,4.55,0,0,1,324,84.21a5.33,5.33,0,0,1-3.78,1.63,4.9,4.9,0,0,1-3.79-1.63,5.28,5.28,0,0,1-1.63-3.79V40.85a5.39,5.39,0,0,1,1.63-4" transform="translate(0.01 0.01)"></path>
      <path class="cls-5" d="M364.08,40.6a5.29,5.29,0,0,1,2.17,3.24,7.17,7.17,0,0,1-.54,4.06,5.4,5.4,0,0,1-3.25,2.16,5.61,5.61,0,0,1-4.07-.81c-3.79-2.43-6.75-3.78-9.2-3.78a8.74,8.74,0,0,0-6,1.88c-1.08.82-1.62,1.36-1.62,1.9a2,2,0,0,0,.27,1.36,3.74,3.74,0,0,0,1.08.81,16.19,16.19,0,0,0,7.32,2.43h0a37.75,37.75,0,0,1,9.74,3,13.57,13.57,0,0,1,6.5,5.7,13.46,13.46,0,0,1-4.06,18.67,21.79,21.79,0,0,1-13,4.06c-6.23,0-12.18-2.43-17.87-7a5.77,5.77,0,0,1-1.9-3.53,5.2,5.2,0,0,1,8.4-4.56,15.73,15.73,0,0,0,11.1,4.33,11.61,11.61,0,0,0,6.77-1.9c1.08-1.08,1.9-1.89,1.9-2.71s0-1.08-.27-1.35c0-.28-.55-.81-1.36-1.08a20.15,20.15,0,0,0-8.13-2.86h0a28.26,28.26,0,0,1-9.2-3,16.56,16.56,0,0,1-6.5-5.67,12.61,12.61,0,0,1-1.61-6.23,13.3,13.3,0,0,1,5.95-11.11,21.82,21.82,0,0,1,12.45-3.79c4.56.28,9.48,2.16,14.89,5.69" transform="translate(0.01 0.01)"></path>
    </g>
  </g>
</svg>
  </a>

	<nav data-menu="" class="hidden lg:flex items-center justify-center content-start lg:content-center lg:gap-y-4 flex-1 z-40 fixed inset-0 lg:static bg-slate-900 lg:bg-transparent text-sm max-h-screen lg:max-w-none pt-20 pb-8 lg:py-0 overflow-y-auto lg:overflow-y-visible">
    
    
      

        
        <a href="../getting-started.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Get started
        </a>

        
        <a href="../getting-started.html" class="flex lg:hidden items-center mt-1.5">
          Get started
        </a>
      
    
      
        
        
        <dl class="hidden lg:flex group relative first:ml-auto ml-1 mt-3 mb-0 px-3 pt-2 pb-5 cursor-pointer">
          <dt class="sr-only uppercase lg:not-sr-only flex items-center justify-items-center group-hover:text-white/50 group-focus-within:text-white/50 whitespace-nowrap transition-colors" href="#">
            
            Docs
          </dt>
          <dd class="hidden lg:grid text-[0.8rem] lg:text-sm text-redis-neutral-800 absolute top-full -mt-1 right-[1000rem] p-2 group-hover:right-[unset] group-hover:-left-3 group-focus-within:right-[unset] group-focus-within:-left-3 bg-white rounded-lg border border-slate-500/10 bg-clip-padding shadow-md">
            
              
                <div class="-my-2 pr-3 py-4 col-start-1  pl-3 ">
                  <a href="../about.html" class=" font-semibold text-[0.9375rem] text-slate-900 flex items-center whitespace-nowrap min-w-[10rem] hover:text-slate-600 focus:text-slate-600 transition-colors">
                    
                      <span class="grid place-items-center w-5 h-5 mr-2.5">
                        
                        <svg viewBox="0 0 147 126" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M140.708 96.7107c-7.81 4.0703-48.2904 20.7203-57.0004 25.2903C74.9976 126.571 70.3176 126.441 63.4976 123.191s-49.8-20.73-57.57002-24.4403C2.04758 96.9007.00756836 95.3407.00756836 93.8607V79.0508S56.0876 66.8807 65.1376 63.6107 77.3176 60.2406 85.0276 63.0606C92.7376 65.8806 138.798 74.2007 146.408 76.9807V91.5606C146.408 93.0806 144.658 94.5606 140.668 96.6907L140.708 96.7107z" fill="#a32422"></path><path d="M140.708 81.9108C132.898 85.9808 92.4176 102.631 83.7076 107.121 74.9976 111.611 70.3176 111.561 63.4976 108.321c-6.82-3.24-49.8-20.6703-57.57001-24.3703-7.77-3.7-7.92999-6.27-.30999-9.25s50.47-19.78 59.52-23S77.3176 48.3408 85.0276 51.1708C92.7376 54.0008 132.968 70.0108 140.578 72.7908 148.188 75.5708 148.488 77.8808 140.668 81.9208L140.708 81.9108z" fill="#dc382c"></path><path d="M140.708 72.5807C132.898 76.6507 92.4176 93.3008 83.7076 97.7908 74.9976 102.281 70.3176 102.231 63.4976 98.9907 56.6776 95.7507 13.6976 78.3407 5.92758 74.6207 2.04758 72.7707.00756836 71.2007.00756836 69.7207V54.9306S56.0876 42.7607 65.1376 39.4707 77.3176 36.1107 85.0276 38.9407C92.7376 41.7707 138.798 50.0607 146.408 52.8507v14.64C146.488 68.9607 144.698 70.4907 140.708 72.5807z" fill="#a32422"></path><path d="M140.708 57.7808c-7.81 4.08-48.2904 20.7099-57.0004 25.1999S70.3176 87.4407 63.4976 84.1807s-49.8-20.65-57.57001-24.36C-1.84241 56.1107-2.0024 53.5607 5.6176 50.5807s50.47-19.78 59.52-23S77.3176 24.2208 85.0276 27.0308C92.7376 29.8408 132.968 45.9508 140.578 48.6608 148.188 51.3708 148.488 53.7408 140.668 57.7908L140.708 57.7808z" fill="#dc382c"></path><path d="M140.708 47.5508c-7.81 4.08-48.2904 20.73-57.0004 25.22C74.9976 77.2608 70.3176 77.2107 63.4976 73.9507 56.6776 70.6907 13.6976 53.3007 5.92758 49.5907c-3.88-1.84-5.92001164-3.41-5.92001164-4.89V29.9008S56.0876 17.7207 65.1376 14.4507c9.05-3.27 12.18-3.3599 19.89-.549899999999999C92.7376 16.7108 138.798 25.0407 146.408 27.8307V42.4208C146.488 43.9408 144.698 45.4908 140.708 47.5508z" fill="#a32422"></path><path d="M140.708 32.7607c-7.81 4-48.2904 20.7599-57.0004 25.1999s-13.39 4.4401-20.21 1.2001-49.8-20.66-57.57001-24.36c-7.77-3.7-7.92999-6.27-.30999-9.26 7.62-2.99 50.47-19.77998 59.52-22.99998 9.05-3.219996 12.18-3.360025 19.89-.53003C92.7376 4.84069 132.968 20.8507 140.578 23.6407 148.188 26.4307 148.488 28.7207 140.668 32.7707L140.708 32.7607z" fill="#dc382c"></path><path d="M140.708 96.7107c-7.81 4.0703-48.2904 20.7203-57.0004 25.2903C74.9976 126.571 70.3176 126.441 63.4976 123.191s-49.8-20.73-57.57002-24.4403C2.04758 96.9007.00756836 95.3407.00756836 93.8607V79.0508S56.0876 66.8807 65.1376 63.6107 77.3176 60.2406 85.0276 63.0606C92.7376 65.8806 138.798 74.2007 146.408 76.9807V91.5606C146.408 93.0806 144.658 94.5606 140.668 96.6907L140.708 96.7107z" fill="#a32422"></path><path d="M140.708 81.9108C132.898 85.9808 92.4176 102.631 83.7076 107.121 74.9976 111.611 70.3176 111.561 63.4976 108.321c-6.82-3.24-49.8-20.6703-57.57001-24.3703-7.77-3.7-7.92999-6.27-.30999-9.25s50.47-19.78 59.52-23S77.3176 48.3408 85.0276 51.1708C92.7376 54.0008 132.968 70.0108 140.578 72.7908 148.188 75.5708 148.488 77.8808 140.668 81.9208L140.708 81.9108z" fill="#dc382c"></path><path d="M140.708 72.5807C132.898 76.6507 92.4176 93.3008 83.7076 97.7908 74.9976 102.281 70.3176 102.231 63.4976 98.9907 56.6776 95.7507 13.6976 78.3407 5.92758 74.6207 2.04758 72.7707.00756836 71.2007.00756836 69.7207V54.9306S56.0876 42.7607 65.1376 39.4707 77.3176 36.1107 85.0276 38.9407C92.7376 41.7707 138.798 50.0607 146.408 52.8507v14.64C146.488 68.9607 144.698 70.4907 140.708 72.5807z" fill="#a32422"></path><path d="M140.708 57.7808c-7.81 4.08-48.2904 20.7099-57.0004 25.1999S70.3176 87.4407 63.4976 84.1807s-49.8-20.65-57.57001-24.36C-1.84241 56.1107-2.0024 53.5607 5.6176 50.5807s50.47-19.78 59.52-23S77.3176 24.2208 85.0276 27.0308C92.7376 29.8408 132.968 45.9508 140.578 48.6608 148.188 51.3708 148.488 53.7408 140.668 57.7908L140.708 57.7808z" fill="#dc382c"></path><path d="M140.708 47.5508c-7.81 4.08-48.2904 20.73-57.0004 25.22C74.9976 77.2608 70.3176 77.2107 63.4976 73.9507 56.6776 70.6907 13.6976 53.3007 5.92758 49.5907c-3.88-1.84-5.92001164-3.41-5.92001164-4.89V29.9008S56.0876 17.7207 65.1376 14.4507c9.05-3.27 12.18-3.3599 19.89-.549899999999999C92.7376 16.7108 138.798 25.0407 146.408 27.8307V42.4208C146.488 43.9408 144.698 45.4908 140.708 47.5508z" fill="#a32422"></path><path d="M140.708 32.7607c-7.81 4-48.2904 20.7599-57.0004 25.1999s-13.39 4.4401-20.21 1.2001-49.8-20.66-57.57001-24.36c-7.77-3.7-7.92999-6.27-.30999-9.26 7.62-2.99 50.47-19.77998 59.52-22.99998 9.05-3.219996 12.18-3.360025 19.89-.53003C92.7376 4.84069 132.968 20.8507 140.578 23.6407 148.188 26.4307 148.488 28.7207 140.668 32.7707L140.708 32.7607z" fill="#dc382c"></path><path d="M75.5476 11.7307l9.66-3.17-2.62 6.26 9.83 3.68-12.67 1.32L76.8976 26.6607l-4.58-7.63-14.65-1.32 10.94-3.94L65.3176 7.71069l10.23 4.02001z" fill="#fff"></path><path d="M76.1575 51.6607l-23.68-9.83 33.92-5.2-10.24 15.03z" fill="#fff"></path><path d="M43.3276 22.3008c10 0 18.12 3.15 18.12 7s-8.14 7-18.12 7c-9.98.0-18.14-3.15000000000001-18.14-7s8.13-7 18.14-7z" fill="#fff"></path><path d="M107.428 20.3707l20.07 7.93-20.05 7.93L107.428 20.3707z" fill="#741113"></path><path d="M107.428 20.3707 107.448 36.2307 105.268 37.0807l-20.0605-7.93 22.2205-8.78z" fill="#ac2724"></path></svg>
                      </span>
                    
                    Redis
                  </a>
                  
                    <a href="../getting-started.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Get started
                    </a>
                  
                    <a href="../data-types.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Data types
                    </a>
                  
                    <a href="../ui/cli.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Redis CLI
                    </a>
                  
                    <a href="../clients.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Redis clients
                    </a>
                  
                    <a href="../management/persistence.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Persistence
                    </a>
                  
                    <a href="../management/scaling.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Scaling
                    </a>
                  
                </div>
              
            
              
                <div class="-my-2 pr-3 py-4 col-start-2  border-l pl-5 ">
                  <a href="../stack.html" class=" font-semibold text-[0.9375rem] text-slate-900 flex items-center whitespace-nowrap min-w-[10rem] hover:text-slate-600 focus:text-slate-600 transition-colors">
                    
                      <span class="grid place-items-center w-5 h-5 mr-2.5">
                        
                        <svg viewBox="0 0 39 31" fill="none"><path d="M21.7371 15.2903C21.5759 15.2895 21.4198 15.2337 21.2947 15.1321 21.1695 15.0305 21.0828 14.8892 21.049 14.7316S21.0362 14.4096 21.1086 14.2655C21.1811 14.1215 21.3005 14.0066 21.4472 13.9397L35.7199 7.47338 21.4578 1.34289C21.2943 1.26329 21.1678 1.12377 21.1045.953307 21.0412.78285 21.046.594558 21.1179.427547 21.1898.260535 21.3233.127641 21.4906.0564719 21.6579-.0146977 21.8462-.0186728 22.0164.045373L37.7492 6.80518C37.8747 6.8605 37.9814 6.95112 38.0563 7.06599S38.171 7.31503 38.171 7.45216 38.1312 7.72347 38.0563 7.83834C37.9814 7.95321 37.8747 8.04383 37.7492 8.09915L22.0306 15.2266C21.9388 15.2698 21.8385 15.2916 21.7371 15.2903z" fill="#db2e2e"></path><path d="M16.4339 15.2903C16.3379 15.2906 16.2429 15.2714 16.1546 15.2337L.421813 8.47393C.296339 8.41861.18966 8.32799.114767 8.21312.0398745 8.09825.0 7.96407.0 7.82694.0 7.68981.0398745 7.55564.114767 7.44077.18966 7.3259.296339 7.23528.421813 7.17995L16.1546.052465C16.3235-.0111265 16.5104-.00772359 16.6768.0619772 16.8433.131678 16.9768.2624 17.0501.427363 17.1233.592325 17.1306.779042 17.0706.949259 17.0106 1.11948 16.8878 1.26031 16.7274 1.34291L2.44763 7.80573 16.7132 13.9362C16.8612 14.0015 16.9823 14.1154 17.0565 14.2592 17.1306 14.4029 17.1532 14.5677 17.1205 14.7261 17.0878 14.8845 17.0019 15.0269 16.8769 15.1295 16.752 15.2322 16.5956 15.2889 16.4339 15.2903z" fill="#db2e2e"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 17.4328c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 13.9539C37.3908 13.8108 37.6564 13.6514 37.9118 13.4766 37.972 13.8833 37.972 14.2967 37.9118 14.7034 37.8022 15.1312 37.4875 15.4847 36.289 16.061 35.4617 16.4605 33.1531 17.408 30.5792 18.4687c-3.6167 1.4884-7.778 3.1819-9.0826 3.889C19.2587 23.4183 18.0284 23.4183 16.3137 22.644 15.4864 22.2021 12.4918 20.9117 9.39476 19.5611c-3.3198-1.446-6.75627-2.945-7.77802-3.4753C.22377 15.3575.153061 15.1948.160132 14.8271V13.8655L.513678 14.0564c1.311652.6647 7.219412 3.1819 11.486722 5.0204 2.1142.898 3.8112 1.6298 4.3769 1.8844C18.092 21.7319 19.3082 21.8733 21.5603 20.6748 22.7022 20.0808 25.9619 18.7409 29.1651 17.4328z" fill="#494c4d"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 24.5037c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 21.0248C37.3908 20.8817 37.6564 20.7223 37.9118 20.5475 37.972 20.9542 37.972 21.3676 37.9118 21.7743 37.8022 22.2021 37.4875 22.5557 36.289 23.1319 35.4617 23.5314 33.1531 24.4789 30.5792 25.5396c-3.6167 1.4884-7.778 3.1819-9.0826 3.889-2.2379 1.0606-3.4682 1.0606-5.1829.2864C15.4864 29.2801 12.4918 27.9755 9.39476 26.625c-3.3198-1.446-6.75627-2.9451-7.77802-3.4754C.22377 22.4213.153061 22.2587.160132 21.891V20.9364L.513678 21.1273C1.82533 21.792 7.73309 24.3092 12.0004 26.1477c2.1001.898 3.8006 1.6298 4.3663 1.8844C18.0814 28.8028 19.2976 28.9442 21.5497 27.7457 22.7022 27.1518 25.9619 25.8118 29.1651 24.5037z" fill="#494c4d"></path></svg>
                      </span>
                    
                    Redis Stack
                  </a>
                  
                    <a href="../stack/get-started.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Get started
                    </a>
                  
                    <a href="../stack/get-started/clients.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Stack clients
                    </a>
                  
                    <a href="../ui/insight.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      RedisInsight
                    </a>
                  
                    <a href="../stack/json.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      JSON
                    </a>
                  
                    <a href="../stack/search.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Search
                    </a>
                  
                    <a href="../stack/bloom.html" class=" pl-[1.875rem] flex items-center whitespace-nowrap rounded min-w-[10rem] pt-2 text-slate-500 hover:text-indigo-600 focus:text-slate-900 transition-colors">
                      
                      Probabilistic
                    </a>
                  
                </div>
              
            
          </dd>
        </dl>
        
        
        <dl class="lg:hidden">
          <dt class="sr-only">
            Docs
          </dt>
          <dd class="lg:hidden flex flex-col">
            
              
                <a href="../about.html" class="flex items-center mt-2">
                  Redis
                </a>
                
                  <a href="../getting-started.html" class="mt-2">
                    Get started
                  </a>
                
                  <a href="../data-types.html" class="mt-2">
                    Data types
                  </a>
                
                  <a href="../ui/cli.html" class="mt-2">
                    Redis CLI
                  </a>
                
                  <a href="../clients.html" class="mt-2">
                    Redis clients
                  </a>
                
                  <a href="../management/persistence.html" class="mt-2">
                    Persistence
                  </a>
                
                  <a href="../management/scaling.html" class="mt-2">
                    Scaling
                  </a>
                
                <hr class="opacity-10 mt-4 mb-2">
              
            
              
                <a href="../stack.html" class="flex items-center mt-2">
                  Redis Stack
                </a>
                
                  <a href="../stack/get-started.html" class="mt-2">
                    Get started
                  </a>
                
                  <a href="../stack/get-started/clients.html" class="mt-2">
                    Stack clients
                  </a>
                
                  <a href="../ui/insight.html" class="mt-2">
                    RedisInsight
                  </a>
                
                  <a href="../stack/json.html" class="mt-2">
                    JSON
                  </a>
                
                  <a href="../stack/search.html" class="mt-2">
                    Search
                  </a>
                
                  <a href="../stack/bloom.html" class="mt-2">
                    Probabilistic
                  </a>
                
                <hr class="opacity-10 mt-4 mb-2">
              
            
          </dd>
        </dl>
      
    
      

        
        <a href="../../commands.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Commands
        </a>

        
        <a href="../../commands.html" class="flex lg:hidden items-center mt-1.5">
          Commands
        </a>
      
    
      
        
        
        <dl class="hidden lg:flex group relative first:ml-auto ml-1 mt-3 mb-0 px-3 pt-2 pb-5 cursor-pointer">
          <dt class="sr-only uppercase lg:not-sr-only flex items-center justify-items-center group-hover:text-white/50 group-focus-within:text-white/50 whitespace-nowrap transition-colors" href="#">
            
            Resources
          </dt>
          <dd class="hidden lg:grid text-[0.8rem] lg:text-sm text-redis-neutral-800 absolute top-full -mt-1 right-[1000rem] p-2 group-hover:right-[unset] group-hover:-left-3 group-focus-within:right-[unset] group-focus-within:-left-3 bg-white rounded-lg border border-slate-500/10 bg-clip-padding shadow-md">
            
              
              <a href="../../resources/clients.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Clients
              </a>
              
            
              
              <a href="../../resources/libraries.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Libraries
              </a>
              
            
              
              <a href="../../resources/tools.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Tools
              </a>
              
            
              
              <a href="../../resources/modules.html" class=" px-3 flex items-center whitespace-nowrap rounded min-w-[10rem] py-1 text-slate-500 hover:text-slate-900 focus:text-slate-900 transition-colors">
                
                Modules
              </a>
              
            
          </dd>
        </dl>
        
        
        <dl class="lg:hidden">
          <dt class="sr-only">
            Resources
          </dt>
          <dd class="lg:hidden flex flex-col">
            
              
              <a href="../../resources/clients.html" class="mt-2">
                Clients
              </a>
              
            
              
              <a href="../../resources/libraries.html" class="mt-2">
                Libraries
              </a>
              
            
              
              <a href="../../resources/tools.html" class="mt-2">
                Tools
              </a>
              
            
              
              <a href="../../resources/modules.html" class="mt-2">
                Modules
              </a>
              
            
          </dd>
        </dl>
      
    
      

        
        <a href="../../community.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Community
        </a>

        
        <a href="../../community.html" class="flex lg:hidden items-center mt-1.5">
          Community
        </a>
      
    
      

        
        <a href="../../support.html" class="hidden uppercase rounded-sm lg:flex items-center justify-items-center first:ml-auto ml-1 px-3 py-2 rounded bg-transparent hover:text-white/50 focus:text-white/50 whitespace-nowrap transition-colors">
          
          
          Support
        </a>

        
        <a href="../../support.html" class="flex lg:hidden items-center mt-1.5">
          Support
        </a>
      
    
    
    <div class="flex flex-col lg:flex-row lg:ml-auto lg:space-x-2">
      <button id="search-button" type="button" class="rounded-sm w-full lg:w-auto transition-colors shrink-0 flex-1 lg:flex-none lg:ml-2 lg:mr-0 mt-4 lg:mt-0 inline-flex items-center px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 border-white/50 hover:text-indigo-600 focus:text-indigo-600 hover:bg-white focus:bg-white focus:ring-white">
        <svg class="w-[0.875rem] h-[0.875rem] mr-0.5" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <circle cx="10" cy="10" r="7"></circle>
          <line x1="21" y1="21" x2="15" y2="15"></line>
        </svg>
        <span class="sr-only">Quick search&amp;hellip…</span>
        <span class="lg:hidden xl:block flex-auto ml-1 mr-4" aria-hidden="">Search…</span>
        <script>
          if (navigator.appVersion.indexOf("Win") != -1 || navigator.appVersion.indexOf("Linux") != -1) {
            document.querySelector('[title="Command"]').textContent = "&#8963;";
          } 
        </script>
        <kbd class="font-sans font-semibold">
          <abbr title="Command" class="no-underline">⌘</abbr>&nbsp;K
        </kbd>
      </button>
      
        <a class="rounded-sm transition-colors shrink-0 inline-flex items-center justify-center mt-2 lg:mt-0 px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900
         border-transparent bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 focus:ring-indigo-600
        " href="../../download.html">
          Download
        </a>
      
        <a class="rounded-sm transition-colors shrink-0 inline-flex items-center justify-center mt-2 lg:mt-0 px-4 py-2 text-sm font-medium rounded border focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900
        
         border-white/50 hover:text-indigo-600 focus:text-indigo-600 hover:bg-white focus:bg-white focus:ring-white" href="http://redis.com/try-free/">
          Try Redis Cloud
        </a>
      
    </div>
	</nav>

  <button data-menu-toggle="" aria-expanded="false" class="menu-toggle block ml-auto lg:hidden relative z-50"> 
    <span class="sr-only">Open main menu</span> 
    <svg aria-hidden="true" role="img" viewBox="0 0 24 24" style="pointer-events: none; width: 24px; height: 24px;" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <line x1="4" y1="6" x2="20" y2="6"></line>
      <line x1="4" y1="12" x2="20" y2="12"></line>
      <line x1="4" y1="18" x2="20" y2="18"></line>
    </svg>
  </button>
</div>
    </header>

    
  <main class="docs w-full max-w-[85rem] mx-auto px-4 sm:px-6 lg:px-8 md:flex gap-16">
    

<div class="hidden md:block w-52 h-full shrink-0">
  <nav class="w-52 z-40 bg-white hidden md:block fixed top-28 pb-16 h-full max-h-[calc(100vh-7rem)] text-[0.8125rem] leading-7 font">
    <div class="absolute right-0 -top-28 z-[-1] h-screen border-r border-slate-200/50 bg-gradient-to-bl from-slate-50 via-slate-50 to-indigo-100 w-[17rem] xl:w-[calc(50vw-23rem)]"></div>
    <ul class="h-full max-h-[calc(100vh-7rem)] overflow-y-auto pr-6">
      
    <li>
      <a class="flex justify-between items-center truncate font-semibold text-slate-900" href="../../docs.html">
          <span>Documentation</span>
          
      </a>
        <ul class="">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../about.html">
          <span>About</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../getting-started.html">
          <span>Getting started</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../ui.html">
          <span>User interfaces</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../data-types.html">
          <span>Data types</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../clients.html">
          <span>Client quickstarts</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../manual.html">
          <span>Using Redis</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../management.html">
          <span>Managing Redis</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../reference.html">
          <span>Reference</span>
          
            
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400 rotate-90" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./command-tips.html">
          <span>Command tips</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate active text-indigo-600" href="./modules.html">
          <span>Modules API</span>
          
            
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400 rotate-90" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./modules/modules-api-ref.html">
          <span>API reference</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./modules/modules-blocking-ops.html">
          <span>Blocking commands</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./modules/modules-native-types.html">
          <span>Native types API</span>
          
      </a>
    </li>
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./sentinel-clients.html">
          <span>Sentinel clients</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./key-specs.html">
          <span>Command key specifications</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./protocol-spec.html">
          <span>Protocol spec</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./clients.html">
          <span>Client handling</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./eviction.html">
          <span>Eviction</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./command-arguments.html">
          <span>Command arguments</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./signals.html">
          <span>Signal handling</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./cluster-spec.html">
          <span>Cluster spec</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./gopher.html">
          <span>Gopher protocol</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./arm.html">
          <span>ARM support</span>
          
      </a>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="./internals.html">
          <span>Internals</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
        </ul>
    </li>
    <li>
      <a class="flex justify-between items-center truncate text-slate-600 hover:text-indigo-600" href="../stack.html">
          <span>Redis Stack</span>
          
            
            <svg class="shrink-0 h-[1.0rem] w-[1.0rem] stroke-slate-400" viewBox="0 0 20 20" fill="currentColor">
    <path d="M13.5355 10L6.46447 2.92893"></path>
    <path d="M6.46447 17.0711L13.5355 10"></path>
</svg>
            
          
      </a>
        <ul class="child-list">
          
        </ul>
    </li>
        </ul>
    </li>
    </ul>
  </nav>
</div>
    <div class="w-full max-w-[47rem] py-12">
      <nav class="flex" aria-label="Breadcrumb">
  <ol role="list" class="flex items-center space-x-2">
    
  
    
  
    
  
    
  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <a class="text-gray-400 hover:text-gray-500" href="../../../redis.io.html">
        <svg class="flex-shrink-0 h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
        </svg>
        <span class="sr-only">Home</span>
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../../docs.html">
        Documentation
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="../reference.html">
        Redis reference
      </a>
    
  </li>

  
  <li class="flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 pointer-events-none">
    
      <svg class="flex-shrink-0 h-5 w-5 mr-2 text-slate-300" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
      </svg>
      <a class="" href="./modules.html">
        Redis modules API
      </a>
    
  </li>

  </ol>
</nav>


      <section class="prose prose-slate w-full max-w-[47rem] py-12">
        <h1>Redis modules API</h1>
        <p class="text-lg -mt-5 mb-10">Introduction to writing Redis modules</p>
        <p>The modules documentation is composed of the following pages:</p>
<ul>
<li>Introduction to Redis modules (this file). An overview about Redis Modules system and API. It's a good idea to start your reading here.</li>
<li><a href="./modules/modules-native-types.html">Implementing native data types</a> covers the implementation of native data types into modules.</li>
<li><a href="./modules/modules-blocking-ops.html">Blocking operations</a> shows how to write blocking commands that will not reply immediately, but will block the client, without blocking the Redis server, and will provide a reply whenever will be possible.</li>
<li><a href="./modules/modules-api-ref.html">Redis modules API reference</a> is generated from module.c top comments of RedisModule functions. It is a good reference in order to understand how each function works.</li>
</ul>
<p>Redis modules make it possible to extend Redis functionality using external
modules, rapidly implementing new Redis commands with features
similar to what can be done inside the core itself.</p>
<p>Redis modules are dynamic libraries that can be loaded into Redis at
startup, or using the <a href="../../commands/module-load.html"><code>MODULE LOAD</code></a> command. Redis exports a C API, in the
form of a single C header file called <code>redismodule.h</code>. Modules are meant
to be written in C, however it will be possible to use C++ or other languages
that have C binding functionalities.</p>
<p>Modules are designed in order to be loaded into different versions of Redis,
so a given module does not need to be designed, or recompiled, in order to
run with a specific version of Redis. For this reason, the module will
register to the Redis core using a specific API version. The current API
version is "1".</p>
<p>This document is about an alpha version of Redis modules. API, functionalities
and other details may change in the future.</p>
<a class="dashAnchor" name="//apple_ref/Section/Loading%20modules"></a><h2 id="loading-modules">Loading modules</h2>
<p>In order to test the module you are developing, you can load the module
using the following <code>redis.conf</code> configuration directive:</p>
<pre><code>loadmodule /path/to/mymodule.so
</code></pre>
<p>It is also possible to load a module at runtime using the following command:</p>
<pre><code>MODULE LOAD /path/to/mymodule.so
</code></pre>
<p>In order to list all loaded modules, use:</p>
<pre><code>MODULE LIST
</code></pre>
<p>Finally, you can unload (and later reload if you wish) a module using the
following command:</p>
<pre><code>MODULE UNLOAD mymodule
</code></pre>
<p>Note that <code>mymodule</code> above is not the filename without the <code>.so</code> suffix, but
instead, the name the module used to register itself into the Redis core.
The name can be obtained using <a href="../../commands/module-list.html"><code>MODULE LIST</code></a>. However it is good practice
that the filename of the dynamic library is the same as the name the module
uses to register itself into the Redis core.</p>
<a class="dashAnchor" name="//apple_ref/Section/The%20simplest%20module%20you%20can%20write"></a><h2 id="the-simplest-module-you-can-write">The simplest module you can write</h2>
<p>In order to show the different parts of a module, here we'll show a very
simple module that implements a command that outputs a random number.</p>
<pre><code>#include "redismodule.h"
#include &lt;stdlib.h&gt;

int HelloworldRand_RedisCommand(RedisModuleCtx *ctx, RedisModuleString **argv, int argc) {
    RedisModule_ReplyWithLongLong(ctx,rand());
    return REDISMODULE_OK;
}

int RedisModule_OnLoad(RedisModuleCtx *ctx, RedisModuleString **argv, int argc) {
    if (RedisModule_Init(ctx,"helloworld",1,REDISMODULE_APIVER_1)
        == REDISMODULE_ERR) return REDISMODULE_ERR;

    if (RedisModule_CreateCommand(ctx,"helloworld.rand",
        HelloworldRand_RedisCommand, "fast random",
        0, 0, 0) == REDISMODULE_ERR)
        return REDISMODULE_ERR;

    return REDISMODULE_OK;
}
</code></pre>
<p>The example module has two functions. One implements a command called
HELLOWORLD.RAND. This function is specific of that module. However the
other function called <code>RedisModule_OnLoad()</code> must be present in each
Redis module. It is the entry point for the module to be initialized,
register its commands, and potentially other private data structures
it uses.</p>
<p>Note that it is a good idea for modules to call commands with the
name of the module followed by a dot, and finally the command name,
like in the case of <code>HELLOWORLD.RAND</code>. This way it is less likely to
have collisions.</p>
<p>Note that if different modules have colliding commands, they'll not be
able to work in Redis at the same time, since the function
<code>RedisModule_CreateCommand</code> will fail in one of the modules, so the module
loading will abort returning an error condition.</p>
<a class="dashAnchor" name="//apple_ref/Section/Module%20initialization"></a><h2 id="module-initialization">Module initialization</h2>
<p>The above example shows the usage of the function <code>RedisModule_Init()</code>.
It should be the first function called by the module <code>OnLoad</code> function.
The following is the function prototype:</p>
<pre><code>int RedisModule_Init(RedisModuleCtx *ctx, const char *modulename,
                     int module_version, int api_version);
</code></pre>
<p>The <code>Init</code> function announces the Redis core that the module has a given
name, its version (that is reported by <a href="../../commands/module-list.html"><code>MODULE LIST</code></a>), and that is willing
to use a specific version of the API.</p>
<p>If the API version is wrong, the name is already taken, or there are other
similar errors, the function will return <code>REDISMODULE_ERR</code>, and the module
<code>OnLoad</code> function should return ASAP with an error.</p>
<p>Before the <code>Init</code> function is called, no other API function can be called,
otherwise the module will segfault and the Redis instance will crash.</p>
<p>The second function called, <code>RedisModule_CreateCommand</code>, is used in order
to register commands into the Redis core. The following is the prototype:</p>
<pre><code>int RedisModule_CreateCommand(RedisModuleCtx *ctx, const char *name,
                              RedisModuleCmdFunc cmdfunc, const char *strflags,
                              int firstkey, int lastkey, int keystep);
</code></pre>
<p>As you can see, most Redis modules API calls all take as first argument
the <code>context</code> of the module, so that they have a reference to the module
calling it, to the command and client executing a given command, and so forth.</p>
<p>To create a new command, the above function needs the context, the command's
name, a pointer to the function implementing the command, the command's flags
and the positions of key names in the command's arguments.</p>
<p>The function that implements the command must have the following prototype:</p>
<pre><code>int mycommand(RedisModuleCtx *ctx, RedisModuleString **argv, int argc);
</code></pre>
<p>The command function arguments are just the context, that will be passed
to all the other API calls, the command argument vector, and total number
of arguments, as passed by the user.</p>
<p>As you can see, the arguments are provided as pointers to a specific data
type, the <code>RedisModuleString</code>. This is an opaque data type you have API
functions to access and use, direct access to its fields is never needed.</p>
<p>Zooming into the example command implementation, we can find another call:</p>
<pre><code>int RedisModule_ReplyWithLongLong(RedisModuleCtx *ctx, long long integer);
</code></pre>
<p>This function returns an integer to the client that invoked the command,
exactly like other Redis commands do, like for example <a href="../../commands/incr.html"><code>INCR</code></a> or <a href="../../commands/scard.html"><code>SCARD</code></a>.</p>
<a class="dashAnchor" name="//apple_ref/Section/Module%20cleanup"></a><h2 id="module-cleanup">Module cleanup</h2>
<p>In most cases, there is no need for special cleanup.
When a module is unloaded, Redis will automatically unregister commands and
unsubscribe from notifications.
However in the case where a module contains some persistent memory or
configuration, a module may include an optional <code>RedisModule_OnUnload</code>
function.
If a module provides this function, it will be invoked during the module unload
process.
The following is the function prototype:</p>
<pre><code>int RedisModule_OnUnload(RedisModuleCtx *ctx);
</code></pre>
<p>The <code>OnUnload</code> function may prevent module unloading by returning
<code>REDISMODULE_ERR</code>.
Otherwise, <code>REDISMODULE_OK</code> should be returned.</p>
<a class="dashAnchor" name="//apple_ref/Section/Setup%20and%20dependencies%20of%20a%20Redis%20module"></a><h2 id="setup-and-dependencies-of-a-redis-module">Setup and dependencies of a Redis module</h2>
<p>Redis modules don't depend on Redis or some other library, nor they
need to be compiled with a specific <code>redismodule.h</code> file. In order
to create a new module, just copy a recent version of <code>redismodule.h</code>
in your source tree, link all the libraries you want, and create
a dynamic library having the <code>RedisModule_OnLoad()</code> function symbol
exported.</p>
<p>The module will be able to load into different versions of Redis.</p>
<p>A module can be designed to support both newer and older Redis versions where certain API functions are not available in all versions.
If an API function is not implemented in the currently running Redis version, the function pointer is set to NULL.
This allows the module to check if a function exists before using it:</p>
<pre><code>if (RedisModule_SetCommandInfo != NULL) {
    RedisModule_SetCommandInfo(cmd, &amp;info);
}
</code></pre>
<p>In recent versions of <code>redismodule.h</code>, a convenience macro <code>RMAPI_FUNC_SUPPORTED(funcname)</code> is defined.
Using the macro or just comparing with NULL is a matter of personal preference.</p>
<h1 id="passing-configuration-parameters-to-redis-modules">Passing configuration parameters to Redis modules</h1>
<p>When the module is loaded with the <a href="../../commands/module-load.html"><code>MODULE LOAD</code></a> command, or using the
<code>loadmodule</code> directive in the <code>redis.conf</code> file, the user is able to pass
configuration parameters to the module by adding arguments after the module
file name:</p>
<pre><code>loadmodule mymodule.so foo bar 1234
</code></pre>
<p>In the above example the strings <code>foo</code>, <code>bar</code> and <code>1234</code> will be passed
to the module <code>OnLoad()</code> function in the <code>argv</code> argument as an array
of RedisModuleString pointers. The number of arguments passed is into <code>argc</code>.</p>
<p>The way you can access those strings will be explained in the rest of this
document. Normally the module will store the module configuration parameters
in some <code>static</code> global variable that can be accessed module wide, so that
the configuration can change the behavior of different commands.</p>
<a class="dashAnchor" name="//apple_ref/Section/Working%20with%20RedisModuleString%20objects"></a><h2 id="working-with-redismodulestring-objects">Working with RedisModuleString objects</h2>
<p>The command argument vector <code>argv</code> passed to module commands, and the
return value of other module APIs functions, are of type <code>RedisModuleString</code>.</p>
<p>Usually you directly pass module strings to other API calls, however sometimes
you may need to directly access the string object.</p>
<p>There are a few functions in order to work with string objects:</p>
<pre><code>const char *RedisModule_StringPtrLen(RedisModuleString *string, size_t *len);
</code></pre>
<p>The above function accesses a string by returning its pointer and setting its
length in <code>len</code>.
You should never write to a string object pointer, as you can see from the
<code>const</code> pointer qualifier.</p>
<p>However, if you want, you can create new string objects using the following
API:</p>
<pre><code>RedisModuleString *RedisModule_CreateString(RedisModuleCtx *ctx, const char *ptr, size_t len);
</code></pre>
<p>The string returned by the above command must be freed using a corresponding
call to <code>RedisModule_FreeString()</code>:</p>
<pre><code>void RedisModule_FreeString(RedisModuleString *str);
</code></pre>
<p>However if you want to avoid having to free strings, the automatic memory
management, covered later in this document, can be a good alternative, by
doing it for you.</p>
<p>Note that the strings provided via the argument vector <code>argv</code> never need
to be freed. You only need to free new strings you create, or new strings
returned by other APIs, where it is specified that the returned string must
be freed.</p>
<a class="dashAnchor" name="//apple_ref/Section/Creating%20strings%20from%20numbers%20or%20parsing%20strings%20as%20numbers"></a><h2 id="creating-strings-from-numbers-or-parsing-strings-as-numbers">Creating strings from numbers or parsing strings as numbers</h2>
<p>Creating a new string from an integer is a very common operation, so there
is a function to do this:</p>
<pre><code>RedisModuleString *mystr = RedisModule_CreateStringFromLongLong(ctx,10);
</code></pre>
<p>Similarly in order to parse a string as a number:</p>
<pre><code>long long myval;
if (RedisModule_StringToLongLong(ctx,argv[1],&amp;myval) == REDISMODULE_OK) {
    /* Do something with 'myval' */
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/Accessing%20Redis%20keys%20from%20modules"></a><h2 id="accessing-redis-keys-from-modules">Accessing Redis keys from modules</h2>
<p>Most Redis modules, in order to be useful, have to interact with the Redis
data space (this is not always true, for example an ID generator may
never touch Redis keys). Redis modules have two different APIs in order to
access the Redis data space, one is a low level API that provides very
fast access and a set of functions to manipulate Redis data structures.
The other API is more high level, and allows to call Redis commands and
fetch the result, similarly to how Lua scripts access Redis.</p>
<p>The high level API is also useful in order to access Redis functionalities
that are not available as APIs.</p>
<p>In general modules developers should prefer the low level API, because commands
implemented using the low level API run at a speed comparable to the speed
of native Redis commands. However there are definitely use cases for the
higher level API. For example often the bottleneck could be processing the
data and not accessing it.</p>
<p>Also note that sometimes using the low level API is not harder compared to
the higher level one.</p>
<a class="dashAnchor" name="//apple_ref/Section/Calling%20Redis%20commands"></a><h2 id="calling-redis-commands">Calling Redis commands</h2>
<p>The high level API to access Redis is the sum of the <code>RedisModule_Call()</code>
function, together with the functions needed in order to access the
reply object returned by <code>Call()</code>.</p>
<p><code>RedisModule_Call</code> uses a special calling convention, with a format specifier
that is used to specify what kind of objects you are passing as arguments
to the function.</p>
<p>Redis commands are invoked just using a command name and a list of arguments.
However when calling commands, the arguments may originate from different
kind of strings: null-terminated C strings, RedisModuleString objects as
received from the <code>argv</code> parameter in the command implementation, binary
safe C buffers with a pointer and a length, and so forth.</p>
<p>For example if I want to call <a href="../../commands/incrby.html"><code>INCRBY</code></a> using a first argument (the key)
a string received in the argument vector <code>argv</code>, which is an array
of RedisModuleString object pointers, and a C string representing the
number "10" as second argument (the increment), I'll use the following
function call:</p>
<pre><code>RedisModuleCallReply *reply;
reply = RedisModule_Call(ctx,"INCRBY","sc",argv[1],"10");
</code></pre>
<p>The first argument is the context, and the second is always a null terminated
C string with the command name. The third argument is the format specifier
where each character corresponds to the type of the arguments that will follow.
In the above case <code>"sc"</code> means a RedisModuleString object, and a null
terminated C string. The other arguments are just the two arguments as
specified. In fact <code>argv[1]</code> is a RedisModuleString and <code>"10"</code> is a null
terminated C string.</p>
<p>This is the full list of format specifiers:</p>
<ul>
<li><strong>c</strong> -- Null terminated C string pointer.</li>
<li><strong>b</strong> -- C buffer, two arguments needed: C string pointer and <code>size_t</code> length.</li>
<li><strong>s</strong> -- RedisModuleString as received in <code>argv</code> or by other Redis module APIs returning a RedisModuleString object.</li>
<li><strong>l</strong> -- Long long integer.</li>
<li><strong>v</strong> -- Array of RedisModuleString objects.</li>
<li><strong>!</strong> -- This modifier just tells the function to replicate the command to replicas and AOF. It is ignored from the point of view of arguments parsing.</li>
<li><strong>A</strong> -- This modifier, when <code>!</code> is given, tells to suppress AOF propagation: the command will be propagated only to replicas.</li>
<li><strong>R</strong> -- This modifier, when <code>!</code> is given, tells to suppress replicas propagation: the command will be propagated only to the AOF if enabled.</li>
</ul>
<p>The function returns a <code>RedisModuleCallReply</code> object on success, on
error NULL is returned.</p>
<p>NULL is returned when the command name is invalid, the format specifier uses
characters that are not recognized, or when the command is called with the
wrong number of arguments. In the above cases the <code>errno</code> var is set to <code>EINVAL</code>. NULL is also returned when, in an instance with Cluster enabled, the target
keys are about non local hash slots. In this case <code>errno</code> is set to <code>EPERM</code>.</p>
<a class="dashAnchor" name="//apple_ref/Section/Working%20with%20RedisModuleCallReply%20objects%2E"></a><h2 id="working-with-redismodulecallreply-objects">Working with RedisModuleCallReply objects.</h2>
<p><code>RedisModuleCall</code> returns reply objects that can be accessed using the
<code>RedisModule_CallReply*</code> family of functions.</p>
<p>In order to obtain the type or reply (corresponding to one of the data types
supported by the Redis protocol), the function <code>RedisModule_CallReplyType()</code>
is used:</p>
<pre><code>reply = RedisModule_Call(ctx,"INCRBY","sc",argv[1],"10");
if (RedisModule_CallReplyType(reply) == REDISMODULE_REPLY_INTEGER) {
    long long myval = RedisModule_CallReplyInteger(reply);
    /* Do something with myval. */
}
</code></pre>
<p>Valid reply types are:</p>
<ul>
<li><code>REDISMODULE_REPLY_STRING</code> Bulk string or status replies.</li>
<li><code>REDISMODULE_REPLY_ERROR</code> Errors.</li>
<li><code>REDISMODULE_REPLY_INTEGER</code> Signed 64 bit integers.</li>
<li><code>REDISMODULE_REPLY_ARRAY</code> Array of replies.</li>
<li><code>REDISMODULE_REPLY_NULL</code> NULL reply.</li>
</ul>
<p>Strings, errors and arrays have an associated length. For strings and errors
the length corresponds to the length of the string. For arrays the length
is the number of elements. To obtain the reply length the following function
is used:</p>
<pre><code>size_t reply_len = RedisModule_CallReplyLength(reply);
</code></pre>
<p>In order to obtain the value of an integer reply, the following function is used, as already shown in the example above:</p>
<pre><code>long long reply_integer_val = RedisModule_CallReplyInteger(reply);
</code></pre>
<p>Called with a reply object of the wrong type, the above function always
returns <code>LLONG_MIN</code>.</p>
<p>Sub elements of array replies are accessed this way:</p>
<pre><code>RedisModuleCallReply *subreply;
subreply = RedisModule_CallReplyArrayElement(reply,idx);
</code></pre>
<p>The above function returns NULL if you try to access out of range elements.</p>
<p>Strings and errors (which are like strings but with a different type) can
be accessed using in the following way, making sure to never write to
the resulting pointer (that is returned as a <code>const</code> pointer so that
misusing must be pretty explicit):</p>
<pre><code>size_t len;
char *ptr = RedisModule_CallReplyStringPtr(reply,&amp;len);
</code></pre>
<p>If the reply type is not a string or an error, NULL is returned.</p>
<p>RedisCallReply objects are not the same as module string objects
(RedisModuleString types). However sometimes you may need to pass replies
of type string or integer, to API functions expecting a module string.</p>
<p>When this is the case, you may want to evaluate if using the low level
API could be a simpler way to implement your command, or you can use
the following function in order to create a new string object from a
call reply of type string, error or integer:</p>
<pre><code>RedisModuleString *mystr = RedisModule_CreateStringFromCallReply(myreply);
</code></pre>
<p>If the reply is not of the right type, NULL is returned.
The returned string object should be released with <code>RedisModule_FreeString()</code>
as usually, or by enabling automatic memory management (see corresponding
section).</p>
<a class="dashAnchor" name="//apple_ref/Section/Releasing%20call%20reply%20objects"></a><h2 id="releasing-call-reply-objects">Releasing call reply objects</h2>
<p>Reply objects must be freed using <code>RedisModule_FreeCallReply</code>. For arrays,
you need to free only the top level reply, not the nested replies.
Currently the module implementation provides a protection in order to avoid
crashing if you free a nested reply object for error, however this feature
is not guaranteed to be here forever, so should not be considered part
of the API.</p>
<p>If you use automatic memory management (explained later in this document)
you don't need to free replies (but you still could if you wish to release
memory ASAP).</p>
<a class="dashAnchor" name="//apple_ref/Section/Returning%20values%20from%20Redis%20commands"></a><h2 id="returning-values-from-redis-commands">Returning values from Redis commands</h2>
<p>Like normal Redis commands, new commands implemented via modules must be
able to return values to the caller. The API exports a set of functions for
this goal, in order to return the usual types of the Redis protocol, and
arrays of such types as elements. Also errors can be returned with any
error string and code (the error code is the initial uppercase letters in
the error message, like the "BUSY" string in the "BUSY the sever is busy" error
message).</p>
<p>All the functions to send a reply to the client are called
<code>RedisModule_ReplyWith&lt;something&gt;</code>.</p>
<p>To return an error, use:</p>
<pre><code>RedisModule_ReplyWithError(RedisModuleCtx *ctx, const char *err);
</code></pre>
<p>There is a predefined error string for key of wrong type errors:</p>
<pre><code>REDISMODULE_ERRORMSG_WRONGTYPE
</code></pre>
<p>Example usage:</p>
<pre><code>RedisModule_ReplyWithError(ctx,"ERR invalid arguments");
</code></pre>
<p>We already saw how to reply with a <code>long long</code> in the examples above:</p>
<pre><code>RedisModule_ReplyWithLongLong(ctx,12345);
</code></pre>
<p>To reply with a simple string, that can't contain binary values or newlines,
(so it's suitable to send small words, like "OK") we use:</p>
<pre><code>RedisModule_ReplyWithSimpleString(ctx,"OK");
</code></pre>
<p>It's possible to reply with "bulk strings" that are binary safe, using
two different functions:</p>
<pre><code>int RedisModule_ReplyWithStringBuffer(RedisModuleCtx *ctx, const char *buf, size_t len);

int RedisModule_ReplyWithString(RedisModuleCtx *ctx, RedisModuleString *str);
</code></pre>
<p>The first function gets a C pointer and length. The second a RedisModuleString
object. Use one or the other depending on the source type you have at hand.</p>
<p>In order to reply with an array, you just need to use a function to emit the
array length, followed by as many calls to the above functions as the number
of elements of the array are:</p>
<pre><code>RedisModule_ReplyWithArray(ctx,2);
RedisModule_ReplyWithStringBuffer(ctx,"age",3);
RedisModule_ReplyWithLongLong(ctx,22);
</code></pre>
<p>To return nested arrays is easy, your nested array element just uses another
call to <code>RedisModule_ReplyWithArray()</code> followed by the calls to emit the
sub array elements.</p>
<a class="dashAnchor" name="//apple_ref/Section/Returning%20arrays%20with%20dynamic%20length"></a><h2 id="returning-arrays-with-dynamic-length">Returning arrays with dynamic length</h2>
<p>Sometimes it is not possible to know beforehand the number of items of
an array. As an example, think of a Redis module implementing a FACTOR
command that given a number outputs the prime factors. Instead of
factorializing the number, storing the prime factors into an array, and
later produce the command reply, a better solution is to start an array
reply where the length is not known, and set it later. This is accomplished
with a special argument to <code>RedisModule_ReplyWithArray()</code>:</p>
<pre><code>RedisModule_ReplyWithArray(ctx, REDISMODULE_POSTPONED_LEN);
</code></pre>
<p>The above call starts an array reply so we can use other <code>ReplyWith</code> calls
in order to produce the array items. Finally in order to set the length,
use the following call:</p>
<pre><code>RedisModule_ReplySetArrayLength(ctx, number_of_items);
</code></pre>
<p>In the case of the FACTOR command, this translates to some code similar
to this:</p>
<pre><code>RedisModule_ReplyWithArray(ctx, REDISMODULE_POSTPONED_LEN);
number_of_factors = 0;
while(still_factors) {
    RedisModule_ReplyWithLongLong(ctx, some_factor);
    number_of_factors++;
}
RedisModule_ReplySetArrayLength(ctx, number_of_factors);
</code></pre>
<p>Another common use case for this feature is iterating over the arrays of
some collection and only returning the ones passing some kind of filtering.</p>
<p>It is possible to have multiple nested arrays with postponed reply.
Each call to <code>SetArray()</code> will set the length of the latest corresponding
call to <code>ReplyWithArray()</code>:</p>
<pre><code>RedisModule_ReplyWithArray(ctx, REDISMODULE_POSTPONED_LEN);
... generate 100 elements ...
RedisModule_ReplyWithArray(ctx, REDISMODULE_POSTPONED_LEN);
... generate 10 elements ...
RedisModule_ReplySetArrayLength(ctx, 10);
RedisModule_ReplySetArrayLength(ctx, 100);
</code></pre>
<p>This creates a 100 items array having as last element a 10 items array.</p>
<a class="dashAnchor" name="//apple_ref/Section/Arity%20and%20type%20checks"></a><h2 id="arity-and-type-checks">Arity and type checks</h2>
<p>Often commands need to check that the number of arguments and type of the key
is correct. In order to report a wrong arity, there is a specific function
called <code>RedisModule_WrongArity()</code>. The usage is trivial:</p>
<pre><code>if (argc != 2) return RedisModule_WrongArity(ctx);
</code></pre>
<p>Checking for the wrong type involves opening the key and checking the type:</p>
<pre><code>RedisModuleKey *key = RedisModule_OpenKey(ctx,argv[1],
    REDISMODULE_READ|REDISMODULE_WRITE);

int keytype = RedisModule_KeyType(key);
if (keytype != REDISMODULE_KEYTYPE_STRING &amp;&amp;
    keytype != REDISMODULE_KEYTYPE_EMPTY)
{
    RedisModule_CloseKey(key);
    return RedisModule_ReplyWithError(ctx,REDISMODULE_ERRORMSG_WRONGTYPE);
}
</code></pre>
<p>Note that you often want to proceed with a command both if the key
is of the expected type, or if it's empty.</p>
<a class="dashAnchor" name="//apple_ref/Section/Low%20level%20access%20to%20keys"></a><h2 id="low-level-access-to-keys">Low level access to keys</h2>
<p>Low level access to keys allow to perform operations on value objects associated
to keys directly, with a speed similar to what Redis uses internally to
implement the built-in commands.</p>
<p>Once a key is opened, a key pointer is returned that will be used with all the
other low level API calls in order to perform operations on the key or its
associated value.</p>
<p>Because the API is meant to be very fast, it cannot do too many run-time
checks, so the user must be aware of certain rules to follow:</p>
<ul>
<li>Opening the same key multiple times where at least one instance is opened for writing, is undefined and may lead to crashes.</li>
<li>While a key is open, it should only be accessed via the low level key API. For example opening a key, then calling DEL on the same key using the <code>RedisModule_Call()</code> API will result into a crash. However it is safe to open a key, perform some operation with the low level API, closing it, then using other APIs to manage the same key, and later opening it again to do some more work.</li>
</ul>
<p>In order to open a key the <code>RedisModule_OpenKey</code> function is used. It returns
a key pointer, that we'll use with all the next calls to access and modify
the value:</p>
<pre><code>RedisModuleKey *key;
key = RedisModule_OpenKey(ctx,argv[1],REDISMODULE_READ);
</code></pre>
<p>The second argument is the key name, that must be a <code>RedisModuleString</code> object.
The third argument is the mode: <code>REDISMODULE_READ</code> or <code>REDISMODULE_WRITE</code>.
It is possible to use <code>|</code> to bitwise OR the two modes to open the key in
both modes. Currently a key opened for writing can also be accessed for reading
but this is to be considered an implementation detail. The right mode should
be used in sane modules.</p>
<p>You can open non existing keys for writing, since the keys will be created
when an attempt to write to the key is performed. However when opening keys
just for reading, <code>RedisModule_OpenKey</code> will return NULL if the key does not
exist.</p>
<p>Once you are done using a key, you can close it with:</p>
<pre><code>RedisModule_CloseKey(key);
</code></pre>
<p>Note that if automatic memory management is enabled, you are not forced to
close keys. When the module function returns, Redis will take care to close
all the keys which are still open.</p>
<a class="dashAnchor" name="//apple_ref/Section/Getting%20the%20key%20type"></a><h2 id="getting-the-key-type">Getting the key type</h2>
<p>In order to obtain the value of a key, use the <code>RedisModule_KeyType()</code> function:</p>
<pre><code>int keytype = RedisModule_KeyType(key);
</code></pre>
<p>It returns one of the following values:</p>
<pre><code>REDISMODULE_KEYTYPE_EMPTY
REDISMODULE_KEYTYPE_STRING
REDISMODULE_KEYTYPE_LIST
REDISMODULE_KEYTYPE_HASH
REDISMODULE_KEYTYPE_SET
REDISMODULE_KEYTYPE_ZSET
</code></pre>
<p>The above are just the usual Redis key types, with the addition of an empty
type, that signals the key pointer is associated with an empty key that
does not yet exists.</p>
<a class="dashAnchor" name="//apple_ref/Section/Creating%20new%20keys"></a><h2 id="creating-new-keys">Creating new keys</h2>
<p>To create a new key, open it for writing and then write to it using one
of the key writing functions. Example:</p>
<pre><code>RedisModuleKey *key;
key = RedisModule_OpenKey(ctx,argv[1],REDISMODULE_WRITE);
if (RedisModule_KeyType(key) == REDISMODULE_KEYTYPE_EMPTY) {
    RedisModule_StringSet(key,argv[2]);
}
</code></pre>
<a class="dashAnchor" name="//apple_ref/Section/Deleting%20keys"></a><h2 id="deleting-keys">Deleting keys</h2>
<p>Just use:</p>
<pre><code>RedisModule_DeleteKey(key);
</code></pre>
<p>The function returns <code>REDISMODULE_ERR</code> if the key is not open for writing.
Note that after a key gets deleted, it is setup in order to be targeted
by new key commands. For example <code>RedisModule_KeyType()</code> will return it is
an empty key, and writing to it will create a new key, possibly of another
type (depending on the API used).</p>
<a class="dashAnchor" name="//apple_ref/Section/Managing%20key%20expires%20%28TTLs%29"></a><h2 id="managing-key-expires-ttls">Managing key expires (TTLs)</h2>
<p>To control key expires two functions are provided, that are able to set,
modify, get, and unset the time to live associated with a key.</p>
<p>One function is used in order to query the current expire of an open key:</p>
<pre><code>mstime_t RedisModule_GetExpire(RedisModuleKey *key);
</code></pre>
<p>The function returns the time to live of the key in milliseconds, or
<code>REDISMODULE_NO_EXPIRE</code> as a special value to signal the key has no associated
expire or does not exist at all (you can differentiate the two cases checking
if the key type is <code>REDISMODULE_KEYTYPE_EMPTY</code>).</p>
<p>In order to change the expire of a key the following function is used instead:</p>
<pre><code>int RedisModule_SetExpire(RedisModuleKey *key, mstime_t expire);
</code></pre>
<p>When called on a non existing key, <code>REDISMODULE_ERR</code> is returned, because
the function can only associate expires to existing open keys (non existing
open keys are only useful in order to create new values with data type
specific write operations).</p>
<p>Again the <code>expire</code> time is specified in milliseconds. If the key has currently
no expire, a new expire is set. If the key already have an expire, it is
replaced with the new value.</p>
<p>If the key has an expire, and the special value <code>REDISMODULE_NO_EXPIRE</code> is
used as a new expire, the expire is removed, similarly to the Redis
<a href="../../commands/persist.html"><code>PERSIST</code></a> command. In case the key was already persistent, no operation is
performed.</p>
<a class="dashAnchor" name="//apple_ref/Section/Obtaining%20the%20length%20of%20values"></a><h2 id="obtaining-the-length-of-values">Obtaining the length of values</h2>
<p>There is a single function in order to retrieve the length of the value
associated to an open key. The returned length is value-specific, and is
the string length for strings, and the number of elements for the aggregated
data types (how many elements there is in a list, set, sorted set, hash).</p>
<pre><code>size_t len = RedisModule_ValueLength(key);
</code></pre>
<p>If the key does not exist, 0 is returned by the function:</p>
<a class="dashAnchor" name="//apple_ref/Section/String%20type%20API"></a><h2 id="string-type-api">String type API</h2>
<p>Setting a new string value, like the Redis <a href="../../commands/set.html"><code>SET</code></a> command does, is performed
using:</p>
<pre><code>int RedisModule_StringSet(RedisModuleKey *key, RedisModuleString *str);
</code></pre>
<p>The function works exactly like the Redis <a href="../../commands/set.html"><code>SET</code></a> command itself, that is, if
there is a prior value (of any type) it will be deleted.</p>
<p>Accessing existing string values is performed using DMA (direct memory
access) for speed. The API will return a pointer and a length, so that's
possible to access and, if needed, modify the string directly.</p>
<pre><code>size_t len, j;
char *myptr = RedisModule_StringDMA(key,&amp;len,REDISMODULE_WRITE);
for (j = 0; j &lt; len; j++) myptr[j] = 'A';
</code></pre>
<p>In the above example we write directly on the string. Note that if you want
to write, you must be sure to ask for <code>WRITE</code> mode.</p>
<p>DMA pointers are only valid if no other operations are performed with the key
before using the pointer, after the DMA call.</p>
<p>Sometimes when we want to manipulate strings directly, we need to change
their size as well. For this scope, the <code>RedisModule_StringTruncate</code> function
is used. Example:</p>
<pre><code>RedisModule_StringTruncate(mykey,1024);
</code></pre>
<p>The function truncates, or enlarges the string as needed, padding it with
zero bytes if the previous length is smaller than the new length we request.
If the string does not exist since <code>key</code> is associated to an open empty key,
a string value is created and associated to the key.</p>
<p>Note that every time <code>StringTruncate()</code> is called, we need to re-obtain
the DMA pointer again, since the old may be invalid.</p>
<a class="dashAnchor" name="//apple_ref/Section/List%20type%20API"></a><h2 id="list-type-api">List type API</h2>
<p>It's possible to push and pop values from list values:</p>
<pre><code>int RedisModule_ListPush(RedisModuleKey *key, int where, RedisModuleString *ele);
RedisModuleString *RedisModule_ListPop(RedisModuleKey *key, int where);
</code></pre>
<p>In both the APIs the <code>where</code> argument specifies if to push or pop from tail
or head, using the following macros:</p>
<pre><code>REDISMODULE_LIST_HEAD
REDISMODULE_LIST_TAIL
</code></pre>
<p>Elements returned by <code>RedisModule_ListPop()</code> are like strings created with
<code>RedisModule_CreateString()</code>, they must be released with
<code>RedisModule_FreeString()</code> or by enabling automatic memory management.</p>
<a class="dashAnchor" name="//apple_ref/Section/Set%20type%20API"></a><h2 id="set-type-api">Set type API</h2>
<p>Work in progress.</p>
<a class="dashAnchor" name="//apple_ref/Section/Sorted%20set%20type%20API"></a><h2 id="sorted-set-type-api">Sorted set type API</h2>
<p>Documentation missing, please refer to the top comments inside <code>module.c</code>
for the following functions:</p>
<ul>
<li><code>RedisModule_ZsetAdd</code></li>
<li><code>RedisModule_ZsetIncrby</code></li>
<li><code>RedisModule_ZsetScore</code></li>
<li><code>RedisModule_ZsetRem</code></li>
</ul>
<p>And for the sorted set iterator:</p>
<ul>
<li><code>RedisModule_ZsetRangeStop</code></li>
<li><code>RedisModule_ZsetFirstInScoreRange</code></li>
<li><code>RedisModule_ZsetLastInScoreRange</code></li>
<li><code>RedisModule_ZsetFirstInLexRange</code></li>
<li><code>RedisModule_ZsetLastInLexRange</code></li>
<li><code>RedisModule_ZsetRangeCurrentElement</code></li>
<li><code>RedisModule_ZsetRangeNext</code></li>
<li><code>RedisModule_ZsetRangePrev</code></li>
<li><code>RedisModule_ZsetRangeEndReached</code></li>
</ul>
<a class="dashAnchor" name="//apple_ref/Section/Hash%20type%20API"></a><h2 id="hash-type-api">Hash type API</h2>
<p>Documentation missing, please refer to the top comments inside <code>module.c</code>
for the following functions:</p>
<ul>
<li><code>RedisModule_HashSet</code></li>
<li><code>RedisModule_HashGet</code></li>
</ul>
<a class="dashAnchor" name="//apple_ref/Section/Iterating%20aggregated%20values"></a><h2 id="iterating-aggregated-values">Iterating aggregated values</h2>
<p>Work in progress.</p>
<a class="dashAnchor" name="//apple_ref/Section/Replicating%20commands"></a><h2 id="replicating-commands">Replicating commands</h2>
<p>If you want to use module commands exactly like normal Redis commands, in the
context of replicated Redis instances, or using the AOF file for persistence,
it is important for module commands to handle their replication in a consistent
way.</p>
<p>When using the higher level APIs to invoke commands, replication happens
automatically if you use the "!" modifier in the format string of
<code>RedisModule_Call()</code> as in the following example:</p>
<pre><code>reply = RedisModule_Call(ctx,"INCRBY","!sc",argv[1],"10");
</code></pre>
<p>As you can see the format specifier is <code>"!sc"</code>. The bang is not parsed as a
format specifier, but it internally flags the command as "must replicate".</p>
<p>If you use the above programming style, there are no problems.
However sometimes things are more complex than that, and you use the low level
API. In this case, if there are no side effects in the command execution, and
it consistently always performs the same work, what is possible to do is to
replicate the command verbatim as the user executed it. To do that, you just
need to call the following function:</p>
<pre><code>RedisModule_ReplicateVerbatim(ctx);
</code></pre>
<p>When you use the above API, you should not use any other replication function
since they are not guaranteed to mix well.</p>
<p>However this is not the only option. It's also possible to exactly tell
Redis what commands to replicate as the effect of the command execution, using
an API similar to <code>RedisModule_Call()</code> but that instead of calling the command
sends it to the AOF / replicas stream. Example:</p>
<pre><code>RedisModule_Replicate(ctx,"INCRBY","cl","foo",my_increment);
</code></pre>
<p>It's possible to call <code>RedisModule_Replicate</code> multiple times, and each
will emit a command. All the sequence emitted is wrapped between a
<code>MULTI/EXEC</code> transaction, so that the AOF and replication effects are the
same as executing a single command.</p>
<p>Note that <code>Call()</code> replication and <code>Replicate()</code> replication have a rule,
in case you want to mix both forms of replication (not necessarily a good
idea if there are simpler approaches). Commands replicated with <code>Call()</code>
are always the first emitted in the final <code>MULTI/EXEC</code> block, while all
the commands emitted with <code>Replicate()</code> will follow.</p>
<a class="dashAnchor" name="//apple_ref/Section/Automatic%20memory%20management"></a><h2 id="automatic-memory-management">Automatic memory management</h2>
<p>Normally when writing programs in the C language, programmers need to manage
memory manually. This is why the Redis modules API has functions to release
strings, close open keys, free replies, and so forth.</p>
<p>However given that commands are executed in a contained environment and
with a set of strict APIs, Redis is able to provide automatic memory management
to modules, at the cost of some performance (most of the time, a very low
cost).</p>
<p>When automatic memory management is enabled:</p>
<ol>
<li>You don't need to close open keys.</li>
<li>You don't need to free replies.</li>
<li>You don't need to free RedisModuleString objects.</li>
</ol>
<p>However you can still do it, if you want. For example, automatic memory
management may be active, but inside a loop allocating a lot of strings,
you may still want to free strings no longer used.</p>
<p>In order to enable automatic memory management, just call the following
function at the start of the command implementation:</p>
<pre><code>RedisModule_AutoMemory(ctx);
</code></pre>
<p>Automatic memory management is usually the way to go, however experienced
C programmers may not use it in order to gain some speed and memory usage
benefit.</p>
<a class="dashAnchor" name="//apple_ref/Section/Allocating%20memory%20into%20modules"></a><h2 id="allocating-memory-into-modules">Allocating memory into modules</h2>
<p>Normal C programs use <code>malloc()</code> and <code>free()</code> in order to allocate and
release memory dynamically. While in Redis modules the use of malloc is
not technically forbidden, it is a lot better to use the Redis Modules
specific functions, that are exact replacements for <code>malloc</code>, <code>free</code>,
<code>realloc</code> and <code>strdup</code>. These functions are:</p>
<pre><code>void *RedisModule_Alloc(size_t bytes);
void* RedisModule_Realloc(void *ptr, size_t bytes);
void RedisModule_Free(void *ptr);
void RedisModule_Calloc(size_t nmemb, size_t size);
char *RedisModule_Strdup(const char *str);
</code></pre>
<p>They work exactly like their <code>libc</code> equivalent calls, however they use
the same allocator Redis uses, and the memory allocated using these
functions is reported by the <a href="../../commands/info.html"><code>INFO</code></a> command in the memory section, is
accounted when enforcing the <code>maxmemory</code> policy, and in general is
a first citizen of the Redis executable. On the contrary, the method
allocated inside modules with libc <code>malloc()</code> is transparent to Redis.</p>
<p>Another reason to use the modules functions in order to allocate memory
is that, when creating native data types inside modules, the RDB loading
functions can return deserialized strings (from the RDB file) directly
as <code>RedisModule_Alloc()</code> allocations, so they can be used directly to
populate data structures after loading, instead of having to copy them
to the data structure.</p>
<a class="dashAnchor" name="//apple_ref/Section/Pool%20allocator"></a><h2 id="pool-allocator">Pool allocator</h2>
<p>Sometimes in commands implementations, it is required to perform many
small allocations that will be not retained at the end of the command
execution, but are just functional to execute the command itself.</p>
<p>This work can be more easily accomplished using the Redis pool allocator:</p>
<pre><code>void *RedisModule_PoolAlloc(RedisModuleCtx *ctx, size_t bytes);
</code></pre>
<p>It works similarly to <code>malloc()</code>, and returns memory aligned to the
next power of two of greater or equal to <code>bytes</code> (for a maximum alignment
of 8 bytes). However it allocates memory in blocks, so it the overhead
of the allocations is small, and more important, the memory allocated
is automatically released when the command returns.</p>
<p>So in general short living allocations are a good candidates for the pool
allocator.</p>
<a class="dashAnchor" name="//apple_ref/Section/Writing%20commands%20compatible%20with%20Redis%20Cluster"></a><h2 id="writing-commands-compatible-with-redis-cluster">Writing commands compatible with Redis Cluster</h2>
<p>Documentation missing, please check the following functions inside <code>module.c</code>:</p>
<pre><code>RedisModule_IsKeysPositionRequest(ctx);
RedisModule_KeyAtPos(ctx,pos);
</code></pre>

        <nav>
          
            <a href="./modules/modules-api-ref.html">Modules API reference</a>
            <p>Reference for the Redis Modules API</p>
          
            <a href="./modules/modules-blocking-ops.html">Redis modules and blocking commands</a>
            <p>How to implement blocking commands in a Redis module</p>
          
            <a href="./modules/modules-native-types.html">Modules API for native types</a>
            <p>How to use native types in a Redis module</p>
          
        </nav>
          
  <form class="page-feedback" method="POST" name="page-feedback"><input type="hidden" name="form-name" value="page-feedback">
    <input name="origin" value="https://redis.io/docs/reference/modules/" class="hidden">
  <div class="grid justify-center mt-10 pt-10 border-t-2">
    <span class="font-bold font-small">Rate this page</span>
    <div class="star-rating">
      
      <input type="radio" id="5-stars" name="rating" value="5" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="5-stars" class="star">★</label>
      
      <input type="radio" id="4-stars" name="rating" value="4" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="4-stars" class="star">★</label>
      
      <input type="radio" id="3-stars" name="rating" value="3" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="3-stars" class="star">★</label>
      
      <input type="radio" id="2-stars" name="rating" value="2" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="2-stars" class="star">★</label>
      
      <input type="radio" id="1-stars" name="rating" value="1" onchange="document.querySelector('#feedback-form').classList.remove('hidden')">
      <label for="1-stars" class="star">★</label>
      
    </div>  
  </div>
  <div id="feedback-form" class="hidden">
    <div class="feedback-submit">
      <textarea name="comment" placeholder="Why did you choose this rating?" class="border border-neutral-500 p-2 mt-1 block w-full h-24" rows="3"></textarea>
      <button class="button button-indigo w-min justify-self-end" type="submit">
        Submit
      </button>
    </div>
  </div>
</form>
      </section>
    </div>
    

  <section class="hidden xl:block w-52 h-full shrink-0">
    <div class="w-52 z-40 hidden bg-white/75 md:block overflow-auto fixed top-28 h-full max-h-[calc(100vh-15rem)] text-[0.8125rem]">
      





<nav class="flex flex-col gap-1 mb-6 pb-2 border-b-2">
  <a href="https://github.com/redis/redis-doc/edit/master/docs/reference/modules/_index.md" target="_blank" class="group inline-flex items-center gap-1 text-sm text-slate-700 hover:text-indigo-600 mt-auto self-start">
    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
      <path d="M11 44q-1.2 0-2.1-.9Q8 42.2 8 41V7q0-1.2.9-2.1Q9.8 4 11 4h17l12 12v7.8h-3V18H26V7H11v34h15v3Zm0-3V7v34Zm26.8-11.15 1.4 1.4-8.2 8.2V42h2.55l8.2-8.2 1.4 1.4-8.8 8.8H29v-5.35Zm5.35 5.35-5.35-5.35 3.05-3.05q.45-.45 1.05-.45.6 0 1.05.45l3.25 3.25q.45.45.45 1.05 0 .6-.45 1.05Z" fill="currentColor"></path>
    </svg>
    Edit this page
  </a>
  <a href="https://github.com/redis/redis-doc/issues/new?title=Redis%20modules%20API" target="_blank" class="group inline-flex items-center gap-1 text-sm text-slate-700 hover:text-indigo-600 mt-auto self-start">
    <svg class="w-4 h-4" viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="currentColor"></path>
    </svg>
    Create an issue
  </a>
</nav>


      
        <h1 class="font-semibold my-3">On This Page</h1>
        <nav class="text-slate-700">
          <nav id="TableOfContents">
  <ul>
    <li><a href="#loading-modules">Loading modules</a></li>
    <li><a href="#the-simplest-module-you-can-write">The simplest module you can write</a></li>
    <li><a href="#module-initialization">Module initialization</a></li>
    <li><a href="#module-cleanup">Module cleanup</a></li>
    <li><a href="#setup-and-dependencies-of-a-redis-module">Setup and dependencies of a Redis module</a></li>
  </ul>

  <ul>
    <li><a href="#working-with-redismodulestring-objects">Working with RedisModuleString objects</a></li>
    <li><a href="#creating-strings-from-numbers-or-parsing-strings-as-numbers">Creating strings from numbers or parsing strings as numbers</a></li>
    <li><a href="#accessing-redis-keys-from-modules">Accessing Redis keys from modules</a></li>
    <li><a href="#calling-redis-commands">Calling Redis commands</a></li>
    <li><a href="#working-with-redismodulecallreply-objects">Working with RedisModuleCallReply objects.</a></li>
    <li><a href="#releasing-call-reply-objects">Releasing call reply objects</a></li>
    <li><a href="#returning-values-from-redis-commands">Returning values from Redis commands</a></li>
    <li><a href="#returning-arrays-with-dynamic-length">Returning arrays with dynamic length</a></li>
    <li><a href="#arity-and-type-checks">Arity and type checks</a></li>
    <li><a href="#low-level-access-to-keys">Low level access to keys</a></li>
    <li><a href="#getting-the-key-type">Getting the key type</a></li>
    <li><a href="#creating-new-keys">Creating new keys</a></li>
    <li><a href="#deleting-keys">Deleting keys</a></li>
    <li><a href="#managing-key-expires-ttls">Managing key expires (TTLs)</a></li>
    <li><a href="#obtaining-the-length-of-values">Obtaining the length of values</a></li>
    <li><a href="#string-type-api">String type API</a></li>
    <li><a href="#list-type-api">List type API</a></li>
    <li><a href="#set-type-api">Set type API</a></li>
    <li><a href="#sorted-set-type-api">Sorted set type API</a></li>
    <li><a href="#hash-type-api">Hash type API</a></li>
    <li><a href="#iterating-aggregated-values">Iterating aggregated values</a></li>
    <li><a href="#replicating-commands">Replicating commands</a></li>
    <li><a href="#automatic-memory-management">Automatic memory management</a></li>
    <li><a href="#allocating-memory-into-modules">Allocating memory into modules</a></li>
    <li><a href="#pool-allocator">Pool allocator</a></li>
    <li><a href="#writing-commands-compatible-with-redis-cluster">Writing commands compatible with Redis Cluster</a></li>
  </ul>
</nav>
        </nav>
        
    </div>
  </section>


  </main>


    <footer class="bg-midnight-700 relative z-50">
      <p class="container max-w-[85rem] mx-auto px-4 sm:px-8 py-8 text-slate-400 text-sm text-center">
  This is a community website sponsored by <a href="https://redis.com/" class="text-white underline underline-offset-1 decoration-transparent hover:decoration-slate-500 transition-colors">Redis Ltd.</a> © 2023. Redis and the cube logo are registered trademarks of Redis Ltd. <a href="../../terms.html" class="text-white underline underline-offset-1 decoration-transparent hover:decoration-slate-500 transition-colors">Terms of use &amp; privacy policy</a>.
</p>

      <script>
  
  document.addEventListener('DOMContentLoaded', () => {

    const TableOfContents = {
      container: document.querySelector('#TableOfContents'),
      links: null,
      headings: null,
      intersectionOptions: {
        rootMargin: '0px',
        threshold: 1
      },
      previousSection: null,
      observer: null,

      init() {
        if (!this.container) return false

        this.handleObserver = this.handleObserver.bind(this)
        this.setUpObserver()
        this.findLinksAndHeadings()
        this.observeSections()
      },

      handleObserver(entries, observer) {
        entries.forEach(entry => {
          let href = `#${entry.target.getAttribute('id')}`
          let link = this.links.find(l => l.getAttribute('href') === href)

          if (entry.isIntersecting && entry.intersectionRatio >= 1) {
            link.classList.add('visible')
            this.previousSection = entry.target.getAttribute('id')
          } else {
            link.classList.remove('visible')
          }

          this.highlightFirstActive()
        })
      },

      highlightFirstActive() {
        let firstVisibleLink = this.container.querySelector('.visible')

        this.links.forEach(link => {
          link.classList.remove('active')
        })

        if (firstVisibleLink) {
          firstVisibleLink.classList.add('active')
        }

        if (!firstVisibleLink && this.previousSection) {
          this.container.querySelector(
            `a[href="#${this.previousSection}"]`
          ).classList.add('active')
        }
      },

      observeSections() {
        this.headings.forEach(heading => {
          this.observer.observe(heading)
        })
      },

      setUpObserver() {
        this.observer = new IntersectionObserver(
          this.handleObserver,
          this.intersectionOptions
        )
      },

      findLinksAndHeadings() {
        this.links = [...this.container.querySelectorAll('a')]
        this.headings = this.links.map(link => {
          let id = link.getAttribute('href')
          return document.querySelector(id)
        })
      }
    }

    TableOfContents.init()

})
</script>
    </footer>

    
<div class="sr-only w-screen h-screen fixed z-[200] top-0 left-0 cursor-auto flex flex-col bg-slate-900/75 p-4 sm:p-6 md:p-[10vh] lg:p-[12vh]" id="search-container" role="button" aria-expanded="true" aria-haspopup="listbox" aria-labelledby="search-label" tabindex="0">
  <div class="search-modal">
    <header class="search-bar">
      <form id="search-form" class="search-form">
        <label class="search-magnifier-label" for="search-input" id="search-label">
          <svg width="20" height="20" class="search-icon" viewBox="0 0 20 20">
            <path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </label>
        <div class="search-loading-indicator">
          <svg viewBox="0 0 38 38" stroke="currentColor" stroke-opacity=".5">
            <g fill="none" fill-rule="evenodd">
              <g transform="translate(1 1)" stroke-width="2">
                <circle stroke-opacity=".3" cx="18" cy="18" r="18"></circle>
                <path d="M36 18c0-9.94-8.06-18-18-18">
                  <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite"></animateTransform>
                </path>
              </g>
            </g>
          </svg>
        </div>
        <input class="search-input" aria-autocomplete="both" aria-labelledby="search-label" id="search-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search…" maxlength="64" type="search" value="">
        <button type="reset" title="Clear the query" class="search-reset" aria-label="Clear the query" hidden="">
          <svg width="20" height="20" viewBox="0 0 20 20">
            <path d="M10 10l5.09-5.09L10 10l5.09 5.09L10 10zm0 0L4.91 4.91 10 10l-5.09 5.09L10 10z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </button>
      </form>
      <button id="search-cancel" type="reset" aria-label="Cancel">
        Cancel
      </button>
    </header>
    <dl id="search-results" class="search-results" role="listbox"></dl>
    <footer class="search-footer">
      <a href="../stack/search.html" target="_blank" rel="noopener noreferrer">
        <span class="logo-label">Powered by Redis Stack</span>
        
        <svg viewBox="0 0 39 31" fill="none"><path d="M21.7371 15.2903C21.5759 15.2895 21.4198 15.2337 21.2947 15.1321 21.1695 15.0305 21.0828 14.8892 21.049 14.7316S21.0362 14.4096 21.1086 14.2655C21.1811 14.1215 21.3005 14.0066 21.4472 13.9397L35.7199 7.47338 21.4578 1.34289C21.2943 1.26329 21.1678 1.12377 21.1045.953307 21.0412.78285 21.046.594558 21.1179.427547 21.1898.260535 21.3233.127641 21.4906.0564719 21.6579-.0146977 21.8462-.0186728 22.0164.045373L37.7492 6.80518C37.8747 6.8605 37.9814 6.95112 38.0563 7.06599S38.171 7.31503 38.171 7.45216 38.1312 7.72347 38.0563 7.83834C37.9814 7.95321 37.8747 8.04383 37.7492 8.09915L22.0306 15.2266C21.9388 15.2698 21.8385 15.2916 21.7371 15.2903z" fill="#db2e2e"></path><path d="M16.4339 15.2903C16.3379 15.2906 16.2429 15.2714 16.1546 15.2337L.421813 8.47393C.296339 8.41861.18966 8.32799.114767 8.21312.0398745 8.09825.0 7.96407.0 7.82694.0 7.68981.0398745 7.55564.114767 7.44077.18966 7.3259.296339 7.23528.421813 7.17995L16.1546.052465C16.3235-.0111265 16.5104-.00772359 16.6768.0619772 16.8433.131678 16.9768.2624 17.0501.427363 17.1233.592325 17.1306.779042 17.0706.949259 17.0106 1.11948 16.8878 1.26031 16.7274 1.34291L2.44763 7.80573 16.7132 13.9362C16.8612 14.0015 16.9823 14.1154 17.0565 14.2592 17.1306 14.4029 17.1532 14.5677 17.1205 14.7261 17.0878 14.8845 17.0019 15.0269 16.8769 15.1295 16.752 15.2322 16.5956 15.2889 16.4339 15.2903z" fill="#db2e2e"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 17.4328c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 13.9539C37.3908 13.8108 37.6564 13.6514 37.9118 13.4766 37.972 13.8833 37.972 14.2967 37.9118 14.7034 37.8022 15.1312 37.4875 15.4847 36.289 16.061 35.4617 16.4605 33.1531 17.408 30.5792 18.4687c-3.6167 1.4884-7.778 3.1819-9.0826 3.889C19.2587 23.4183 18.0284 23.4183 16.3137 22.644 15.4864 22.2021 12.4918 20.9117 9.39476 19.5611c-3.3198-1.446-6.75627-2.945-7.77802-3.4753C.22377 15.3575.153061 15.1948.160132 14.8271V13.8655L.513678 14.0564c1.311652.6647 7.219412 3.1819 11.486722 5.0204 2.1142.898 3.8112 1.6298 4.3769 1.8844C18.092 21.7319 19.3082 21.8733 21.5603 20.6748 22.7022 20.0808 25.9619 18.7409 29.1651 17.4328z" fill="#494c4d"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M29.1651 24.5037c3.1288-1.2763 6.2047-2.5279 7.1875-3.0617L37.1163 21.0248C37.3908 20.8817 37.6564 20.7223 37.9118 20.5475 37.972 20.9542 37.972 21.3676 37.9118 21.7743 37.8022 22.2021 37.4875 22.5557 36.289 23.1319 35.4617 23.5314 33.1531 24.4789 30.5792 25.5396c-3.6167 1.4884-7.778 3.1819-9.0826 3.889-2.2379 1.0606-3.4682 1.0606-5.1829.2864C15.4864 29.2801 12.4918 27.9755 9.39476 26.625c-3.3198-1.446-6.75627-2.9451-7.77802-3.4754C.22377 22.4213.153061 22.2587.160132 21.891V20.9364L.513678 21.1273C1.82533 21.792 7.73309 24.3092 12.0004 26.1477c2.1001.898 3.8006 1.6298 4.3663 1.8844C18.0814 28.8028 19.2976 28.9442 21.5497 27.7457 22.7022 27.1518 25.9619 25.8118 29.1651 24.5037z" fill="#494c4d"></path></svg>
      </a>
    </footer>
  </div>
</div>

<script>
  const searchModal = (() => {
    const searchButton = document.querySelector('#search-button')
    const searchContainer = document.querySelector('#search-container')
    const searchInput = searchContainer.querySelector('#search-input')
    const resultsContainer = searchContainer.querySelector('#search-results')
    const style = document.createElement('style')
    
    let keys = {}
    let focusable
    let firstFocusable
    let lastFocusable
  
    function next (elem, selector) {
      let nextElem = elem.nextElementSibling
      if (!selector) return nextElem
      if (nextElem && nextElem.matches(selector)) return nextElem
      return null
    }
  
    function debounce(callback, delay) {
      let timeout
      
      return function() {
        clearTimeout(timeout)
        timeout = setTimeout(callback, delay)
      }
    }
  
    function searchSubmit(form) {
      if (form.id !== 'search-form') return false
  
      const searchTerm = searchInput.value
  
      if (searchTerm.length < 1) {
        resultsContainer.innerHTML = ''
        return
      }
  
      function search(url) {
        let promise = new Promise((resolve, reject) => {
          const req = new XMLHttpRequest()
          req.open('GET', url)
          req.onload = function() {
            if (req.status === 200) {
              resolve(JSON.parse(req.response))
            } else {
              reject(Error(req.status))
            }
          }
          req.send()
        })
  
        return promise
      }
  
      function sortData(data) {
        
        const getCategories = (data) =>
          data.reduce((a, c) => {
            if (!a.includes(c.hierarchy[0])) {
              a.push(c.hierarchy[0])
            }
  
            return a
          }, [])

        
        const constructSectionTitle = (record) => {
          if (record.hierarchy && record.hierarchy.length > 2) {
            return record.hierarchy[1]
          } else {
            return record.title
          }
        }

        
        const mergeData = (data, categories) =>
          categories.map((category) => {
            const obj = {}
            obj.category = category
  
            data.forEach((record) => {
              if (record.hierarchy[0] === category) {
                obj[record.title] = {
                  path: constructSectionTitle(record),
                  url: record.url,
                }
              }
            })
  
            return obj
          })
  
        return mergeData(data.results, getCategories(data.results))
      }
  
      function escape_evil_chars(str_in) {
        return str_in.replaceAll('>','&gt;').replaceAll('<', '&lt;').replaceAll('&', '&amp;').replaceAll('"','&quot;').replaceAll("'",'&#x27;')
      }   
      
      function displayData(data) {
        resultsContainer.innerHTML = ''
        
        if (data.results.length < 1) {
          escapedSearchTerm = escape_evil_chars(searchTerm)
          resultsContainer.insertAdjacentHTML(
            'beforeend',
            `<dt class="sr-only">${escapedSearchTerm}:</dt>
            <dd class="search-no-results">
              No results for \"<span class="search-title">${escapedSearchTerm}</span>\"
            </dd>`
          )
        } else {
          sortData(data).forEach((result) => {
            resultsContainer.insertAdjacentHTML(
              'beforeend', 
              `<dt class="search-item-source">
                ${result.category}
              </dt>`
            )
    
            delete result.category
    
            Object.keys(result).forEach((key, index) => {
              resultsContainer.insertAdjacentHTML(
                'beforeend',
                `<dd class="search-item" role="option">
                  <a href="${result[key].url}">
                    <span class="search-item-icon"></span>
                    <span class="search-item-content">
                      ${result[key].path ? `<span class="search-item-path">${result[key].path}</span>` : ''}
                      <span class="search-item-title">${key.replace(new RegExp(`(^|)(${searchTerm})(|$)`, 'ig'), '$1<b class="search-term-match">$2</b>$3')}</span>
                    </span>
                    <span class="search-item-action"></span>
                  </a>
                </dd>`
              )
            })
            
            if (!resultsContainer.querySelector('[aria-selected]')) resultsContainer.querySelector('.search-item').setAttribute('aria-selected', '')
          })
        }
        return
      }
  
      function displayError(error) {
        console.log(error)
      }
  
      search(`https://search-service.redislabs.com/search?q=${searchTerm}*&site=https://redis.io`)
        .then(displayData)
        .catch(displayError)
    }
  
    function loadHandler(event) {
      style.innerHTML = `
        [data-scroll-disabled="on"], 
        [data-scroll-disabled="on"] body {
          touch-action: none;
          overscroll-behavior: none;
          -webkit-overflow-scrolling: auto;
          overflow: hidden;
        }
  
        [data-scroll-disabled="on"] .sticky {
          position: fixed;
        }
      `
  
      document.head.appendChild(style)
      document.documentElement.dataset.searchState = 'off'
    }
  
    function getNextSibling(elem, selector, direction) {
      let sibling = direction === 'down' ? elem.nextElementSibling : elem.previousElementSibling
    
      while (sibling) {
        if (sibling.matches(selector)) return sibling
        sibling = direction === 'down' ? sibling.nextElementSibling : sibling.previousElementSibling
      }
    }
  
    function tabSelection(direction) {
      const currentSelection = resultsContainer.querySelector('[aria-selected]')
      if (!currentSelection || direction === 'down' && !currentSelection.nextElementSibling || direction === 'up' && !currentSelection.previousElementSibling) return false
        
      const nextSelection = getNextSibling(currentSelection, '.search-item', direction)
      if (!nextSelection) return false
      
      nextSelection.setAttribute('aria-selected', '')
      currentSelection.removeAttribute('aria-selected')
      resultsContainer.scrollTop = nextSelection.offsetTop - resultsContainer.offsetTop
    }
    
    function keyDownHandler(event) {
      switch (event.key) {
  
        // Arrow keys
        case 'ArrowDown':
          if (document.documentElement.dataset.searchState === 'off' || !document.querySelector('.search-item')) return false
          event.preventDefault()
          tabSelection('down')
          break
  
        case 'ArrowUp':
          if (document.documentElement.dataset.searchState === 'off' || !document.querySelector('.search-item')) return false
          event.preventDefault()
          tabSelection('up')
          break
  
        // Tab
        case 'Tab':
          if (document.documentElement.dataset.searchState === 'off') return false
  
          if (focusable.length === 1) {
            event.preventDefault()
            break
          }
  
          // If shift is fired, tab backward
          if (event.shiftKey) {
            if (document.activeElement === firstFocusable) {
              event.preventDefault()
              lastFocusable.focus()
            }
  
            // Otherwise tab forward
          } else {
            if (document.activeElement === lastFocusable) {
              event.preventDefault()
              firstFocusable.focus()
            }
          }
          break
  
        // Esc
        case 'Escape':
          if (document.documentElement.dataset.searchState === 'off') return false
          stopSearch()
          break
        
        // Enter
        case 'Enter':
          if (!document.querySelector('.search-item:focus-within') && document.querySelector('.search-item[aria-selected]')) {
            event.preventDefault()
            document.querySelector('.search-item[aria-selected] a').click()
          }
          break
  
        // Forward slash
        case '/':
          if (document.documentElement.dataset.searchState === 'on') return false
          event.preventDefault()
          startSearch()
          break
      
        // Default
        default:
          return false
          break
      }
    }
  
    function keyUpHandler(event) {
      if (document.documentElement.dataset.searchState === 'off' || !document.activeElement.matches('.search-input')) return false
      
      switch (event.key) {
        case 'ArrowDown':
          return false
          break
        case 'ArrowUp':
          return false
          break
        case 'ArrowLeft':
          return false
          break
        case 'ArrowRight':
          return false
          break
        case 'Tab':
          return false
          break
        case 'Escape':
          return false
          break
        case 'Enter':
          return false
          break
        case '/':
          return false
          break
        default:
          searchSubmit(document.activeElement.closest('form'))
          break
      }
    }
  
    function multiKeyHandler(event) {
      if (document.documentElement.dataset.searchState === 'on') return false
  
      let { key, type } = event
      let isKeyDown = (type == 'keydown')
      keys[key] = isKeyDown
  
      // Both (cmd || cntrl) & k pressed
      if (isKeyDown && (keys.Control || keys.Meta) && keys.k) {
        event.preventDefault()
        startSearch()
      }
    }
  
    // Click handler function
    function clickHandler(event) {
      if (event.target.closest('#search-button')) {
        startSearch()
      } else if (event.target.closest('#search-cancel') || event.target.matches('#search-container')) {
        stopSearch()
      }
    }
  
    function startSearch() {
      sessionStorage.setItem('scroll-position', document.documentElement.scrollTop)
      document.documentElement.dataset.scrollDisabled = 'on'
      document.documentElement.dataset.searchState = 'on'
      allowFocus(searchContainer, true)
      trapFocus(searchContainer)
      searchInput.focus()
    }
  
    function stopSearch() {
      document.documentElement.dataset.searchState = 'off'
      document.documentElement.dataset.scrollDisabled = 'off'
      document.documentElement.scrollTop = sessionStorage.getItem('scroll-position')
      allowFocus(searchContainer, false)
      document.activeElement.blur()
      resultsContainer.innerHTML = ''
      searchInput.value = ''
      keys = {}
    }
  
    function submitHandler(event) {
      if (event.target.id === 'search-form') {
        event.preventDefault()
        return false
      }
    }
  
    function allowFocus(selector, state) {
      const focusable = selector.querySelectorAll('button, [href], input, select, textarea')
      focusable.forEach(el => el.setAttribute('tabindex', state ? '' : '-1'))
      selector.classList.toggle('sr-only')
    }
  
    function trapFocus(selector) {
      focusable = selector.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"]')
      firstFocusable = focusable[0]
      lastFocusable = focusable[focusable.length - 1]
    }
  
    // Attach event listeners
    document.addEventListener('DOMContentLoaded', loadHandler)
    document.addEventListener('click', clickHandler)
    document.addEventListener('keydown', event => debounce(keyDownHandler(event), 100))
    document.addEventListener('keyup', event => debounce(keyUpHandler(event), 100))
    document.addEventListener('keydown', multiKeyHandler)
    document.addEventListener('keyup', multiKeyHandler)
    document.addEventListener('submit', submitHandler)
  })()
</script>
  

</body></html>