
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>How to capture warnings — pytest documentation</title>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../_static/basic.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments_pytest.css" rel="stylesheet" type="text/css"/>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
<script src="../_static/jquery.js"></script>
<script src="../_static/underscore.js"></script>
<script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="../_static/doctools.js"></script>
<script src="../_static/sphinx_highlight.js"></script>
<link href="../_static/favicon.png" rel="shortcut icon"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="skipping.html" rel="next" title="How to use skip and xfail to deal with tests that cannot succeed"/>
<link href="capture-stdout-stderr.html" rel="prev" title="How to capture stdout/stderr output"/>
<script>DOCUMENTATION_OPTIONS.URL_ROOT = '';</script>
</head><body>
<div aria-label="related navigation" class="related" role="navigation">
<h3>Navigation</h3>
<ul>
<li class="right" style="margin-right: 10px">
<a href="../py-modindex.html" title="Python Module Index">modules</a></li>
<li class="right">
<a accesskey="N" href="skipping.html" title="How to use skip and xfail to deal with tests that cannot succeed">next</a> |</li>
<li class="right">
<a accesskey="P" href="capture-stdout-stderr.html" title="How to capture stdout/stderr output">previous</a> |</li>
<li class="nav-item nav-item-0"><a href="../contents.html">pytest-7.3</a> »</li>
<li class="nav-item nav-item-this"><a href="">How to capture warnings</a></li>
</ul>
</div>
<div class="document">
<div class="documentwrapper">
<div class="body" role="main">
<section id="how-to-capture-warnings">
<a class="dashAnchor" name="//apple_ref/cpp/Section/How to capture warnings"></a><span id="warnings"></span><h1>How to capture warnings<a class="headerlink" href="#how-to-capture-warnings" title="Permalink to this heading">¶</a></h1>
<p>Starting from version <code class="docutils literal notranslate"><span class="pre">3.1</span></code>, pytest now automatically catches warnings during test execution
and displays them at the end of the session:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of test_show_warnings.py</span>
<span class="kn">import</span> <span class="nn">warnings</span>


<span class="k">def</span> <span class="nf">api_v1</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">(</span><span class="s2">"api v1, should use functions from v2"</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">test_one</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">api_v1</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Running pytest now produces this output:</p>
<div class="highlight-pytest notranslate"><div class="highlight"><pre><span></span>$ pytest test_show_warnings.py
<span class="-Color -Color-Bold">=========================== test session starts ============================</span>
platform linux -- Python 3.x.y, pytest-7.x.y, pluggy-1.x.y
rootdir: /home/sweet/project
collected 1 item

test_show_warnings.py <span class="-Color -Color-Green">.</span>                                              <span class="-Color -Color-Green">[100%]</span>

<span class="-Color -Color-Yellow">============================= warnings summary =============================</span>
test_show_warnings.py::test_one
  /home/sweet/project/test_show_warnings.py:5: UserWarning: api v1, should use functions from v2
    warnings.warn(UserWarning("api v1, should use functions from v2"))

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
<span class="-Color -Color-Yellow">======================= </span><span class="-Color -Color-Green">1 passed</span>, <span class="-Color -Color-Bold -Color-Bold-Yellow">1 warning</span><span class="-Color -Color-Yellow"> in 0.12s =======================</span>
</pre></div>
</div>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Controlling warnings"></a><section id="controlling-warnings">
<span id="id1"></span><h2>Controlling warnings<a class="headerlink" href="#controlling-warnings" title="Permalink to this heading">¶</a></h2>
<p>Similar to Python’s <a class="reference external" href="https://docs.python.org/3/library/warnings.html#warning-filter">warning filter</a> and <a class="reference external" href="https://docs.python.org/3/using/cmdline.html#cmdoption-W" title="(in Python v3.11)"><code class="xref std std-option docutils literal notranslate"><span class="pre">-W</span> <span class="pre">option</span></code></a> flag, pytest provides
its own <code class="docutils literal notranslate"><span class="pre">-W</span></code> flag to control which warnings are ignored, displayed, or turned into
errors. See the <a class="reference external" href="https://docs.python.org/3/library/warnings.html#warning-filter">warning filter</a> documentation for more
advanced use-cases.</p>
<p>This code sample shows how to treat any <code class="docutils literal notranslate"><span class="pre">UserWarning</span></code> category class of warning
as an error:</p>
<div class="highlight-pytest notranslate"><div class="highlight"><pre><span></span>$ pytest -q test_show_warnings.py -W error::UserWarning
<span class="-Color -Color-Red">F</span>                                                                    <span class="-Color -Color-Red">[100%]</span>
================================= FAILURES =================================
<span class="-Color -Color-Bold -Color-Bold-Red">_________________________________ test_one _________________________________</span>

    def test_one():
&gt;       assert api_v1() == 1

<span class="-Color -Color-Bold -Color-Bold-Red">test_show_warnings.py</span>:10:
<span class="-Color -Color-Bold -Color-Bold-Red">_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _</span>

    def api_v1():
&gt;       warnings.warn(UserWarning("api v1, should use functions from v2"))
<span class="-Color -Color-Bold -Color-Bold-Red">E       UserWarning: api v1, should use functions from v2</span>

<span class="-Color -Color-Bold -Color-Bold-Red">test_show_warnings.py</span>:5: UserWarning
<span class="-Color -Color-Bold -Color-Bold-Cyan">========================= short test summary info ==========================</span>
<span class="-Color -Color-Red">FAILED</span> test_show_warnings.py::<span class="-Color -Color-Bold">test_one</span> - UserWarning: api v1, should use ...
<span class="-Color -Color-Bold -Color-Bold-Red">1 failed</span><span class="-Color -Color-Red"> in 0.12s</span>
</pre></div>
</div>
<p>The same option can be set in the <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code> or <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file using the
<code class="docutils literal notranslate"><span class="pre">filterwarnings</span></code> ini option. For example, the configuration below will ignore all
user warnings and specific deprecation warnings matching a regex, but will transform
all other warnings into errors.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">filterwarnings</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="na">error</span>
<span class="w">    </span><span class="na">ignore</span><span class="o">:</span><span class="s">:UserWarning</span>
<span class="w">    </span><span class="na">ignore</span><span class="o">:</span><span class="s">function ham\(\) is deprecated:DeprecationWarning</span>
</pre></div>
</div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="c1"># pyproject.toml</span>
<span class="k">[tool.pytest.ini_options]</span>
<span class="n">filterwarnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s">"error"</span><span class="p">,</span>
<span class="w">    </span><span class="s">"ignore::UserWarning"</span><span class="p">,</span>
<span class="w">    </span><span class="c1"># note the use of single quote below to denote "raw" strings in TOML</span>
<span class="w">    </span><span class="s">'ignore:function ham\(\) is deprecated:DeprecationWarning'</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>When a warning matches more than one option in the list, the action for the last matching option
is performed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-W</span></code> flag and the <code class="docutils literal notranslate"><span class="pre">filterwarnings</span></code> ini option use warning filters that are
similar in structure, but each configuration option interprets its filter
differently. For example, <em>message</em> in <code class="docutils literal notranslate"><span class="pre">filterwarnings</span></code> is a string containing a
regular expression that the start of the warning message must match,
case-insensitively, while <em>message</em> in <code class="docutils literal notranslate"><span class="pre">-W</span></code> is a literal string that the start of
the warning message must contain (case-insensitively), ignoring any whitespace at
the start or end of message. Consult the <a class="reference external" href="https://docs.python.org/3/library/warnings.html#warning-filter">warning filter</a> documentation for more
details.</p>
</div>
</section>
<section id="pytest-mark-filterwarnings">
<a class="dashAnchor" name="//apple_ref/cpp/Section/@pytest.mark.filterwarnings"></a><span id="filterwarnings"></span><h2><code class="docutils literal notranslate"><span class="pre">@pytest.mark.filterwarnings</span></code><a class="headerlink" href="#pytest-mark-filterwarnings" title="Permalink to this heading">¶</a></h2>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">@pytest.mark.filterwarnings</span></code> to add warning filters to specific test items,
allowing you to have finer control of which warnings should be captured at test, class or
even module level:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>


<span class="k">def</span> <span class="nf">api_v1</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">(</span><span class="s2">"api v1, should use functions from v2"</span><span class="p">))</span>
    <span class="k">return</span> <span class="mi">1</span>


<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore:api v1"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_one</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">api_v1</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Filters applied using a mark take precedence over filters passed on the command line or configured
by the <code class="docutils literal notranslate"><span class="pre">filterwarnings</span></code> ini option.</p>
<p>You may apply a filter to all tests of a class by using the <code class="docutils literal notranslate"><span class="pre">filterwarnings</span></code> mark as a class
decorator or to all tests in a module by setting the <a class="reference internal" href="../reference/reference.html#globalvar-pytestmark"><code class="xref std std-globalvar docutils literal notranslate"><span class="pre">pytestmark</span></code></a> variable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># turns all warnings into errors for this module</span>
<span class="n">pytestmark</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"error"</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Credits go to Florian Schulze for the reference implementation in the</em> <a class="reference external" href="https://github.com/fschulze/pytest-warnings">pytest-warnings</a>
<em>plugin.</em></p>
</section>
<section id="disabling-warnings-summary">
<h2>Disabling warnings summary<a class="headerlink" href="#disabling-warnings-summary" title="Permalink to this heading">¶</a></h2>
<p>Although not recommended, you can use the <code class="docutils literal notranslate"><span class="pre">--disable-warnings</span></code> command-line option to suppress the
warning summary entirely from the test run output.</p>
</section>
<section id="disabling-warning-capture-entirely">
<h2>Disabling warning capture entirely<a class="headerlink" href="#disabling-warning-capture-entirely" title="Permalink to this heading">¶</a></h2>
<p>This plugin is enabled by default but can be disabled entirely in your <code class="docutils literal notranslate"><span class="pre">pytest.ini</span></code> file with:</p>
<blockquote>
<div><div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[pytest]</span>
<span class="na">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">-p no:warnings</span>
</pre></div>
</div>
</div></blockquote>
<p>Or passing <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">no:warnings</span></code> in the command-line. This might be useful if your test suites handles warnings
using an external system.</p>
</section>
<section id="deprecationwarning-and-pendingdeprecationwarning">
<a class="dashAnchor" name="//apple_ref/cpp/Section/DeprecationWarning and PendingDeprecationWarning"></a><span id="deprecation-warnings"></span><h2>DeprecationWarning and PendingDeprecationWarning<a class="headerlink" href="#deprecationwarning-and-pendingdeprecationwarning" title="Permalink to this heading">¶</a></h2>
<p>By default pytest will display <code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> and <code class="docutils literal notranslate"><span class="pre">PendingDeprecationWarning</span></code> warnings from
user code and third-party libraries, as recommended by <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0565/"><strong>PEP 565</strong></a>.
This helps users keep their code modern and avoid breakages when deprecated warnings are effectively removed.</p>
<p>However, in the specific case where users capture any type of warnings in their test, either with
<a class="reference internal" href="../reference/reference.html#pytest.warns" title="pytest.warns"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.warns()</span></code></a>, <a class="reference internal" href="../reference/reference.html#pytest.deprecated_call" title="pytest.deprecated_call"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.deprecated_call()</span></code></a> or using the <a class="reference internal" href="#recwarn"><span class="std std-ref">recwarn</span></a> fixture,
no warning will be displayed at all.</p>
<p>Sometimes it is useful to hide some specific deprecation warnings that happen in code that you have no control over
(such as third-party libraries), in which case you might use the warning filters options (ini or marks) to ignore
those warnings.</p>
<p>For example:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[pytest]</span>
<span class="na">filterwarnings</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="na">ignore</span><span class="o">:</span><span class="s">.*U.*mode is deprecated:DeprecationWarning</span>
</pre></div>
</div>
<p>This will ignore all warnings of type <code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> where the start of the message matches
the regular expression <code class="docutils literal notranslate"><span class="pre">".*U.*mode</span> <span class="pre">is</span> <span class="pre">deprecated"</span></code>.</p>
<p>See <a class="reference internal" href="#filterwarnings"><span class="std std-ref">@pytest.mark.filterwarnings</span></a> and
<a class="reference internal" href="#controlling-warnings"><span class="std std-ref">Controlling warnings</span></a> for more examples.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If warnings are configured at the interpreter level, using
the <span class="target" id="index-1"></span><a class="reference external" href="https://docs.python.org/3/using/cmdline.html#envvar-PYTHONWARNINGS" title="(in Python v3.11)"><code class="docutils literal notranslate"><span class="pre">PYTHONWARNINGS</span></code></a> environment variable or the
<code class="docutils literal notranslate"><span class="pre">-W</span></code> command-line option, pytest will not configure any filters by default.</p>
<p>Also pytest doesn’t follow <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0506/"><strong>PEP 506</strong></a> suggestion of resetting all warning filters because
it might break test suites that configure warning filters themselves
by calling <a class="reference external" href="https://docs.python.org/3/library/warnings.html#warnings.simplefilter" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">warnings.simplefilter()</span></code></a> (see <a class="reference external" href="https://github.com/pytest-dev/pytest/issues/2430">issue #2430</a> for an example of that).</p>
</div>
</section>
<section id="ensuring-code-triggers-a-deprecation-warning">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Ensuring code triggers a deprecation warning"></a><span id="ensuring-function-triggers"></span><a class="dashAnchor" name="//apple_ref/cpp/Section/Ensuring code triggers a deprecation warning"></a><span id="ensuring-a-function-triggers-a-deprecation-warning"></span><h2>Ensuring code triggers a deprecation warning<a class="headerlink" href="#ensuring-code-triggers-a-deprecation-warning" title="Permalink to this heading">¶</a></h2>
<p>You can also use <a class="reference internal" href="../reference/reference.html#pytest.deprecated_call" title="pytest.deprecated_call"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.deprecated_call()</span></code></a> for checking
that a certain function call triggers a <code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> or
<code class="docutils literal notranslate"><span class="pre">PendingDeprecationWarning</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="k">def</span> <span class="nf">test_myfunction_deprecated</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">deprecated_call</span><span class="p">():</span>
        <span class="n">myfunction</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
</pre></div>
</div>
<p>This test will fail if <code class="docutils literal notranslate"><span class="pre">myfunction</span></code> does not issue a deprecation warning
when called with a <code class="docutils literal notranslate"><span class="pre">17</span></code> argument.</p>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Asserting warnings with the warns function"></a><section id="warns">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Asserting warnings with the warns function"></a><span id="asserting-warnings-with-the-warns-function"></span><a class="dashAnchor" name="//apple_ref/cpp/Section/Asserting warnings with the warns function"></a><span id="assertwarnings"></span><a class="dashAnchor" name="//apple_ref/cpp/Section/Asserting warnings with the warns function"></a><span id="asserting-warnings"></span><span id="id2"></span><h2>Asserting warnings with the warns function<a class="headerlink" href="#warns" title="Permalink to this heading">¶</a></h2>
<p>You can check that code raises a particular warning using <a class="reference internal" href="../reference/reference.html#pytest.warns" title="pytest.warns"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.warns()</span></code></a>,
which works in a similar manner to <a class="reference internal" href="assert.html#assertraises"><span class="std std-ref">raises</span></a> (except that
<a class="reference internal" href="assert.html#assertraises"><span class="std std-ref">raises</span></a> does not capture all exceptions, only the
<code class="docutils literal notranslate"><span class="pre">expected_exception</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">pytest</span>


<span class="k">def</span> <span class="nf">test_warning</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">"my warning"</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
</pre></div>
</div>
<p>The test will fail if the warning in question is not raised. Use the keyword
argument <code class="docutils literal notranslate"><span class="pre">match</span></code> to assert that the warning matches a text or regex.
To match a literal string that may contain regular expression metacharacters like <code class="docutils literal notranslate"><span class="pre">(</span></code> or <code class="docutils literal notranslate"><span class="pre">.</span></code>, the pattern can
first be escaped with <code class="docutils literal notranslate"><span class="pre">re.escape</span></code>.</p>
<p>Some examples:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">"must be 0 or None"</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">"value must be 0 or None"</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">r</span><span class="s2">"must be \d+$"</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">"value must be 42"</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="sa">r</span><span class="s2">"must be \d+$"</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">"this is not here"</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">Failed</span>: <span class="n">DID NOT WARN. No warnings of type ...UserWarning... were emitted...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">warns</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="s2">"issue with foo() func"</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">"issue with foo() func"</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>You can also call <a class="reference internal" href="../reference/reference.html#pytest.warns" title="pytest.warns"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.warns()</span></code></a> on a function or code string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="n">expected_warning</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="n">expected_warning</span><span class="p">,</span> <span class="s2">"func(*args, **kwargs)"</span><span class="p">)</span>
</pre></div>
</div>
<p>The function also returns a list of all raised warnings (as
<code class="docutils literal notranslate"><span class="pre">warnings.WarningMessage</span></code> objects), which you can query for
additional information:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="ne">RuntimeWarning</span><span class="p">)</span> <span class="k">as</span> <span class="n">record</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">"another warning"</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>

<span class="c1"># check that only one warning was raised</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="c1"># check that the message matches</span>
<span class="k">assert</span> <span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"another warning"</span>
</pre></div>
</div>
<p>Alternatively, you can examine raised warnings in detail using the
<a class="reference internal" href="#recwarn"><span class="std std-ref">recwarn</span></a> fixture (see below).</p>
<p>The <a class="reference internal" href="#recwarn"><span class="std std-ref">recwarn</span></a> fixture automatically ensures to reset the warnings
filter at the end of the test, so no global state is leaked.</p>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Recording warnings"></a><section id="recwarn">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Recording warnings"></a><span id="recording-warnings"></span><span id="id3"></span><h2>Recording warnings<a class="headerlink" href="#recwarn" title="Permalink to this heading">¶</a></h2>
<p>You can record raised warnings either using <a class="reference internal" href="../reference/reference.html#pytest.warns" title="pytest.warns"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.warns()</span></code></a> or with
the <code class="docutils literal notranslate"><span class="pre">recwarn</span></code> fixture.</p>
<p>To record with <a class="reference internal" href="../reference/reference.html#pytest.warns" title="pytest.warns"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.warns()</span></code></a> without asserting anything about the warnings,
pass no arguments as the expected warning type and it will default to a generic Warning:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">()</span> <span class="k">as</span> <span class="n">record</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">"runtime"</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"user"</span>
<span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"runtime"</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">recwarn</span></code> fixture will record warnings for the whole function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>


<span class="k">def</span> <span class="nf">test_hello</span><span class="p">(</span><span class="n">recwarn</span><span class="p">):</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">recwarn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">recwarn</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">message</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"hello"</span>
    <span class="k">assert</span> <span class="n">w</span><span class="o">.</span><span class="n">filename</span>
    <span class="k">assert</span> <span class="n">w</span><span class="o">.</span><span class="n">lineno</span>
</pre></div>
</div>
<p>Both <code class="docutils literal notranslate"><span class="pre">recwarn</span></code> and <a class="reference internal" href="../reference/reference.html#pytest.warns" title="pytest.warns"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.warns()</span></code></a> return the same interface for recorded
warnings: a WarningsRecorder instance. To view the recorded warnings, you can
iterate over this instance, call <code class="docutils literal notranslate"><span class="pre">len</span></code> on it to get the number of recorded
warnings, or index into it to get a particular recorded warning.</p>
<p>Full API: <a class="reference internal" href="../reference/reference.html#pytest.WarningsRecorder" title="_pytest.recwarn.WarningsRecorder"><code class="xref py py-class docutils literal notranslate"><span class="pre">WarningsRecorder</span></code></a>.</p>
</section>
<section id="additional-use-cases-of-warnings-in-tests">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Additional use cases of warnings in tests"></a><span id="warns-use-cases"></span><h2>Additional use cases of warnings in tests<a class="headerlink" href="#additional-use-cases-of-warnings-in-tests" title="Permalink to this heading">¶</a></h2>
<p>Here are some use cases involving warnings that often come up in tests, and suggestions on how to deal with them:</p>
<ul class="simple">
<li><p>To ensure that <strong>at least one</strong> of the indicated warnings is issued, use:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_warning</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">((</span><span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)):</span>
        <span class="o">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p>To ensure that <strong>only</strong> certain warnings are issued, use:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_warning</span><span class="p">(</span><span class="n">recwarn</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">recwarn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">user_warning</span> <span class="o">=</span> <span class="n">recwarn</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">user_warning</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>To ensure that <strong>no</strong> warnings are emitted, use:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_warning</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">"error"</span><span class="p">)</span>
        <span class="o">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p>To suppress warnings, use:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Custom failure messages"></a><section id="custom-failure-messages">
<span id="id4"></span><h2>Custom failure messages<a class="headerlink" href="#custom-failure-messages" title="Permalink to this heading">¶</a></h2>
<p>Recording warnings provides an opportunity to produce custom test
failure messages for when no warnings are issued or other conditions
are met.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="ne">Warning</span><span class="p">)</span> <span class="k">as</span> <span class="n">record</span><span class="p">:</span>
        <span class="n">f</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="p">:</span>
            <span class="n">pytest</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">"Expected a warning!"</span><span class="p">)</span>
</pre></div>
</div>
<p>If no warnings are issued when calling <code class="docutils literal notranslate"><span class="pre">f</span></code>, then <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">record</span></code> will
evaluate to <code class="docutils literal notranslate"><span class="pre">True</span></code>.  You can then call <a class="reference internal" href="../reference/reference.html#pytest.fail" title="pytest.fail"><code class="xref py py-func docutils literal notranslate"><span class="pre">pytest.fail()</span></code></a> with a
custom error message.</p>
</section>
<section id="internal-pytest-warnings">
<a class="dashAnchor" name="//apple_ref/cpp/Section/Internal pytest warnings"></a><span id="internal-warnings"></span><h2>Internal pytest warnings<a class="headerlink" href="#internal-pytest-warnings" title="Permalink to this heading">¶</a></h2>
<p>pytest may generate its own warnings in some situations, such as improper usage or deprecated features.</p>
<p>For example, pytest will emit a warning if it encounters a class that matches <a class="reference internal" href="../reference/reference.html#confval-python_classes"><code class="xref std std-confval docutils literal notranslate"><span class="pre">python_classes</span></code></a> but also
defines an <code class="docutils literal notranslate"><span class="pre">__init__</span></code> constructor, as this prevents the class from being instantiated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of test_pytest_warnings.py</span>
<span class="k">class</span> <span class="nc">Test</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">test_foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-pytest notranslate"><div class="highlight"><pre><span></span>$ pytest test_pytest_warnings.py -q

<span class="-Color -Color-Yellow">============================= warnings summary =============================</span>
test_pytest_warnings.py:1
  /home/sweet/project/test_pytest_warnings.py:1: PytestCollectionWarning: cannot collect test class 'Test' because it has a __init__ constructor (from: test_pytest_warnings.py)
    class Test:

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
<span class="-Color -Color-Bold -Color-Bold-Yellow">1 warning</span><span class="-Color -Color-Yellow"> in 0.12s</span>
</pre></div>
</div>
<p>These warnings might be filtered using the same builtin mechanisms used to filter other types of warnings.</p>
<p>Please read our <a class="reference internal" href="../backwards-compatibility.html#backwards-compatibility"><span class="std std-ref">Backwards Compatibility Policy</span></a> to learn how we proceed about deprecating and eventually removing
features.</p>
<p>The full list of warnings is listed in <a class="reference internal" href="../reference/reference.html#warnings-ref"><span class="std std-ref">the reference documentation</span></a>.</p>
</section>
<a class="dashAnchor" name="//apple_ref/cpp/Section/Resource Warnings"></a><section id="resource-warnings">
<span id="id5"></span><h2>Resource Warnings<a class="headerlink" href="#resource-warnings" title="Permalink to this heading">¶</a></h2>
<p>Additional information of the source of a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ResourceWarning" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceWarning</span></code></a> can be obtained when captured by pytest if
<a class="reference external" href="https://docs.python.org/3/library/tracemalloc.html#module-tracemalloc" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tracemalloc</span></code></a> module is enabled.</p>
<p>One convenient way to enable <a class="reference external" href="https://docs.python.org/3/library/tracemalloc.html#module-tracemalloc" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tracemalloc</span></code></a> when running tests is to set the <span class="target" id="index-3"></span><a class="reference external" href="https://docs.python.org/3/using/cmdline.html#envvar-PYTHONTRACEMALLOC" title="(in Python v3.11)"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONTRACEMALLOC</span></code></a> to a large
enough number of frames (say <code class="docutils literal notranslate"><span class="pre">20</span></code>, but that number is application dependent).</p>
<p>For more information, consult the <a class="reference external" href="https://docs.python.org/3/library/devmode.html">Python Development Mode</a>
section in the Python documentation.</p>
</section>
</section>
<div class="clearer"></div>
</div>
</div>
<span id="sidebar-top"></span>
<div class="clearer"></div>
</div>
<div class="footer" role="contentinfo">
        © Copyright 2015, holger krekel and pytest-dev team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
<script src="../_static/version_warning_offset.js"></script>
</body>
</html>